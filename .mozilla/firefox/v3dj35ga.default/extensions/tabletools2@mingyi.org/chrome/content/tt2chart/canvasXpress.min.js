
/*
 * CanvasXpress 3.3 - JavaScript Canvas Library
 *
 * Copyright (c) 2009-2010 Isaac Neuhaus
 *
 * imnphd@gmail.com
 *
 * Redistributions of this source code must retain this copyright
 * notice and the following disclaimer.
 *  
 * CanvasXpress is licensed under the terms of the Open Source
 * LGPL 3.0 license. 
 * 
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 * 
 * Commercial use is permitted to the extent that this source code
 * do NOT become part of any other Open Source or Commercially licensed
 * development library or toolkit without explicit permission.
 * 
 * Network graphs were implemented based on the HeyGraph by Tom Martin
 * <http://www.heychinaski.com>.
 *
 * Thanks to Mingyi Liu for his contributions in extending the Ext panel
 * and adding major capabilities to the network graphs and animations.
 *
 */

var DumperIndent=1;var DumperIndentText=" ";var DumperNewline="\n";var DumperObject=null;var DumperMaxDepth=-1;var DumperIgnoreStandardObjects=true;var DumperProperties=null;var DumperTagProperties=new Object();function DumperGetArgs(b,d){var c=new Array();for(var e=d;e<b.length;e++){c[c.length]=b[e]}return c}function DumperPopup(b){var a=window.open("about:blank");a.document.open();a.document.writeln("<HTML><BODY><PRE>");a.document.writeln(Dumper(b,DumperGetArgs(arguments,1)));a.document.writeln("</PRE></BODY></HTML>");a.document.close()}function DumperAlert(a){alert(Dumper(a,DumperGetArgs(arguments,1)))}function DumperWrite(e){var f=1;var c=document;if(arguments.length>1&&arguments[1]==window.document){c=arguments[1];f=2}var a=DumperIndentText;var b=DumperGetArgs(arguments,f);DumperIndentText="&nbsp;";c.write(Dumper(e,b));DumperIndentText=a}function DumperPad(a){var b="";for(var c=0;c<a;c++){b+=DumperIndentText}return b}function Dumper(d){var a=1;var k=DumperIndent;var j="";if(arguments.length>1&&typeof(arguments[1])=="number"){a=arguments[1];k=arguments[2];if(d==DumperObject){return"[original object]"}}else{DumperObject=d;if(arguments.length>1){var h=arguments;var e=1;if(typeof(arguments[1])=="object"){h=arguments[1];e=0}for(var f=e;f<h.length;f++){if(DumperProperties==null){DumperProperties=new Object()}DumperProperties[h[f]]=1}}}if(DumperMaxDepth!=-1&&a>DumperMaxDepth){return"..."}if(DumperIgnoreStandardObjects){if(d==window||d==window.document){return"[Ignored Object]"}}if(d==null){j="[null]";return j}if(typeof(d)=="function"){j="[function]";return j}if(typeof(d)=="boolean"){j=(d)?"true":"false";return j}if(typeof(d)=="string"){j="'"+d+"'";return j}if(typeof(d)=="number"){j=d;return j}if(typeof(d)=="object"){if(typeof(d.length)=="number"){j="[";for(var f=0;f<d.length;f++){if(f>0){j+=","+DumperNewline+DumperPad(k)}else{j+=DumperNewline+DumperPad(k)}j+=Dumper(d[f],a+1,k-0+DumperIndent)}if(f>0){j+=DumperNewline+DumperPad(k-DumperIndent)}j+="]";return j}else{j="{";var g=0;for(f in d){if(d==DumperObject&&DumperProperties!=null&&DumperProperties[f]!=1){}else{if(typeof(d[f])!="unknown"){var c=true;if(typeof(d.tagName)!="undefined"){if(typeof(DumperTagProperties[d.tagName])!="undefined"){c=false;for(var b=0;b<DumperTagProperties[d.tagName].length;b++){if(DumperTagProperties[d.tagName][b]==f){c=true;break}}}}if(c){if(g++>0){j+=","+DumperNewline+DumperPad(k)}else{j+=DumperNewline+DumperPad(k)}j+="'"+f+"' => "+Dumper(d[f],a+1,k-0+f.length+6+DumperIndent)}}}}if(g>0){j+=DumperNewline+DumperPad(k-DumperIndent)}j+="}";return j}}};function str_repeat(b,a){for(var c=[];a>0;c[--a]=b){}return(c.join(""))}function sprintf(){var g=0,e,h=arguments[g++],k=[],d,j,l,b;while(h){if(d=/^[^\x25]+/.exec(h)){k.push(d[0])}else{if(d=/^\x25{2}/.exec(h)){k.push("%")}else{if(d=/^\x25(?:(\d+)\$)?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(h)){if(((e=arguments[d[1]||g++])==null)||(e==undefined)){throw ("Too few arguments.")}if(/[^s]/.test(d[7])&&(typeof(e)!="number")){throw ("Expecting number but found "+typeof(e))}switch(d[7]){case"b":e=e.toString(2);break;case"c":e=String.fromCharCode(e);break;case"d":e=parseInt(e);break;case"e":e=d[6]?e.toExponential(d[6]):e.toExponential();break;case"f":e=d[6]?parseFloat(e).toFixed(d[6]):parseFloat(e);break;case"o":e=e.toString(8);break;case"s":e=((e=String(e))&&d[6]?e.substring(0,d[6]):e);break;case"u":e=Math.abs(e);break;case"x":e=e.toString(16);break;case"X":e=e.toString(16).toUpperCase();break}e=(/[def]/.test(d[7])&&d[2]&&e>0?"+"+e:e);l=d[3]?d[3]=="0"?"0":d[3].charAt(1):" ";b=d[5]-String(e).length;j=d[5]?str_repeat(l,b):"";k.push(d[4]?e+j:j+e)}else{throw ("Huh ?!")}}}h=h.substring(d[0].length)}return k.join("")};var dateFormat=function(){var a=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,b=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,d=/[^-+\dA-Z]/g,c=function(f,e){f=String(f);e=e||2;while(f.length<e){f="0"+f}return f};return function(i,v,q){var g=dateFormat;if(arguments.length==1&&Object.prototype.toString.call(i)=="[object String]"&&!/\d/.test(i)){v=i;i=undefined}i=i?new Date(i):new Date;if(isNaN(i)){throw SyntaxError("invalid date")}v=String(g.masks[v]||v||g.masks["default"]);if(v.slice(0,4)=="UTC:"){v=v.slice(4);q=true}var t=q?"getUTC":"get",l=i[t+"Date"](),e=i[t+"Day"](),j=i[t+"Month"](),p=i[t+"FullYear"](),r=i[t+"Hours"](),k=i[t+"Minutes"](),u=i[t+"Seconds"](),n=i[t+"Milliseconds"](),f=q?0:i.getTimezoneOffset(),h={d:l,dd:c(l),ddd:g.i18n.dayNames[e],dddd:g.i18n.dayNames[e+7],m:j+1,mm:c(j+1),mmm:g.i18n.monthNames[j],mmmm:g.i18n.monthNames[j+12],yy:String(p).slice(2),yyyy:p,h:r%12||12,hh:c(r%12||12),H:r,HH:c(r),M:k,MM:c(k),s:u,ss:c(u),l:c(n,3),L:c(n>99?Math.round(n/10):n),t:r<12?"a":"p",tt:r<12?"am":"pm",T:r<12?"A":"P",TT:r<12?"AM":"PM",Z:q?"UTC":(String(i).match(b)||[""]).pop().replace(d,""),o:(f>0?"-":"+")+c(Math.floor(Math.abs(f)/60)*100+Math.abs(f)%60,4),S:["th","st","nd","rd"][l%10>3?0:(l%100-l%10!=10)*l%10]};return v.replace(a,function(m){return m in h?h[m]:m.slice(1,m.length-1)})}}();dateFormat.masks={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"};dateFormat.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]};Date.prototype.format=function(a,b){return dateFormat(this,a,b)};if(typeof(CanvasXpress)=="undefined"){CanvasXpress={}}var CanvasXpress=function(h,f,a,d){if(!h){var k=document.createElement("canvas");var j=0;var b="canvasXpress"+j;var g=document.getElementById(b);while(g){j++;b="canvasXpress"+j;g=document.getElementById(b)}k.id=b;document.body.appendChild(k);h=b}if(!a){a={}}this.setOriginalOptions=function(){if(a){for(var c in a){this[c]=a[c]}}};this.resetOptions=function(c){var l={};for(var e=0;e<c.length;e++){l[c[e]]=this[c[e]]}this.initConfigurations(true);for(var e in l){this[e]=l[e]}};this.setGlobalOptions=function(c){if(a.graphType=="Network"){if(!a.backgroundType){this.backgroundType="gradient";this.nodeFontColor=this.background}}if(a){for(var e=0;e<c.length;e++){var l=c[e];if(a.hasOwnProperty(l)){this[l]=a[l]}}}if(this.isIE){this.showAnimation=false}};this.writeToConsole=function(e,m){for(var l=0;l<e.length;l++){if(m){console.log(e[l])}else{console.log(e[l]+" = "+this[e[l]])}}};this.dumpToConsole=function(c){console.log(Dumper(c,DumperGetArgs(arguments,1)))};this.isSubstandardBrowser=function(){if((this.browser=="Firefox"&&this.browserVersion>2)||(this.browser=="Opera"&&this.browserVersion>9)||(this.browser=="Safari"&&this.browserVersion>4)||(this.browser=="Chrome"&&this.browserVersion>1)){return false}else{return true}};this.initialize=function(){this.initBrowser();this.addCSS();var i=document.createElement("div");i.id="wrapper-"+h;i.style.position="relative";var l=document.getElementById(h);var e=l.parentNode;e.insertBefore(i,l);i.appendChild(l.parentNode.appendChild(l));if(window.G_vmlCanvasManager&&window.attachEvent&&!window.opera){this.isIE=true;this.subBrowser=true;this.canvas=window.G_vmlCanvasManager.initElement(l)}else{this.isIE=false;this.subBrowser=this.isSubstandardBrowser();this.canvas=l}this.ctx=this.canvas.getContext("2d");this.version=3.2;this.initConfigurations();this.initData(f);this.initLayout();this.initEvents(h,d);this.initAnimation();this.initGraph()};this.initialize();CanvasXpress.references.push(this)};CanvasXpress.references=[];CanvasXpress.prototype.addCSS=function(){var a="table.shorts {border: 1px solid; border-collapse: collapse; font-size: x-small}";a+="td.k {text-align: center; padding: 1px; border: 1px solid;}";a+="td.d {padding: 1px; border: 1px solid;}";var b=document.createElement("style");b.type="text/css";if(b.styleSheet){b.styleSheet.cssText=a}else{b.appendChild(document.createTextNode(a))}document.getElementsByTagName("head")[0].appendChild(b)};CanvasXpress.prototype.initBrowser=function(){this.dataBrowser=[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}];this.dataOS=[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.platform,subString:"Linux",identity:"Linux"}];this.searchString=function(d){for(var a=0;a<d.length;a++){var b=d[a].string;var c=d[a].prop;this.versionSearchString=d[a].versionSearch||d[a].identity;if(b){if(b.indexOf(d[a].subString)!=-1){return d[a].identity}}else{if(c){return d[a].identity}}}};this.searchVersion=function(b){var a=b.indexOf(this.versionSearchString);if(a==-1){return}return parseFloat(b.substring(a+this.versionSearchString.length+1))};this.initializeBrowser=function(){this.browser=this.searchString(this.dataBrowser)||"An unknown browser";this.browserVersion=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"an unknown version";this.browserOS=this.searchString(this.dataOS)||"an unknown OS"};this.initializeBrowser()};CanvasXpress.prototype.initConfigurations=function(a){this.configOpts=[];this.graphType="Bar";this.configOpts.push("graphType");this.graphOrientation="horizontal";this.configOpts.push("graphOrientation");this.foreground="rgb(0,0,0)";this.configOpts.push("foreground");this.background="rgb(255,255,255)";this.configOpts.push("background");this.backgroundType="solid";this.configOpts.push("backgroundType");this.backgroundGradient1Color="rgb(0,0,200)";this.configOpts.push("backgroundGradient1Color");this.backgroundGradient2Color="rgb(0,0,36)";this.configOpts.push("backgroundGradient2Color");this.margin=5;this.configOpts.push("margin");this.showShadow=false;this.configOpts.push("showShadow");this.shadowOffsetX=3;this.configOpts.push("shadowOffsetX");this.shadowOffsetY=3;this.configOpts.push("shadowOffsetY");this.shadowBlur=2;this.configOpts.push("shadowBlur");this.shadowColor="rgba(0,0,0,0.5)";this.configOpts.push("shadowColor");this.fonts=this.isIE||this.subBrowser?["Gentilis","Helvetiker","Optimer"]:["Gentilis","Helvetiker","Optimer","Verdana, sans-serif"];this.fontName=this.isIE?"Gentilis":this.subBrowser?"Optimer":"Verdana, sans-serif";this.configOpts.push("fontName");this.fontStyle=false;this.configOpts.push("fontStyle");this.fontSize=12;this.configOpts.push("fontSize");this.font=this.fontStyle?this.fontStyle+this.fontSize+"pt "+this.fontName:this.fontSize+"pt "+this.fontName;this.align="center";this.configOpts.push("align");this.baseline="middle";this.configOpts.push("baseline");this.maxTextSize=14;this.configOpts.push("maxTextSize");this.minTextSize=4;this.configOpts.push("minTextSize");this.autoScaleFont=true;this.configOpts.push("autoScaleFont");this.scaleTextConstantMult=40;this.scaleTextConstantAdd=2.5;this.title=false;this.configOpts.push("title");this.titleHeight=30;this.configOpts.push("titleHeight");this.subtitle=false;this.configOpts.push("subtitle");this.subtitleHeight=16;this.configOpts.push("subtitleHeight");this.dashLength=8;this.configOpts.push("dashLength");this.dotLength=5;this.configOpts.push("dotLength");this.arrowPointSize=10;this.configOpts.push("arrowPointSize");this.lines=[];this.colors=["rgb(255,0,0)","rgb(0,0,255)","rgb(0,255,0)","rgb(255,255,0)","rgb(0,255,255)","rgb(255,0,255)","rgb(153,51,0)","rgb(0,0,128)","rgb(128,128,0)","rgb(255,102,0)","rgb(0,128,128)","rgb(102,0,102)","rgb(255,153,204)","rgb(102,102,153)","rgb(51,51,0)","rgb(255,204,153)","rgb(204,255,255)","rgb(153,153,255)","rgb(255,128,128)","rgb(51,102,255)","rgb(51,153,102)","rgb(255,204,0)","rgb(0,204,255)","rgb(208,32,144)","rgb(153,51,102)","rgb(0,102,204)","rgb(153,204,0)","rgb(255,153,0)","rgb(51,204,204)","rgb(204,153,255)","rgb(128,0,0)","rgb(51,51,153)","rgb(0,128,0)","rgb(255,255,204)","rgb(153,204,255)","rgb(128,0,128)"];this.hexs=["#FF0000","#0000FF","#00FF00","#FFFF00","#00FFFF","#FF00FF","#993300","#000080","#808000","#FF6600","#008080","#660066","#FF99CC","#666699","#333300","#FFCC99","#CCFFFF","#9999FF","#FF8080","#3366FF","#339966","#FFCC00","#00CCFF","#D02090","#993366","#0066CC","#99CC00","#FF9900","#33CCCC","#CC99FF","#800000","#333399","#008000","#FFFFCC","#99CCFF","#800080"];this.colorNames=["red","blue","brightgreen","yellow","cyan","magenta","brown","darkblue","darkyellow","orange","teal","darkpurple","rose","bluegray","olivegreen","tan","liteturquoise","periwinkle","coral","lightblue","seagreen","gold","skyblue","violetred","plum","oceanblue","lime","lightorange","aqua","lavender","darkred","indigo","green","ivory","paleblue","violet"];this.shapes=["sphere","square","triangle","star","rhombus","octagon","oval","plus","minus","pacman","mdavid","rect2","rect3"];this.sizes=[4,6,8,10,12,14,16,18,20,22,24,26,28,30,32,34];this.timeFormat="isoDate";this.configOpts.push("timeFormat");this.autoExtend=false;this.configOpts.push("autoExtend");this.maxSmpStringLen=50;this.configOpts.push("maxSmpStringLen");this.maxVarStringLen=30;this.configOpts.push("maxVarStringLen");this.smpTitle=false;this.configOpts.push("smpTitle");this.smpTitleFontSize=10;this.configOpts.push("smpTitleFontSize");this.smpTitleFont=(this.smpTitleFontSize)+"Pt "+this.fontName;this.smpTitleColor=this.foreground;this.configOpts.push("smpTitleColor");this.scaleSmpTitleFontFactor=1;this.configOpts.push("scaleSmpTitleFontFactor");this.smpLabelFontSize=10;this.configOpts.push("smpLabelFontSize");this.smpLabelFont=(this.smpLabelFontSize)+"Pt "+this.fontName;this.smpLabelColor=this.foreground;this.configOpts.push("smpLabelColor");this.scaleSmpLabelFontFactor=1;this.configOpts.push("scaleSmpLabelFontFactor");this.varLabelFontSize=10;this.configOpts.push("varLabelFontSize");this.varLabelFont=(this.varLabelFontSize)+"Pt "+this.fontName;this.varLabelColor=this.foreground;this.configOpts.push("varLabelColor");this.scaleVarLabelFontFactor=1;this.configOpts.push("scaleVarLabelFontFactor");this.showSampleNames=true;this.configOpts.push("showSampleNames");this.showVariableNames=true;this.configOpts.push("showVariableNames");this.highlightVar=[];this.configOpts.push("highlightVar");this.highlightSmp=[];this.configOpts.push("highlightSmp");this.highlightNode=[];this.configOpts.push("highlightNode");this.smpHighlightColor="rgb(255,0,0)";this.configOpts.push("smpHighlightColor");this.varHighlightColor="rgb(255,0,0)";this.configOpts.push("varHighlightColor");this.nodeHighlightColor="rgb(255,0,0)";this.configOpts.push("nodeHighlightColor");this.selectNode={};this.isSelectNodes=0;this.overlaysWidth=30;this.configOpts.push("overlaysWidth");this.overlays=[];this.smpOverlays=[];this.configOpts.push("smpOverlays");this.varOverlays=[];this.configOpts.push("varOverlays");this.showOverlays=true;this.configOpts.push("showOverlays");this.overlayFontSize=6;this.configOpts.push("overlayFontSize");this.overlayFont=(this.overlayFontSize)+"Pt "+this.fontName;this.overlayFontColor=this.foreground;this.configOpts.push("overlayFontColor");this.scaleOverlayFontFactor=1;this.configOpts.push("scaleOverlayFontFactor");this.showLegend=true;this.configOpts.push("showLegend");this.legendPosition="right";this.configOpts.push("legendPosition");this.legendBox=true;this.configOpts.push("legendBox");this.legendFontSize=10;this.configOpts.push("legendFontSize");this.legendFont=(this.legendFontSize)+"Pt "+this.fontName;this.legendColor=this.foreground;this.configOpts.push("legendColor");this.scaleLegendFontFactor=1;this.configOpts.push("scaleLegendFontFactor");this.showIndicators=true;this.configOpts.push("showIndicators");this.indicatorsPosition="bottom";this.configOpts.push("indicatorsPosition");this.showDecorations=false;this.configOpts.push("showDecorations");this.decorationsPosition="bottom";this.configOpts.push("decorationsPosition");this.decorationsColor=this.foreground;this.configOpts.push("decorationsColor");this.decorationFontSize=10;this.configOpts.push("decorationFontSize");this.decorationFont=(this.decorationFontSize)+"Pt "+this.fontName;this.scaleDecorationFontFactor=1;this.configOpts.push("scaleDecorationFontFactor");this.axisTickFontSize=10;this.configOpts.push("axisTickFontSize");this.axisTickFont=(this.axisTickFontSize)+"Pt "+this.fontName;this.axisTickColor=this.foreground;this.configOpts.push("axisTickColor");this.scaleTickFontFactor=1;this.configOpts.push("scaleTickFontFactor");this.axisTitleFontSize=10;this.configOpts.push("axisTitleFontSize");this.axisTitleFont=(this.axisTitleFontSize)+"Pt "+this.fontName;this.axisTitleColor=this.foreground;this.configOpts.push("axisTitleColor");this.scaleTitleFontFactor=1;this.configOpts.push("scaleTitleFontFactor");this.isGroupedData=false;this.isTransformedData=false;this.isBoxPlotCalc=false;this.isMarketDataFormated=false;this.isMarketSwitched=false;this.isGraphTime=false;this.configOpts.push("isGraphTime");this.groupingFactors=[];this.configOpts.push("groupingFactors");this.segregateSamplesBy=false;this.configOpts.push("segregateSamplesBy");this.segregateVariablesBy=false;this.configOpts.push("segregateVariablesBy");this.isLogData=false;this.configOpts.push("isLogData");this.smpSort=-1;this.varSort=-1;this.tmpAsciiArray=[];this.sortDir="ascending";this.configOpts.push("sortDir");this.transformBase=2;this.configOpts.push("transformBase");this.transformType=false;this.configOpts.push("transformType");this.ratioReference=0;this.configOpts.push("ratioReference");this.zscoreAxis="samples";this.configOpts.push("zscoreAxis");this.showErrorBars=true;this.configOpts.push("showErrorBars");this.randomData=false;this.configOpts.push("randomData");this.randomDataMean=100;this.configOpts.push("randomDataMean");this.randomDataSigma=50;this.configOpts.push("randomDataSigma");this.randomDataVariables=6;this.configOpts.push("randomDataVariables");this.randomDataSamples=12;this.configOpts.push("randomDataSamples");this.randomDataVariableAnnotations=2;this.configOpts.push("randomDataVariableAnnotations");this.randomDataSampleAnnotations=3;this.configOpts.push("randomDataSampleAnnotations");this.randomDataVariableAnnotationRatio=2;this.configOpts.push("randomDataVariableAnnotationRatio");this.randomDataSampleAnnotationRatio=2;this.configOpts.push("randomDataSampleAnnotationRatio");this.randomMissingDataPercentage=0;this.configOpts.push("randomMissingDataPercentage");this.distance="euclidian";this.configOpts.push("distance");this.linkage="single";this.configOpts.push("linkage");this.clusterAxis="samples";this.configOpts.push("clusterAxis");this.kmeansClusters=3;this.configOpts.push("kmeansClusters");this.maxIterations=10;this.configOpts.push("maxIterations");this.imputeMethod="mean";this.configOpts.push("imputeMethod");this.centerData=false;this.configOpts.push("centerData");this.xAxisAbsMax=false;this.xAxisAbsMin=false;this.xAxis2AbsMax=false;this.xAxis2AbsMin=false;this.yAxisAbsMax=false;this.yAxisAbsMin=false;this.zAxisAbsMax=false;this.zAxisAbsMin=false;this.setMax=false;this.configOpts.push("setMax");this.setMin=false;this.configOpts.push("setMin");this.setMax2=false;this.configOpts.push("setMax2");this.setMin2=false;this.configOpts.push("setMin2");this.setMaxX=false;this.configOpts.push("setMaxX");this.setMinX=false;this.configOpts.push("setMinX");this.setMaxY=false;this.configOpts.push("setMaxY");this.setMinY=false;this.configOpts.push("setMinY");this.setMaxZ=false;this.configOpts.push("setMaxZ");this.setMinZ=false;this.configOpts.push("setMinZ");this.xAxisCurrent=0;this.configOpts.push("xAxisCurrent");this.yAxisCurrent=0;this.configOpts.push("yAxisCurrent");this.zAxisCurrent=0;this.configOpts.push("zAxisCurrent");this.xAxisTitle=false;this.configOpts.push("xAxisTitle");this.yAxisTitle=false;this.configOpts.push("yAxisTitle");this.zAxisTitle=false;this.configOpts.push("zAxisTitle");this.xAxis=[];this.configOpts.push("xAxis");this.xAxis2=[];this.configOpts.push("xAxis2");this.yAxis=[];this.configOpts.push("yAxis");this.zAxis=[];this.configOpts.push("zAxis");this.xAxisTickStyle="solid";this.configOpts.push("xAxisTickStyle");this.yAxisTickStyle="solid";this.configOpts.push("yAxisTickStyle");this.zAxisTickStyle="solid";this.configOpts.push("zAxisTickStyle");this.xAxisTickColor="rgb(220,220,220)";this.configOpts.push("xAxisTickColor");this.yAxisTickColor="rgb(220,220,220)";this.configOpts.push("yAxisTickColor");this.zAxisTickColor="rgb(220,220,220)";this.configOpts.push("zAxisTickColor");this.axisExtension=0.1;this.configOpts.push("axisExtension");this.axisExact=false;this.configOpts.push("axisExact");this.xAxisExact=false;this.configOpts.push("xAxisExact");this.xAxis2Exact=false;this.configOpts.push("xAxis2Exact");this.yAxisExact=false;this.configOpts.push("yAxisExact");this.zAxisExact=false;this.configOpts.push("zAxisExact");this.timeValues=[];this.configOpts.push("timeValues");this.timeValueIndices=[];this.configOpts.push("timeValueIndices");this.xAxisValues=[];this.configOpts.push("xAxisValues");this.xAxis2Values=[];this.configOpts.push("xAxis2Values");this.yAxisValues=[];this.configOpts.push("yAxisValues");this.zAxisValues=[];this.configOpts.push("zAxisValues");this.xAxisTransform=false;this.configOpts.push("xAxisTransform");this.yAxisTransform=false;this.configOpts.push("yAxisTransform");this.zAxisTransform=false;this.configOpts.push("zAxisTransform");this.xAxisShow=true;this.configOpts.push("xAxisShow");this.yAxisShow=true;this.configOpts.push("yAxisShow");this.zAxisShow=true;this.configOpts.push("zAxisShow");this.ticks=50;this.configOpts.push("ticks");this.timeTicks=10;this.configOpts.push("timeTicks");this.xAxisTicks=5;this.configOpts.push("xAxisTicks");this.xAxis2Ticks=5;this.configOpts.push("xAxis2Ticks");this.yAxisTicks=5;this.configOpts.push("yAxisTicks");this.zAxisTicks=5;this.configOpts.push("zAxisTicks");this.smpHairline="dotted";this.configOpts.push("smpHairline");this.smpHairlineColor="rgb(220,220,220)";this.configOpts.push("smpHairlineColor");this.blockContrast=false;this.configOpts.push("blockContrast");this.blockContrastOddColor=this.background;this.configOpts.push("blockContrastOddColor");this.blockContrastEvenColor="rgb(240,240,240)";this.configOpts.push("blockContrastEvenColor");this.blockSeparationFactor=1;this.configOpts.push("blockSeparationFactor");this.blockFactor=1;this.configOpts.push("blockFactor");this.lineDecoration="symbol";this.configOpts.push("lineDecoration");this.coordinateLineColor=true;this.configOpts.push("coordinateLineColor");this.colorBy=false;this.configOpts.push("colorBy");this.shapeBy=false;this.configOpts.push("shapeBy");this.sizeBy=false;this.configOpts.push("sizeBy");this.isScatterLine=false;this.configOpts.push("isScatterLine");this.selectDataPoint=[];this.hideDataPoint=[];this.isSelectDataPoints=0;this.isHistogram=false;this.configOpts.push("isHistogram");this.histogramBarWidth=0.5;this.configOpts.push("histogramBarWidth");this.histogramBins=20;this.configOpts.push("histogramBins");this.isCreateHistogram=false;this.allVsAll=false;this.configOpts.push("allVsAll");this.allVsAllType="both";this.configOpts.push("allVsAllType");this.functionIntervals=20;this.configOpts.push("functionIntervals");this.xRotate=45;this.configOpts.push("xRotate");this.yRotate=0;this.configOpts.push("yRotate");this.zRotate=0;this.configOpts.push("zRotate");this.rotationDelay=100;this.configOpts.push("rotationDelay");this.rotationSensitivity=45;this.configOpts.push("rotationSensitivity");this.rotationStep=2;this.configOpts.push("rotationStep");this.indicatorCenter="white";this.configOpts.push("indicatorCenter");this.indicatorHeight=8;this.configOpts.push("indicatorHeight");this.heatmapType="blue-red";this.configOpts.push("heatmapType");this.varIndicesStart=-1;this.smpIndicesStart=-1;this.correlationAxis="samples";this.configOpts.push("correlationAxis");this.correlationAnchorLegend=false;this.configOpts.push("correlationAnchorLegend");this.correlationAnchorLegendAlignWidth=40;this.configOpts.push("correlationAnchorLegendAlignWidth");this.showSmpDendrogram=false;this.configOpts.push("showSmpDendrogram");this.showVarDendrogram=false;this.configOpts.push("showVarDendrogram");this.varDendrogramPosition="top";this.configOpts.push("varDendrogramPosition");this.smpDendrogramPosition="left";this.configOpts.push("smpDendrogramPosition");this.dendrogramSpace=6;this.configOpts.push("dendrogramSpace");this.dendrogramHang=false;this.configOpts.push("dendrogramHang");this.dendrogramHeight=false;this.configOpts.push("dendrogramHeight");this.vennGroups=4;this.configOpts.push("vennGroups");this.vennCompartments=["A","B","AB","C","AC","BC","ABC","D","AD","BD","CD","ABD","ACD","BCD","ABCD"];this.pieType="separated";this.configOpts.push("pieType");this.pieSegmentPrecision=0;this.configOpts.push("pieSegmentPrecision");this.pieSegmentSeparation=3;this.configOpts.push("pieSegmentSeparation");this.pieSegmentLabels="inside";this.configOpts.push("pieSegmentLabels");this.maxPieSectors=20;this.configOpts.push("maxPieSectors");this.showVolume=true;this.configOpts.push("showVolume");this.calculateLayout=true;this.configOpts.push("calculateLayout");this.networkLayoutType="forceDirected";this.configOpts.push("networkLayoutType");this.networkRoot=false;this.configOpts.push("networkRoot");this.showNetworkRadialLayout=false;this.configOpts.push("showNetworkRadialLayout");this.networkDepth=0;this.networkDivisions=0;this.preScaleNetwork=false;this.configOpts.push("preScaleNetwork");this.showNodeNameThreshold=50;this.configOpts.push("showNodeNameThreshold");this.showHiddenChildEdges=true;this.configOpts.push("showHiddenChildEdges");this.nodeWidth=this.preScaleNetwork?10:20;this.configOpts.push("nodeWidth");this.edgeWidth=1;this.configOpts.push("edgeWidth");this.layoutTime=15;this.configOpts.push("layoutTime");this.nodeFontSize=this.nodeWidth;this.configOpts.push("nodeFontSize");this.nodeFont=this.nodeFontSize+"Pt "+this.fontName;this.nodeFontColor=this.foreground;this.configOpts.push("nodeFontColor");this.scaleNodeFontFactor=1;this.configOpts.push("scaleNodeFontFactor");this.randomNetwork=false;this.configOpts.push("randomNetwork");this.reduceRandomNetwork=false;this.configOpts.push("reduceRandomNetwork");this.randomNetworkNodes=50;this.configOpts.push("randomNetworkNodes");this.randomNetworkNodeEdgesMax=5;this.configOpts.push("randomNetworkNodeEdgesMax");this.colorNodeBy=false;this.configOpts.push("colorNodeBy");this.shapeNodeBy=false;this.configOpts.push("shapeNodeBy");this.sizeNodeBy=false;this.configOpts.push("sizeNodeBy");this.colorEdgeBy=false;this.configOpts.push("colorEdgeBy");this.shapeEdgeBy=false;this.configOpts.push("shapeEdgeBy");this.sizeEdgeBy=false;this.configOpts.push("sizeEdgeBy");this.is3DNetwork=false;this.configOpts.push("is3DNetwork");this.network2DRotate=0;this.trackNameFontSize=10;this.configOpts.push("trackNameFontSize");this.trackNameFont=(this.trackNameFontSize)+"Pt "+this.fontName;this.trackNameFontColor=this.background;this.configOpts.push("trackNameFontColor");this.showFeatureNameThereshold=20;this.configOpts.push("showFeatureNameThereshold ");this.featureNameFontSize=8;this.configOpts.push("featureNameFontSize");this.featureNameFont=(this.featureNameFontSize)+"Pt "+this.fontName;this.featureNameFontColor=this.background;this.configOpts.push("featureNameFontColor");this.featureWidthDefault=3;this.configOpts.push("featureWidthDefault");this.featureHeightDefault=8;this.configOpts.push("featureHeightDefault");this.featureTypeDefault="line";this.configOpts.push("featureTypeDefault");this.sequenceFontSize=10;this.configOpts.push("sequenceFontSize");this.sequenceFont=(this.sequenceFontSize)+"Pt "+this.fontName;this.sequenceAColor="rgb(255, 255, 0)";this.configOpts.push("sequenceAColor");this.sequenceCColor="rgb(0, 255, 255)";this.configOpts.push("sequenceCColor");this.sequenceGColor="rgb(0, 255, 0)";this.configOpts.push("sequenceGColor");this.sequenceTColor="rgb(255, 0, 0)";this.configOpts.push("sequenceTColor");this.sequenceMColor="rgb(255, 0, 255)";this.configOpts.push("sequenceMColor");this.wireColor="rgba(220,220,220,0.1)";this.configOpts.push("wireColor");this.periodTicksLabels=5;this.configOpts.push("periodTicksLabels");this.debug=true;this.configOpts.push("debug");this.disableEvents=false;this.configOpts.push("disableEvents");this.eventKeys=true;this.configOpts.push("eventKeys");this.dragAreaColor="rgb(208,222,240)";this.configOpts.push("dragAreaColor");this.infoAreaColor="rgb(208,222,240)";this.configOpts.push("infoAreaColor");this.infoTimeOut=3000;this.configOpts.push("infoTimeOut");this.resizeAreaColor="rgb(220,220,220)";this.configOpts.push("resizeAreaColor");this.resizeAreaColorCurrent="rgb(153,187,232)";this.configOpts.push("resizeAreaColorCurrent");this.resizeWidth=18;this.configOpts.push("resizeWidth");this.resizeSliderWidth=5;this.configOpts.push("resizeSliderWidth");this.modelEvent="local";this.configOpts.push("modelEvent");this.dataEvent=[];this.resizerEventData={};this.isBroadcasting=true;this.configOpts.push("isBroadcasting");this.showAnimation=false;this.configOpts.push("showAnimation");this.showAnimationFontSize=10;this.configOpts.push("showAnimationFontSize");this.showAnimationFont=(this.showAnimationFontSize)+"Pt "+this.fontName;this.showAnimationFontColor=this.background;this.configOpts.push("showAnimationFontColor");this.animationTime=30;this.configOpts.push("animationTime");this.animationType="grow";this.configOpts.push("animationType");this.animationCycles=20;this.configOpts.push("animationCycles");this.snapshots=[];this.isAnimation=false;this.weight=1;this.scaleX=1;this.scaleY=1;this.translateX=0;this.translateY=0;this.offsetX=0;this.offsetY=0;this.layoutWidth=0;this.layoutHeight=0;this.layout="1X1";this.configOpts.push("layout");this.layoutComb=false;this.configOpts.push("layoutComb");this.layoutAdjust=false;this.configOpts.push("layoutAdjust");this.layoutCurrent=0;this.layoutMaxLegend=0;this.layoutMulticolor=true;this.configOpts.push("layoutMulticolor");this.layoutAxis=3;if(!a){this.setGlobalOptions(this.configOpts);this.initDimensions();this.initUtils();this.initApi();this.initText();this.initTime();this.initAttributes()}};CanvasXpress.prototype.initDimensions=function(){if(this.canvas.width){this.originalWidth=this.canvas.width;this.width=this.canvas.width}else{if(this.width){this.originalWidth=this.width;this.canvas.width=this.width}else{this.width=600;this.originalWidth=this.width;this.canvas.width=this.width}}if(this.canvas.height){this.originalHeight=this.canvas.height;this.height=this.canvas.height}else{if(this.height){this.originalHeight=this.height;this.canvas.height=this.height}else{this.height=600;this.originalHeight=this.height;this.canvas.height=this.height}}this.top=this.margin;if(this.title){this.top+=this.titleHeight+this.margin;if(this.subtitle){this.top+=this.subtitleHeight+this.margin}}this.left=this.margin;this.right=this.margin;this.bottom=this.margin;this.x=this.width-(this.left+this.right);this.y=this.height-(this.top+this.bottom)};CanvasXpress.prototype.initUtils=function(){this.validateColor=function(col){if(col.match(/^rgba?\((\d{1,3},\d{1,3},\d{1,3})(?:,([0-9\.]+))?/i)){if(RegExp.$2){return"rgba("+RegExp.$1+","+RegExp.$2+")"}else{return"rgb("+RegExp.$1+")"}}else{return false}};this.getVarColor=function(variable){if(this.highlightVar){for(var i=0;i<this.highlightVar.length;i++){if(this.highlightVar[i]==variable){return this.varHighlightColor}}}return this.varLabelColor};this.getSmpColor=function(sample){if(this.highlightSmp){for(var i=0;i<this.highlightSmp.length;i++){if(this.highlightSmp[i]==sample){return this.smpHighlightColor}}}return this.smpLabelColor};this.getNodeColor=function(node){if(this.highlightNode){for(var i=0;i<this.highlightNode.length;i++){if(this.highlightNode[i]==node){return this.nodeHighlightColor}}}return this.selectNode.hasOwnProperty(node)?this.nodeHighlightColor:this.nodeFontColor};this.drawTitle=function(){var f;var h;var sh;if(this.title){h=this.titleHeight/2;f=this.scaleTextToFont(this.title,this.titleHeight-h,this.x);this.drawText(this.title,this.width/2,this.titleHeight/2,f,false,"center","middle");if(this.subtitle){sh=this.subtitleHeight/4;f=this.scaleTextToFont(this.subtitle,this.subtitleHeight-sh,this.x);this.drawText(this.subtitle,this.width/2,(this.titleHeight+this.subtitleHeight)-(h/2),f,false,"center","middle")}}};this.resizeCanvas=function(r,w,h){if(this.ctx){if(r||w||h){if(w||h){if(w){this.width=w;this.originalWidth=w}if(h){this.height=h;this.originalHeight=h}}else{if(r){this.width=this.originalWidth;this.height=this.originalHeight}}this.top=this.margin;if(this.title){this.top+=this.titleHeight+this.margin;if(this.subtitle){this.top+=this.subtitleHeight+this.margin}}this.left=this.margin;this.right=this.margin;this.bottom=this.margin;this.resetMap()}this.canvas.width=this.width;this.canvas.height=this.height;if(this.backgroundType=="solid"){this.rectangle(0,0,this.width,this.height,this.background,this.background)}else{var gradient=this.ctx.createLinearGradient(this.width/2,0,this.width/2,this.height);gradient.addColorStop(0,this.backgroundGradient1Color);gradient.addColorStop(1,this.backgroundGradient2Color);this.ctx.fillStyle=gradient;this.ctx.fillRect(0,0,this.width,this.height)}}};this.maskPlotArea=function(){var width=this.layoutComb?this.layoutWidth:this.width;var height=this.layoutComb?this.layoutHeight:this.height;if(this.backgroundType=="solid"){this.rectangle(this.offsetX,this.offsetY,width,this.top,this.background,this.background);this.rectangle(this.offsetX,this.offsetY,this.left,height,this.background,this.background);this.rectangle(this.offsetX,(this.offsetY+height)-this.bottom,width,this.bottom,this.background,this.background);this.rectangle((this.offsetX+width)-this.right,this.offsetY,this.right,height,this.background,this.background)}else{this.ctx.save();var g=this.ctx.createLinearGradient(this.width/2,0,this.width/2,this.height);g.addColorStop(0,this.backgroundGradient1Color);g.addColorStop(1,this.backgroundGradient2Color);this.ctx.fillStyle=g;this.ctx.fillRect(this.offsetX,this.offsetY,width,this.top);this.ctx.fillRect(this.offsetX,this.offsetY,this.left,height);this.ctx.fillRect(this.offsetX,(this.offsetY+height)-this.bottom,width,this.bottom);this.ctx.fillRect((this.offsetX+width)-this.right,this.offsetY,this.right,height)}};this.maskTreeArea=function(){if(this.backgroundType=="solid"){this.ctx.save();this.rectangle(this.offsetX,this.offsetY,this.left,this.top,this.background,this.background);this.rectangle(this.offsetX+this.left+this.x,this.offsetY,this.right,this.top,this.background,this.background);this.rectangle(this.offsetX,this.offsetY+this.top+this.y,this.left,this.bottom,this.background,this.background);this.rectangle(this.offsetX+this.left+this.x,this.offsetY+this.top+this.y,this.right,this.bottom,this.background,this.background)}else{this.ctx.save();var g=this.ctx.createLinearGradient(this.width/2,0,this.width/2,this.height);g.addColorStop(0,this.backgroundGradient1Color);g.addColorStop(1,this.backgroundGradient2Color);this.ctx.fillStyle=g;this.ctx.fillRect(this.offsetX,this.offsetY,this.left,this.top);this.ctx.fillRect(this.offsetX+this.left+this.x,this.offsetY,this.right,this.top);this.ctx.fillRect(this.offsetX,this.offsetY+this.top+this.y,this.left,this.bottom);this.ctx.fillRect(this.offsetX+this.left+this.x,this.offsetY+this.top+this.y,this.right,this.bottom)}};this.drawGradientBackground=function(){this.ctx.save();var g=this.ctx.createLinearGradient(this.width/2,0,this.width/2,this.height);g.addColorStop(0,this.backgroundGradient1Color);g.addColorStop(1,this.backgroundGradient2Color);this.ctx.fillStyle=g;this.ctx.fillRect(0,0,this.width,this.height)};this.modifyObjectArray=function(els,check,par){var arr=this[par];if(check){var seen={};var temp=[];if(this.isArray(els)){for(var i=0;i<els.length;i++){seen[els[i]]=1}}else{seen[els]=1}for(var i=0;i<arr.length;i++){if(!seen.hasOwnProperty(arr[i])){temp.push(arr[i])}}this[par]=temp}else{if(this.isArray(els)){for(var i=0;i<els.length;i++){arr.push(els[i])}}else{arr.push(els)}}};this.getObjectArray=function(arr){var seen={};for(var i=0;i<arr.length;i++){seen[arr[i]]=1}return seen};this.isArray=function(o){if(o&&!(o.propertyIsEnumerable("length"))&&typeof o==="object"&&typeof o.length==="number"){return true}else{return false}};this.toArray=function(o){return this.isArray(o)?o:[o]};this.cloneObject=function(obj){if(obj==null||typeof(obj)!="object"){return obj}var temp=new obj.constructor();for(var key in obj){temp[key]=this.cloneObject(obj[key])}return temp};this.drawDecorationData=function(){if(this.showDecorations&&this.data.d){if(this.data.d.nlfit){var xRange,xMax,xMin;var indices=this.smpIndices;var x0,y0;for(var i=0;i<this.data.d.nlfit.length;i++){var fit=[];var col=i%this.colors.length;var a0=this.data.d.nlfit[i].param[0];var a1=this.data.d.nlfit[i].param[1];var a2=this.data.d.nlfit[i].param[2];var a3=this.data.d.nlfit[i].param[3];var ii=this.xAxisIndices[i];if(this.xAxisTransform=="percentile"){xRange=this.getAxisRangeBySample(ii);xMin=xRange[0];xMax=xRange[1]}var xs=this.data.y.data[ii];indices.sort(function(a,b){return xs[a]-xs[b]});col=this.data.d.nlfit[i].color?this.data.d.nlfit[i].color:this.colors[col];for(var j=0;j<indices.length;j++){var jj=indices[j];var x=this.getDataAtPos(ii,jj,false,this.xAxisTransform,xMin,xMax);var y;var sxs=[];if(x>0){if(j>0){var jjj=indices[j-1];var xp=this.getDataAtPos(ii,jjj,false,this.xAxisTransform,xMin,xMax);if(xp>0){var interval=(x-xp)/this.functionIntervals;for(var k=0;k<this.functionIntervals;k++){sxs.push(xp);xp+=interval}}}else{sxs=[x]}for(var k=0;k<sxs.length;k++){if(this.data.d.nlfit[i].type=="reg"){y=a0+((a1-a0)/(1+a2/(Math.pow(sxs[k],a3))))}else{y=a0+((a1-a0)/(1+(Math.pow((sxs[k]/a2),a3))))}x0=(this.offsetX+this.left)+((sxs[k]-this.xAxisMin)*this.xAxisUnit);y0=(this.offsetY+this.top+this.y)-((y-this.yAxisMin)*this.yAxisUnit);fit.push([x0,y0])}}}if(fit.length>0){this.pathShd(fit,col);if(this.data.d.nlfit[i].type=="reg"){y=a0+((a1-a0)/(1+a2/(Math.pow(a2,a3))))}else{y=a0+((a1-a0)/(1+(Math.pow((a2/a2),a3))))}x0=(this.offsetX+this.left)+((a2-this.xAxisMin)*this.xAxisUnit);y0=(this.offsetY+this.top+this.y)-((y-this.yAxisMin)*this.yAxisUnit);this.dashedLine(this.left,y0,x0,y0,col);this.dashedLine(x0,y0,x0,(this.top+this.y),col)}}}if(this.data.d.reg){for(var i=0;i<this.data.d.reg.length;i++){if(this.data.d.reg[i].slope&&this.data.d.reg[i].intercept){var col=i%this.colors.length;var type=this.data.d.reg[i].type?this.data.d.reg[i].type:"line";var slope=this.data.d.reg[i].slope;var inter=this.data.d.reg[i].intercept;var cor=this.data.d.reg[i].cor;var x0=this.data.d.reg[i].start?this.data.d.reg[i].start:this.xAxisMin;var y0=(slope*x0)+inter;var x1=this.data.d.reg[i].end?this.data.d.reg[i].end:this.xAxisMax;var y1=(slope*x1)+inter;x0=(this.offsetX+this.left)+(x0*this.xAxisUnit);y0=(this.offsetY+this.top+this.y)-(y0*this.yAxisUnit);x1=(this.offsetX+this.left)+(x1*this.xAxisUnit);y1=(this.offsetY+this.top+this.y)-(y1*this.yAxisUnit);col=this.data.d.reg[i].color?this.data.d.reg[i].color:this.colors[col];this[type](x0,y0,x1,y1,col)}}}if(this.data.d.nor){for(var i=0;i<this.data.d.nor.length;i++){if(this.data.d.nor[i].mu&&this.data.d.nor[i].sigma){var nor=[];var xy=[];var x0,y0;var col=i%this.colors.length;var mu=this.data.d.nor[i].mu;var sigma=this.data.d.nor[i].sigma;var start=this.data.d.nor[i].start?this.data.d.nor[i].start:this.data.d.nor[i].yAxis?this.yAxisMin:this.xAxisMin;var end=this.data.d.nor[i].end?this.data.d.nor[i].end:this.data.d.nor[i].yAxis?this.yAxisMax:this.xAxisMax;var tot=120;if(start<mu&&mu<end){var xp,yp,max,units;var interval=(mu-start)/tot;var vrn=sigma*sigma;var vrn2=vrn*2;var peak=1/Math.sqrt(2*Math.PI*vrn);if(this.data.d.nor[i].yAxis){max=this.data.d.nor[i].max?this.data.d.nor[i].max*this.xAxisUnit:this.x-(this.x*this.axisExtension);units=max/peak;xp=start;yp;for(var j=0;j<tot-1;j++){yp=peak*Math.pow(Math.E,-Math.pow(xp-mu,2)/vrn);xy.push([xp,yp]);x0=(this.offsetX+this.left)+(yp*units);y0=(this.offsetY+this.top+this.y)-(xp*this.yAxisUnit);nor.push([x0,y0]);xp+=interval}interval=(end-mu)/tot;xp=mu;for(var j=0;j<tot;j++){yp=peak*Math.pow(Math.E,-Math.pow(xp-mu,2)/vrn);xy.push([xp,yp]);x0=(this.offsetX+this.left)+(yp*units);y0=(this.offsetY+this.top+this.y)-(xp*this.yAxisUnit);nor.push([x0,y0]);xp+=interval}col=this.data.d.nor[i].color?this.data.d.nor[i].color:this.colors[col];this.pathShd(nor,col)}else{max=this.data.d.nor[i].max?this.data.d.nor[i].max*this.yAxisUnit:this.y-(this.y*this.axisExtension);units=max/peak;xp=start;yp;for(var j=0;j<tot-1;j++){yp=peak*Math.pow(Math.E,-Math.pow(xp-mu,2)/vrn);xy.push([xp,yp]);x0=(this.offsetX+this.left)+(xp*this.xAxisUnit);y0=(this.offsetY+this.top+this.y)-(yp*units);nor.push([x0,y0]);xp+=interval}interval=(end-mu)/tot;xp=mu;for(var j=0;j<tot;j++){yp=peak*Math.pow(Math.E,-Math.pow(xp-mu,2)/vrn);xy.push([xp,yp]);x0=(this.offsetX+this.left)+(xp*this.xAxisUnit);y0=(this.offsetY+this.top+this.y)-(yp*units);nor.push([x0,y0]);xp+=interval}col=this.data.d.nor[i].color?this.data.d.nor[i].color:this.colors[col];this.pathShd(nor,col)}}}}}if(this.data.d.area){for(var i=0;i<this.data.d.area.length;i++){if(this.data.d.area[i].type&&this.data.d.area[i].x&&this.data.d.area[i].y&&this.data.d.area[i].size){if(this.isValidShape(this.data.d.area[i].type)){var x0=(this.offsetX+this.left)+(this.data.d.area[i].x*this.xAxisUnit);var y0=(this.offsetY+this.top+this.y)-(this.data.d.area[i].y*this.yAxisUnit);var col=this.data.d.area[i].color?this.data.d.area[i].color:this.colors[i%this.colors.length];this[this.data.d.area[i].type](x0,y0,col,this.data.d.area[i].size)}}}}}};this.setDecorationLegendDimension=function(){this.legendDecorationWidth=0;this.legendDecorationHeight=0;if(this.showDecorations&&this.data.d){var pt=this.getFontPt(this.decorationFont);var wn=0;var wr=0;var wn=0;var wa=0;if(this.data.d.nlfit){var params=this.measureText(sprintf("%75s","X"),this.decorationFont)+(this.margin*4);var max=0;for(var i=0;i<this.data.d.nlfit.length;i++){var tmp=this.measureText(this.data.d.nlfit[i].label,this.decorationFont);max=Math.max(tmp,max)}wn=this.margin+max+this.margin+params+this.margin;this.legendDecorationHeight=(this.data.d.nlfit.length*pt*2)+pt+this.margin}if(this.data.d.reg){var params=this.measureText(sprintf("%45s","X"),this.decorationFont)+(this.margin*2);var max=0;for(var i=0;i<this.data.d.reg.length;i++){var tmp=this.measureText(this.data.d.reg[i].label,this.decorationFont);max=Math.max(tmp,max)}wr=this.margin+max+this.margin+params+this.margin;this.legendDecorationHeight+=(this.data.d.reg.length*pt*2)+pt+this.margin}if(this.data.d.nor){var params=this.measureText(sprintf("%30s","X"),this.decorationFont)+(this.margin*1);var max=0;for(var i=0;i<this.data.d.nor.length;i++){var tmp=this.measureText(this.data.d.nor[i].label,this.decorationFont);max=Math.max(tmp,max)}wn=this.margin+max+this.margin+params+this.margin;this.legendDecorationHeight+=(this.data.d.nor.length*pt*2)+pt+this.margin}if(this.data.d.area){var max=0;for(var i=0;i<this.data.d.area.length;i++){var tmp=this.measureText(this.data.d.area[i].label,this.decorationFont);max=Math.max(tmp,max)}wa=this.margin+max+this.margin;this.legendDecorationHeight+=(this.data.d.area.length*pt*2)+this.margin}this.legendDecorationWidth=Math.max(Math.max(Math.max(wn,wr),wn),wa)}};this.drawDecorationLegend=function(){if(this.showDecorations&&this.data.d){var pt=this.getFontPt(this.decorationFont);var col=this.measureText(sprintf("%15s","X"),this.decorationFont);var x0,y0,xi,all;if(this.decorationsPosition=="right"){y0=this.offsetY+this.top+(pt/2)+((this.y-this.legendDecorationHeight)/2)}else{y0=(this.offsetY+this.top+this.y+this.bottom)-this.legendDecorationHeight}if(this.data.d.nlfit){all=(this.margin*5)+(5*col);if(this.decorationsPosition=="right"){xi=(this.offsetX+this.left+this.x+this.right+col)-all}else{xi=this.offsetX+this.left+((this.x-this.legendDecorationWidth)/2)+(this.legendDecorationWidth-all)+col}x0=xi;this.drawText("Min",x0,y0,this.decorationFont,this.decorationsColor,"right","middle");x0+=col+this.margin;this.drawText("Max",x0,y0,this.decorationFont,this.decorationsColor,"right","middle");x0+=col+this.margin;this.drawText("EC50",x0,y0,this.decorationFont,this.decorationsColor,"right","middle");x0+=col+this.margin;this.drawText("Slope",x0,y0,this.decorationFont,this.decorationsColor,"right","middle");x0+=col+this.margin;this.drawText("p-Val",x0,y0,this.decorationFont,this.decorationsColor,"right","middle");y0+=pt+pt;for(var i=0;i<this.data.d.nlfit.length;i++){var color=i%this.colors.length;color=this.data.d.nlfit[i].color?this.data.d.nlfit[i].color:this.colors[color];x0=(xi+this.margin)-col;if(this.graphType=="ScatterBubble2D"&&this.decorationsPosition=="right"&&this.zAxisShow){x0+=this.margin+this.getFontPt(this.axisTitleFont)+this.margin}this.drawText(this.data.d.nlfit[i].label,x0,y0,this.decorationFont,color,"right","middle");x0=xi;for(var j=0;j<5;j++){var val=this.data.d.nlfit[i].param[j];this.drawText(this.formatNumber(val),x0,y0,this.decorationFont,this.decorationsColor,"right","middle");x0+=col+this.margin}y0+=pt+pt}}if(this.data.d.reg){all=(this.margin*3)+(3*col);if(this.decorationsPosition=="right"){xi=(this.offsetX+this.left+this.x+this.right)-all}else{xi=this.offsetX+this.left+((this.x-this.legendDecorationWidth)/2)+(this.legendDecorationWidth-all)+col}x0=xi;this.drawText("Slope",x0,y0,this.decorationFont,this.decorationsColor,"right","middle");x0+=col+this.margin;this.drawText("Int",x0,y0,this.decorationFont,this.decorationsColor,"right","middle");x0+=col+this.margin;this.drawText("Cor",x0,y0,this.decorationFont,this.decorationsColor,"right","middle");y0+=pt+pt;for(var i=0;i<this.data.d.reg.length;i++){var color=i%this.colors.length;color=this.data.d.reg[i].color?this.data.d.reg[i].color:this.colors[color];x0=(xi+this.margin)-col;if(this.graphType=="ScatterBubble2D"&&this.decorationsPosition=="right"&&this.zAxisShow){x0+=this.margin+this.getFontPt(this.axisTitleFont)+this.margin}this.drawText(this.data.d.reg[i].label,x0,y0,this.decorationFont,color,"right","middle");x0=xi;this.drawText(this.formatNumber(this.data.d.reg[i].slope),x0,y0,this.decorationFont,this.decorationsColor,"right","middle");x0+=col+this.margin;this.drawText(this.formatNumber(this.data.d.reg[i].intercept),x0,y0,this.decorationFont,this.decorationsColor,"right","middle");x0+=col+this.margin;this.drawText(this.formatNumber(this.data.d.reg[i].cor),x0,y0,this.decorationFont,this.decorationsColor,"right","middle");x0+=col+this.margin;y0+=pt+pt}}if(this.data.d.nor){all=(this.margin*2)+(2*col);if(this.decorationsPosition=="right"){xi=(this.offsetX+this.left+this.x+this.right)-all}else{xi=this.offsetX+this.left+((this.x-this.legendDecorationWidth)/2)+(this.legendDecorationWidth-all)+col}x0=xi;this.drawText("Mu",x0,y0,this.decorationFont,this.decorationsColor,"right","middle");x0+=col+this.margin;this.drawText("Sigma",x0,y0,this.decorationFont,this.decorationsColor,"right","middle");y0+=pt+pt;for(var i=0;i<this.data.d.nor.length;i++){var color=i%this.colors.length;color=this.data.d.nor[i].color?this.data.d.nor[i].color:this.colors[color];x0=(xi+this.margin)-col;if(this.graphType=="ScatterBubble2D"&&this.decorationsPosition=="right"&&this.zAxisShow){x0+=this.margin+this.getFontPt(this.axisTitleFont)+this.margin}this.drawText(this.data.d.nor[i].label,x0,y0,this.decorationFont,color,"right","middle");x0=xi;this.drawText(this.formatNumber(this.data.d.nor[i].mu),x0,y0,this.decorationFont,this.decorationsColor,"right","middle");x0+=col+this.margin;this.drawText(this.formatNumber(this.data.d.nor[i].sigma),x0,y0,this.decorationFont,this.decorationsColor,"right","middle");x0+=col+this.margin;y0+=pt+pt}}if(this.data.d.area){for(var i=0;i<this.data.d.area.length;i++){if(this.data.d.area[i].label){if(this.decorationsPosition=="right"){x0=this.offsetX+this.left+this.x+this.margin}else{x0=this.offsetX+this.left+((this.x-this.legendDecorationWidth)/2)+this.margin}for(var i=0;i<this.data.d.area.length;i++){var color=this.data.d.area[i].color?this.data.d.area[i].color:this.colors[i%this.colors.length];if(this.graphType=="ScatterBubble2D"&&this.decorationsPosition=="right"&&this.zAxisShow){x0+=this.margin+this.getFontPt(this.axisTitleFont)+this.margin}this.drawText(this.data.d.area[i].label,x0,y0,this.decorationFont,color,"left","middle");y0+=pt+pt}}}}}};this.setLegendFont=function(){if(this.autoScaleFont){if(this.layoutComb){this.legendFont=(parseInt(Math.max(this.minTextSize,this.legendFontSize-Math.min(this.layoutRows,this.layoutCols))*this.scaleLegendFontFactor))+"Pt "+this.fontName}else{this.legendFont=(parseInt(this.legendFontSize*this.scaleLegendFontFactor))+"Pt "+this.fontName}}else{this.legendFont=(parseInt(this.legendFontSize))+"Pt "+this.fontName}};this.setSampleLegendDimension=function(){this.legendSampleWidth=0;this.legendSampleHeight=0;if(this.xAxisIndices.length!=this.yAxisIndices.length||this.xAxisIndices.length>1){var size=this.getFontPt(this.legendFont);var max=0;if(this.xAxisIndices.length==this.yAxisIndices.length&&this.xAxisIndices.length>1){for(var i=0;i<this.xAxisIndices.length;i++){var len=this.measureText(this.shortenText(this.xAxis[i],this.maxSmpStringLen)+" vs "+this.shortenText(this.yAxis[i],this.maxSmpStringLen),this.legendFont);max=Math.max(len,max)}}else{if(this.xAxisIndices.length>this.yAxisIndices.length){max=this.measureText(this.shortenText(this.getMaxText(this.xAxis),this.maxSmpStringLen)+" vs "+this.shortenText(this.yAxis[0],this.maxSmpStringLen),this.legendFont)}else{if(this.yAxisIndices.length>this.xAxisIndices.length){max=this.measureText(this.shortenText(this.getMaxText(this.yAxis),this.maxSmpStringLen)+" vs "+this.shortenText(this.xAxis[0],this.maxSmpStringLen),this.legendFont)}}}this.legendSampleWidth=(size-1)+max+(this.margin*3);this.legendSampleHeight=(Math.max(this.xAxisIndices.length,this.yAxisIndices.length)*(size+this.margin))+this.margin}};this.drawSampleLegend=function(x0,y0){var xi=x0;var yi=y0;var size=this.getFontPt(this.legendFont);var half=(size-1)/2;y0+=this.margin+half;var maxind=Math.max(this.xAxisIndices.length,this.yAxisIndices.length);for(var i=0;i<maxind;i++){var col=i%this.colors.length;var shp=0;var lab=this.xAxisIndices.length==this.yAxisIndices.length?this.yAxis[i]:this.xAxisIndices.length>this.yAxisIndices.length?this.yAxis[0]:this.xAxis[0];var text=this.shortenText(this.xAxisIndices.length<this.yAxisIndices.length?this.yAxis[i]:this.xAxis[i],this.maxSmpStringLen)+" vs "+this.shortenText(lab,this.maxSmpStringLen);var xp=x0+half+this.margin;var yp=y0+half+this.margin;if(this.colorBy){this[this.shapes[shp]](xp,y0,false,size-1,"open",this.colors[col])}else{this[this.shapes[shp]](xp,y0,this.colors[col],size-1)}this.drawText(text,xp+half+this.margin,y0,this.legendFont,this.legendColor,"left","middle");y0+=size+this.margin}if(this.legendBox){this.rectangleShd(xi,yi,this.legendSampleWidth,this.legendSampleHeight,this.foreground,false,true)}this.addArea(["rect",xi,yi,xi+this.legendSampleWidth,yi+this.legendSampleHeight],[-1],"-legend-sample")};this.setVariableLegendDimension=function(){this.legendVariableWidth=0;this.legendVariableHeight=0;if((this.colorBy&&this.colorBy=="variable")||(this.shapeBy&&this.shapeBy=="variable")||(this.sizeBy&&this.sizeBy=="variable")){var size=this.sizeBy&&this.sizeBy=="variable"?Math.max(this.sizes[this.varIndices.length-1],this.getFontPt(this.legendFont)):this.getFontPt(this.legendFont);var varLabStr=this.shortenText(this.maxVarNameStr,this.maxVarStringLen);this.legendVariableWidth=(size-1)+this.measureText(varLabStr,this.legendFont)+(this.margin*3);this.legendVariableHeight=(this.varIndices.length*(size+this.margin))+this.margin}};this.drawVariableLegend=function(x0,y0){if((this.colorBy&&this.colorBy=="variable")||(this.shapeBy&&this.shapeBy=="variable")||(this.sizeBy&&this.sizeBy=="variable")){var xi=x0;var yi=y0;var size=this.getFontPt(this.legendFont);var max=this.sizeBy&&this.sizeBy=="variable"?Math.max(this.sizes[this.varIndices.length-1],size):size;y0+=this.margin+(max/2);for(var i=0;i<this.varIndices.length;i++){var ii=this.varIndices[i];var col=this.colorBy&&this.colorBy=="variable"?i%this.colors.length:0;var shp=this.shapeBy&&this.shapeBy=="variable"?i%this.shapes.length:0;var siz=this.sizeBy&&this.sizeBy=="variable"?this.sizes[i%this.sizes.length]:max;var half=max/2;var xp=x0+half+this.margin;var yp=y0+half+this.margin;var lab=this.shortenText(this.data.y.vars[ii],this.maxVarStringLen);if(this.colorBy&&this.colorBy!="variable"){this[this.shapes[shp]](xp,y0,false,siz,"open",this.foreground)}else{this[this.shapes[shp]](xp,y0,this.colors[col],siz)}this.drawText(lab,xp+half+this.margin,y0,this.legendFont,this.legendColor,"left","middle");y0+=max+this.margin}if(this.legendBox){this.rectangleShd(xi,yi,this.legendVariableWidth,this.legendVariableHeight,this.foreground,false,true)}this.addArea(["rect",xi,yi,xi+this.legendVariableWidth,yi+this.legendVariableHeight],[-1],"-legend-variable")}};this.setColorLegendIndicatorDimensions=function(){var colors=this.heatmapType.split("-");if(this.heatmapType.split("-").length>1){this.legendColorIndicatorWidth=parseInt(2*256/this.indicatorBins)+(this.margin*4)+1}else{this.legendColorIndicatorWidth=parseInt(256/this.indicatorBins)+(this.margin*4)+1}this.legendColorIndicatorHeight=this.indicatorHeight+(this.margin*3)+this.getFontPt(this.legendFont);if(this.colorBy){this.legendColorIndicatorHeight+=this.getFontPt(this.legendFont)+this.margin}};this.getHeatmapColor=function(min,max,val){var abs=Math.abs(min);min+=abs;max+=abs;val+=abs;var idx=(val*this.heatmapColors.length/max).toFixed()-1;return this.heatmapColors[Math.max(0,idx)]};this.drawColorIndicator=function(x0,y0,min,max,decs){var xi=x0;var yi=y0;var x1=this.indicatorHeight;var y1=this.indicatorHeight;if(this.indicatorsPosition=="bottom"){for(var i=0;i<this.heatmapColors.length;i++){this.line(x0,y0,x0,y0+y1,this.heatmapColors[i]);x0++}x0=xi;y0+=y1+this.margin;this.drawText(sprintf("%."+decs+"f",min),x0,y0,this.legendFont,this.legendColor,"center","top");x0+=(this.heatmapColors.length+0.5)/2;if(this.heatmapColors.length>=10){this.drawText(sprintf("%."+decs+"f",(min+max)/2),x0,y0,this.legendFont,this.legendColor,"center","top")}if(this.colorBy){this.drawText(this.colorBy,x0,y0+this.margin+this.getFontPt(this.legendFont),this.legendFont,this.legendColor,"center","top")}x0+=(this.heatmapColors.length+0.5)/2;this.drawText(sprintf("%."+decs+"f",max),x0,y0,this.legendFont,this.legendColor,"center","top");this.addArea(["rect",xi-(this.margin*2),yi-this.margin,x0+(this.margin*2),y0+this.getFontPt(this.legendFont)+this.margin],[-1],"-legend-indicator-color")}else{y0-=y1;for(var i=0;i<this.heatmapColors.length;i++){this.line(x0,y0,x0+x1,y0,this.heatmapColors[i]);y0--}x0+=x1+this.margin;y0=yi;this.drawText(sprintf("%."+decs+"f",min),x0,y0,this.legendFont,this.legendColor,"center","top",-Math.PI/2);y0-=(this.heatmapColors.length+0.5)/2;if(this.heatmapColors.length>=10){this.drawText(sprintf("%."+decs+"f",(min+max)/2),x0,y0,this.legendFont,this.legendColor,"center","top",-Math.PI/2)}if(this.colorBy){this.drawText(this.colorBy,x0+this.margin+this.getFontPt(this.legendFont),y0,this.legendFont,this.legendColor,"center","top",-Math.PI/2)}y0-=(this.heatmapColors.length+0.5)/2;this.drawText(sprintf("%."+decs+"f",max),x0,y0,this.legendFont,this.legendColor,"center","top",-Math.PI/2);this.addArea(["rect",xi-this.margin,y0-(this.margin*2),x0+this.margin+this.getFontPt(this.legendFont),yi+(this.margin*2)],[-1],"-legend-indicator-color")}};this.setShapeLegendIndicatorDimensions=function(){this.legendShapeIndicatorWidth=(10*(this.indicatorHeight+this.margin))+(this.margin*2);this.legendShapeIndicatorHeight=this.indicatorHeight+(this.margin*3)+this.getFontPt(this.legendFont);if(this.shapeBy){this.legendShapeIndicatorHeight+=this.getFontPt(this.legendFont)+this.margin}};this.drawShapeIndicator=function(x0,y0,min,max,decs){var xi=x0;var yi=y0;var h=this.indicatorHeight/2;var xp=x0;var yp=y0;if(this.indicatorsPosition=="bottom"){for(var i=0;i<10;i++){this["pie"+i](xp,yp+this.margin,this.background,this.indicatorHeight,"open",this.foreground);xp+=this.indicatorHeight+h}x0=xi;y0+=this.indicatorHeight+this.margin;this.drawText(sprintf("%."+decs+"f",min),x0,y0,this.legendFont,this.legendColor,"center","top");x0+=this.indicatorHeight*7;this.drawText(sprintf("%."+decs+"f",(min+max)/2),x0,y0,this.legendFont,this.legendColor,"center","top");if(this.shapeBy){this.drawText(this.shapeBy,x0,y0+this.margin+this.getFontPt(this.legendFont),this.legendFont,this.legendColor,"center","top")}x0+=this.indicatorHeight*7;this.drawText(sprintf("%."+decs+"f",max),x0,y0,this.legendFont,this.legendColor,"center","top");this.addArea(["rect",xi-(this.margin*2),yi-this.margin,x0+(this.margin*2),y0+this.getFontPt(this.legendFont)+this.margin],[-1],"-legend-indicator-shape")}else{for(var i=0;i<10;i++){this["pie"+i](xp+this.margin,yp,this.background,this.indicatorHeight,"open",this.foreground);yp-=this.indicatorHeight+h}x0+=this.indicatorHeight+this.margin;y0=yi;this.drawText(sprintf("%."+decs+"f",min),x0,y0,this.legendFont,this.legendColor,"center","top",-Math.PI/2);y0-=this.indicatorHeight*7;if(this.heatmapColors.length>=10){this.drawText(sprintf("%."+decs+"f",(min+max)/2),x0,y0,this.legendFont,this.legendColor,"center","top",-Math.PI/2)}if(this.shapeBy){this.drawText(this.shapeBy,x0+this.margin+this.getFontPt(this.legendFont),y0,this.legendFont,this.legendColor,"center","top",-Math.PI/2)}y0-=this.indicatorHeight*7;this.drawText(sprintf("%."+decs+"f",max),x0,y0,this.legendFont,this.legendColor,"center","top",-Math.PI/2);this.addArea(["rect",xi-this.margin,y0-(this.margin*2),x0+this.margin+this.getFontPt(this.legendFont),yi+(this.margin*2)],[-1],"-legend-indicator-shape")}};this.setSizeLegendIndicatorDimensions=function(){var w=0;var h=this.indicatorHeight/2;for(var i=0;i<10;i++){w+=this.sizes[i]+h}this.legendSizeIndicatorWidth=(w-(this.sizes[0]+this.sizes[9]))+(this.margin*4);this.legendSizeIndicatorHeight=this.sizes[9]+(this.margin*3)+this.getFontPt(this.legendFont);if(this.sizeBy){this.legendSizeIndicatorHeight+=this.getFontPt(this.legendFont)+this.margin}};this.drawSizeIndicator=function(x0,y0,min,max,decs){var xi=x0;var yi=y0;var h=this.indicatorHeight/2;var mx=this.sizes[9];var xp=x0;var yp=y0;var xm=x0;var ym=y0;if(this.indicatorsPosition=="bottom"){for(var i=0;i<10;i++){var siz=this.sizes[i];this.sphere(xp,yp+(mx/2),this.background,siz,"open",this.foreground);xp+=siz+h;if(i<4){xm+=siz+h}else{if(i==5){xm+=(siz+h)/2}}}y0+=mx+this.margin;this.drawText(sprintf("%."+decs+"f",min),xi,y0,this.legendFont,this.legendColor,"center","top");this.drawText(sprintf("%."+decs+"f",(min+max)/2),xm,y0,this.legendFont,this.legendColor,"center","top");if(this.sizeBy){this.drawText(this.sizeBy,xi+(this.legendColorIndicatorWidth/2),y0+this.margin+this.getFontPt(this.legendFont),this.legendFont,this.legendColor,"center","top")}this.drawText(sprintf("%."+decs+"f",max),xp-(mx+h),y0,this.legendFont,this.legendColor,"center","top");this.addArea(["rect",xi-(this.margin*2),yi-this.margin,(xp-mx)+(this.margin*2),y0+this.getFontPt(this.legendFont)+this.margin],[-1],"-legend-indicator-size")}else{for(var i=0;i<10;i++){var siz=this.sizes[i];this.sphere(xp+(mx/2),yp,this.background,siz,"open",this.foreground);yp-=(siz+h);if(i<4){ym-=(siz+h)}else{if(i==5){ym-=((siz+h)/2)}}}x0+=mx+this.margin;this.drawText(sprintf("%."+decs+"f",min),x0,y0,this.legendFont,this.legendColor,"center","top",-Math.PI/2);this.drawText(sprintf("%."+decs+"f",(min+max)/2),x0,ym,this.legendFont,this.legendColor,"center","top",-Math.PI/2);if(this.sizeBy){this.drawText(this.sizeBy,x0+this.margin+this.getFontPt(this.legendFont),yi-(this.legendColorIndicatorWidth/2),this.legendFont,this.legendColor,"center","top",-Math.PI/2)}this.drawText(sprintf("%."+decs+"f",max),x0,yp+(mx+h),this.legendFont,this.legendColor,"center","top",-Math.PI/2);this.addArea(["rect",xi-this.margin,(yp+(mx+h))-(this.margin*2),x0+this.margin+this.getFontPt(this.legendFont),yi+(this.margin*2)],[-1],"-legend-indicator-size")}};this.setDataColorShapeSizeIndicatorDimensions=function(){this.setColorLegendIndicatorDimensions();this.setShapeLegendIndicatorDimensions();this.setSizeLegendIndicatorDimensions()};this.drawSelectedBackground=function(idx,key,shp,x0,y0,s,w,h,cl){if(this.isSelectDataPoints){if(this.selectDataPoint[idx]){if(this.selectDataPoint[idx].hasOwnProperty(key)){if(w||h){this[shp](x0-4,y0-4,w+8,h+8,this.dragAreaColor,false,false,cl)}else{this[shp](x0,y0,this.dragAreaColor,s+8,false,false,cl)}}}}};this.isVisibleSelectedDataPoint=function(idx,key){if(this.isSelectDataPoints){if(this.hideDataPoint.length>0&&this.hideDataPoint[idx]){if(this.hideDataPoint[idx].hasOwnProperty(key)){return false}}}return true};this.getDiameterLegend=function(){var d;if(this.autoExtend){d=10}else{d=this.x>=600?10:this.x>=400?8:this.x>=200?6:4}return d};this.setColorLegendDimensions=function(is1D){this.legendColorWidth=0;this.legendColorHeight=0;if(this.colorBy){var maxAnnt,maxLab;var d=this.getDiameterLegend();if(is1D&&this.data.x.hasOwnProperty(this.colorBy)){maxAnnt=this.setMaxSmpStringAnnt(this.colorBy);maxLab=this.setMaxSmpStringLabel(this.colorBy)}else{if(this.data.z.hasOwnProperty(this.colorBy)){maxAnnt=this.setMaxVarStringAnnt(this.colorBy);maxLab=this.setMaxVarStringLabel(this.colorBy)}}var maxAnntWidth=this.measureText(maxAnnt,this.legendFont);var maxLabWidth=this.measureText(maxLab,this.legendFont)+d+this.margin;this.legendColorWidth=Math.max(maxAnntWidth,maxLabWidth)+(this.margin*2);var pt=this.getFontPt(this.legendFont);var maxHeight=Math.max(d,pt);this.legendColorHeight=(this.legendColorsN*(maxHeight+this.margin))+pt+(this.margin*3)}};this.drawColorLegend=function(x0,y0){if(this.colorBy&&((this.data.x&&this.data.x.hasOwnProperty(this.colorBy))||(this.data.z&&this.data.z.hasOwnProperty(this.colorBy)))){var d=this.getDiameterLegend();var pt=this.getFontPt(this.legendFont);var hpt=pt/2;var cur=y0+this.margin+hpt;var max=Math.max(d,pt);this.rectangleShd(x0,y0,this.legendColorWidth,this.legendColorHeight,this.background);this.drawText(this.colorBy,x0+(this.legendColorWidth/2),cur,this.legendFont,this.colorLegend,"center","middle");cur+=hpt+this.margin;this.lineShd(x0,cur,x0+this.legendColorWidth,cur,this.foreground);cur+=this.margin+(max/2);for(var col in this.legendColors){this.circleShd(x0+this.margin+(d/2),cur,this.legendColors[col],d);this.drawText(col,x0+(this.margin*2)+d,cur,this.legendFont,this.colorLegend,"left","middle");cur+=this.margin+max}this.addArea(["rect",x0,y0,x0+this.legendColorWidth,y0+this.legendColorHeight],[-1],"-legend-color")}};this.setShapeLegendDimensions=function(){this.legendShapeWidth=0;this.legendShapeHeight=0;if(this.shapeBy&&this.data.z.hasOwnProperty(this.shapeBy)){var d=this.getDiameterLegend();var maxAnnt=this.setMaxVarStringAnnt(this.shapeBy);var maxLab=this.setMaxVarStringLabel(this.shapeBy);var maxAnntWidth=this.measureText(maxAnnt,this.legendFont);var maxLabWidth=this.measureText(maxLab,this.legendFont)+d+this.margin;this.legendShapeWidth=Math.max(maxAnntWidth,maxLabWidth)+(this.margin*2);var pt=this.getFontPt(this.legendFont);var maxHeight=Math.max(d,pt);this.legendShapeHeight=(this.legendShapesN*(maxHeight+this.margin))+pt+(this.margin*3)}};this.drawShapeLegend=function(x0,y0){if(this.shapeBy&&this.data.z.hasOwnProperty(this.shapeBy)){var d=this.getDiameterLegend();var pt=this.getFontPt(this.legendFont);var hpt=pt/2;var cur=y0+this.margin+hpt;var max=Math.max(d,pt);this.rectangleShd(x0,y0,this.legendShapeWidth,this.legendShapeHeight,this.background);this.drawText(this.shapeBy,x0+(this.legendShapeWidth/2),cur,this.legendFont,this.colorLegend,"center","middle");cur+=hpt+this.margin;this.lineShd(x0,cur,x0+this.legendShapeWidth,cur,this.foreground);cur+=this.margin+(max/2);for(var shp in this.legendShapes){this[this.legendShapes[shp]](x0+this.margin+(d/2),cur,this.background,d);this.drawText(shp,x0+(this.margin*2)+d,cur,this.legendFont,this.colorLegend,"left","middle");cur+=this.margin+max}this.addArea(["rect",x0,y0,x0+this.legendShapeWidth,y0+this.legendShapeHeight],[-1],"-legend-shape")}};this.setSizeLegendDimensions=function(){this.legendSizeWidth=0;this.legendSizeHeight=0;if(this.sizeBy&&this.data.z.hasOwnProperty(this.sizeBy)){var d=this.sizes[this.legendSizesN-1];var maxAnnt=this.setMaxVarStringAnnt(this.sizeBy);var maxLab=this.setMaxVarStringLabel(this.sizeBy);var maxAnntWidth=this.measureText(maxAnnt,this.legendFont);var maxLabWidth=this.measureText(maxLab,this.legendFont)+d+this.margin;this.legendSizeWidth=Math.max(maxAnntWidth,maxLabWidth)+(this.margin*2);var pt=this.getFontPt(this.legendFont);var maxHeight=Math.max(d,pt);this.legendSizeHeight=(this.legendSizesN*(maxHeight+this.margin))+pt+(this.margin*3)}};this.drawSizeLegend=function(x0,y0){if(this.sizeBy&&this.data.z.hasOwnProperty(this.sizeBy)){var d=this.sizes[this.legendSizesN-1];var pt=this.getFontPt(this.legendFont);var hpt=pt/2;var cur=y0+this.margin+hpt;var max=Math.max(d,pt);this.rectangleShd(x0,y0,this.legendSizeWidth,this.legendSizeHeight,this.background);this.drawText(this.sizeBy,x0+(this.legendSizeWidth/2),cur,this.legendFont,this.colorLegend,"center","middle");cur+=hpt+this.margin;this.lineShd(x0,cur,x0+this.legendSizeWidth,cur,this.foreground);cur+=this.margin+(max/2);for(var siz in this.legendSizes){this.circleShd(x0+this.margin+(d/2),cur,this.background,this.legendSizes[siz]);this.drawText(siz,x0+(this.margin*2)+d,cur,this.legendFont,this.colorLegend,"left","middle");cur+=this.margin+max}this.addArea(["rect",x0,y0,x0+this.legendSizeWidth,y0+this.legendSizeHeight],[-1],"-legend-size")}};this.setDataColorShapeSizeDimensions=function(){this.setColorLegendDimensions();this.setShapeLegendDimensions();this.setSizeLegendDimensions()};this.setDataColor=function(is1D){if(this.colorBy){var idx=0;var track={};var yellow="rgb(255,255,0)";this.dataColors=[];this.legendColors={};this.legendColorsN=0;if(is1D){if(!this.isGroupedData&&this.data.x&&this.data.x.hasOwnProperty(this.colorBy)){if(this.isNumeric(this.data.x[this.colorBy],true)){var range=this.range(this.data.x[this.colorBy],true);for(var i=0;i<this.smpIndices.length;i++){var ii=this.smpIndices[i];var val=this.data.x[this.colorBy][ii];var col=!isNaN(val)?this.getHeatmapColor(range[0],range[1],val):yellow;this.dataColors.push(col)}this.legendColorsN=-1;this.legendColorRange=range;this.legendColorDecs=this.getAxisDecimals(this.getAxisIncrements(range[0],range[1],this.heatmapColors.length));this.setColorLegendIndicatorDimensions()}else{for(var i=0;i<this.smpIndices.length;i++){var ii=this.smpIndices[i];var col=this.data.x[this.colorBy][ii];if(!track.hasOwnProperty(col)){track[col]=idx%this.colors.length;this.legendColors[col]=this.colors[track[col]];idx++}this.dataColors.push(this.colors[track[col]])}this.legendColorsN=idx;this.setColorLegendDimensions(is1D)}}}else{if(this.data.z&&this.data.z.hasOwnProperty(this.colorBy)){if(this.isNumeric(this.data.z[this.colorBy],false,true)){var range=this.range(this.data.z[this.colorBy],false,true);for(var i=0;i<this.varIndices.length;i++){var ii=this.varIndices[i];var val=this.data.z[this.colorBy][ii];if(!isNaN(val)){this.dataColors.push(this.getHeatmapColor(range[0],range[1],val))}else{this.dataColors.push(yellow)}}this.legendColorRange=range;this.legendColorDecs=this.getAxisDecimals(this.getAxisIncrements(range[0],range[1],this.heatmapColors.length));this.setColorLegendIndicatorDimensions()}else{for(var i=0;i<this.varIndices.length;i++){var ii=this.varIndices[i];var col=this.data.z[this.colorBy][ii];if(!track.hasOwnProperty(col)){track[col]=idx%this.colors.length;this.legendColors[col]=this.colors[track[col]];idx++}this.dataColors.push(this.colors[track[col]])}this.legendColorsN=idx;this.setColorLegendDimensions()}}else{if(this.getSampleIndices(this.colorBy)>-1){idx=this.getSampleIndices(this.colorBy);var range=this.getAxisRangeBySample(idx);for(var i=0;i<this.varIndices.length;i++){var ii=this.varIndices[i];var val=this.getDataAtPos(ii,idx);if(!isNaN(val)){this.dataColors.push(this.getHeatmapColor(range[0],range[1],val))}else{this.dataColors.push(yellow)}}this.legendColorRange=range;this.legendColorDecs=this.getAxisDecimals(this.getAxisIncrements(range[0],range[1],this.heatmapColors.length));this.setColorLegendIndicatorDimensions()}else{if(this.colorBy=="variable"){for(var i=0;i<this.varIndices.length;i++){var col=i%this.colors.length;this.dataColors.push(this.colors[col])}this.setVariableLegendDimension()}else{for(var i=0;i<this.varIndices.length;i++){this.dataColors.push(this.colors[0])}}}}}}};this.setDataShape=function(){if(this.shapeBy){var idx=0;var track={};var square="square";this.dataShapes=[];this.legendShapes={};this.legendShapesN=0;if(this.data.z&&this.data.z.hasOwnProperty(this.shapeBy)){if(this.isNumeric(this.data.z[this.shapeBy],false,true)){var range=this.range(this.data.z[this.shapeBy],false,true);for(var i=0;i<this.varIndices.length;i++){var ii=this.varIndices[i];var val=this.data.z[this.shapeBy][ii];if(!isNaN(val)){var prc=this.percentile(range[0],range[1],val);var shp=parseInt(prc/10);if(shp>0){shp--}this.dataShapes.push("pie"+shp)}else{this.dataShapes.push(square)}}this.legendShapeRange=range;this.legendShapeDecs=this.getAxisDecimals(this.getAxisIncrements(range[0],range[1],10));this.setShapeLegendIndicatorDimensions()}else{for(var i=0;i<this.varIndices.length;i++){var ii=this.varIndices[i];var shp=this.data.z[this.shapeBy][ii];if(!track.hasOwnProperty(shp)){track[shp]=idx%this.shapes.length;this.legendShapes[shp]=this.shapes[track[shp]];idx++}this.dataShapes.push(this.shapes[track[shp]])}this.legendShapesN=idx;this.setShapeLegendDimensions()}}else{if(this.getSampleIndices(this.shapeBy)>-1){idx=this.getSampleIndices(this.shapeBy);var range=this.getAxisRangeBySample(idx);for(var i=0;i<this.varIndices.length;i++){var ii=this.varIndices[i];var val=this.getDataAtPos(ii,idx);if(!isNaN(val)){var prc=this.percentile(range[0],range[1],val);var shp=parseInt(prc/10);if(shp>0){shp--}this.dataShapes.push("pie"+shp)}else{this.dataShapes.push(square)}}this.legendShapeRange=range;this.legendShapeDecs=this.getAxisDecimals(this.getAxisIncrements(range[0],range[1],10));this.setShapeLegendIndicatorDimensions()}else{if(this.shapeBy=="variable"){for(var i=0;i<this.varIndices.length;i++){var shp=i%this.shapes.length;this.dataShapes.push(this.shapes[shp])}this.setVariableLegendDimension()}else{for(var i=0;i<this.varIndices.length;i++){this.dataShapes.push(this.shapes[0])}}}}}};this.setDataSize=function(){if(this.sizeBy){var idx=0;var track={};this.dataSizes=[];this.legendSizes={};this.legendSizesN=0;if(this.data.z&&this.data.z.hasOwnProperty(this.sizeBy)){if(this.isNumeric(this.data.z[this.sizeBy],false,true)){var range=this.range(this.data.z[this.sizeBy],false,true);for(var i=0;i<this.varIndices.length;i++){var ii=this.varIndices[i];var val=this.data.z[this.sizeBy][ii];if(!isNaN(val)){var prc=this.percentile(range[0],range[1],val);var siz=parseInt(prc/10);if(siz>0){siz--}this.dataSizes.push(this.sizes[siz])}else{this.dataSizes.push(0)}}this.legendSizeRange=range;this.legendSizeDecs=this.getAxisDecimals(this.getAxisIncrements(range[0],range[1],10));this.setSizeLegendIndicatorDimensions()}else{for(var i=0;i<this.varIndices.length;i++){var ii=this.varIndices[i];var siz=this.data.z[this.sizeBy][ii];if(!track.hasOwnProperty(siz)){track[siz]=idx%this.sizes.length;this.legendSizes[siz]=this.sizes[track[siz]];idx++}this.dataSizes.push(this.sizes[track[siz]])}this.legendSizesN=idx;this.setSizeLegendDimensions()}}else{if(this.getSampleIndices(this.sizeBy)>-1){idx=this.getSampleIndices(this.sizeBy);var range=this.getAxisRangeBySample(idx);for(var i=0;i<this.varIndices.length;i++){var ii=this.varIndices[i];var val=this.getDataAtPos(ii,idx);if(!isNaN(val)){var prc=this.percentile(range[0],range[1],val);var siz=parseInt(prc/10);if(siz>0){siz--}this.dataSizes.push(this.sizes[siz])}else{this.dataSizes.push(0)}}this.legendSizeRange=range;this.legendSizeDecs=this.getAxisDecimals(this.getAxisIncrements(range[0],range[1],10));this.setSizeLegendIndicatorDimensions()}else{if(this.sizeBy=="variable"){for(var i=0;i<this.varIndices.length;i++){var siz=i%this.sizes.length;this.dataSizes.push(this.sizes[siz])}this.setVariableLegendDimension()}else{for(var i=0;i<this.varIndices.length;i++){this.dataSizes.push(this.scatterPointSize)}}}}}};this.setDataColorShapeSize=function(){this.setLegendFont();this.setDataColor();this.setDataShape();this.setDataSize();if(this.graphType=="Scatter2D"||this.graphType=="ScatterBubble2d"){this.setSampleLegendDimension()}};this.setLegendDimensions=function(){this.legendLayout=[];var width=this.margin;var height=this.margin;if(this.showIndicators){var inds=["Color","Shape","Size"];for(var i=0;i<inds.length;i++){var w=this["legend"+inds[i]+"IndicatorWidth"];var h=this["legend"+inds[i]+"IndicatorHeight"];if(w){if(this.indicatorsPosition=="bottom"){height+=this.margin+h}else{width+=this.margin+h}}}}var lw=0;var lh=0;var idx=0;if(this.showLegend){var legends=["Color","Shape","Size","Variable","Sample"];for(var i=0;i<legends.length;i++){var w=this["legend"+legends[i]+"Width"];var h=this["legend"+legends[i]+"Height"];if(w>0){if(this.legendPosition=="right"){if(lh+this.margin+h>this.height){width+=this.margin+w;lw=w;lh=h;idx++;this.legendLayout[idx]=[legends[i]]}else{if(w>lw){width+=(w-lw);lw=w}lh+=h;if(!this.legendLayout[idx]){this.legendLayout[idx]=[]}this.legendLayout[idx].push(legends[i])}}else{if(lw+this.margin+w>this.width){height+=this.margin+h;lw=w;lh=h;idx++;this.legendLayout[i]=[legends[i]]}else{if(h>lh){height+=(h-lh);lh=h}lw+=w;if(!this.legendLayout[idx]){this.legendLayout[idx]=[]}this.legendLayout[idx].push(legends[i])}}}}}this.legendWidth=width+this.margin;this.legendHeight=height+this.margin};this.getXYLegendCoords=function(leg,l,t){var w,h,x,y;var maxw=0;var maxh=0;var ii=-1;var jj=-1;if(this.legendLayout){for(var i=0;i<this.legendLayout.length;i++){w=0;h=0;for(var j=0;j<this.legendLayout[i].length;j++){if(this.legendLayout[i][j]==leg){jj=j}w+=this["legend"+this.legendLayout[i][j]+"Width"]+this.margin;h+=this["legend"+this.legendLayout[i][j]+"Height"]+this.margin;maxw=Math.max(maxw,w);maxh=Math.max(maxh,h)}if(jj>-1){ii=i;break}}if(this.legendPosition=="right"){t=jj==0?this.offsetY+this.top:t;x=l;y=jj==0?this.offsetY+this.top+((this.y-maxh)/2):t;l=jj==this.legendLayout[ii].length-1?l+maxw:l;t=y+this["legend"+this.legendLayout[ii][jj]+"Height"]+this.margin}else{l=jj==0?this.offsetX+this.left:l;x=jj==0?this.offsetX+this.left+((this.x-maxw)/2)+this.margin:l+this.margin;y=t;l=x+this["legend"+this.legendLayout[ii][jj]+"Width"]+this.margin;t=jj==this.legendLayout[ii].length-1?t+maxh:t}}return[x,y,l,t]};this.drawScatterLegend=function(){var left=this.offsetX+this.left+this.x;var top=this.offsetY+this.top+this.y;if(this.showIndicators){var w,h;var x0,y0;if(this.graphType=="Scatter2D"||this.graphType=="ScatterBubble2D"){left+=(this.margin*2);top+=this.get2DXAxisHeight()+this.margin;if(this.graphType=="ScatterBubble2D"&&this.zAxisShow){left+=this.getFontPt(this.axisTitleFont)+(this.margin*2)}}var inds=["Color","Shape","Size"];for(var i=0;i<inds.length;i++){w=this["legend"+inds[i]+"IndicatorWidth"];h=this["legend"+inds[i]+"IndicatorHeight"];if(w){var func="draw"+inds[i]+"Indicator";var range=this["legend"+inds[i]+"Range"];var decs=this["legend"+inds[i]+"Decs"];if(this.indicatorsPosition=="bottom"){x0=this.offsetX+this.left+((this.x-w)/2);y0=top;this[func](x0,y0,range[0],range[1],decs);top+=h+this.margin}else{x0=left;y0=this.offsetY+this.top+(this.y-((this.y-w)/2));this[func](x0,y0,range[0],range[1],decs);left+=h+this.margin}}}}if(this.showLegend){var legends=["Color","Shape","Size","Variable","Sample"];for(var i=0;i<legends.length;i++){w=this["legend"+legends[i]+"Width"];h=this["legend"+legends[i]+"Height"];if(w>0){var func="draw"+legends[i]+"Legend";var coords=this.getXYLegendCoords(legends[i],left,top);this[func](coords[0],coords[1]);if(this.legendPosition=="right"){top=coords[3]+this.margin}else{left=coords[2]+this.margin}}}}};this.set3DRotation=function(){var rad;var lim=0;var min=0;if(this.graphType=="Network"){lim=360;min=360}else{if(this.graphType=="Scatter3D"){lim=90;min=0}}if(this.xRotate>lim){this.xRotate=lim}if(this.xRotate<0){this.xRotate=min}if(this.yRotate>lim){this.yRotate=lim}if(this.yRotate<0){this.yRotate=min}if(this.zRotate>lim){this.zRotate=lim}if(this.zRotate<0){this.zRotate=min}if(this.xRotate>0){rad=180/this.xRotate;this.ry=Math.PI/rad}else{this.ry=0}if(this.yRotate>0){rad=180/this.yRotate;this.rx=Math.PI/rad}else{this.rx=0}if(this.zRotate>0){rad=180/this.zRotate;this.rz=Math.PI/rad}else{this.rz=0}};this.set3DParams=function(){this.perspective=this.x*1.5;this.len=this.x/4;this.pad=this.x/2};this.get3DTransfrom=function(xp,yp,zp){var ox,oy,oz;var arr=[];oy=yp;oz=zp;yp=oy*Math.cos(this.rx)-oz*Math.sin(this.rx);zp=oy*Math.sin(this.rx)+oz*Math.cos(this.rx);ox=xp;oz=zp;xp=oz*Math.sin(this.ry)+ox*Math.cos(this.ry);zp=oz*Math.cos(this.ry)-ox*Math.sin(this.ry);ox=xp;oy=yp;xp=ox*Math.cos(this.rz)-oy*Math.sin(this.rz);yp=ox*Math.sin(this.rz)+oy*Math.cos(this.rz);xp=xp*(this.perspective/(zp+this.perspective));yp=yp*(this.perspective/(zp+this.perspective));arr.push(xp+this.pad);arr.push(yp+this.pad);arr.push(zp+this.pad);return arr};this.load=function(url,callback,format,method){format=format=="json"?"json":"text";method=method=="POST"?"POST":"GET";var http=false;if(window.XMLHttpRequest){try{http=new XMLHttpRequest()}catch(e){http=false}}else{if(typeof ActiveXObject!="undefined"){try{http=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{http=new ActiveXObject("Microsoft.XMLHTTP")}catch(E){http=false}}}}if(http&&url&&callback){var now="uid="+new Date().getTime();url+=(url.indexOf("?")+1)?"&":"?";url+=now;http.open(method,url,true);if(method=="GET"){if(http.overrideMimeType){http.overrideMimeType("text/xml")}}else{var parameters=false;var parts=url.split("?");url=parts[0];parameters=parts[1];http.setRequestHeader("Content-type","application/x-www-form-urlencoded");http.setRequestHeader("Content-length",parameters.length);http.setRequestHeader("Connection","close")}http.onreadystatechange=function(){if(http.readyState==4){if(http.status==200){var result="";if(http.responseText){result=http.responseText}if(format=="json"){result=result.replace(/[\n\r]/g,"");result=eval("("+result+")")}if(callback){callback(result)}}else{if(error){error(http.status)}}}};http.send(parameters)}}};CanvasXpress.prototype.initApi=function(){this.getValidGraphTypes=function(){return this.validGraphTypes};this.setHeatmapScheme=function(){this.initializeAttributes()};this.hasIndicator=function(){if(this.graphType.match(/Scatter/)||this.graphType=="Bar"){return true}else{return false}};this.hasLegend=function(){if(this.graphType!="Network"&&this.graphType!="Genome"&&this.graphType!="Correlation"&&this.graphType!="Heatmap"){return true}else{return false}};this.hasLegendProperties=function(){if(this.graphType!="Network"&&this.graphType!="Genome"&&this.graphType!="Correlation"&&this.graphType!="Heatmap"&&this.graphType!="Pie"){return true}else{return false}};this.hasData=function(){if(this.graphType!="Network"&&this.graphType!="Genome"&&this.graphType!="Venn"){return true}else{return false}};this.hasDataSamples=function(){if(this.graphType!="Network"&&this.graphType!="Genome"&&this.graphType!="Venn"&&this.graphType!="Pie"&&!this.graphType.match(/Scatter/)){if(this.graphType=="Correlation"&&this.correlationAxis!="samples"){return false}return true}else{return false}};this.hasDataGroups=function(){if(this.graphType!="Network"&&this.graphType!="Genome"&&this.graphType!="Venn"&&this.graphType!="Pie"&&!this.graphType.match(/Scatter/)){if(this.graphType=="Correlation"&&this.correlationAxis!="samples"){return false}if(this.data.x){return true}else{return false}}else{return false}};this.hasDataVariables=function(){if(this.graphType!="Network"&&this.graphType!="Genome"&&this.graphType!="Venn"){if(this.graphType=="Correlation"&&this.correlationAxis!="variables"){return false}return true}else{return false}};this.hasDataProperties=function(){if(this.graphType!="Network"&&this.graphType!="Genome"&&this.graphType!="Heatmap"&&this.graphType!="Venn"&&this.graphType!="Pie"&&this.graphType!="Correlation"){return true}else{return false}};this.hasOrientation=function(){if(this.graphType!="Network"&&this.graphType!="Genome"&&this.graphType!="Venn"&&this.graphType!="Pie"&&this.graphType!="Correlation"&&!this.graphType.match(/Scatter/)){return true}else{return false}};this.hasOverlays=function(){if(this.graphType!="Network"&&this.graphType!="Genome"&&this.graphType!="Venn"&&this.graphType!="Pie"&&this.graphType!="Correlation"&&!this.graphType.match(/Scatter/)){return true}else{return false}};this.hasDendrograms=function(){if(this.graphType!="Heatmap"&&(this.data.t.smps||this.data.t.vars)){return true}else{return false}};this.hasDecorations=function(){return this.data.d&&(this.data.d.nlfit||this.data.d.reg||this.data.d.nor||this.data.d.area)?true:false};this.isSegregable=function(){if(this.graphType!="Network"&&this.graphType!="Genome"&&this.graphType!="Venn"&&this.graphType!="Pie"&&this.graphType!="Correlation"&&!this.graphType.match(/Scatter/)){return true}else{return false}};this.getLineTypes=function(){var e=["line"];var c=["","dashed","dotted","bezierY","bezierX","curved"];var a=["arrow","arrowHead","arrowTail","arrowHeadSquareTail","arrowTailSquareHead","square","squareHead","squareTail","squareHeadArrowTail","squareTailArrowHead"];for(var d=0;d<a.length;d++){e.push(a[d]+"Line")}for(var d=1;d<c.length;d++){for(var b=0;b<a.length;b++){e.push(c[d]+this.capitalize(a[b])+"Line")}}return e};this.isValidShape=function(b){for(var a=0;a<this.shapes.length;a++){if(this.shapes[a]==b){return true}}return false};this.modifyHighlights=function(c,b,d){var a=d?"highlightVar":"highlightSmp";this.modifyObjectArray(c,b,a)};this.getHighlights=function(b){var a=b?this.highlightVar:this.highlightSmp;return this.getObjectArray(a)};this.modifySmpOverlays=function(b,a){this.modifyObjectArray(b,a,"smpOverlays")};this.modifyVarOverlays=function(b,a){this.modifyObjectArray(b,a,"varOverlays")};this.getSmpOverlays=function(){return this.getObjectArray(this.smpOverlays)};this.getVarOverlays=function(){return this.getObjectArray(this.varOverlays)};this.clusterSamples=function(){this.clusterAxis="samples";this.showSmpDendrogram=true;if(!this.data.t){this.data.t={}}this.data.t.smps=this.cluster();this.draw()};this.clusterVariables=function(){this.clusterAxis="variables";this.showVarDendrogram=true;if(!this.data.t){this.data.t={}}this.data.t.vars=this.cluster();this.draw()};this.kmeansSamples=function(){this.clusterAxis="samples";this.showOverlays=true;if(!this.data.x){this.data.x={}}this.data.x["k-Means"]=this.kmeans();this.smpOverlays.push("k-Means");this.draw()};this.kmeansVariables=function(){this.clusterAxis="variables";this.showOverlays=true;if(!this.data.z){this.data.z={}}this.data.z["k-Means"]=this.kmeans();this.varOverlays.push("k-Means");this.draw()}};CanvasXpress.prototype.initText=function(){this.drawText=function(o,l,i,g,h,k,j,d,e,p){if(!o){return}if(!this.ctx){if(this.debug){alert("Dude, there is no canvas")}return}if(isNaN(l)||isNaN(i)){if(this.debug){alert("Not a valid coordinate ("+l+", "+i+") to draw "+o)}return}if(d<(Math.PI/-2)||d>(Math.PI/2)){if(this.debug){alert("Dude, you can only rotate between -PI/2 and PI/2")}return}if(!isNaN(o)){o=this.formatNumber(o)}if(!l){l=0}if(!i){i=0}if(!g){g=this.font}if(!h){h=this.foreground}if(!k){k=this.align}if(!j){j=this.baseline}if(e){var n=this.measureText(o,g);while(n>e){o=o.substring(0,o.length-1);n=this.measureText(o,g)}}this.ctx.save();this.ctx.strokeStyle=h;this.ctx.fillStyle=h;this.ctx.font=g;this.ctx.save();this.ctx.translate(l,i);this.ctx.textAlign=k;this.ctx.textBaseline=j;if(this.showShadow){this.ctx.shadowOffsetX=this.shadowOffsetX;this.ctx.shadowOffsetY=this.shadowOffsetY;this.ctx.shadowBlur=this.shadowBlur;this.ctx.shadowColor=this.shadowColor}if(d){this.ctx.rotate(d)}if(p){this.ctx.strokeText(o,0,0)}else{this.ctx.fillText(o,0,0)}this.ctx.restore();if(this.showShadow){this.ctx.shadowOffsetX=0;this.ctx.shadowOffsetY=0;this.ctx.shadowBlur=0;this.ctx.shadowColor=this.background}return o};this.capitalize=function(a){if(a){return a.charAt(0).toUpperCase()+a.slice(1)}};this.measureText=function(a,b){if(!this.ctx){return 0}if(!b){b=this.font}this.ctx.font=b;return this.ctx.measureText(a).width};this.scaleTextToFont=function(b,d,a){var c=d+"pt "+this.fontName;if(b){while(this.measureText(b,c)>a&&d>=this.minTextSize){d-=2;c=d+"pt "+this.fontName}}return c};this.getFontPt=function(a){return parseInt(a.match(/^\d+/)[0])};this.scaleTextToSize=function(a){var d=this.scaleTextConstantMult;if(!a){a=1}return Math.ceil(1/Math.sqrt(a)*d)};this.formatNumber=function(c){if(c.toString().length>=7){var b=sprintf("%.2e",Number(c));var a=sprintf("%.2f",Number(c));if(a.toString().length>b.toString().length){return b.toString()}else{return a.toString()}}else{return c.toString()}};this.getMaxText=function(c){var e="";var b=0;for(var d=0;d<c.length;d++){if(c[d].length>b){e=c[d];b=c[d].length}}return e};this.shortenText=function(b,a){if(b.length<=a){return b}else{return b.substring(0,a-3)+" ..."}};this.convertToNumber=function(a){if(!isNaN(a)){return parseFloat(a)}else{return a}}};CanvasXpress.prototype.initTime=function(){this.times={second:1000,minute:60000,hour:3600000,day:86400000,week:604800000,month:2592000000,year:31556952000};this.parseDate=function(c){var e=parseInt(c.toString().substring(0,4));var a=c.toString().substring(4,6);var b=parseInt(c.toString().substring(6,8));a=parseInt(a.replace(/^0/,""));return new Date(e,a-1,b,0,0)};this.createRandomTimes=function(b){var e;var g=new Date();var a=g.getTime();var f=[a];var h=this.isGroupedData?this.data.w:this.data.y;if(!b||!this.times[b]){b="day"}for(var c=0;c<h.smps.length;c++){e=Date.parse(h.smps[c]);if(!isNaN(e)){a=e}else{a-=this.times[b]}f.unshift(a)}return f};this.validateTimeAxis=function(){var f=this.isGroupedData?this.data.w:this.data.y;var a=false;var e=[];for(var b=0;b<this.smpIndices.length;b++){var c=this.smpIndices.length!=f.smps.length?Date.parse(f.smps[this.smpIndices[b]]):Date.parse(f.smps[b]);if(isNaN(c)){if(this.isExample){e=this.createRandomTimes();return e}else{a=true;break}}else{e.push(c)}}if(this.smpIndices.length==f.smps.length){this.smpIndices.sort(function(g,d){return e[g]-e[d]});e.sort()}else{e.sort();this.smpIndices.sort(function(g,d){return e[d]-e[g]||0})}return a?false:e};this.setTimeAxis=function(){var c=this.validateTimeAxis();if(c){this.timeValues=[];this.timeValueIndices=[];var g=c.length;var a=c[g-1]-c[0];var b=0;if(g<this.timeTicks){b=1}else{b=Math.ceil(g/this.timeTicks)}var f=b-1;while(f<g){var e=c[f];this.timeValues.push(dateFormat(new Date(e),this.timeFormat));this.timeValueIndices.push(f);f+=b}}else{alert("Not valid dates");this.isGraphTime=false}}};CanvasXpress.prototype.initAttributes=function(){this.validateNumbers=function(b){for(var c=0;c<b.length;c++){if(isNaN(b[c])){return false}}return true};this.clip=function(q,f,i){var d,c,n,k,g,m,q;var o,e,a,j;var p=[];if(i&&i.length==4){o=i[0];e=i[1];a=e+i[2];j=o+i[3]}else{o=this.layoutComb?this.offsetY+this.top:this.top;e=this.layoutComb?this.offsetX+this.left:this.left;a=e+this.x;j=o+this.y}if(q=="rect"){d=parseInt(f[0]);n=parseInt(f[1]);c=parseInt(d+f[2]);k=parseInt(n+f[3]);if(d>a||k>j||c<e||n<o){return false}if(d<e){d=e}if(c>a){c=a}if(k<o){k=o}if(n>j){n=j}p=[d,n,c-d,k-n]}else{if(q=="poly"){}else{if(q=="circle"){d=parseInt(f[0]);n=parseInt(f[1]);if(d>a||d<e||n<o||n>j){return false}p=[d,n]}else{if(q=="line"){d=parseFloat(f[0]);n=parseFloat(f[1]);c=parseFloat(f[2]);k=parseFloat(f[3]);if(d==c){if(d<e||d>a){return false}else{if(n>k){if(n<o){return false}else{if(n>j){n=j}}if(k>j){return false}else{if(k<o){k=o}}}else{if(n>j){return false}else{if(n<o){n=o}}if(k<o){return false}else{if(k>j){k=j}}}}}else{if(n==k){if(n<o||n>j){return false}else{if(d>c){if(d<e){return false}else{if(d>a){d=a}}if(c>a){return false}else{if(c<e){c=e}}}else{if(d>a){return false}else{if(d<e){d=e}}if(c<e){return false}else{if(c>a){c=a}}}}}else{if(d>c){if(d<e||c>a){return false}else{if(n>k){if(n<o||k>j){return false}else{g=n-k;m=d-c;if(n>j){q=n-j;q=q*m/g;d=c+q;n=j}else{if(d>a){q=d-a;q=q*g/m;d=a;n-=q}}if(k<o){q=o-k;q=q*m/g;c+=q;k=o}else{if(c<e){q=e-c;q=q*g/m;c=e;k=n-q}}}}else{if(k<o||n>j){return false}else{g=k-n;m=d-c;if(n<o){q=o-n;q=q*m/g;d-=q;n=o}else{if(d>a){q=d-a;q=q*g/m;d=a;n=k-q}}if(k>j){q=k-j;q=q*m/g;c=d-q;k=j}else{if(c<e){q=e-c;q=q*g/m;c=e;k-=q}}}}}}else{if(c<e||d>a){return false}else{if(n>k){if(n<o||k>j){return false}else{g=n-k;m=c-d;if(n>j){q=n-j;q=q*m/g;d=c-q;n=j}else{if(d<e){q=e-d;q=q*g/m;d=e;n-=q}}if(k<o){q=o-k;q=q*m/g;c-=q;k=o}else{if(c>a){q=c-a;q=q*g/m;c=a;k=n-q}}}}else{if(k<o||n>j){return false}else{g=k-n;m=c-d;if(n<o){q=o-n;q=q*m/g;d+=q;n=o}else{if(d<e){q=e-d;q=q*g/m;d=e;n=k-q}}if(k>j){q=k-j;q=q*m/g;c=d+q;k=j}else{if(c>a){q=c-a;q=q*g/m;c=a;k-=q}}}}}}}}p=[d,n,c,k]}else{return false}}}}return p};this.setShapeStyle=function(b,d,a){if(d){d=this.validateColor(d)||this.foreground}if(b=="open"){this.ctx.strokeStyle=a?a:this.foreground}else{this.ctx.strokeStyle=a?a:this.foreground;this.ctx.fillStyle=d?d:this.foreground}if(this.showShadow){this.ctx.shadowOffsetX=this.shadowOffsetX;this.ctx.shadowOffsetY=this.shadowOffsetY;this.ctx.shadowBlur=this.shadowBlur;this.ctx.shadowColor=this.shadowColor}};this.renderShapeStyle=function(a){if(a=="open"){this.ctx.stroke()}else{this.ctx.stroke();this.ctx.fill()}if(this.showShadow){this.ctx.restore();this.ctx.shadowOffsetX=0;this.ctx.shadowOffsetY=0;this.ctx.shadowBlur=0;this.ctx.shadowColor=this.background}};this.arrowHead=function(E,i,C,g,I,w,K,k){if(this.validateNumbers([E,i,C,g])){var A=(this.arrowPointSize/2)-1;if(A<1){A=1}var D=Math.floor((this.arrowPointSize/2.5));var L=w?[[0,-this.arrowPointSize],[0,this.arrowPointSize]]:[[D,0],[-this.arrowPointSize,-A],[-this.arrowPointSize,A]];var J=function(b,a,e){var c=[];for(var d in b){c.push([b[d][0]+a,b[d][1]+e])}return c};var m=function(c,b,d){return[(b*Math.cos(c))-(d*Math.sin(c)),(b*Math.sin(c))+(d*Math.cos(c))]};var y=function(c,b){var d=[];for(var e in c){d.push(m(b,c[e][0],c[e][1]))}return d};var t=C-E;var o=g-i;if(K){if(K=="Y"){if(Math.abs(o)>Math.abs(t)){t=0}else{t=C>E?this.arrowPointSize:-this.arrowPointSize}}else{if(Math.abs(t)>Math.abs(o)){o=0}else{o=g>i?this.arrowPointSize:-this.arrowPointSize}}}else{if(k){var z=this.lineLength(E,i,C,g);var G=this.shortenLine(E,i,C,g,0,z/2,"line");var n=G[2];var B=G[3];var v=z/2;var j=k/v;var u=C>E?Math.asin((B-i)/v):Math.asin(-(B-i)/v);var F=u-(Math.PI/20);if(C>E){E=n+v*Math.cos(F-j);i=B+v*Math.sin(F-j);C=n+v*Math.cos(u-j);g=B+v*Math.sin(u-j)}else{E=n+v*Math.cos((F-j)+Math.PI);i=B+v*Math.sin((F-j)+Math.PI);C=n+v*Math.cos((u-j)+Math.PI);g=B+v*Math.sin((u-j)+Math.PI)}t=C-E;o=g-i}}var H=Math.atan2(o,t);var u=J(y(L,H),C,g);this.ctx.fillStyle=I;this.ctx.strokeStyle=I;this.ctx.beginPath();if(this.showShadow){this.ctx.shadowOffsetX=this.shadowOffsetX;this.ctx.shadowOffsetY=this.shadowOffsetY;this.ctx.shadowBlur=this.shadowBlur;this.ctx.shadowColor=this.shadowColor}this.ctx.moveTo(u[0][0],u[0][1]);for(var x in u){if(x>0){if(!isNaN(u[x][0])&&!isNaN(u[x][1])){this.ctx.lineTo(u[x][0],u[x][1])}}}if(!w){if(!isNaN(u[0][0])&&!isNaN(u[0][1])){this.ctx.lineTo(u[0][0],u[0][1])}this.ctx.fill()}else{this.ctx.stroke()}this.ctx.closePath();if(this.showShadow){this.ctx.restore();this.ctx.shadowOffsetX=0;this.ctx.shadowOffsetY=0;this.ctx.shadowBlur=0;this.ctx.shadowColor=this.background}}};this.lineLength=function(b,d,a,c){return Math.sqrt(Math.pow(a-b,2)+Math.pow(c-d,2))};this.shortenLine=function(b,j,a,i,k,f,l){if(this.validateNumbers([b,j,a,i,k,f])){if(l.match(/bezier/)){if(l.match(/beziery/i)){return i>j?[b,j+k,a,i-f]:[b,j-k,a,i+f]}else{return a>b?[b+k,j,a-f,i]:[b-k,j,a+f,i]}}else{if(l.match(/curved/)){return[b,j,a,i]}else{var c=Math.atan2(i-j,a-b);var d=Math.cos(c);var h=Math.sin(c);var g=this.lineLength(b,j,a,i);if(g){b+=d*k;j+=h*k;a-=d*f;i-=h*f}}}return[b,j,a,i]}};this.dashedLine=function(s,d,r,b,t){if(this.validateNumbers([s,d,r,b])){var u=["poly",s+1,d,r+1,b,r-1,b,s-1,d];var f=r;var e=b;var l=r-s;var k=b-d;var m=Math.atan2(k,l);var o=Math.cos(m);var a=Math.sin(m);var h=this.lineLength(s,d,r,b);var p=Math.floor(h/(this.dashLength*2));if(p){var j=o*this.dashLength;var g=a*this.dashLength;r=s+j;b=d+g;for(var q=0;q<p;q++){this.line(s,d,r,b,t);s+=(j*2);d+=(g*2);r=s+j;b=d+g}this.line(s,d,f,e,t);return u}}};this.dottedLine=function(d,r,b,q,l){if(this.validateNumbers([d,r,b,q])){var j=["poly",d+1,r,b+1,q,b-1,q,d-1,r];var t=b-d;var s=q-r;var f=Math.atan2(s,t);var g=Math.cos(f);var p=Math.sin(f);var k=this.lineLength(d,r,b,q);var e=Math.ceil(k/(this.dotLength*2));var a=k/e;if(e){var o=g*a;var m=p*a;d+=o;r+=m;for(var h=0;h<e-1;h++){this.circle(d,r,l,2,false,l);d+=o;r+=m}return j}}};this.lineClipShd=function(d,f,b,e,g,a){if(this.showShadow){return this.line(d,f,b,e,g,true,a,true)}else{return this.line(d,f,b,e,g,true,a)}};this.lineClip=function(d,f,b,e,g,a){return this.line(d,f,b,e,g,true,a)};this.lineShd=function(e,g,d,f,h,a,b){if(this.showShadow){return this.line(e,g,d,f,h,a,b,true)}else{return this.line(e,g,d,f,h,a,b)}};this.line=function(b,i,a,h,f,j,g,d){if(this.validateNumbers([b,i,a,h])){if(j){var k=this.clip("line",[b,i,a,h],g);if(k){b=k[0];i=k[1];a=k[2];h=k[3]}else{return false}}var e=["poly",b+1,i,a+1,h,a-1,h,b-1,i];this.ctx.strokeStyle=f;if(d){this.ctx.shadowOffsetX=this.shadowOffsetX;this.ctx.shadowOffsetY=this.shadowOffsetY;this.ctx.shadowBlur=this.shadowBlur;this.ctx.shadowColor=this.shadowColor}this.ctx.beginPath();this.ctx.moveTo(parseInt(b)+0.5,parseInt(i)+0.5);this.ctx.lineTo(parseInt(a)+0.5,parseInt(h)+0.5);this.ctx.closePath();this.ctx.stroke();if(d){this.ctx.restore();this.ctx.shadowOffsetX=0;this.ctx.shadowOffsetY=0;this.ctx.shadowBlur=0;this.ctx.shadowColor=this.background}return e}};this.bezierLineX=function(b,e,a,d,f){return this.bezierLine(b,e,a,d,f,"X")};this.bezierLineY=function(b,e,a,d,f){return this.bezierLine(b,e,a,d,f,"Y")};this.bezierLine=function(d,i,a,g,f,b){if(this.validateNumbers([d,i,a,g])){if(d==a||i==g){return this.line(d,i,a,g,f)}d=parseInt(d)+0.5;i=parseInt(i)+0.5;a=parseInt(a)+0.5;g=parseInt(g)+0.5;b=b=="Y"?"Y":"X";var k=a>d?true:false;var j=(d+a)/2;var h=(i+g)/2;var e;if(k){if(b=="X"){e=["poly",d,i-1,j+1,i-1,j+1,g-1,a,g-1,a,g+1,j-1,g+1,j-1,i+1,d,i+1]}else{e=["poly",d-1,i,d-1,h+1,a-1,h+1,a-1,g,a+1,g,a+1,h-1,d+1,h-1,d+1,i]}}else{if(b=="X"){e=["poly",d,i-1,j-1,i-1,j-1,g-1,a,g-1,a,g+1,j+1,g+1,j+1,i+1,d,i+1]}else{e=["poly",d-1,i,d-1,h-1,a-1,h-1,a-1,g,a+1,g,a+1,h+1,d+1,h+1,d+1,i]}}this.ctx.strokeStyle=f;if(this.showShadow){this.ctx.shadowOffsetX=this.shadowOffsetX;this.ctx.shadowOffsetY=this.shadowOffsetY;this.ctx.shadowBlur=this.shadowBlur;this.ctx.shadowColor=this.shadowColor}this.ctx.moveTo(d,i);if(b=="Y"){this.ctx.bezierCurveTo(d,g,a,i,a,g)}else{this.ctx.bezierCurveTo(a,i,d,g,a,g)}this.ctx.stroke();if(this.showShadow){this.ctx.restore();this.ctx.shadowOffsetX=0;this.ctx.shadowOffsetY=0;this.ctx.shadowBlur=0;this.ctx.shadowColor=this.background}return e}};this.curvedLineR=function(d,f,a,e,h,b,g){return this.curvedLine(d,f,a,e,h,false,b,g)};this.curvedLineL=function(d,f,a,e,h,b,g){return this.curvedLine(d,f,a,e,h,true,b,g)};this.curvedLine=function(y,b,w,a,B,p,q,E){if(this.validateNumbers([y,b,w,a,q,E])){var t=this.lineLength(y,b,w,a);var A=this.shortenLine(y,b,w,a,0,t/2,"line");var h=A[2];var x=A[3];var n=t/2;var d=q/n;var m=E/n;var j=(h-y);var g=(x-b);var C=p&&y>w?false:!p&&w>=y?true:p;var k=w>=y?Math.asin(g/n):Math.asin(-g/n);var z=k+Math.PI;var D=["poly"];var u=Math.PI/8;var f=w>=y?0:Math.PI;for(var v=0;v<9;v++){D.push(h-(n+2)*Math.cos(k+((u*v))-f));D.push(x-(n+2)*Math.sin(k+((u*v))-f))}for(var v=8;v>=0;v--){D.push(h-(n-2)*Math.cos(k+((u*v))-f));D.push(x-(n-2)*Math.sin(k+((u*v))-f))}this.ctx.beginPath();this.ctx.strokeStyle=B;if(this.showShadow){this.ctx.shadowOffsetX=this.shadowOffsetX;this.ctx.shadowOffsetY=this.shadowOffsetY;this.ctx.shadowBlur=this.shadowBlur;this.ctx.shadowColor=this.shadowColor}if(w>=y){this.ctx.arc(h,x,n,k-d,z+m,C)}else{this.ctx.arc(h,x,n,k+m,z-d,C)}this.ctx.stroke();if(this.showShadow){this.ctx.restore();this.ctx.shadowOffsetX=0;this.ctx.shadowOffsetY=0;this.ctx.shadowBlur=0;this.ctx.shadowColor=this.background}return D}};this.drawLine=function(b,l,a,k,j,n,m,h){var i;var f=false;var d=false;if(n.match(/bezier/i)){if(n.match(/beziery/i)){i="bezierLineY";f="Y"}else{i="bezierLineX";f="X"}}else{if(n.match(/curved/i)){d=true;if(n.match(/curvedr/i)){i="curvedLineR"}else{i="curvedLineL"}}else{if(n.match(/dashed/i)){i="dashedLine"}else{if(n.match(/dotted/i)){i="dottedLine"}else{i="line"}}}}var g=n.match(/curved/i)?this[i](b,l,a,k,j,m,h):this[i](b,l,a,k,j);if(n.match(/arrowheadsquaretail|squaretailarrowhead/i)){d=d?m:false;this.arrowHead(b,l,a,k,j,false,f,d);d=d?h:false;this.arrowHead(a,k,b,l,j,true,f,d)}else{if(n.match(/arrowtailsquarehead|squareheadarrowtail/i)){d=d?m:false;this.arrowHead(b,l,a,k,j,true,f,d);d=d?h:false;this.arrowHead(a,k,b,l,j,false,f,d)}else{if(n.match(/arrowhead/i)){d=d?m:false;this.arrowHead(b,l,a,k,j,false,f,d)}else{if(n.match(/squarehead/i)){d=d?m:false;this.arrowHead(b,l,a,k,j,true,f,d)}else{if(n.match(/arrowtail/i)){d=d?h:false;this.arrowHead(a,k,b,l,j,false,f,d)}else{if(n.match(/squaretail/i)){d=d?h:false;this.arrowHead(a,k,b,l,j,true,f,d)}else{if(n.match(/arrow/i)){d=d?m:false;this.arrowHead(b,l,a,k,j,false,f,d);d=d?h:false;this.arrowHead(a,k,b,l,j,false,f,d)}else{if(n.match(/square/i)){d=d?m:false;this.arrowHead(b,l,a,k,j,true,f,d);d=d?h:false;this.arrowHead(a,k,b,l,j,true,f,d)}}}}}}}}return g};this.rectangleShd=function(g,h,f,a,i,e,d,b){if(this.showShadow){return this.rectangle(g,h,f,a,i,e,d,b,true)}else{return this.rectangle(g,h,f,a,i,e,d,b)}};this.rectangle=function(d,a,b,j,h,e,l,i,f){if(this.validateNumbers([d,a,b,j])){if(i){var k=this.clip("rect",[d,a,b,j]);if(k){d=k[0];a=k[1];b=k[2];j=k[3]}else{return false}}var g=["rect",d,a,d+b,a+j];this.ctx.beginPath();this.ctx.fillStyle=h;this.ctx.strokeStyle=e?e:this.foreground;if(f){this.ctx.shadowOffsetX=this.shadowOffsetX;this.ctx.shadowOffsetY=this.shadowOffsetY;this.ctx.shadowBlur=this.shadowBlur;this.ctx.shadowColor=this.shadowColor}if(!l){this.ctx.fillRect(d,a,b,j)}this.ctx.strokeRect(d,a,b,j);if(f){this.ctx.restore();this.ctx.shadowOffsetX=0;this.ctx.shadowOffsetY=0;this.ctx.shadowBlur=0;this.ctx.shadowColor=this.background}return g}};this.rectangleXY=function(f,g,e,a,h,d,b){return this.rectangle(f,g,e,a,h,d,b,true)};this.rectangleXYShd=function(f,g,e,a,h,d,b){if(this.showShadow){return this.rectangle(f,g,e,a,h,d,b,true,true)}else{return this.rectangle(f,g,e,a,h,d,b,true)}};this.errorBar=function(e,g,d,f,a,h){if(!this.isGroupedData&&this.isRawData){return}if(this.showErrorBars&&this.validateNumbers([e,g,d,f,a])){var b=this.lineClipShd(e,g,d,f,h);if(a>0){this.lineClipShd(d,f-a/2,d,f+a/2,h)}else{this.lineClipShd(d-a/2,f,d+a/2,f,h)}return b}};this.circleShd=function(f,g,h,e,b,d,a){if(this.showShadow){return this.circle(f,g,h,e,b,d,a,true)}else{return this.circle(f,g,h,e,b,d,a)}};this.circle=function(b,a,g,k,i,d,h,e){if(this.validateNumbers([b,a,k])){if(h){var j=this.clip("circle",[b,a]);if(j){b=j[0];a=j[1]}else{return false}}var f=["circle",b,a,k/2];this.ctx.beginPath();this.ctx.fillStyle=g;this.ctx.strokeStyle=d?d:g?g:this.foreground;if(e){this.ctx.shadowOffsetX=this.shadowOffsetX;this.ctx.shadowOffsetY=this.shadowOffsetY;this.ctx.shadowBlur=this.shadowBlur;this.ctx.shadowColor=this.shadowColor}this.ctx.arc(b,a,k/2,0,Math.PI*2,true);if(!i){this.ctx.fill()}this.ctx.stroke();if(e){this.ctx.restore();this.ctx.shadowOffsetX=0;this.ctx.shadowOffsetY=0;this.ctx.shadowBlur=0;this.ctx.shadowColor=this.background}return f}};this.circleXY=function(e,f,g,d,a,b){return this.circle(e,f,g,d,a,b,true)};this.diamondShd=function(a,f,e,b,d){if(this.showShadow){return this.diamond(a,f,e,b,d,true)}else{return this.diamond(a,f,e,b,d)}};this.diamond=function(a,j,i,f,g,d){if(this.validateNumbers([a,j,f])){var e=f/2;var b=["poly",a,j-e,a-e,j,a,j+e,a+e,j];this.ctx.beginPath();this.ctx.fillStyle=i;if(d){this.ctx.shadowOffsetX=this.shadowOffsetX;this.ctx.shadowOffsetY=this.shadowOffsetY;this.ctx.shadowBlur=this.shadowBlur;this.ctx.shadowColor=this.shadowColor}this.ctx.strokeStyle=this.foreground;this.ctx.moveTo(a,j-e);this.ctx.lineTo(a-e,j);this.ctx.lineTo(a,j+e);this.ctx.lineTo(a+e,j);this.ctx.closePath();this.ctx.fill();if(!g){this.ctx.stroke()}if(d){this.ctx.restore();this.ctx.shadowOffsetX=0;this.ctx.shadowOffsetY=0;this.ctx.shadowBlur=0;this.ctx.shadowColor=this.background}return b}};this.sphere=function(f,e,d,j,h,a,g){if(this.validateNumbers([f,e,j])){if(g){var i=this.clip("circle",[f,e]);if(i){f=i[0];e=i[1]}else{return false}}var b=["circle",f,e,j/2];this.setShapeStyle(h,d,a);this.ctx.beginPath();this.ctx.arc(f,e,j/2,0,Math.PI*2,true);this.ctx.closePath();this.renderShapeStyle(h);return b}};this.square=function(g,f,e,l,j,a,i){if(this.validateNumbers([g,f,l])){if(i){var k=this.clip("circle",[g,f]);if(k){g=k[0];f=k[1]}else{return false}}var b=l/2;var d=["rect",g-b,f-b,g+b,f+b];this.setShapeStyle(j,e,a);this.ctx.beginPath();this.ctx.moveTo(g-b,f-b);this.ctx.lineTo(g+b,f-b);this.ctx.lineTo(g+b,f+b);this.ctx.lineTo(g-b,f+b);this.ctx.closePath();this.renderShapeStyle(j);return d}};this.triangle=function(i,g,f,n,l,b,j){if(this.validateNumbers([i,g,n])){if(j){var m=this.clip("circle",[i,g]);if(m){i=m[0];g=m[1]}else{return false}}n*=2;var a=n*Math.sqrt(3)/6;var d=a/2;var k=Math.sqrt((a*a)-(d*d));var e=["poly",i,g-a,i-k,g+d,i+k,g+d];this.setShapeStyle(l,f,b);this.ctx.beginPath();this.ctx.moveTo(i,g-a);this.ctx.lineTo(i-k,g+d);this.ctx.lineTo(i+k,g+d);this.ctx.closePath();this.renderShapeStyle(l);return e}};this.rhombus=function(g,f,e,l,j,a,i){if(this.validateNumbers([g,f,l])){if(i){var k=this.clip("circle",[g,f]);if(k){g=k[0];f=k[1]}else{return false}}var b=l/2;var d=["poly",g,f-b,g-b,f,g,f+b,g+b,f];this.setShapeStyle(j,e,a);this.ctx.beginPath();this.ctx.moveTo(g,f-b);this.ctx.lineTo(g-b,f);this.ctx.lineTo(g,f+b);this.ctx.lineTo(g+b,f);this.ctx.closePath();this.renderShapeStyle(j);return d}};this.octagon=function(i,g,f,m,k,b,j){if(this.validateNumbers([i,g,m])){if(j){var l=this.clip("circle",[i,g]);if(l){i=l[0];g=l[1]}else{return false}}var d=m/2;var a=m/4;var e=["rect",i-d,g-d,i+d,g+d];this.setShapeStyle(k,f,b);this.ctx.beginPath();this.ctx.moveTo(i-a,g-d);this.ctx.lineTo(i+a,g-d);this.ctx.lineTo(i+d,g-a);this.ctx.lineTo(i+d,g+a);this.ctx.lineTo(i+a,g+d);this.ctx.lineTo(i-a,g+d);this.ctx.lineTo(i-d,g+a);this.ctx.lineTo(i-d,g-a);this.ctx.closePath();this.renderShapeStyle(k);return e}};this.oval=function(g,f,e,l,j,a,i){if(this.validateNumbers([g,f,l])){if(i){var k=this.clip("circle",[g,f]);if(k){g=k[0];f=k[1]}else{return false}}var b=l/2;var d=["rect",g-b,f-b,g+b,f+b];this.ctx.save();this.setShapeStyle(j,e,a);this.ctx.scale(1,0.5);this.ctx.beginPath();this.ctx.arc(g,f*2,l/2,0,Math.PI*2,true);this.ctx.closePath();this.renderShapeStyle(j);this.ctx.restore();return d}};this.ellipse=function(l,k,j,u,p,f,n){if(this.validateNumbers([l,k,u])){if(n){var r=this.clip("circle",[l,k]);if(r){l=r[0];k=r[1]}else{return false}}var m=u;var g=u/2;var i=["rect",l-g,k-g,l+g,k+g];this.ctx.save();this.ctx.beginPath();this.setShapeStyle(p,j,f);var o=(m/2)*0.5522848;var b=(g/2)*0.5522848;var a=l+m;var q=k+g;var e=l+m/2;var d=k+g/2;this.ctx.moveTo(l,d);this.ctx.bezierCurveTo(l,d-b,e-o,k,e,k);this.ctx.bezierCurveTo(e+o,k,a,d-b,a,d);this.ctx.bezierCurveTo(a,d+b,e+o,q,e,q);this.ctx.bezierCurveTo(e-o,q,l,d+b,l,d);this.ctx.closePath();this.renderShapeStyle(p);this.ctx.restore();return i}};this.plus=function(g,f,e,l,j,a,i){if(this.validateNumbers([g,f,l])){if(i){var k=this.clip("circle",[g,f]);if(k){g=k[0];f=k[1]}else{return false}}var b=(l/2);var d=["rect",g-b,f-b,g+b,f+b];b+=0.5;this.setShapeStyle(j,e,a);this.ctx.beginPath();this.ctx.moveTo(g-1.5,f-b);this.ctx.lineTo(g+1.5,f-b);this.ctx.lineTo(g+1.5,f-1.5);this.ctx.lineTo(g+b,f-1.5);this.ctx.lineTo(g+b,f+1.5);this.ctx.lineTo(g+1.5,f+1.5);this.ctx.lineTo(g+1.5,f+b);this.ctx.lineTo(g-1.5,f+b);this.ctx.lineTo(g-1.5,f+1.5);this.ctx.lineTo(g-b,f+1.5);this.ctx.lineTo(g-b,f-1.5);this.ctx.lineTo(g-1.5,f-1.5);this.ctx.lineTo(g-1.5,f-b);this.ctx.closePath();this.renderShapeStyle(j);return d}};this.minus=function(g,f,e,l,j,a,i){if(this.validateNumbers([g,f,l])){if(i){var k=this.clip("circle",[g,f]);if(k){g=k[0];f=k[1]}else{return false}}var b=(l/2);var d=["rect",g-b,f-b,g+b,f+b];b+=0.5;this.setShapeStyle(j,e,a);this.ctx.beginPath();this.ctx.moveTo(g-b,f-1.5);this.ctx.lineTo(g+b,f-1.5);this.ctx.lineTo(g+b,f+1.5);this.ctx.lineTo(g-b,f+1.5);this.ctx.lineTo(g-b,f-1.5);this.ctx.closePath();this.renderShapeStyle(j);return d}};this.pie=function(i,g,f,n,k,b,j,l,a){if(!l){l=0}if(!a){a=Math.PI*2}if(this.validateNumbers([i,g,n,l,a])){if(j){var m=this.clip("circle",[i,g]);if(m){i=m[0];g=m[1]}else{return false}}var d=n/2;var e=["circle",i,g,d];this.setShapeStyle(k,f,b);this.ctx.beginPath();this.ctx.arc(i,g,d,l,a,false);this.ctx.lineTo(i,g);this.ctx.closePath();this.renderShapeStyle(k);return e}};this.pie0=function(a,h,g,f,d,e,b){return this.pie(a,h,g,f,d,e,b,0,Math.PI/5)};this.pie1=function(a,h,g,f,d,e,b){return this.pie(a,h,g,f,d,e,b,0,Math.PI/3.5)};this.pie2=function(a,h,g,f,d,e,b){return this.pie(a,h,g,f,d,e,b,0,Math.PI/2)};this.pie3=function(a,h,g,f,d,e,b){return this.pie(a,h,g,f,d,e,b,0,Math.PI/1.5)};this.pie4=function(a,h,g,f,d,e,b){return this.pie(a,h,g,f,d,e,b,0,Math.PI)};this.pie5=function(a,h,g,f,d,e,b){return this.pie(a,h,g,f,d,e,b,0,Math.PI*1.2)};this.pie6=function(a,h,g,f,d,e,b){return this.pie(a,h,g,f,d,e,b,0,Math.PI*1.4)};this.pie7=function(a,h,g,f,d,e,b){return this.pie(a,h,g,f,d,e,b,0,Math.PI*1.6)};this.pie8=function(a,h,g,f,d,e,b){return this.pie(a,h,g,f,d,e,b,0,Math.PI*1.8)};this.pie9=function(a,h,g,f,d,e,b){return this.pie(a,h,g,f,d,e,b,0,Math.PI*2)};this.pacman=function(a,h,g,f,d,e,b){return this.pie(a,h,g,f,d,e,b,Math.PI*5/4,Math.PI*3/4)};this.mdavid=function(k,j,h,o,m,b,l){if(this.validateNumbers([k,j,o])){if(l){var n=this.clip("circle",[k,j]);if(n){k=n[0];j=n[1]}else{return false}}var e=o/3;var g=["circle",k,j,o/2];var d=Math.PI/6;this.ctx.save();this.setShapeStyle(m,h,b);this.ctx.translate(k,j);this.ctx.beginPath();this.ctx.moveTo(e,0);for(var a=0;a<11;a++){this.ctx.rotate(d);if(a%2==0){this.ctx.lineTo((e/0.55),0)}else{this.ctx.lineTo(e,0)}}this.ctx.closePath();this.renderShapeStyle(m);this.ctx.restore();return g}};this.rect2=function(g,f,e,l,j,a,i){if(this.validateNumbers([g,f,l])){if(i){var k=this.clip("circle",[g,f]);if(k){g=k[0];f=k[1]}else{return false}}var b=l/2;var d=["rect",g-l,f-b,g+l,f+b];this.setShapeStyle(j,e,a);this.ctx.beginPath();this.ctx.moveTo(g-l,f-b);this.ctx.lineTo(g+l,f-b);this.ctx.lineTo(g+l,f+b);this.ctx.lineTo(g-l,f+b);this.ctx.closePath();this.renderShapeStyle(j);return d}};this.rect3=function(i,g,f,m,k,a,j){if(this.validateNumbers([i,g,m])){if(j){var l=this.clip("circle",[i,g]);if(l){i=l[0];g=l[1]}else{return false}}var d=m/2;var b=m+d;var e=["rect",i-b,g-d,i+b,g+d];this.setShapeStyle(k,f,a);this.ctx.beginPath();this.ctx.moveTo(i-b,g-d);this.ctx.lineTo(i+b,g-d);this.ctx.lineTo(i+b,g+d);this.ctx.lineTo(i-b,g+d);this.ctx.closePath();this.renderShapeStyle(k);return e}};this.star=function(k,j,h,o,m,b,l){if(this.validateNumbers([k,j,o])){if(l){var n=this.clip("circle",[k,j]);if(n){k=n[0];j=n[1]}else{return false}}var e=o/5;var g=["circle",k,j,o/2];var d=Math.PI/5;this.ctx.save();this.setShapeStyle(m,h,b);this.ctx.translate(k,j);this.ctx.rotate(d*0.45);this.ctx.beginPath();this.ctx.moveTo(e,0);for(var a=0;a<9;a++){this.ctx.rotate(d);if(a%2==0){this.ctx.lineTo((e/0.35),0)}else{this.ctx.lineTo(e,0)}}this.ctx.closePath();this.renderShapeStyle(m);this.ctx.restore();return g}};this.polygon=function(j,c,k,h){var a=j.shift();var g=a[0];var e=a[1];var d=[g,e];if(this.validateNumbers([g,e])){this.ctx.beginPath();this.ctx.fillStyle=c?c:this.foreground;this.ctx.strokeStyle=k?k:this.background;this.ctx.moveTo(g,e);for(var b=0;b<j.length;b++){a=j[b];g=a[0];e=a[1];if(this.validateNumbers([g,e])){this.ctx.lineTo(g,e);d.push(g,e)}}this.ctx.closePath();this.renderShapeStyle(h);d.unshift("poly");return d}};this.pathShd=function(a,b){if(this.showShadow){return this.path(a,b,true)}else{return this.path(a,b)}};this.path=function(g,j,e){var f=g.shift();var a=f[0];var h=f[1];var b=[a,h];if(this.validateNumbers([a,h])){this.ctx.beginPath();this.ctx.strokeStyle=j;if(e){this.ctx.shadowOffsetX=this.shadowOffsetX;this.ctx.shadowOffsetY=this.shadowOffsetY;this.ctx.shadowBlur=this.shadowBlur;this.ctx.shadowColor=this.shadowColor}this.ctx.moveTo(a,h);for(var d=0;d<g.length;d++){f=g[d];a=f[0];h=f[1];if(this.validateNumbers([a,h])){this.ctx.lineTo(a,h);b.push(a,h)}}this.ctx.stroke();if(e){this.ctx.restore();this.ctx.shadowOffsetX=0;this.ctx.shadowOffsetY=0;this.ctx.shadowBlur=0;this.ctx.shadowColor=this.background}b.unshift("poly");return b}};this.setRGB=function(){this.reds=[];this.greens=[];this.blues=[];this.indicatorBins=this.allVsAll?Math.min(this.x,this.y)/(this.layoutRows*2):Math.min(this.x,this.y)/2;this.indicatorBins=this.indicatorBins>512?1:this.indicatorBins>256?2:this.indicatorBins>128?4:8;var d=this.indicatorBins;var b=parseInt(256/d);var c;if(this.indicatorCenter=="black"){c=255;for(var a=0;a<b;a++){this.reds.push("rgb("+c+",0,0)");this.greens.push("rgb(0,"+c+",0)");this.blues.push("rgb(0,0,"+c+")");c-=d}}else{this.reds.push("rgb(255,0,0)");this.greens.push("rgb(0,255,0)");this.blues.push("rgb(0,0,255)");c=d-1;for(var a=0;a<b-1;a++){this.reds.push("rgb(255,"+c+","+c+")");this.greens.push("rgb("+c+",255,"+c+")");this.blues.push("rgb("+c+","+c+",255)");c+=d}}};this.setLineTypes=function(){this.lines=this.getLineTypes()};this.initializeAttributes=function(){this.setLineTypes();this.setRGB()};this.initializeAttributes()};CanvasXpress.prototype.initLayout=function(){this.isValidLayout=function(){var a=this.layout.split(/X/i);if(a.length==2){this.layoutRows=a[0];this.layoutCols=a[1]}else{this.layoutRows=1;this.layoutCols=1;this.layoutValid=false}if(!this.graphType.match(/Scatter/)&&this.layoutComb&&!this.autoExtend&&this.data.l&&(this.data.l.vars||this.data.l.smps)&&this.data.l.weight&&this.data.l.type){this.data.l.comp=[];if(this.data.l.vars&&this.data.l.smps){var f=0;for(var d=0;d<this.data.l.smps.length;d++){for(var b=0;b<this.data.l.vars.length;b++){this.data.l.comp[f]=[this.getVariableIndices(this.data.l.vars[b]),this.getSampleIndices(this.data.l.smps[d])];f++}}this.layoutRows=this.data.l.smps.length;this.layoutCols=this.data.l.vars.length}else{if(this.data.l.vars){for(var d=0;d<this.data.l.vars.length;d++){this.data.l.comp[d]=this.getVariableIndices(this.data.l.vars[d])}}else{for(var d=0;d<this.data.l.smps.length;d++){this.data.l.comp[d]=this.getSampleIndices(this.data.l.smps[d])}}if(this.graphType=="vertical"){this.layoutRows=this.data.l.comp.length}else{this.layoutCols=this.data.l.comp.length}}this.layoutValid=true;this.layoutAdjust=true}else{if(this.layoutComb&&!this.autoExtend&&this.data.l&&this.data.l.smps&&this.data.l.weight&&this.data.l.type){this.data.l.comp=[];var e=this.getVariableIndices(this.data.y.vars);for(var d=0;d<this.data.l.type.length;d++){this.data.l.comp[d]=e}this.layoutValid=true}else{if(!this.autoExtend&&this.data.l&&this.data.l.comp){if(this.data.l.comp.length<=(this.layoutRows*this.layoutCols)){this.layoutValid=true}else{this.layoutValid=false}}else{this.layoutValid=false}}}};this.setLayout=function(b){if(b==0){this.layoutCols=1;this.layoutRows=1;this.scaleX=1;this.scaleY=1;this.translateX=0;this.translateY=0;this.layout="1X1";this.legendBox=true;this.layoutValid=false}else{if(!this.graphType.match(/Scatter|Pie|Venn|Network|Genome/)){this.layoutCols=b;this.layoutRows=Math.ceil(this.varIndices.length/b);this.layout=this.layoutRows+"X"+this.layoutCols;this.autoExtend=false;this.data.l={};this.data.l["comp"]=[];if(this.graphType=="Candlestick"){for(var a=0;a<this.varIndices.length;a++){this.data.l["comp"].push(this.varIndices)}}else{for(var a=0;a<this.varIndices.length;a++){this.data.l["comp"].push([this.varIndices[a]])}this.legendBox=false}this.layoutValid=true}}this.draw()};this.setLayoutLeft=function(){if(this.graphOrientation!="vertical"&&this.segregateSamplesBy&&this.segregateVariablesBy){this.set1DVarSmpLabelFont();return this.fontSize+(this.margin*4)+this.measureText(this.maxSmpNameStr,this.smpLabelFont)+this.getSmpOverlaysLength()}else{if(this.graphOrientation!="vertical"&&this.segregateVariablesBy){this.set1DVarSmpLabelFont();return(this.margin*2)+this.measureText(this.maxSmpNameStr,this.smpLabelFont)+this.getSmpOverlaysLength()}else{if((this.segregateSamplesBy||this.segregateVariablesBy)&&this.graphOrientation=="vertical"){return this.fontSize+(this.margin*2)}else{if(this.graphType=="Candlestick"&&this.graphOrientation!="vertical"){this.setTimeAxis();this.set1DVarSmpLabelFont();return this.getSampleLabelLength()+this.getSmpOverlaysLength()}else{return 0}}}}};this.setLayoutRight=function(){return 0};this.setLayoutTop=function(){if(((this.segregateSamplesBy||this.segregateVariablesBy)&&this.graphOrientation!="vertical")||(this.segregateSamplesBy&&this.segregateVariablesBy)){return this.fontSize+(this.margin*2)}else{return 0}};this.setLayoutBottom=function(){if(this.segregateSamplesBy&&this.segregateVariablesBy){return this.getLegendHeight()}else{if(this.segregateVariablesBy&&this.graphOrientation=="vertical"){this.set1DVarSmpLabelFont();return(this.margin*2)+this.measureText(this.maxSmpNameStr,this.smpLabelFont)+this.getSmpOverlaysLength()}else{if(this.graphType=="Candlestick"&&this.graphOrientation=="vertical"){this.setTimeAxis();this.set1DVarSmpLabelFont();return this.getSampleLabelLength()+this.getSmpOverlaysLength()}else{return 0}}}};this.drawLayoutSampleOverlays=function(b){var a=this.smpIndices;this.smpIndices=b;this.set1DVarSmpLabelFont();this.smpIndices=a;this.showSampleNames=true;this.showOverlays=true;this.draw1DYLayout()};this.drawLayoutVariableLegend=function(){this.showLegend=true;this.draw1DLegend();this.showLegend=false};this.setLayoutDimensions=function(){this.offsetX=0;this.offsetY=0;this.layoutLeft=this.setLayoutLeft();this.layoutRight=this.setLayoutRight();this.layoutTop=this.setLayoutTop();this.layoutBottom=this.setLayoutBottom()};this.drawLabelsLayout=function(){var a,f;if(this.segregateSamplesBy&&this.segregateVariablesBy){f=(this.fontSize/2)+this.margin;a=this.layoutLeft;for(var e=0;e<this.data.l.vars.length;e++){var c=e*this.data.l.smps.length;var b=(this.width-(this.layoutLeft+this.layoutRight))*this["subGraphWeight"+c][0];a+=(b/2);this.drawText(this.data.l.name[c][0],a,f,this.font,this.foreground,"center","middle");a+=(b/2)}a=(this.fontSize/2)+this.margin;f=this.layoutTop;for(var c=0;c<this.data.l.smps.length;c++){var d=(this.height-(this.layoutTop+this.layoutBottom))*this["subGraphWeight"+c][1];f+=(d/2);this.drawText(this.data.l.name[c][1],a,f,this.font,this.foreground,"center","middle",-Math.PI/2);f+=(d/2)}}else{if((this.segregateSamplesBy||this.segregateVariablesBy)&&this.graphOrientation=="vertical"&&this.data.l.name){a=(this.fontSize/2)+this.margin;f=this.layoutTop;for(var c=0;c<this.data.l.name.length;c++){var d=(this.height-(this.layoutTop+this.layoutBottom))*this["subGraphWeight"+c];f+=(d/2);this.drawText(this.data.l.name[c],a,f,this.font,this.foreground,"center","middle",-Math.PI/2);f+=(d/2)}}else{if((this.segregateSamplesBy||this.segregateVariablesBy)&&this.graphOrientation=="horizontal"&&this.data.l.name){f=(this.fontSize/2)+this.margin;a=this.layoutLeft;for(var c=0;c<this.data.l.name.length;c++){var b=(this.width-(this.layoutLeft+this.layoutRight))*this["subGraphWeight"+c];a+=(b/2);this.drawText(this.data.l.name[c],a,f,this.font,this.foreground,"center","middle");a+=(b/2)}}}}};this.setLayoutGraphAttributes=function(){var g=0;for(var d=0;d<this.layoutRows;d++){for(var b=0;b<this.layoutCols;b++){var e="subGraphType"+g;if(!this[e]){if(this.data.l.type&&this.data.l.type[g]){this[e]=this.data.l.type[g]}else{this[e]=this.graphType}}var f="subSummaryType"+g;if(this[e]=="Boxplot"||this.summaryType=="iqr"){this[f]="iqr"}else{if(this.summaryType=="median"){this[f]="median"}else{if(this.summaryType=="sum"){this[f]="sum"}else{if(this[e]=="Correlation"){this[f]="cor"}else{if(this[e]=="Candlestick"){if((this.graphOrientation=="vertical"&&d>0)||(this.graphOrientation=="horizontal"&&b==0)){this[f]="volume"}else{this[f]="candle"}}else{this[f]="mean"}}}}}var a="subTransformType"+g;if(!this[a]){if(this.data.l.transform&&this.data.l.transform[g]){this[a]=this.data.l.transform[g]}else{this[a]=this.subTransformType}}g++}}};this.setLayoutWeights=function(){if(this.data.l.weight){var d=0;var e=0;var a;var b;if(this.allVsAll){for(var c=0;c<this.layoutRows;c++){a="subGraphWeight"+c;b=this[a]?this[a]:this.data.l.weight[c];d+=b}for(var c=0;c<this.data.l.weight.length;c++){a="subGraphWeight"+c;b=this[a]?this[a]:this.data.l.weight[c];this.data.l.weight[c]=b/d;this[a]=this.data.l.weight[c]}}else{if(this.data.l.vars&&this.data.l.smps){for(var c=0;c<this.data.l.weight.length;c++){a="subGraphWeight"+c;b=this[a]?this[a]:this.data.l.weight[c];d+=b[0];e+=b[1]}for(var c=0;c<this.data.l.weight.length;c++){a="subGraphWeight"+c;b=this[a]?this[a]:this.data.l.weight[c];this.data.l.weight[c][0]=b[0]/d*this.data.l.smps.length;this.data.l.weight[c][1]=b[1]/e*this.data.l.vars.length;this[a]=this.data.l.weight[c]}}else{for(var c=0;c<this.data.l.weight.length;c++){a="subGraphWeight"+c;b=this[a]?this[a]:this.data.l.weight[c];d+=b}for(var c=0;c<this.data.l.weight.length;c++){a="subGraphWeight"+c;b=this[a]?this[a]:this.data.l.weight[c];this.data.l.weight[c]=b/d;this[a]=this.data.l.weight[c]}}}}else{if(this.data.l.comp){this.data.l.weight=[];for(var c=0;c<this.data.l.comp.length;c++){a="subGraphWeight"+c;this.data.l.weight[c]=this.data.l.comp.length;this[a]=this.data.l.weight[c]}}else{alert("Wuz going on dude? This aint't gonna work!")}}};this.setMinimumLayoutAxisFonts=function(){var h=0;var e=Number.MAX_VALUE;for(var d=0;d<this.layoutRows;d++){for(var b=0;b<this.layoutCols;b++){var g,f,a;if(this.data.l.desc&&this.data.l.desc[h]){g=this.data.l.desc[h]}else{g="NA"}a=this.graphOrientation=="vertical"?this.height*this["subGraphWeight"+h]:this.width*this["subGraphWeight"+h];this.setAxisFont(g,a);f=this.getFontPt(this.axisTitleFont);if(f<e){e=f;this.minLayoutAxis=e;this.minLayoutAxisTitle=g}h++}}};this.getLayoutSummaryTypes=function(){var g=0;var a={};var e=[];for(var d=0;d<this.layoutRows;d++){for(var b=0;b<this.layoutCols;b++){var f="subSummaryType"+g;if(!a.hasOwnProperty(this[f])){e.push(this[f]);a[this[f]]=true}g++}}return e};this.setLayoutRange=function(){if(this.graphType.match(/Scatter/)){this.xAxis=this.data.y.smps;this.yAxis=this.data.y.smps;this.initAxes(true)}};this.validateLayoutSummaryGrouping=function(){if(this.isGroupedData){var b=this.getLayoutSummaryTypes();for(var a=0;a<b.length;a++){if(!this.isValidPlotData(b[a])){this.groupSamples(this.groupingFactors,b);break}}}};this.resetLayout=function(){delete (this.data.l);delete (this.layoutParams);this.offsetX=0;this.offsetY=0;this.layoutValidN=false;this.layoutValidR=false;this.layoutValidC=false;this.layoutComb=false;this.layout="1X1"};this.drawLayoutCompartments=function(h){var f,e,D,C,l,o,y,q,a;var A=0;var s=0;var w=this.varIndices;var u=this.smpIndices;var d=this.getObjectArray(w);var g=this.getObjectArray(u);var f=this.width;var B=false;var z=["left","right","top","bottom","x","y","width","height","weight","offsetX","offsetY","varIndices","smpIndices","grpIndices","graphType","summaryType","transformType","varIndicesStart","smpIndicesStart","dataEvent","minData","maxData","xAxisMin","xAxisMax","xAxis2Min","xAxis2Max","yAxisMin","yAxisMax","zAxisMin","zAxisMax","xAxisAbsMin","xAxisAbsMax","xAxis2AbsMin","xAxis2AbsMax","yAxisAbsMin","yAxisAbsMax","zAxisAbsMin","zAxisAbsMax","xAxisUnit","xAxis2Unit","yAxisUnit","zAxisUnit","setMin","setMax","setMinX","setMaxX","setMinX2","setMaxX2","setMinY","setMaxY","setMinZ","setMaxZ"];var n=["graphType","transformType","varIndicesStart","smpIndicesStart","dataEvent","setMin","setMax","setMinX","setMaxX","setMinX2","setMaxX2","setMinY","setMaxY","setMinZ","setMaxZ"];var r;if(this.layoutComb){if(!this.graphType.match(/Scatter/)){if(this.data.l.vars){y=0;if(this.data.l.comp){for(var x=0;x<this.data.l.comp.length;x++){y=Math.max(y,this.data.l.comp[x].length)}}this.layoutMaxLegend=y}else{this.layoutMaxLegend=this.varIndices.length}}this.setLayoutDimensions();this.initAxes(false,true);if(this.layoutParams&&this.layoutValidN>-1){r=this.layoutParams;if(r[this.layoutValidN]){for(var x=0;x<z.length;x++){r[this.layoutValidN][z[x]]=this[z[x]]}}}this.offsetX=this.layoutLeft;this.offsetY=this.layoutTop;this.layoutMaxLegendLabel=this.data.l.vars?this.maxVarNameStr:this.maxSmpNameStr;this.layoutParams=[];if(!this.graphType.match(/Scatter/)){if(this.data.l.vars&&this.data.l.smps){this.layoutRows=this.data.l.smps.length;this.layoutCols=this.data.l.vars.length;this.layoutMaxSamples=this.smpIndices.length*this.layoutCols/this.layoutRows;this.legendPosition="bottom"}else{y=Math.max(this.layoutRows,this.layoutCols);if(this.graphOrientation=="vertical"){this.layoutRows=y;this.layoutCols=1;this.legendPosition="right"}else{this.layoutRows=1;this.layoutCols=y;this.legendPosition="bottom"}}}if(this.graphType.match(/Scatter/)&&!this.layoutAdjust){this.setLayoutRange()}this.setLayoutWeights();this.setMinimumLayoutAxisFonts();this.setLayoutGraphAttributes();this.validateLayoutSummaryGrouping();this.drawLabelsLayout();for(var x=0;x<this.layoutRows;x++){for(var v=0;v<this.layoutCols;v++){this.layoutCurrent=A;if(r){for(var t=0;t<n.length;t++){this[n[t]]=r[A][n[t]]}}this.weight=this["subGraphWeight"+A];this.graphType=this["subGraphType"+A];this.summaryType=this["subSummaryType"+A];this.transformType=this["subTransformType"+A];if(this["subTransformType"+A]){this.isTransformedData=true}if(this.data.l.log&&this.data.l.log[A]){this.isLogData=this.data.l.log[A]}if(this.graphType.match(/Scatter/)){if(this.data.l.smps[A].xAxis&&this.data.l.smps[A].yAxis){this.xAxis=this.data.l.smps[A].xAxis;this.yAxis=this.data.l.smps[A].yAxis;this.xAxisIndices=this.getSampleIndices(this.xAxis);this.yAxisIndices=this.getSampleIndices(this.yAxis)}else{this.xAxis=false;this.yAxis=false;this.xAxisIndices=false;this.yAxisIndices=false}this.layoutWidth=(this.width-(this.layoutLeft+this.layoutRight))*this["subGraphWeight"+A];this.layoutHeight=(this.height-(this.layoutTop+this.layoutBottom))*this["subGraphWeight"+A];this.varIndices=this.data.l.comp[A];if(this.graphType.match(/Scatter/)&&this.layoutAdjust&&this.xAxis&&this.yAxis){this.initAxes(true);this.layoutAxis=3}else{if(this.graphType.match(/Scatter/)){this.layoutAxis=v==0?2:0;this.layoutAxis=x==this.layoutRows&&this.layoutAxis?3:x==this.layoutRows?1:0}}}else{if(this.data.l.vars&&this.data.l.smps){B=this.graphOrientation=="vertical"?true:false;this.showLegend=false}else{B=this.data.l.smps?true:false}this.showSampleNames=B;this.showOverlays=B;this.xAxisTitle=this.data.l.desc&&this.data.l.desc[A]?this.data.l.desc[A]:false;if(this.data.l.vars&&this.data.l.smps){this.layoutHeight=(this.height-(this.layoutTop+this.layoutBottom))*this["subGraphWeight"+A][1];this.layoutWidth=(this.width-(this.layoutLeft+this.layoutRight))*this["subGraphWeight"+A][0];a=[];for(var t=0;t<this.data.l.comp[A][0].length;t++){if(d.hasOwnProperty(this.data.l.comp[A][0][t])){a.push(this.data.l.comp[A][0][t])}}this.varIndices=a;a=[];for(var t=0;t<this.data.l.comp[A][1].length;t++){if(g.hasOwnProperty(this.data.l.comp[A][1][t])){a.push(this.data.l.comp[A][1][t])}}this.smpIndices=a}else{if(this.graphOrientation=="vertical"){this.layoutHeight=(this.height-(this.layoutTop+this.layoutBottom))*this["subGraphWeight"+A];this.layoutWidth=this.width-(this.layoutLeft+this.layoutRight)}else{this.layoutWidth=(this.width-(this.layoutLeft+this.layoutRight))*this["subGraphWeight"+A];this.layoutHeight=this.height-(this.layoutTop+this.layoutBottom)}a=[];if(this.data.l.vars){for(var t=0;t<this.data.l.comp[A].length;t++){if(d.hasOwnProperty(this.data.l.comp[A][t])){a.push(this.data.l.comp[A][t])}}this.varIndices=a}else{for(var t=0;t<this.data.l.comp[A].length;t++){if(g.hasOwnProperty(this.data.l.comp[A][t])){a.push(this.data.l.comp[A][t])}}this.smpIndices=a}}if(this.layoutAdjust){this.layoutAxis=3;this.initAxes(true)}}h.call(this);if(this.graphType.match(/Scatter/)){if(x==v){var p=this.scaleTextToFont(this.maxSmpNameStr,this.maxTextSize,(this.layoutWidth-(this.layoutLeft+this.layoutRight)));this.drawText(this.data.y.smps[x],this.offsetX+this.left+(this.x/2),this.offsetY+this.top+(this.y/2),p,this.foreground,"center","middle")}}else{if(!B){if(this.data.l.vars&&this.data.l.smps){if(this.graphOrientation!="vertical"&&A%this.data.l.vars.length==0){this.drawLayoutSampleOverlays(u)}if(A>=this.data.l.vars.length*(this.data.l.smps.length-1)){this.drawLayoutVariableLegend()}}else{if((this.graphOrientation=="vertical"&&(A+1)==y)||(this.graphOrientation!="vertical"&&A==0)){this.drawLayoutSampleOverlays(u)}}}else{if(this.data.l.vars&&this.data.l.smps){if(A>=this.data.l.vars.length*(this.data.l.smps.length-1)){this.drawLayoutVariableLegend()}}}}var b={};for(var t=0;t<z.length;t++){b[z[t]]=this[z[t]]}b.width=this.layoutWidth;b.height=this.layoutHeight;b.subGraphType=this.graphType;b.subSummaryType=this.SummaryType;b.subTransformType=this.transformType;this.layoutParams.push(b);if(this.graphType.match(/Scatter/)||(this.data.l.vars&&this.data.l.smps)){this.offsetX+=this.layoutWidth}else{if(this.graphOrientation=="vertical"){this.offsetY+=this.layoutHeight}else{this.offsetX+=this.layoutWidth}}A++}if(this.graphType.match(/Scatter/)||(this.data.l.vars&&this.data.l.smps)){this.offsetX=this.layoutLeft;this.offsetY+=this.layoutHeight}}this.varIndices=w;this.smpIndices=u;this.showSampleNames=true;this.showOverlays=true;this.showLegend=true}else{this.scaleX=1/this.layoutCols;this.scaleY=1/this.layoutRows;this.ctx.save();this.ctx.scale(this.scaleX,this.scaleY);C=0;e=this.height;for(var x=0;x<this.layoutRows;x++){this.translateY=this.height*x;f=this.width;D=0;for(var v=0;v<this.layoutCols;v++){this.translateX=this.width*v;if(this.data.l.comp.length>A){if(v==0&&this.layoutCols==1){this.layoutAxis=3}else{if(x==0&&this.layoutCols>1){this.layoutAxis=1}else{if(x==this.layoutRows-1){this.layoutAxis=2}else{this.layoutAxis=0}}}this.varIndices=this.data.l.comp[A];if(this.layoutAdjust){this.layoutAxis=3;this.initAxes(true)}if(this.data.l.type&&this.data.l.type[A]){this.graphType=this.data.l.type[A]}h.call(this);D+=parseFloat(f);this.ctx.translate(D,0);if(this.layoutCols>2){f/=Math.pow(this.layoutCols+1,this.layoutCols+1)}else{f/=Math.pow(this.layoutCols+4,this.layoutCols+4)}if(this.layoutMulticolor){this.colors.push(this.colors.shift())}A++}}C+=parseFloat(e);this.ctx.translate(-D*this.layoutCols,C);e/=Math.pow(this.layoutRows+1,this.layoutRows+1)}this.ctx.restore();this.ctx.translate(-D*(this.layoutCols-1),-C*(this.layoutRows-1));this.ctx.scale(this.layoutCols,this.layoutRows);this.varIndices=w;if(this.layoutMulticolor){for(var x=0;x<A;x++){this.colors.unshift(this.colors.pop())}}}};this.initializeLayout=function(){this.isValidLayout()};this.initializeLayout()};CanvasXpress.prototype.initEvents=function(b,a){this.resetUserEvents=function(){this.setUserEvents()};this.cancelEvent=function(c){if(!c){c=window.event}if(c.preventDefault){c.preventDefault()}else{c.returnValue=true}};this.stopEvent=function(c){if(!c){c=window.event}if(c.stopPropagation){c.stopPropagation()}else{c.cancelBubble=true}};this.addEvtListener=function(h,g,i,d){if(this.isIE){h.attachEvent(this.normalizeEvtName(g),i)}else{h.addEventListener(g,i,d)}};this.removeEvtListener=function(h,g,i,d){if(this.isIE){h.detachEvent(this.normalizeEvtName(g),i)}else{h.removeEventListener(g,i,d)}};this.normalizeEvtName=function(c){return this.isIE?"on"+c:c};this.adjustedCoordinates=function(i,g){if(!g){g=document.getElementById(b+"canvasXpressImage")}if(g){var k={};var h=g.parentNode.getClientRects();var f=h[0].left;var g=h[0].top;var d=i&&i.clientX?i.clientX:i&&i[0]?i[0]:f;var j=i&&i.clientY?i.clientY:i&&i[1]?i[1]:g;k.x=document.body.scrollLeft>Math.abs(f)+d&&d>document.body.scrollLeft-f?Math.abs(f)+d:d-f;k.y=document.body.scrollTop>Math.abs(g)+j&&j>document.body.scrollTop-g?Math.abs(g)+j:j-g;return k}};this.findXYCoordinates=function(f){var d=this.adjustedCoordinates(f);var g={};g.x=(d.x/this.scaleFactor||1)-this.offsetX;g.y=(d.y/this.scaleFactor||1)-this.offsetY;return g};this.addDragDiv=function(){if(document.getElementById(b+"canvasXpressDrag")){this.resetDragDiv();return}var c=document.createElement("div");c.id=b+"canvasXpressDrag";c.style.width="0.5px";c.style.height="0.5px";c.style.opacity=0.5;c.style.filter="alpha(opacity = 50)";c.style.backgroundColor=this.dragAreaColor;c.style.position="absolute";c.style.zIndex=9000;this.canvas.parentNode.appendChild(c)};this.addInfoSpan=function(){if(document.getElementById(b+"canvasXpressInfo")){this.resetInfoSpan();return}var c=document.createElement("span");c.id=b+"canvasXpressInfo";c.style.backgroundColor=this.infoAreaColor;c.style.margin="0.5px";c.style.padding="0.5px";c.style.fontSize="x-small";c.style.border="1px solid";c.style.borderColor="#C0C0C0";c.style.position="absolute";c.style.zIndex=19010;this.canvas.parentNode.appendChild(c)};this.addResizeDiv=function(){if(document.getElementById(b+"canvasXpressCanvasResize")){this.resetCanvasResizer();return}var c=document.createElement("div");c.id=b+"canvasXpressCanvasResize";c.style.left="0px";c.style.top="0px";c.style.width="0.5px";c.style.height="0.5px";c.style.opacity=0.5;c.style.filter="alpha(opacity = 50)";c.style.backgroundColor=this.resizeAreaColor;c.style.position="absolute";c.style.display="none";c.style.zIndex=7001;this.canvas.parentNode.appendChild(c)};this.addResizeAxesDiv=function(){if(document.getElementById(b+"canvasXpressAxesResize")){this.resetResizer();return}var g=document.createElement("div");g.id=b+"canvasXpressAxesResize";g.style.width="0.5px";g.style.height="0.5px";g.style.opacity=0.8;g.style.filter="alpha(opacity = 50)";g.style.backgroundColor=this.resizeAreaColor;g.style.position="absolute";g.style.display="none";g.style.zIndex=9001;var f=document.createElement("div");f.id=b+"canvasXpressAxesResizeTotal";f.style.width="0.5px";f.style.height="0.5px";f.style.opacity=0.5;f.style.filter="alpha(opacity = 50)";f.style.backgroundColor="rgb(21,66,139)";f.style.position="absolute";f.style.zIndex=9002;var e=document.createElement("div");e.id=b+"canvasXpressAxesResizeMin";e.style.width="0.5px";e.style.height="0.5px";e.style.opacity=0.5;e.style.filter="alpha(opacity = 50)";e.style.backgroundColor="rgb(21,66,139)";e.style.border="1px dotted rgb(255,255,255)";e.style.position="absolute";e.style.zIndex=9005;var l=document.createElement("div");l.id=b+"canvasXpressAxesResizeMax";l.style.width="0.5px";l.style.height="0.5px";l.style.opacity=0.5;l.style.filter="alpha(opacity = 50)";l.style.backgroundColor="rgb(21,66,139)";l.style.border="1px dotted rgb(255,255,255)";l.style.position="absolute";l.style.zIndex=9004;var k=document.createElement("div");k.id=b+"canvasXpressAxesResizeCurrent";k.style.width="0.5px";k.style.height="0.5px";k.style.opacity=0.5;k.style.filter="alpha(opacity = 50)";k.style.backgroundColor=this.resizeAreaColorCurrent;k.style.position="absolute";k.style.zIndex=9003;var j=document.createElement("div");j.id=b+"canvasXpressAxesResizeClose";j.style.position="absolute";j.style.fontSize="x-small";j.style.cursor="default";j.style.marginTop="-2px";j.style.marginLeft="2px";j.style.zIndex=9006;var h=document.createTextNode("Close");j.appendChild(h);var i=document.createElement("div");i.id=b+"canvasXpressAxesResizeReset";i.style.position="absolute";i.style.fontSize="x-small";i.style.cursor="default";i.style.marginTop="-2px";i.style.marginLeft="2px";i.style.zIndex=9006;var c=document.createTextNode("Reset");i.appendChild(c);g.appendChild(f);g.appendChild(e);g.appendChild(l);g.appendChild(k);g.appendChild(j);g.appendChild(i);this.canvas.parentNode.appendChild(g)};this.addImage=function(){if(document.getElementById(b+"canvasXpressImage")){return}var c=document.createElement("img");c.id=b+"canvasXpressImage";c.src=this.setPixelImage();c.width=this.width;c.height=this.height;c.useMap="#"+b+"canvasXpressMap";c.style.left=this.canvas.offsetLeft+"px";c.style.top=this.canvas.offsetTop+"px";c.style.border="0px";c.style.position="absolute";c.style.zIndex=9000;this.canvas.parentNode.appendChild(c)};this.print=function(c){return function(f){alert("A new window will open so you can right click on the graph and save it");if(c.isIE){var h=c.canvas.parentNode.childNodes[0];return window.open().document.write("<html><body>"+h.innerHTML+"</body></html>")}else{var g=c.canvas.toDataURL("image/png");return window.open().document.write('<html><body><img src="'+g+'" /></body></html>')}}}(this);this.setPixelImage=function(){if(navigator.onLine){return"http://canvasxpress.org/js/canvasXpress.gif"}else{var e=document.getElementsByTagName("script");if(e){for(var d=0;d<e.length;d++){if(!e[d].src){continue}var g=e[d].src;var c=g.lastIndexOf("/");var j=g.substring(0,c+1);var h=g.substring(c+1);if(h.match(/canvasXpress/)){return j+"canvasXpress.gif"}}}alert("Dude! I couldn't find canvasXpress.js")}};this.resizeImage=function(c){var d=document.getElementById(b+"canvasXpressImage");if(d){d.style.left="0px";d.style.top="0px";d.style.width=this.width+"px";d.style.height=this.height+"px";if(!c){if(this.modelEvent!="local"){this.addGlobalArea(["rect",this.left,this.top,this.left+this.x,this.top+this.y])}}}};this.mousedownImage=function(c){return function(d){c.cancelEvent(d);c.registerDragDiv(d);return false}}(this);this.mousemoveDoc=function(c){return function(d){c.cancelEvent(d);c.updateDragDiv(d);return false}}(this);this.mousemoveImage=function(c){return function(d){c.cancelEvent(d);c.updateDragDiv(d);return false}}(this);this.mouseupImage=function(c){return function(d){c.cancelEvent(d);c.endDragDiv(d);c.endResize(d);return false}}(this);this.keydownDoc=function(c){return function(d){c.registerKey(d)}}(this);this.keyupDoc=function(c){return function(d){c.resetKey(d)}}(this);this.clickImage=function(c){return function(d){c.cancelEvent(d);c.mouseClick(d)}}(this);this.clickResizeClose=function(c){return function(d){c.cancelEvent(d);c.hideResizer(d)}}(this);this.clickResizeReset=function(c){return function(d){c.cancelEvent(d);c.resetResizer(d)}}(this);this.mousedownResize=function(c){return function(d){c.cancelEvent(d);c.registerResize(d);return false}}(this);this.mousemoveResize=function(c){return function(d){c.cancelEvent(d);c.updateResize(d);return false}}(this);this.mouseupResize=function(c){return function(d){c.cancelEvent(d);c.endResize(d);return false}}(this);this.resizeWindow=function(c){return function(d){c.resizeImage(true);return false}}(this);this.addCanvasListeners=function(){var e=this;var c=document.getElementById(b+"canvasXpressImage");var f=document.getElementById(b+"canvasXpressDrag");if(c&&f){this.addEvtListener(c,"mousedown",this.mousedownImage,false);this.addEvtListener(c,"mousemove",this.mousemoveImage,false);this.addEvtListener(c,"mouseup",this.mouseupImage,false);this.addEvtListener(c,"click",this.clickImage,false);this.addEvtListener(f,"mousemove",this.mousemoveImage,false);this.addEvtListener(this.canvas,"click",this.clickImage,false);this.addEvtListener(document,"mousemove",this.mousemoveDoc,false);this.addEvtListener(document,"mouseup",this.mouseupImage,false);this.addEvtListener(document,"keydown",this.keydownDoc,false);this.addEvtListener(document,"keyup",this.keyupDoc,false);this.addEvtListener(window,"resize",this.resizeWindow,false)}};this.addMap=function(){if(document.getElementById(b+"canvasXpressMap")){return this.resetMap()}var c=document.createElement("map");c.name=b+"canvasXpressMap";c.id=b+"canvasXpressMap";this.canvas.parentNode.appendChild(c);this.addArea(["rect",0,0,2,2],[-1])};this.resetMap=function(){var c=document.getElementById(b+"canvasXpressMap");if(c){var e=c.childNodes;var g=[];for(var f=1;f<e.length;f++){if(e[f].id){g.push(e[f].id)}}for(var f=0;f<g.length;f++){var d=document.getElementById(g[f]);if(d){this.removeEvtListener(d,"mouseover",this.mouseoverArea,false);this.removeEvtListener(d,"mousemove",this.mousemoveArea,false);this.removeEvtListener(d,"mouseout",this.mouseoutArea,false);this.removeEvtListener(d,"mousedown",this.mousedownArea,false);this.removeEvtListener(d,"mouseup",this.mouseupArea,false);this.removeEvtListener(d,"click",this.clickArea,false);d.parentNode.removeChild(d)}}if(this.modelEvent!="local"){this.dataEvent=[this.dataEvent[0]]}}};this.formatCoords=function(m,n){var j=[];if(this.graphType!="Network"){for(var g=0;g<n.length;g++){if(g%2){j.push(sprintf("%.0f",(n[g]+this.translateY)*this.scaleY))}else{if(this.layoutValid&&m=="circle"&&g==2){j.push(sprintf("%.0f",n[g]*((this.scaleX+this.scaleY)/2)))}else{j.push(sprintf("%.0f",(n[g]+this.translateX)*this.scaleX))}}}}else{for(var g=0;g<n.length;g++){j.push(sprintf("%.0f",n[g]))}}if(m=="rect"){var e=Math.min(j[0],j[2]);var f=Math.min(j[1],j[3]);var d=Math.max(j[0],j[2]);var k=Math.max(j[1],j[3]);j=[e,f,d,k]}return j.join(",")};this.setLayoutValidIndices=function(n){if(this.layoutComb){var m=this.adjustedCoordinates(n);if(m){var d=m.x;var k=m.y;var o=0;for(var h=0;h<this.layoutRows;h++){for(var g=0;g<this.layoutCols;g++){var f=this.getBoundsXY(o,h,g);if(d>=f[0]&&d<=f[1]&&k>=f[2]&&k<=f[3]){if(this.layoutValid){this.layoutValidR=h;this.layoutValidC=g;this.layoutValidN=o}}o++}}}}};this.getEventAreaId=function(d){if(this.modelEvent=="local"){var c=d.target||d.srcElement;if(c){this.setLayoutValidIndices(d);return c.id.replace(b,"").split(",")}}else{this.setLayoutValidIndices(d);return this.isEvent(d)}};this.getEventAreaData=function(c){return this.extractDataObject(this.getEventAreaId(c))};this.areaEvent=function(d,c){return function(g){var f=d.getEventAreaId(g);if(f){d.handleMouseEvents(c,g,f)}}};this.mouseoverArea=this.areaEvent(this,"mouseover");this.mouseoutArea=this.areaEvent(this,"mouseout");this.clickArea=this.areaEvent(this,"click");this.mousemoveArea=function(c){return function(f){c.updateDragDiv(f);if(c.modelEvent!="local"){var d=c.isEvent(f);if(d){c.handleMouseEvents("mousemove",f,d)}}}}(this);this.mousedownArea=function(c){return function(d){c.cancelEvent(d);c.registerDragDiv(d)}}(this);this.mouseupArea=function(c){return function(d){c.cancelEvent(d);c.endDragDiv(d);if(c.resizingCanvasOn){c.endResize(d)}}}(this);this.addArea=function(k,g,j){if(!k||!g){return}var h=k.shift();if(h&&k){if(this.modelEvent=="local"){var d=document.getElementById(b+"canvasXpressMap");var e=document.createElement("area");e.shape=h;e.coords=this.formatCoords(h,k);e.id=b+g.join(",");e.style.cursor="default";if(j){e.id+=j}this.addEvtListener(e,"mouseover",this.mouseoverArea,false);this.addEvtListener(e,"mousemove",this.mousemoveArea,false);this.addEvtListener(e,"mouseout",this.mouseoutArea,false);this.addEvtListener(e,"mousedown",this.mousedownArea,false);this.addEvtListener(e,"mouseup",this.mouseupArea,false);this.addEvtListener(e,"click",this.clickArea,false);d.appendChild(e)}else{this.dataEvent.push([g,h,k])}}};this.addGlobalArea=function(g){if(!g){return}var f=g.shift();if(f&&g){var d=document.getElementById(b+"canvasXpressMap");var e=document.createElement("area");e.shape=f;e.coords=this.formatCoords(f,g);e.id=b+"globalArea";this.addEvtListener(e,"mouseover",this.mouseoverArea,false);this.addEvtListener(e,"mousemove",this.mousemoveArea,false);this.addEvtListener(e,"mouseout",this.mouseoutArea,false);this.addEvtListener(e,"mousedown",this.mousedownArea,false);this.addEvtListener(e,"mouseup",this.mouseupArea,false);this.addEvtListener(e,"click",this.clickArea,false);d.appendChild(e)}};this.isEvent=function(h){var o=this.adjustedCoordinates(h);if(o){var n=o.x;var k=o.y;if(this.modelEvent=="local"){var f=document.getElementById(b+"canvasXpressMap");if(f){var l=f.childNodes;for(var g=0;g<l.length;g++){var d=l[g].id.replace(b,"");var p=l[g].shape;var j=l[g].coords.split(",");if(this.isPointInsideArea(p,n,k,j)){return d}}}}else{for(var g=0;g<this.dataEvent.length;g++){var d=this.dataEvent[g][0];var p=this.dataEvent[g][1];var j=this.dataEvent[g][2];if(this.isPointInsideArea(p,n,k,j)){return d}}}}return false};this.isPointInsideArea=function(o,n,m,l){switch(o){case"rect":if(n>=l[0]&&n<=l[2]&&m>=l[1]&&m<=l[3]){return true}else{return false}case"circle":var k=Math.pow(2,l[0]-n)+Math.pow(2,l[1]-m);if(k<=Math.pow(2,l[2])){return true}else{return false}case"poly":var g=[];var e=[];for(var h=0;h<l.length;h++){if(h%2){e.push(l[h])}else{g.push(l[h])}}for(var h=0,f=g.length-1;h<g.length;f=h++){if(((e[h]<=m&&m<e[f])||(e[f]<=m&&m<e[h]))&&(n<(g[f]-g[h])*(m-e[h])/(e[f]-e[h])+g[h])){return true}}return false}};this.handleMouseEvents=function(d,f,c){if(c[0]==-1){this.showInfoSpan(f,"CanvasXpress ("+this.version+")")}else{var g=this.extractDataObject(c);if(this.userEvents[d]){if(typeof(this.userEvents[d])=="object"&&this.userEvents[d].handler&&this.userEvents[d].scope){if(this.ctrlOn&&d=="click"){this.addRemoveToSelectedDataPoints(false,this.getEventAreaId(f));this.draw()}else{if(this.shiftOn&&d=="click"&&this.graphType=="Network"&&this.networkLayoutType=="radial"){this.reRootRadialNetwork(this.getEventAreaId(f))}else{this.userEvents[d].handler.apply(this.userEvents[d].scope,[g,f])}}}else{if(typeof(this.userEvents[d])=="object"&&this.userEvents[d].handler){if(this.ctrlOn&&d=="click"){this.addRemoveToSelectedDataPoints(false,this.getEventAreaId(f));this.draw()}else{if(this.shiftOn&&d=="click"&&this.graphType=="Network"&&this.networkLayoutType=="radial"){this.reRootRadialNetwork(this.getEventAreaId(f))}else{this.userEvents[d].handler(g,f)}}}else{if(this.ctrlOn&&d=="click"){this.addRemoveToSelectedDataPoints(false,this.getEventAreaId(f));this.draw()}else{if(this.shiftOn&&d=="click"&&this.graphType=="Network"&&this.networkLayoutType=="radial"){this.reRootRadialNetwork(this.getEventAreaId(f))}else{this.userEvents[d](g,f)}}}}}}};this.extractDataObject=function(m){var k=this.layoutComb&&this.layoutValidN>-1?this.layoutParams[this.layoutValidN].graphType:this.graphType;switch(k){case"Area":var e={x:{},y:{},z:{}};e.x=this.data.x;e.y.vars=[];e.y.vars.push(this.data.y.vars[m[0]]);e.y.smps=this.data.y.smps;e.y.data=this.data.y.data[m[0]];for(var c in this.data.z){e.z[c]=[this.data.z[c][m[0]]]}return e;case"Bar":case"Line":case"BarLine":case"Boxplot":case"Dotplot":case"Heatmap":case"Stacked":case"StackedPercent":case"Scatter2D":case"ScatterBubble2D":case"Scatter3D":case"Candlestick":if(!m||!m[0].match(/^\d/)){if(m[0].match(/Dendrogram/)){var e={t:{}};var c=m[0].split("-");e.t.d=parseInt(c[1]);e.t.o=parseInt(c[2]);e.t.t=c[3];return e}else{return}}if(this.isGroupedData){var e={x:{},w:{},z:{}};for(var c in this.data.z){e.z[c]=[this.data.z[c][m[0]]]}for(var c in this.data.w){if(c=="grps"||c=="smps"){e.w[c]=[];e.w[c].push(this.data.w[c][m[1]])}else{if(c=="vars"){e.w[c]=[];e.w[c].push(this.data.y.vars[m[0]])}else{if(this.data.w[c].length>m[0]&&this.data.w[c][m[0]].length>m[1]){e.w[c]=[];e.w[c].push(this.data.w[c][m[0]][m[1]])}}}}for(var c in this.data.x){var h=[];for(var j=0;j<e.w.grps[0].length;j++){h.push(this.data.x[c][e.w.grps[0][j]])}e.x[c]=h}}else{var e={x:{},y:{},z:{}};if(k.match(/Scatter/)){var w=[m[0]];w.push(m[1]);w.push(m[2]);if(k=="Scatter3D"||this.type2D=="XYZ"||k=="ScatterBubble2D"){w.push(m[3])}if(this.colorBy&&this.getSampleIndices(this.colorBy)>-1){w.push(this.getSampleIndices(this.colorBy))}if(this.shapeBy&&this.getSampleIndices(this.shapeBy)>-1){w.push(this.getSampleIndices(this.shapeBy))}if(this.sizeBy&&this.getSampleIndices(this.sizeBy)>-1){w.push(this.getSampleIndices(this.sizeBy))}m=w}if(this.data.x){for(var c in this.data.x){var h=[];for(var j=1;j<m.length;j++){h.push(this.data.x[c][m[j]])}e.x[c]=h}}if(this.data.z){for(var c in this.data.z){var l=[];e.z[c]=[this.data.z[c][m[0]]]}}var q=[];var x=[];if(this.isRawData&&k!="Candlestick"){for(var j=1;j<m.length;j++){q.push(this.data.y.data[m[0]][m[j]]);x.push(this.data.y.smps[m[j]])}e.y.vars=[this.data.y.vars[m[0]]];e.y.smps=x;e.y.data=q}else{for(var j=1;j<m.length;j++){x.push(this.data.y.smps[m[j]])}e.y.vars=[this.data.y.vars[m[0]]];e.y.smps=x;for(var c in this.data.y){q=[];for(var j=1;j<m.length;j++){if(c&&c!="vars"&&c!="smps"&&c!="desc"){q.push(this.data.y[c][m[0]][m[j]])}}if(c&&c!="vars"&&c!="smps"&&c!="desc"){e.y[c]=q}}}}return e;case"Pie":var e={x:{},y:{},z:{}};if(this.data.x){for(var c in this.data.x){e.x[c]=[this.data.x[c][m[m.length-1]]]}}if(this.data.z){for(var c in this.data.z){var l=[];for(var j=0;j<m.length-1;j++){e.z[c]=[this.data.z[c][m[j]]]}}}var q=[];var u=[];for(var j=0;j<m.length-1;j++){u.push(this.data.y.vars[m[j]])}e.y.vars=u;e.y.smps=[this.data.y.smps[m[m.length-1]]];for(var c in this.data.y){q=[];for(var j=0;j<m.length-1;j++){if(c&&c!="vars"&&c!="smps"&&c!="desc"){q.push(this.data.y[c][m[j]][m[m.length-1]])}}if(c&&c!="vars"&&c!="smps"&&c!="desc"){e.y[c]=q}}return e;case"Correlation":if(!m||!m[0].match(/^\d/)){return}var q=this.isGroupedData?this.data.w.cor:this.data.y.cor;if(this.correlationAxis=="samples"){var e={x:{},y:{}};for(var c in this.data.x){var h=[];for(var j=0;j<m.length;j++){h.push(this.data.x[c][m[j]])}e.x[c]=h}e.y.smps=[this.data.y.smps[m[0]],this.data.y.smps[m[1]]]}else{var e={y:{},z:{}};for(var c in this.data.y){var l=[];for(var j=0;j<m.length;j++){l.push(this.data.y[c][m[j]])}e.z[c]=l}e.y.vars=[this.data.y.vars[m[0]],this.data.y.vars[m[1]]]}e.y.data=q[m[0]][m[1]];return e;case"Venn":var e={venn:{data:{}}};e.venn.data[this.vennCompartments[m[0]]]=this.data.venn.data[this.vennCompartments[m[0]]];return e;case"Network":var e={};if(!m||m.length==0){return}if(isNaN(m[0])){if(m[0].match(/legend/)){if(m[0].match(/Nodes/)){e={nodeLegend:this.data.legend.nodes}}else{if(m[0].match(/Edges/)){e={edgeLegend:this.data.legend.edges}}else{var w=parseInt(m[0].replace("-1-legend-Text",""));e={textLegend:this.data.legend.text[w]}}}}}else{for(var j=0;j<m.length;j++){if(m[j]>=this.data.nodes.length){if(!e.edges){e.edges=[]}e.edges.push(this.data.edges[m[j]-this.data.nodes.length])}else{if(!e.nodes){e.nodes=[]}e.nodes.push(this.data.nodes[m[j]])}}}return e;case"Genome":var e=[];e[0]={};var w=0;for(var j=0;j<this.data.tracks.length;j++){var f=this.data.tracks[j].data.length;w+=f;if(m[0]<w){var r=m[0]-(w-f);for(var c in this.data.tracks[j]){if(c=="data"){e[0][c]=[];e[0][c].push(this.data.tracks[j][c][r])}else{e[0][c]=this.data.tracks[j][c]}}return e}}}};this.registerDragDiv=function(r){if(!r){r=window.event}if(this.resizingCanvasOn){this.movingOn=true}else{if(!r){return}var w=this.adjustedCoordinates(r);if(w){var m=w.x;var x=w.y;var v=0;for(var o=0;o<this.layoutRows;o++){for(var n=0;n<this.layoutCols;n++){var q=this.layoutComb?this.layoutParams[v].graphType:this.graphType;if(q.match(/Correlation|Pie|Venn|Stacked|Area/)){return false}var u=this.getBoundsXY(v,o,n);if(m>=u[0]&&m<=u[1]&&x>=u[2]&&x<=u[3]){this.draggingOn=true;this.draggingShiftOn=this.shiftOn;this.draggingAltOn=this.altOn;this.draggingCtrlOn=this.ctrlOn;this.xMouseDown=m;this.yMouseDown=x;var s=document.getElementById(b+"canvasXpressDrag");if(q=="Network"){var k,p;var h=r.target||r.srcElement;var f=h.id;if(f.match(/-legend-/)){if(f.match(/-legend-Nodes/)){this.moveLegend="Nodes"}else{if(f.match(/-legend-Edges/)){this.moveLegend="Edges"}else{this.moveLegend=f.split(/-legend-/)[1]}}}else{if(f.match(/-lab$/)){if(this.shiftOn){k=parseInt(f.split(/-lab/)[0].replace(b,""));p=true}else{this.resetDragDiv(r)}}else{k=parseInt(f.replace(b,""))}if(!isNaN(k)&&k<this.data.nodes.length){h.style.cursor="move";this.moveNode=true;this.moveNodeIndex=k;if(p){this.moveNodeLab=true}}}}if((!q.match(/Scatter|Heatmap|Network|Genome/)&&this.graphOrientation=="vertical"&&!this.draggingShiftOn)||(!q.match(/Scatter|Heatmap|Network|Genome/)&&this.graphOrientation!="vertical"&&this.draggingShiftOn)){s.style.left=u[0]+"px"}else{s.style.left=this.xMouseDown+"px"}if((!q.match(/Scatter|Heatmap|Network|Genome/)&&this.graphOrientation!="vertical"&&!this.draggingShiftOn)||(!q.match(/Scatter|Heatmap|Network|Genome/)&&this.graphOrientation=="vertical"&&this.draggingShiftOn)||q=="Genome"){s.style.top=u[2]+"px"}else{s.style.top=this.yMouseDown+"px"}if(this.layoutValid){this.layoutValidR=o;this.layoutValidC=n;this.layoutValidN=v}return false}v++}}}}};this.updateDragDiv=function(L){if(this.draggingOn){if(!L){L=window.event}if(this.resetOn){this.resetOn=false;this.stopEvent(L);return}var O=this.adjustedCoordinates(L);if(O){var D=O.x;var z=O.y;var G=this.layoutValidR;var F=this.layoutValidC;var N=this.layoutValidN;var I=this.layoutComb?this.layoutParams[N].graphType:this.graphType;if(I.match(/Correlation|Pie|Venn|Stacked|Area/)){return false}if(I=="Scatter3D"&&!this.shiftOn){if(!this.rotatingOn){this.rotatingOn=new Date().getTime();var f=this;var K=this.xMouseDown;var m=this.yMouseDown;var J=D;var k=z;var v=this.lineLength(K,m,J,k);var E=this.layoutComb?this.layoutParams[N].x:this.layoutValid?this.x*this.scaleX:this.x;var h=this.layoutComb?this.layoutParams[N].y:this.layoutValid?this.y*this.scaleY:this.y;var u=((J-K)*this.rotationSensitivity)/E;var q=((k-m)*this.rotationSensitivity)/h;var p=(v*this.rotationSensitivity)/E;this.xRotate-=u;this.yRotate+=q;this.zRotate-=p;this.draw();this.rotatingOn=true;var s=function(){this.update=function(){var e=new Date().getTime();if(e-f.rotatingOn>f.rotationDelay){f.rotatingOn=false;clearInterval(c)}};var c=setInterval(this.update,20)};s.call()}}else{if(I=="Network"&&(this.moveNode||this.moveLegend)){this.movingOn=true;var o=D;var n=z;var H=L.target||L.srcElement;if(this.moveLegend){if(this.moveLegend=="Nodes"){var u=this.data.legend.pos.nodes.x-((o/this.scaleFactor)-this.offsetX);var q=this.data.legend.pos.nodes.y-((n/this.scaleFactor)-this.offsetY);this.data.legend.pos.nodes.x-=u;this.data.legend.pos.nodes.y-=q}else{if(this.moveLegend=="Edges"){var u=this.data.legend.pos.edges.x-((o/this.scaleFactor)-this.offsetX);var q=this.data.legend.pos.edges.y-((n/this.scaleFactor)-this.offsetY);this.data.legend.pos.edges.x-=u;this.data.legend.pos.edges.y-=q}else{var B=parseInt(this.moveLegend.replace("Text",""));var u=this.data.legend.text[B].x-((o/this.scaleFactor)-this.offsetX);var q=this.data.legend.text[B].y-((n/this.scaleFactor)-this.offsetY);this.data.legend.text[B].x-=u;this.data.legend.text[B].y-=q}}}else{if(this.data.nodes[this.moveNodeIndex]){var u,q;var C=this.data.nodes[this.moveNodeIndex];if(this.is3DNetwork){u=C.x3d-((o/this.scaleFactor)-this.offsetX);q=C.y3d-((n/this.scaleFactor)-this.offsetY)}else{u=C.x-((o/this.scaleFactor)-this.offsetX);q=C.y-((n/this.scaleFactor)-this.offsetY)}var A=this.randomNetwork;if(this.moveNodeLab){u=C.labelX?C.labelX-((o/this.scaleFactor)-this.offsetX):u;q=C.labelY?C.labelY-((n/this.scaleFactor)-this.offsetY):q;this.modifyXYNodeLab(C.id,u,q)}else{this.modifyXYNode(C.id,u,q);for(var B in this.selectNode){if(B!=C.id){this.modifyXYNode(B,u,q)}}}}}this.calculateLayout=false;this.randomNetwork=false;this.draw();if(this.is3DNetwork){this.moveNodeIndex=this.data.nodeIndices[C.id]}this.randomNetwork=A;document.getElementById(H.id).style.cursor="move"}else{var w=this.getBoundsXY(N,G,F);var M=document.getElementById(b+"canvasXpressDrag");if((!I.match(/Scatter|Heatmap|Network|Genome/)&&this.graphOrientation=="vertical"&&!this.draggingShiftOn)||(!I.match(/Scatter|Heatmap|Network|Genome/)&&this.graphOrientation!="vertical"&&this.draggingShiftOn)){M.style.width=(w[1]-w[0])+"px"}else{if(D>this.xMouseDown){if(D>w[1]){M.style.width=(w[1]-this.xMouseDown)+"px"}else{M.style.width=(D-this.xMouseDown)+"px"}}else{if(D<w[0]){M.style.left=w[0]+"px";M.style.width=(this.xMouseDown-w[0])+"px"}else{M.style.left=D+"px";M.style.width=(this.xMouseDown-D)+"px"}}}if((!I.match(/Scatter|Heatmap|Network|Genome/)&&this.graphOrientation!="vertical"&&!this.draggingShiftOn)||(!I.match(/Scatter|Heatmap|Network|Genome/)&&this.graphOrientation=="vertical"&&this.draggingShiftOn)||I=="Genome"){M.style.height=(w[3]-w[2])+"px"}else{if(z>this.yMouseDown){if(z>w[3]){M.style.height=(w[3]-this.yMouseDown)+"px"}else{M.style.height=(z-this.yMouseDown)+"px"}}else{if(z<w[2]){M.style.top=w[2]+"px";M.style.height=(this.yMouseDown-w[2])+"px"}else{M.style.top=z+"px";M.style.height=(this.yMouseDown-z)+"px"}}}}}}this.movingOn=true;this.resetOn=false}else{if(this.resizingCanvasOn&&this.movingOn){document.body.style.cursor=this.resizingCanvasOn;var A=document.getElementById(b+"canvasXpressCanvasResize");var O=this.adjustedCoordinates(L);if(A&&O){if(this.resizingCanvasOn=="se-resize"){A.style.width=O.x+"px";A.style.height=O.y+"px"}else{if(this.resizingCanvasOn=="e-resize"){A.style.width=O.x+"px";A.style.height=this.height+"px"}else{if(this.resizingCanvasOn=="s-resize"){A.style.width=this.width+"px";A.style.height=O.y+"px"}}}A.style.display="block"}}else{this.registerCanvasResize(L)}}};this.endDragDiv=function(k){if(this.draggingOn){var r=this.layoutComb?this.layoutParams[this.layoutValidN].graphType:this.graphType;if(r.match(/Correlation|Pie|Venn|Stacked|Area/)){return false}if(!k){k=window.event}if(r=="Scatter3D"&&!this.shiftOn){this.endDrag=true;this.resetDragDiv(k)}else{if(r=="Network"&&(this.moveNode||this.moveLegend)){var n=document.getElementById(b+"canvasXpressImage");if(n){n.style.cursor="default";var f=k.target||k.srcElement;f.style.cursor="default";if(this.isSelectNodes&&this.movingOn){this.resetSelectedNodes();this.draw()}if(this.userEvents.enddragnode&&this.movingOn){var j;if(this.moveLegend){j={legend:this.moveLegend}}else{var q=this.moveNodeIndex;var c=this.findChildrenNodeIndices(this.data.nodes[q].id);if(c){c.push(q)}else{c=[q]}j=this.extractDataObject(c)}this.resetDragDiv(k);this.userEvents.enddragnode.call(this,j)}else{this.resetDragDiv(k)}}}else{if(this.movingOn){var u=this.adjustedCoordinates(k);if(u){var i=u.x;var s=u.y;if(i!=this.xMouseDown||s!=this.yMouseDown){var m=document.getElementById(b+"canvasXpressDrag");var h=parseInt(m.style.left);var p=parseInt(m.style.top);var g=h+parseInt(m.style.width);var o=p+parseInt(m.style.height);this.endDrag=true;this.handleDragEvent(h,p,g,o);this.resetDragDiv(k)}}}else{this.resetDragDiv(k)}}}}else{this.resetDragDiv(k)}};this.registerKey=function(d){if(!d){d=window.event}var f;if((d.charCode)&&(d.keyCode==0)){f=d.charCode}else{f=d.keyCode}if(this.eventKeys||(this.ctrlOn&&this.altOn&&f==107)){if(f==27){if(this.ctrlOn){if(this.shiftOn){if(this.ctrlShiftDisabled){this.ctrlShiftDisabled=false}else{this.ctrlShiftDisabled=true}}else{if(this.altOn){if(this.ctrlAltDisabled){this.ctrlAltDisabled=false}else{this.ctrlAlttDisabled=true}}else{if(this.ctrlDisabled){this.ctrlDisabled=false}else{this.ctrlDisabled=true}}}}else{if(this.shiftOn){if(this.ctrlOn){if(this.ctrlShiftDisabled){this.ctrlShiftDisabled=false}else{this.ctrlShiftDisabled=true}}else{if(this.altOn){if(this.shiftAltDisabled){this.shiftAltDisabled=false}else{this.shiftAlttDisabled=true}}else{if(this.shiftDisabled){this.shiftDisabled=false}else{this.shiftDisabled=true}}}}else{if(this.altOn){if(this.ctrlOn){if(this.ctrlAltDisabled){this.ctrlAltDisabled=false}else{this.ctrlAlttDisabled=true}}else{if(this.shiftOn){if(this.shiftAltDisabled){this.shiftAltDisabled=false}else{this.shiftAlttDisabled=true}}else{if(this.altDisabled){this.altDisabled=false}else{this.altDisabled=true}}}}else{this.masterReset(d)}}}}else{if(f==16){this.shiftOn=true;if(this.ctrlOn){if(!this.ctrlShiftDisabled){this.showCtrlShiftShorts()}}else{if(this.altOn){if(!this.shiftAltDisabled){this.showShiftAltShorts()}}else{if(!this.shiftDisabled){this.showShiftShorts()}}}}else{if(f==17){this.ctrlOn=true;if(this.shiftOn){if(!this.ctrlShiftDisabled){this.showCtrlShiftShorts()}}else{if(this.altOn){if(!this.ctrlAltDisabled){this.showCtrlAltShorts()}}else{if(!this.ctrlDisabled){this.showCtrlShorts()}}}}else{if(f==18){this.altOn=true;if(this.ctrlOn){if(!this.ctrlAltDisabled){this.showCtrlAltShorts()}}else{if(this.shiftOn){if(!this.shiftAltDisabled){this.showShiftAltShorts()}}else{if(!this.altDisabled){this.showAltShorts()}}}}else{if((f>90&&f<95)||f==0){this.winOn=true}else{if(this.ctrlOn&&this.shiftOn){if(!this.ctrlShiftDisabled){this.cancelEvent(d);if(f==80){this.print()}if(f>=33&&f<=40){this.arrowMove(f)}document.defaultAction=true}}else{if(this.ctrlOn&&this.altOn){if(!this.ctrlAltDisabled){this.cancelEvent(d);if(f==107){if(this.eventKeys){this.eventKeys=false}else{this.eventKeys=true}}document.defaultAction=true}}else{if(this.shiftOn&&this.altOn){if(!this.shiftAltDisabled){this.cancelEvent(d);if(f>=50&&f<90){this.setGraphType(f)}document.defaultAction=true}}else{if(this.ctrlOn){if(!this.ctrlDisabled){this.cancelEvent(d);if(f>=33&&f<=40){this.arrowMove(f)}else{if(f==45||f==46){this.showHideSelectedDataPoint(d,f)}else{if(f>=48&&f<58){this.setLayout(f-48)}else{if(f>=65&&f<90){if(f==80){this.print()}if(this.graphType=="Network"){this.alignDistributeSelectedNodes(f)}}}}}document.defaultAction=true}}else{if(this.shiftOn){if(!this.shiftDisabled){this.cancelEvent(d);document.defaultAction=true}}else{if(this.altOn){if(!this.altDisabled){this.cancelEvent(d);document.defaultAction=true}}else{this.shiftOn=false;this.ctrlOn=false;this.altOn=false;this.winOn=false}}}}}}}}}}}}};this.showCtrlShiftShorts=function(){var c="<table class=shorts>";c+="<tr><th colspan=2>Shift + Ctrl</th></tr>";if(this.graphType=="Network"){if(this.is3DNetwork){c+="<tr><td class=k>&rarr;</td><td class=d>Rotate clockwise "+(this.rotationStep*1)+"&deg; continuously</td></tr>";c+="<tr><td class=k>&larr;</td><td class=d>Rotate anti-clockwise "+(this.rotationStep*1)+"&deg; continuously</td></tr>";c+="<tr><td class=k>&darr;</td><td class=d>Rotate forward "+(this.rotationStep*1)+"&deg; continuously</td></tr>";c+="<tr><td class=k>&uarr;</td><td class=d>Rotate backward "+(this.rotationStep*1)+"&deg; continuously</td></tr>";c+="<tr><td class=k>PgUp</td><td class=d>Rotate anti-clockwise and backward "+(this.rotationStep*3)+"&deg; continuously</td></tr>";c+="<tr><td class=k>PgDn</td><td class=d>Rotate clockwise and forward "+(this.rotationStep*3)+"&deg; continuously</td></tr>"}else{c+="<tr><td class=k>&rarr; or &darr;</td><td class=d>Rotate clockwise "+(this.rotationStep*1)+"&deg; continuously</td></tr>";c+="<tr><td class=k>&larr; or &uarr;</td><td class=d>Rotate anti-clockwise "+(this.rotationStep*1)+"&deg; continuously</td></tr>";c+="<tr><td class=k>PgUp</td><td class=d>Rotate anti-clockwise "+(this.rotationStep*3)+"&deg; continuously</td></tr>";c+="<tr><td class=k>PgDn</td><td class=d>Rotate clockwise "+(this.rotationStep*3)+"&deg; continuously</td></tr>"}}else{if(this.graphType=="Scatter2D"||this.graphType=="ScatterBubble2D"){if(this.type2D=="XYZ"){if(this.xAxis.length>1){c+="<tr><td class=k>&rarr; or &darr; or &larr; or &uarr;</td><td class=d>Update samples in X, Y and Z axes continuously (1x)</td></tr>";c+="<tr><td class=k>PgUp or PgDn</td><td class=d>Update samples in X, Y and Z axes continuously (2x)</td></tr>"}}else{if(this.type2D=="XY"){if(this.zAxis.length>1){c+="<tr><td class=k>&rarr; or &darr; or &larr; or &uarr;</td><td class=d>Update sample in Z axis continuously (1x)</td></tr>";c+="<tr><td class=k>PgUp or PgDn</td><td class=d>Update sample in Z axis continuously (2x)</td></tr>"}}else{if(this.type2D=="X"){if(this.yAxis.length>1){c+="<tr><td class=k>&rarr; or &darr; or &larr; or &uarr;</td><td class=d>Update samples in Y and Z axes continuously (1x)</td></tr>";c+="<tr><td class=k>PgUp or PgDn</td><td class=d>Update samples in Y and Z axes continuously (2x)</td></tr>"}}else{if(this.xAxis.length>1){c+="<tr><td class=k>&rarr; or &darr; or &larr; or &uarr;</td><td class=d>Update samples in X and Z axes continuously (1x)</td></tr>";c+="<tr><td class=k>PgUp or PgDn</td><td class=d>Update samples in X and Z axes continuously (2x)</td></tr>"}}}}}else{if(this.graphType=="Scatter3D"){c+="<tr><td class=k>&rarr; or &darr; or &larr; or &uarr;</td><td class=d>Rotate continuously</td></tr>";c+="<tr><td class=k>PgUp or PgDn</td><td class=d>Rotate continuously</td></tr>"}else{if(this.isSegregable()){c+="<tr><td class=k>Click and Drag</td><td class=d>Select Samples</td></tr>"}}}}c+="<tr><td class=k>P</td><td class=d>Print</td></tr>";c+="</table>";this.showInfoSpan(false,c)};this.showCtrlAltShorts=function(){var c="<table class=shorts>";c+="<tr><th colspan=2>Ctrl + Alt</th></tr>";c+="<tr><td class=k>k</td><td class=d>Enable/Disable key events</td></tr>";c+="</table>";this.showInfoSpan(false,c)};this.showShiftAltShorts=function(){var c="<table class=shorts>";c+="<tr><th colspan=2>Shift + Alt</th></tr>";c+="<tr><td class=k>2</td><td class=d>Scatter2D</td></tr>";c+="<tr><td class=k>3</td><td class=d>Scatter3D</td></tr>";c+="<tr><td class=k>4</td><td class=d>ScatterBubble2D</td></tr>";c+="<tr><td class=k>A</td><td class=d>Area</td></tr>";c+="<tr><td class=k>B</td><td class=d>Bar</td></tr>";c+="<tr><td class=k>C</td><td class=d>BarLine</td></tr>";c+="<tr><td class=k>D</td><td class=d>Dotplot</td></tr>";c+="<tr><td class=k>G</td><td class=d>Genome</td></tr>";c+="<tr><td class=k>H</td><td class=d>Heatmap</td></tr>";c+="<tr><td class=k>I</td><td class=d>Boxplot</td></tr>";c+="<tr><td class=k>L</td><td class=d>Line</td></tr>";c+="<tr><td class=k>M</td><td class=d>Candlestick</td></tr>";c+="<tr><td class=k>N</td><td class=d>Network</td></tr>";c+="<tr><td class=k>P</td><td class=d>Pie</td></tr>";c+="<tr><td class=k>S</td><td class=d>Stacked</td></tr>";c+="<tr><td class=k>T</td><td class=d>StackedPercent</td></tr>";c+="<tr><td class=k>V</td><td class=d>Venn</td></tr>";c+="<tr><td class=k>X</td><td class=d>Correlation</td></tr>";c+="</table>";this.showInfoSpan(false,c)};this.showCtrlShorts=function(){var c="<table class=shorts>";c+="<tr><th colspan=2>Ctrl</th></tr>";if(this.graphType=="Network"){if(this.is3DNetwork){c+="<tr><td class=k>&rarr;</td><td class=d>Rotate clockwise "+(this.rotationStep*1)+"&deg;</td></tr>";c+="<tr><td class=k>&larr;</td><td class=d>Rotate anti-clockwise "+(this.rotationStep*1)+"&deg;</td></tr>";c+="<tr><td class=k>&darr;</td><td class=d>Rotate forward "+(this.rotationStep*1)+"&deg;</td></tr>";c+="<tr><td class=k>&uarr;</td><td class=d>Rotate backward "+(this.rotationStep*1)+"&deg;</td></tr>";c+="<tr><td class=k>PgUp</td><td class=d>Rotate anti-clockwise and backward "+(this.rotationStep*3)+"&deg;</td></tr>";c+="<tr><td class=k>PgDn</td><td class=d>Rotate clockwise and forward "+(this.rotationStep*3)+"&deg;</td></tr>"}else{c+="<tr><td class=k>&rarr; or &darr;</td><td class=d>Rotate clockwise "+(this.rotationStep*1)+"&deg;</td></tr>";c+="<tr><td class=k>&larr; or &uarr;</td><td class=d>Rotate anti-clockwise "+(this.rotationStep*1)+"&deg;</td></tr>";c+="<tr><td class=k>PgUp</td><td class=d>Rotate anti-clockwise "+(this.rotationStep*3)+"&deg;</td></tr>";c+="<tr><td class=k>PgDn</td><td class=d>Rotate clockwise "+(this.rotationStep*3)+"&deg;</td></tr>"}c+="<tr><td class=k>click</td><td class=d>Select/Unselect node</td></tr>";if(this.isSelectNodes){c+="<tr><td class=k>Delete</td><td class=d>Hide selected nodes</td></tr>";c+="<tr><td class=k>Insert</td><td class=d>Show selected-hidden nodes</td></tr>";c+="<tr><td class=k>t</td><td class=d>Align top</td></tr>";c+="<tr><td class=k>r</td><td class=d>Align right</td></tr>";c+="<tr><td class=k>b</td><td class=d>Align bottom</td></tr>";c+="<tr><td class=k>l</td><td class=d>Align left</td></tr>";c+="<tr><td class=k>v</td><td class=d>Distribute verticaly</td></tr>";c+="<tr><td class=k>h</td><td class=d>Distribute Horizontaly</td></tr>";c+="<tr><td class=k>u</td><td class=d>Undo move</td></tr>"}}else{if(this.graphType=="Scatter2D"||this.graphType=="ScatterBubble2D"){if(this.type2D=="XYZ"){if(this.xAxis.length>1){c+="<tr><td class=k>&rarr; or &darr; or &larr; or &uarr;</td><td class=d>Update samples in X, Y and Z axes (1x)</td></tr>";c+="<tr><td class=k>PgUp or PgDn</td><td class=d>Update samples in X, Y and Z axes (2x)</td></tr>"}}else{if(this.type2D=="XY"){if(this.zAxis.length>1){c+="<tr><td class=k>&rarr; or &darr; or &larr; or &uarr;</td><td class=d>Update sample in Z axis (1x)</td></tr>";c+="<tr><td class=k>PgUp or PgDn</td><td class=d>Update sample in Z axis (2x)</td></tr>"}}else{if(this.type2D=="X"){if(this.yAxis.length>1){c+="<tr><td class=k>&rarr; or &darr; or &larr; or &uarr;</td><td class=d>Update samples in Y and Z axes (1x)</td></tr>";c+="<tr><td class=k>PgUp or PgDn</td><td class=d>Update samples in Y and Z axes (2x)</td></tr>"}}else{if(this.xAxis.length>1){c+="<tr><td class=k>&rarr; or &darr; or &larr; or &uarr;</td><td class=d>Update samples in X and Z axes (1x)</td></tr>";c+="<tr><td class=k>PgUp or PgDn</td><td class=d>Update samples in X and Z axes (2x)</td></tr>"}}}}if(this.isSelectDataPoints){c+="<tr><td class=k>Delete</td><td class=d>Hide selected nodes</td></tr>";c+="<tr><td class=k>Insert</td><td class=d>Show selected-hidden nodes</td></tr>"}}else{if(this.graphType=="Scatter3D"){c+="<tr><td class=k>&rarr;</td><td class=d>Rotate clockwise "+(this.rotationStep*1)+"&deg;</td></tr>";c+="<tr><td class=k>&larr;</td><td class=d>Rotate anti-clockwise "+(this.rotationStep*1)+"&deg;</td></tr>";c+="<tr><td class=k>&darr;</td><td class=d>Rotate forward "+(this.rotationStep*1)+"&deg;</td></tr>";c+="<tr><td class=k>&uarr;</td><td class=d>Rotate backward "+(this.rotationStep*1)+"&deg;</td></tr>";c+="<tr><td class=k>PgUp</td><td class=d>Rotate anti-clockwise and backward "+(this.rotationStep*3)+"&deg;</td></tr>";c+="<tr><td class=k>PgDn</td><td class=d>Rotate clockwise and forward "+(this.rotationStep*3)+"&deg;</td></tr>";c+="<tr><td class=k>click</td><td class=d>Select/Unselect data points</td></tr>";if(this.isSelectDataPoints){c+="<tr><td class=k>Delete</td><td class=d>Hide selected nodes</td></tr>";c+="<tr><td class=k>Insert</td><td class=d>Show selected-hidden nodes</td></tr>"}}else{if(this.isSegregable()){c+="<tr><td class=k>1 - 9</td><td class=d>Number of columns to plot individual variables</td></tr>";c+="<tr><td class=k>0</td><td class=d>Reset layout</td></tr>"}}}}c+="<tr><td class=k>P</td><td class=d>Print</td></tr>";c+="</table>";this.showInfoSpan(false,c)};this.showShiftShorts=function(){};this.showAltShorts=function(){};this.masterReset=function(c){this.animationOn=false;this.resetKey(c);this.resetDragDiv(c);this.resetSelectedDataPoints();this.resetSelectedNodes();document.defaultAction=true;this.redraw()};this.resetKey=function(c){if(this.eventKeys){this.ctrlOn=false;this.altOn=false;this.shiftOn=false;this.winOn=false}};this.arrowMove=function(g){switch(this.graphType){case"Network":if(this.is3DNetwork){if(g==33){this.xRotate+=(this.rotationStep*3);this.yRotate-=(this.rotationStep*3)}else{if(g==34){this.xRotate-=(this.rotationStep*3);this.yRotate+=(this.rotationStep*3)}else{if(g==37){this.xRotate+=this.rotationStep}else{if(g==38){this.yRotate-=this.rotationStep}else{if(g==39){this.xRotate-=this.rotationStep}else{if(g==40){this.yRotate+=this.rotationStep}}}}}}}else{if(g==33){this.network2DRotate-=(this.rotationStep*3)}else{if(g==34){this.network2DRotate+=(this.rotationStep*3)}else{if(g==37||g==38){this.network2DRotate-=this.rotationStep}else{if(g==39||g==40){this.network2DRotate+=this.rotationStep}}}}}break;case"Scatter2D":case"ScatterBubble2D":var e;var f;if(this.type2D=="XYZ"){e=["xAxisCurrent","yAxisCurrent","zAxisCurrent"];f=["xAxis","yAxis","zAxis"]}else{if(this.type2D=="XY"){e=["zAxisCurrent"];f=["zAxis"]}else{if(this.type2D=="X"){e=["yAxisCurrent","zAxisCurrent"];f=["yAxis","zAxis"]}else{e=["xAxisCurrent","zAxisCurrent"];f=["xAxis","zAxis"]}}}if(g==33){for(var d=0;d<e.length;d++){this[e[d]]+=2}}else{if(g==34){for(var d=0;d<e.length;d++){this[e[d]]-=2}}else{if(g==35){for(var d=0;d<e.length;d++){this[e[d]]=this[f[d]].length-1}}else{if(g==36){for(var d=0;d<e.length;d++){this[e[d]]=0}}else{if(g==37||g==40){for(var d=0;d<e.length;d++){this[e[d]]--}}else{if(g==38||g==39){for(var d=0;d<e.length;d++){this[e[d]]++}}}}}}}this.xAxisCurrent=this.xAxisCurrent<0?this.xAxis.length-1:this.xAxisCurrent>this.xAxis.length-1?0:this.xAxisCurrent;this.yAxisCurrent=this.yAxisCurrent<0?this.xAxis.length-1:this.yAxisCurrent>this.yAxis.length-1?0:this.yAxisCurrent;this.zAxisCurrent=this.zAxisCurrent<0?this.xAxis.length-1:this.zAxisCurrent>this.zAxis.length-1?0:this.zAxisCurrent;break;case"Scatter3D":if(g==33){this.xRotate+=(this.rotationStep*3);this.yRotate-=(this.rotationStep*3)}else{if(g==34){this.xRotate-=(this.rotationStep*3);this.yRotate+=(this.rotationStep*3)}else{if(g==35){this.xRotate=0;this.yRotate=0;this.zRotate=45}else{if(g==36){this.xRotate=45;this.yRotate=0;this.zRotate=0}else{if(g==37){this.xRotate+=this.rotationStep}else{if(g==38){this.yRotate-=this.rotationStep}else{if(g==39){this.xRotate-=this.rotationStep}else{if(g==40){this.yRotate+=this.rotationStep}}}}}}}}break}if(this.ctrlOn&&this.shiftOn&&!this.animationOn){this.animationOn=true;this.animate(g)}else{this.draw()}};this.animate=function(f){var d=this;var e=function(){this.update=function(){if(!d.animationOn){clearInterval(c)}d.arrowMove(f);switch(d.graphType){case"Network":if(this.is3DNetwork){if(f==33){this.xRotate+=(this.rotationStep*3);this.yRotate-=(this.rotationStep*3)}else{if(f==34){this.xRotate-=(this.rotationStep*3);this.yRotate+=(this.rotationStep*3)}else{if(f==37){this.xRotate-=this.rotationStep}else{if(f==38){this.yRotate-=this.rotationStep}else{if(f==39){this.xRotate+=this.rotationStep}else{if(f==40){this.yRotate+=this.rotationStep}}}}}}}else{if(f==33){this.network2DRotate+=(this.rotationStep*3)}else{if(f==34){this.network2DRotate-=(this.rotationStep*3)}else{if(f==37||f==38){this.network2DRotate-=this.rotationStep}else{if(f==39||f==40){this.network2DRotate+=this.rotationStep}}}}}break;case"Scatter2D":case"ScatterBubble2D":if(f!=37){if(d.graphType=="ScatterBubble2D"&&d.xAxisIndices.length>1&&d.xAxisIndices.length==d.yAxisIndices.length&&d.xAxisIndices.length==d.zAxisIndices.length){if(d.xAxisCurrent>=d.xAxis.length-1){d.xAxisCurrent=d.xAxis.length-1;d.yAxisCurrent=d.yAxis.length-1;d.zAxisCurrent=d.zAxis.length-1;f=37}}else{if(d.xAxisIndices.length>1&&d.xAxisIndices.length==d.yAxisIndices.length){if(d.zAxisCurrent>=d.zAxis.length-1){d.zAxisCurrent=d.zAxis.length-1;f=37}}else{if(d.xAxisIndices.length>d.yAxisIndices.length){if(d.yAxisCurrent>=d.yAxis.length-1){d.yAxisCurrent=d.yAxis.length-1}if(d.zAxisCurrent>=d.zAxis.length-1){d.zAxisCurrent=d.zAxis.length-1}if(d.yAxisCurrent>=d.yAxis.length-1&&d.zAxisCurrent>=d.zAxis.length-1){f=37}}else{if(d.xAxisCurrent>=d.xAxis.length-1){d.xAxisCurrent=d.xAxis.length-1}if(d.zAxisCurrent>=d.zAxis.length-1){d.zAxisCurrent=d.zAxis.length-1}if(d.xAxisCurrent>=d.xAxis.length-1&&d.zAxisCurrent>=d.zAxis.length-1){f=37}}}}}else{if(f!=39){if(d.graphType=="ScatterBubble2D"&&d.xAxisIndices.length>1&&d.xAxisIndices.length==d.yAxisIndices.length&&d.xAxisIndices.length==d.zAxisIndices.length){if(d.xAxisCurrent<=0){d.xAxisCurrent=0;d.yAxisCurrent=0;d.zAxisCurrent=0;f=39}}else{if(d.xAxisIndices.length>1&&d.xAxisIndices.length==d.yAxisIndices.length){if(d.zAxisCurrent<=0){d.zAxisCurrent=0;f=39}}else{if(d.xAxisIndices.length>d.yAxisIndices.length){if(d.yAxisCurrent<=0){d.yAxisCurrent=0}if(d.zAxisCurrent<=0){d.zAxisCurrent=0}if(d.yAxisCurrent<=0&&d.zAxisCurrent<=0){f=39}}else{if(d.xAxisCurrent<=0){d.xAxisCurrent=0}if(d.zAxisCurrent<=0){d.zAxisCurrent=0}if(d.xAxisCurrent<=0&&d.zAxisCurrent<=0){f=39}}}}}}break;case"Scatter3D":if(d.xRotate<=0&&(f==39||f<37)){d.xRotate=0;d.yRotate=0;f=40}else{if(d.xRotate>=90&&(f==37||f<37)){d.xRotate=90;d.yRotate=90;f=38}else{if(d.yRotate<=0&&(f==38||f<37)){d.yRotate=0;d.xRotate=90;f=39}else{if(d.yRotate>=90&&(f==40||f<37)){d.yRotate=90;d.xRotate=0;f=37}}}}break}};var c=setInterval(this.update,d.animationTime)};e.call()};this.redraw=function(){this.setOriginalOptions();switch(this.graphType){case"Area":case"Stacked":case"StackedPercent":case"Correlation":case"Venn":case"Pie":this.setAllVariablesVisible();this.setAllSamplesVisible();return true;case"Bar":case"Line":case"BarLine":case"Boxplot":case"Dotplot":case"Genome":case"Candlestick":this.setAllVariablesVisible();this.setAllSamplesVisible();this.setMin=false;this.setMax=false;this.setMin2=false;this.setMax2=false;this.draw();return true;case"Scatter2D":case"ScatterBubble2D":this.resetSelectedDataPoints();this.setAllVariablesVisible();this.setAllSamplesVisible();this.setMinX=false;this.setMaxX=false;this.setMinY=false;this.setMaxY=false;this.draw();return true;case"Scatter3D":this.resetSelectedDataPoints();this.setAllVariablesVisible();this.setAllSamplesVisible();this.xRotate=45;this.yRotate=0;this.draw();return true;case"Heatmap":this.setAllVariablesVisible();this.setAllSamplesVisible();this.varIndicesStart=-1;this.smpIndicesStart=-1;this.draw();return true;case"Network":this.resetSelectedNodes();this.setAllNodesVisible();this.network2DRotate=0;if(this.randomNetwork){this.layoutDone=false}this.ctx.translate(-this.offsetX,-this.offsetY);this.ctx.scale(1/this.scaleFactor,1/this.scaleFactor);this.draw();return true}};this.mouseClick=function(c){if(this.ctrlOn){this.stopEvent(c);this.ctrlOn=false}else{if(this.altOn){this.stopEvent(c);this.altOn=false;this.print(c)}else{if(this.isAxis(c)){this.stopEvent(c)}else{if(this.resizingOn){this.stopEvent(c);this.hideResizer(c)}}}}};this.getBoundsXY=function(f,e,d){if(this.layoutValid){if(this.layoutComb){return[this.layoutParams[f].offsetX+this.layoutParams[f].left,this.layoutParams[f].offsetX+this.layoutParams[f].left+this.layoutParams[f].x,this.layoutParams[f].offsetY+this.layoutParams[f].top,this.layoutParams[f].offsetY+this.layoutParams[f].top+this.layoutParams[f].y]}else{return[(this.width/this.layoutCols*d)+(this.left*this.scaleX),(this.width/this.layoutCols*d)+((this.left+this.x)*this.scaleX),(this.height/this.layoutRows*e)+(this.top*this.scaleY),(this.height/this.layoutRows*e)+((this.top+this.y)*this.scaleY)]}}else{return[this.left,this.left+this.x,this.top,this.top+this.y]}};this.getAxesVals=function(h,e,d){var g=["minData","maxData","xAxisMin","xAxisMax","xAxis2Min","xAxis2Max","yAxisMin","yAxisMax","zAxisMin","zAxisMax","xAxisUnit","xAxis2Unit","yAxisUnit","zAxisUnit","setMin","setMax","setMinX","setMaxX","setMinX2","setMaxX2","setMinY","setMaxY","setMinZ","setMaxZ","xAxisAbsMin","xAxisAbsMax","xAxis2AbsMin","xAxis2AbsMax","yAxisAbsMin","yAxisAbsMax","zAxisAbsMin","zAxisAbsMax","graphType","x","y"];var f={};if(this.layoutComb){for(var e=0;e<g.length;e++){f[g[e]]=this.layoutParams[h][g[e]]}}else{for(var e=0;e<g.length;e++){f[g[e]]=this[g[e]]}}return f};this.modifyDendrogram=function(i){var g=i.t.t=="varDendrogram"?this.varIndicesStart:this.smpIndicesStart;var e=i.t.t.replace("Dendrogram","s");var h=this[i.t.t].object;var j=i.t.d+"-"+i.t.o;var f=this.findDendrogramBranch(h,j);var d=this.reverseDendrogramBranch(f);var c=this.writeNewick(h,true);this.data.t[e]=c;this.draw()};this.findDendrogramBranch=function(d,e,c){if(d.id==e){c=d}if(!c){if(d.left){c=this.findDendrogramBranch(d.left,e,c)}if(d.right){c=this.findDendrogramBranch(d.right,e,c)}}else{return c}return c};this.reverseDendrogramBranch=function(d){if(d&&d.right&&d.left){d.right=this.reverseDendrogramBranch(d.right);d.left=this.reverseDendrogramBranch(d.left);var c=d.left;d.left=d.right;d.right=c;if(d.mid){d.mid=d.mid.reverse()}}return d};this.isAxis=function(k){if(!k){k=window.event}var s=this.adjustedCoordinates(k);if(s){var q=s.x;var o=s.y;var m=0;var r=(this.margin*2);var p=(this.margin*6);for(var f=0;f<this.layoutRows;f++){for(var d=0;d<this.layoutCols;d++){var h=this.layoutComb?this.layoutParams[m].graphType:this.graphType;if(h.match(/Network|Venn|Correlation|Heatmap/)){return false}var l=this.getBoundsXY(m,f,d);if(h.match(/Scatter/)){if(q>=l[0]&&q<=l[1]&&o>=l[3]&&o<=l[3]+this.resizeWidth){var n=this.getAxesVals(m,f,d);this.showResizer("xAxis",l[0],l[1],l[3]+r,l[3]+this.getAxisFont(n.x)+p,"x","h",n,"X",m,f,d);return true}else{if(q>=l[0]-this.resizeWidth&&q<=l[0]&&o>=l[2]&&o<=l[3]){var n=this.getAxesVals(m,f,d);this.showResizer("yAxis",l[0]-(this.getAxisFont(n.y)+p),l[0]-r,l[2],l[3],"y","v",n,"Y",m,f,d);return true}}}else{if(this.graphOrientation=="vertical"){if(q>=l[0]-this.resizeWidth&&q<=l[0]&&o>=l[2]&&o<=l[3]){var n=this.getAxesVals(m,f,d);this.showResizer("xAxis",l[0]-(this.getAxisFont(n.y)+p),l[0]-r,l[2],l[3],"y","v",n,"",m,f,d);return true}else{if(q>=l[1]&&q<=l[1]+this.resizeWidth&&o>=l[2]&&o<=l[3]){var n=this.getAxesVals(m,f,d);if(h=="Barline"){this.showResizer("xAxis2",l[1]+r,l[1]+this.getAxisFont(n.y)+p,l[2],l[3],"y","v",n,"2",m,f,d)}else{this.showResizer("xAxis",l[1]+r,l[1]+this.getAxisFont(n.y)+p,l[2],l[3],"y","v",n,"",m,f,d)}return true}}}else{if(q>=l[0]&&q<=l[1]&&o>=l[2]-this.resizeWidth&&o<=l[2]){var n=this.getAxesVals(m,f,d);this.showResizer("xAxis",l[0],l[1],l[2]-(this.getAxisFont(n.x)+p),l[2]-r,"x","h",n,"",m,f,d);return true}else{if(q>=l[0]&&q<=l[1]&&o>=l[3]&&o<=l[3]+this.resizeWidth){var n=this.getAxesVals(m,f,d);if(h=="Barline"){this.showResizer("xAxis2",l[0],l[1],l[3]+r,l[3]+this.getAxisFont(n.x)+p,"x","h",n,"2",m,f,d)}else{this.showResizer("xAxis",l[0],l[1],l[3]+r,l[3]+this.getAxisFont(n.x)+p,"x","h",n,"",m,f,d)}return true}}}}m++}}}return false};this.showResizer=function(G,w,u,f,ae,ab,T,P,R,E,A,y){var S=document.getElementById(b+"canvasXpressAxesResize");var Q=document.getElementById(b+"canvasXpressAxesResizeTotal");var U=document.getElementById(b+"canvasXpressAxesResizeMin");var O=document.getElementById(b+"canvasXpressAxesResizeMax");var ac=document.getElementById(b+"canvasXpressAxesResizeCurrent");var X=document.getElementById(b+"canvasXpressAxesResizeClose");var N=document.getElementById(b+"canvasXpressAxesResizeReset");if(S&&Q&&U&&O&&ac&&X&&N){var Y=P.graphType;var k=u-w;var i=ae-f;var ad=Math.min(P[G+"AbsMin"],P[G+"Min"]);var H=Math.max(P[G+"AbsMax"],P[G+"Max"]);var B=T=="h"?k:i;var Z=B/(H-ad);var m=Y.match(/Scatter/)?P["setMin"+ab.toUpperCase()]:Y=="BarLine"?P.setMin2:P.setMin;var M=Y.match(/Scatter/)?P["setMax"+ab.toUpperCase()]:Y=="BarLine"?P.setMax2:P.setMax;if(!m||isNaN(m)){m=ad}m=Math.max(m,ad);if(!M||isNaN(M)){M=H}M=Math.min(M,H);var C=(m-ad)*Z;var aa=(M-ad)*Z;var L,K,q,o,F,D,l,j,W,V,J,I;var e=T=="h"?this.getAxisFont(P.x)+(this.margin*4):this.getAxisFont(P.y)+(this.margin*4);S.style.left=w+"px";S.style.top=f+"px";S.style.width=k+"px";S.style.height=i+"px";if(T=="h"){L=C;K=this.resizeSliderWidth;q=0;o=e;F=aa-this.resizeSliderWidth;D=this.resizeSliderWidth;l=0;j=e;W=C;V=aa-C;J=0;I=e;Q.style.left="0px";Q.style.top=(e/2)+"px";Q.style.width=k+"px";Q.style.height=1+"px";U.style.left=C+"px";U.style.top="0px";U.style.width=this.resizeSliderWidth+"px";U.style.height=e+"px";U.style.cursor="e-resize";O.style.left=(aa-this.resizeSliderWidth)+"px";O.style.top="0px";O.style.width=this.resizeSliderWidth+"px";O.style.height=e+"px";O.style.cursor="e-resize";ac.style.left=C+"px";ac.style.top="0px";ac.style.width=(aa-C)+"px";ac.style.height=e+"px";ac.style.cursor="move";X.style.left=k+"px";X.style.top="0px";N.style.left=k+"px";N.style.top="13px"}else{L=0;K=e;q=i-(C+this.resizeSliderWidth);o=this.resizeSliderWidth;F=0;D=e;l=i-aa;j=this.resizeSliderWidth;W=0;V=e;J=i-aa;I=aa-C;Q.style.left=(e/2)+"px";Q.style.top="0px";Q.style.width=1+"px";Q.style.height=i+"px";U.style.left="0px";U.style.top=(i-(C+this.resizeSliderWidth))+"px";U.style.width=e+"px";U.style.height=this.resizeSliderWidth+"px";U.style.cursor="n-resize";O.style.left="0px";O.style.top=(i-aa)+"px";O.style.width=e+"px";O.style.height=this.resizeSliderWidth+"px";O.style.cursor="n-resize";ac.style.left="0px";ac.style.top=(i-aa)+"px";ac.style.width=e+"px";ac.style.height=(aa-C)+"px";ac.style.cursor="move";X.style.left=e+"px";X.style.top="0px";N.style.left=e+"px";N.style.top="13px"}S.style.display="block";this.addEvtListener(S,"mousemove",this.mousemoveResize,false);this.addEvtListener(X,"click",this.clickResizeClose,false);this.addEvtListener(N,"click",this.clickResizeReset,false);this.addEvtListener(U,"mousedown",this.mousedownResize,false);this.addEvtListener(U,"mousemove",this.mousemoveResize,false);this.addEvtListener(U,"mouseup",this.mouseupResize,false);this.addEvtListener(O,"mousedown",this.mousedownResize,false);this.addEvtListener(O,"mousemove",this.mousemoveResize,false);this.addEvtListener(O,"mouseup",this.mouseupResize,false);this.addEvtListener(ac,"mousedown",this.mousedownResize,false);this.addEvtListener(ac,"mousemove",this.mousemoveResize,false);this.addEvtListener(ac,"mouseup",this.mouseupResize,false);this.resizerEventData={axis:G,dim:ab,pos:T,vals:P,min:ad,max:H,smin:m,smax:M,len:B,unit:Z,width:e,set:R,c:E,i:A,j:y,areas:{lim:[w,u,f,ae],min:[L,K,q,o],max:[F,D,l,j],cur:[W,V,J,I]}};if(this.layoutValid){this.layoutValidR=A;this.layoutValidC=y;this.layoutValidN=E}this.resizingOn=true}};this.hideResizer=function(i){if(this.resizingOn){var g=document.getElementById(b+"canvasXpressAxesResize");var f=document.getElementById(b+"canvasXpressAxesResizeClose");var j=document.getElementById(b+"canvasXpressAxesResizeReset");var l=document.getElementById(b+"canvasXpressAxesResizeMin");var d=document.getElementById(b+"canvasXpressAxesResizeMax");var k=document.getElementById(b+"canvasXpressAxesResizeCurrent");if(g&&f&&j&&l&&d&&k){this.removeEvtListener(g,"mousemove",this.mousemoveResize,false);this.removeEvtListener(f,"click",this.clickResizeClose,false);this.removeEvtListener(j,"click",this.clickResizeReset,false);this.removeEvtListener(l,"mousedown",this.mousedownResize,false);this.removeEvtListener(l,"mousemove",this.mousemoveResize,false);this.removeEvtListener(l,"mouseup",this.mouseupResize,false);this.removeEvtListener(d,"mousedown",this.mousedownResize,false);this.removeEvtListener(d,"mousemove",this.mousemoveResize,false);this.removeEvtListener(d,"mouseup",this.mouseupResize,false);this.removeEvtListener(k,"mousedown",this.mousedownResize,false);this.removeEvtListener(k,"mousemove",this.mousemoveResize,false);this.removeEvtListener(k,"mouseup",this.mouseupResize,false);g.style.display="none";this.resizerEventData={};this.resizingOn=false;this.resizeDraggingOn=false;this.xMouseDown=false;this.yMouseDown=false;this.resetInfoSpan(i)}}};this.resetCanvasResizer=function(f){var c=document.getElementById(b+"canvasXpressImage");var d=document.getElementById(b+"canvasXpressCanvasResize");if(c&&d){d.style.width="0.5px";d.style.height="0.5px";d.style.display="none";c.style.cursor="default";document.body.style.cursor="default";this.resizingCanvasOn=false;this.movingOn=false}};this.registerCanvasResize=function(g){if(!g){g=window.event}var d=document.getElementById(b+"canvasXpressImage");if(d){var f=this.adjustedCoordinates(g);if(f){var c=f.x;var h=f.y;if(c>this.width-18&&h>this.height-18){d.style.cursor="se-resize";this.resizingCanvasOn="se-resize"}else{if(c>this.width-18){d.style.cursor="e-resize";this.resizingCanvasOn="e-resize"}else{if(h>this.height-18){d.style.cursor="s-resize";this.resizingCanvasOn="s-resize"}else{if(!this.movingOn){d.style.cursor="default";this.resizingCanvasOn=false}}}}}}};this.registerResize=function(g){if(!g){g=window.event}var f=this.adjustedCoordinates(g);if(f){var c=f.x;var h=f.y;var d=this.resizerEventData.areas;if(c>=d.min[0]+d.lim[0]&&c<=d.min[0]+d.min[1]+d.lim[0]&&h>=d.min[2]+d.lim[2]&&h<=d.min[2]+d.min[3]+d.lim[2]){this.resizerEventData.active="min"}else{if(c>=d.max[0]+d.lim[0]&&c<=d.max[0]+d.max[1]+d.lim[0]&&h>=d.max[2]+d.lim[2]&&h<=d.max[2]+d.max[3]+d.lim[2]){this.resizerEventData.active="max"}else{if(c>=d.cur[0]+d.lim[0]&&c<=d.cur[0]+d.cur[1]+d.lim[0]&&h>=d.cur[2]+d.lim[2]&&h<=d.cur[2]+d.cur[3]+d.lim[2]){this.resizerEventData.active="cur"}else{this.hideResizer();return}}}this.resizeDraggingOn=true;this.xMouseDown=c;this.yMouseDown=h}};this.updateResize=function(k){if(this.resizeDraggingOn){if(!k){k=window.event}var h=this.resizerEventData.areas;var s=this.adjustedCoordinates(k);if(s){var d=this.xMouseDown-s.x;var c=this.yMouseDown-s.y;var p,o;var i=false;var n=false;var f="";if(this.resizerEventData.active=="min"){p=d>h.min[0]?this.xMouseDown-h.min[0]:d<(h.min[0]+h.min[1])-h.max[0]?this.xMouseDown-((h.min[0]+h.min[1])-h.max[0]):s.x;o=c>h.min[2]-(h.max[2]+h.max[3])?this.yMouseDown-(h.min[2]-(h.max[2]+h.max[3])):c<(h.lim[2]+h.min[2]+h.min[3])-h.lim[3]?(h.lim[3]-(h.lim[2]+h.min[2]+h.min[3]))+this.yMouseDown:s.y}else{if(this.resizerEventData.active=="max"){p=d>h.max[0]-(h.min[0]+h.min[1])?this.xMouseDown-(h.max[0]-(h.min[0]+h.min[1])):d<(h.lim[0]+h.max[0]+h.max[1])-h.lim[1]?(h.lim[1]-(h.lim[0]+h.max[0]+h.max[1]))+this.xMouseDown:s.x;o=c>h.max[2]?this.yMouseDown-h.max[2]:c<(h.lim[2]+h.max[2]+h.max[3])-(h.lim[2]+h.min[2])?((h.lim[2]+h.min[2])-(h.lim[2]+h.max[2]+h.max[3]))+this.yMouseDown:s.y}else{p=d>h.min[0]?this.xMouseDown-h.min[0]:d<(h.lim[0]+h.max[0]+h.max[1])-h.lim[1]?(h.lim[1]-(h.lim[0]+h.max[0]+h.max[1]))+this.xMouseDown:s.x;o=c>h.max[2]?this.yMouseDown-h.max[2]:c<(h.lim[2]+h.min[2]+h.min[3])-h.lim[3]?(h.lim[3]-(h.lim[2]+h.min[2]+h.min[3]))+this.yMouseDown:s.y}}var t=p-this.xMouseDown;var r=o-this.yMouseDown;var m=t/this.resizerEventData.unit;var l=r/this.resizerEventData.unit;var g=document.getElementById(b+"canvasXpressAxesResizeMin");var q=document.getElementById(b+"canvasXpressAxesResizeMax");var j=document.getElementById(b+"canvasXpressAxesResizeCurrent");if(g&&q&&j){if(this.resizerEventData.active=="min"){if(this.resizerEventData.pos=="h"){g.style.left=(h.cur[0]+t)+"px";j.style.left=(h.cur[0]+t)+"px";j.style.width=(h.cur[1]-t)+"px";i=this.formatNumber(this.resizerEventData.smin+m)}else{g.style.top=(h.min[2]+r)+"px";j.style.height=(h.cur[3]+r)+"px";i=this.formatNumber(this.resizerEventData.smin-l)}this.showInfoSpan(k,i)}else{if(this.resizerEventData.active=="max"){if(this.resizerEventData.pos=="h"){q.style.left=(h.max[0]+t)+"px";j.style.width=(h.cur[1]+t)+"px";n=this.formatNumber(this.resizerEventData.smax+m)}else{q.style.top=(h.cur[2]+r)+"px";j.style.top=(h.cur[2]+r)+"px";j.style.height=(h.cur[3]-r)+"px";n=this.formatNumber(this.resizerEventData.smax-l)}this.showInfoSpan(k,n)}else{if(this.resizerEventData.pos=="h"){g.style.left=(h.cur[0]+t)+"px";q.style.left=(h.max[0]+t)+"px";j.style.left=(h.cur[0]+t)+"px";i=this.formatNumber(this.resizerEventData.smin+m);n=this.formatNumber(this.resizerEventData.smax+m)}else{g.style.top=(h.min[2]+r)+"px";q.style.top=(h.cur[2]+r)+"px";j.style.top=(h.cur[2]+r)+"px";i=this.formatNumber(this.resizerEventData.smin-l);n=this.formatNumber(this.resizerEventData.smax-l);this.showInfoSpan(k,i+"--"+n)}}}this.resizerEventData.lastMin=i;this.resizerEventData.lastMax=n}}}};this.endResize=function(f){if(this.resizeDraggingOn){this.resetInfoSpan(f);if(this.resizerEventData.lastMin){this["setMin"+this.resizerEventData.set]=parseFloat(this.resizerEventData.lastMin)}if(this.resizerEventData.lastMax){this["setMax"+this.resizerEventData.set]=parseFloat(this.resizerEventData.lastMax)}this.hideResizer(f);this.draw()}else{if(this.resizingCanvasOn){var d=document.getElementById(b+"canvasXpressCanvasResize");if(d){var c=parseInt(d.style.width.replace("px",""));var g=parseInt(d.style.height.replace("px",""));this.draw(c,g);this.resetCanvasResizer(f)}}}};this.resetResizer=function(c){if(this.resizingOn){this.resetInfoSpan(c);this["setMin"+this.resizerEventData.set]=false;this["setMax"+this.resizerEventData.set]=false;this.hideResizer(c);this.draw()}};this.showHideSelectedDataPoint=function(h,k){this.stopEvent(h);if(k==45||k==46){var i=this.layoutComb?this.layoutValidN:0;var g=this.layoutComb?this.layoutParams[i].graphType:this.graphType;if(g=="Network"){var f=[];var d=k==45?false:true;for(var j in this.selectNode){f.push(j)}if(f.length>0){this.hideUnhideNodes(f,d)}}else{if(g.match(/Scatter/)){if(k==45){this.selectDataPoint=this.hideDataPoint;this.hideDataPoint=[]}else{this.hideDataPoint=this.selectDataPoint;this.selectDataPoint=[]}}}this.draw()}};this.addRemoveToSelectedDataPoints=function(j,g){var d=this.isBroadcasting?CanvasXpress.references:[this];for(var f=0;f<d.length;f++){var h=d[f];if(!j){var k=h.layoutComb?h.layoutValidN:0;j=h.layoutComb?h.layoutParams[k].graphType:h.graphType}if(j=="Network"){g=parseInt(g.join(", "));if(g<h.data.nodes.length){var e=h.data.nodes[g].id;if(h.selectNode.hasOwnProperty(e)){h.isSelectNodes--;delete h.selectNode[e]}else{h.isSelectNodes++;h.selectNode[e]=true}}}else{if(j.match(/Scatter/)){var e;if(!h.selectDataPoint[g[0]]){h.selectDataPoint[g[0]]={}}if(j=="Scatter3D"){e=g[1]+":"+g[2]+":"+g[3]}else{e=g[1]+":"+g[2]}if(h.selectDataPoint[g[0]].hasOwnProperty(e)){h.isSelectDataPoints--;delete h.selectDataPoint[g[0]][e]}else{h.isSelectDataPoints++;h.selectDataPoint[g[0]][e]=true}}}}};this.reRootRadialNetwork=function(g){var f=this.data.nodes[g].id;this.networkCurrentAngle=this.getAngle(this.finalRadialNodePositions[f].x,this.finalRadialNodePositions[f].y,this.finalRadialNodePositions[this.networkRoot].x,this.finalRadialNodePositions[this.networkRoot].y,0)+180;this.orderRadialNetwork={};var d=this.data.nodeIndices[f];var e=0;for(var c=d;c<this.data.nodes.length;c++){this.orderRadialNetwork[this.data.nodes[c].id]=e;e++}for(var c=0;c<d;c++){this.orderRadialNetwork[this.data.nodes[c].id]=e;e++}this.networkXCenter=this.finalRadialNodePositions[f].x;this.networkYCenter=this.finalRadialNodePositions[f].y;this.networkRoot=f;this.layoutDone=false;this.draw()};this.handleDragEvent=function(l,d,k,ac){var Z=this.layoutComb?this.layoutValidN:0;var I=this.layoutComb?this.layoutParams[Z].graphType:this.graphType;if(I=="Network"){var S={};var W=[];var M=[];var P=this.randomNetwork;if(this.modelEvent=="local"){var T=document.getElementById(b+"canvasXpressMap");if(T){var aa=T.childNodes;for(var V=0;V<aa.length;V++){var B=aa[V].coords.split(",");if((l<B[0]||l<B[2])&&k>B[0]&&(d<B[1]||d<B[3])&&ac>B[1]){var R=aa[V].id.replace(b,"");if(R<this.data.nodes.length){S[R]=1}}}}}else{for(var V=1;V<this.dataEvent.length;V++){var R=this.dataEvent[V][0];var B=this.dataEvent[V][2];if((l<B[0]||l<B[2])&&k>B[0]&&(d<B[1]||d<B[3])&&ac>B[1]){if(R<this.data.nodes.length){S[R]=1}}}}for(var V=0;V<this.data.nodes.length;V++){if(!S[V]){W.push(this.data.nodes[V].id)}else{M.push(this.data.nodes[V].id)}}if(W.length<this.data.nodes.length){if(this.draggingShiftOn){this.setSelectNodes(M);this.isSelectNodes=M.length;this.draggingShiftOn=false;this.draw()}else{this.hideUnhideNodes(W,true);this.ctx.translate(-this.offsetX,-this.offsetY);this.ctx.scale(1/this.scaleFactor,1/this.scaleFactor);this.calculateLayout=false;this.randomNetwork=false;this.draw();this.randomNetwork=P}}}else{if(I=="Heatmap"){var K=[];var M=[];var X;var Y=this.layoutComb?this.layoutParams[Z].varIndices:this.varIndices;if(this.isGroupedData){X=this.layoutComb?this.layoutParams[Z].grpIndices:this.grpIndices}else{X=this.layoutComb?this.layoutParams[Z].smpIndices:this.smpIndices}if(this.layoutComb){this.varIndicesStart=this.layoutParams[Z].varIndicesStart<0?0:this.layoutParams[Z].varIndicesStart;if(!this.isGroupedData){this.smpIndicesStart=this.layoutParams[Z].smpIndicesStart<0?0:this.layoutParams[Z].smpIndicesStart}}else{this.varIndicesStart=this.varIndicesStart<0?0:this.varIndicesStart;if(!this.isGroupedData){this.smpIndicesStart=this.smpIndicesStart<0?0:this.smpIndicesStart}}this.varIndices=[];if(this.isGroupedData){this.grpIndices=[]}else{this.smpIndices=[]}if(this.modelEvent=="local"){var T=document.getElementById(b+"canvasXpressMap");if(T){var aa=T.childNodes;for(var V=0;V<aa.length;V++){var B=aa[V].coords.split(",");if((l<B[0]||l<B[2])&&k>B[0]&&(d<B[1]||d<B[3])&&ac>B[1]){var D=aa[V].id.replace(b,"").split(",");if(!K[D[0]]){this.varIndices.push(D[0]);K[D[0]]=1}if(!M[D[1]]){if(this.isGroupedData){this.grpIndices.push(D[1])}else{this.smpIndices.push(D[1])}M[D[1]]=1}}}}}else{for(var V=1;V<this.dataEvent.length;V++){var D=this.layoutComb?this.layoutParams[Z].dataEvent[V][0]:this.dataEvent[V][0];var B=this.layoutComb?this.layoutParams[Z].dataEvent[V][2]:this.dataEvent[V][2];if((l<B[0]||l<B[2])&&k>B[0]&&(d<B[1]||d<B[3])&&ac>B[1]){if(!K[D[0]]){this.varIndices.push(D[0]);K[D[0]]=1}if(!M[D[1]]){if(this.isGroupedData){this.grpIndices.push(D[1])}else{this.smpIndices.push(D[1])}M[D[1]]=1}}}}for(var V=0;V<Y.length;V++){if(Y[V]==this.varIndices[0]){this.varIndicesStart+=V}}for(var V=0;V<X.length;V++){if(X[V]==this.smpIndices[0]){if(!this.isGroupedData){this.smpIndicesStart+=V}}}this.draw()}else{var L,z,J,x;var ab,C,H,p;var u,f,e,t;var g,O,N,A;var Q,E,G,F;if(I.match(/Scatter/)){if(this.shiftOn){this.selectDataPoint=[];var M=0;if(this.modelEvent=="local"){var T=document.getElementById(b+"canvasXpressMap");if(T){var aa=T.childNodes;for(var V=0;V<aa.length;V++){var B=aa[V].coords.split(",");if((l<B[0]||l<B[2])&&k>B[0]&&(d<B[1]||d<B[3])&&ac>B[1]){var R=aa[V].id.replace(b,"");this.addRemoveToSelectedDataPoints(I,R.split(","));M++}}}}else{for(var V=1;V<this.dataEvent.length;V++){var R=this.dataEvent[V][0];var B=this.dataEvent[V][2];if((l<B[0]||l<B[2])&&k>B[0]&&(d<B[1]||d<B[3])&&ac>B[1]){this.addRemoveToSelectedDataPoints(I,R.split(","));M++}}}if(M>0){this.isSelectDataPoints=M;this.draw()}}else{if(this.layoutValid){if(this.layoutComb){u=this.layoutParams[Z].xAxisMin+((l-(this.layoutParams[Z].offsetX+this.layoutParams[Z].left))/this.layoutParams[Z].xAxisUnit);f=this.layoutParams[Z].xAxisMin+((k-(this.layoutParams[Z].offsetX+this.layoutParams[Z].left))/this.layoutParams[Z].xAxisUnit);e=this.layoutParams[Z].yAxisMax-((d-(this.layoutParams[Z].offsetY+this.layoutParams[Z].top))/this.layoutParams[Z].yAxisUnit);t=this.layoutParams[Z].yAxisMax-((ac-(this.layoutParams[Z].offsetY+this.layoutParams[Z].top))/this.layoutParams[Z].yAxisUnit)}else{u=this.xAxisMin+((l-(this.left*this.scaleX))/(this.xAxisUnit*this.scaleX));f=this.xAxisMin+((k-(this.left*this.scaleX))/(this.xAxisUnit*this.scaleX));e=this.yAxisMax-((d-(this.top*this.scaleY))/(this.yAxisUnit*this.scaleY));t=this.yAxisMax-((ac-(this.top*this.scaleY))/(this.yAxisUnit*this.scaleY))}}else{u=this.xAxisMin+((l-this.left)/this.xAxisUnit);f=this.xAxisMin+((k-this.left)/this.xAxisUnit);e=this.yAxisMax-((d-this.top)/this.yAxisUnit);t=this.yAxisMax-((ac-this.top)/this.yAxisUnit)}if(this.validateMinMax(u,f)&&this.validateMinMax(t,e)){this.setMinX=u;this.setMaxX=f;this.setMaxY=e;this.setMinY=t;this.draw()}}}else{if(I=="Genome"){if(this.layoutValid){if(this.layoutComb){g=this.layoutParams[Z].xAxisMin+((l-this.layoutParams[Z].left)/this.layoutParams[Z].xAxisUnit);O=this.layoutParams[Z].xAxisMin+((k-this.layoutParams[Z].left)/this.layoutParams[Z].xAxisUnit)}else{g=this.xAxisMin+((l-(this.left*this.scaleX))/(this.xAxisUnit*this.scaleX));O=this.xAxisMin+((k-(this.left*this.scaleX))/(this.xAxisUnit*this.scaleX))}}else{g=this.xAxisMin+((l-this.left)/this.xAxisUnit);O=this.xAxisMin+((k-this.left)/this.xAxisUnit)}if(this.validateMinMax(g,O)){this.setMin=g;this.setMax=O;this.draw()}}else{if(this.draggingShiftOn){var M=[];var T=document.getElementById(b+"canvasXpressMap");var q=[];if(T){var aa=T.childNodes;if(this.graphOrientation=="vertical"){var B,D;for(var V=0;V<aa.length;V++){B=aa[V].coords.split(",");if((l<B[0]||l<B[2])&&k>B[0]&&(d<B[1]||d<B[3])&&ac>B[1]){D=aa[V].id.replace(b,"").split(",");if(!M[D[1]]){q.push(D[1]);M[D[1]]=1}}}}else{for(var V=0;V<aa.length;V++){B=aa[V].coords.split(",");if((l<B[0]||l<B[2])&&k>B[0]&&(d<B[1]||d<B[3])&&ac>B[1]){D=aa[V].id.replace(b,"").split(",");if(!M[D[1]]){q.push(D[1]);M[D[1]]=1}}}}}this.setSamplesVisible(q,true);this.draggingShiftOn=false;this.draw()}else{ab=this.setMin?this.setMin:this.xAxisMin?this.xAxisMin:0;C=this.setMax?this.setMax:this.xAxisMax?this.xAxisMax:0;if(this.graphType.match(/BarLine|Candlestick/)){H=this.setMin2?this.setMin2:this.xAxis2Min?this.xAxis2Min:0;p=this.setMax2?this.setMax2:this.xAxis2Max?this.xAxis2Max:0}if(this.layoutValid){if(this.layoutComb){if(this.layoutCurrent!=Z){ab=this.layoutParams[Z].setMin?this.layoutParams[Z].setMin:this.layoutParams[Z].xAxisMin?this.layoutParams[Z].xAxisMin:0;C=this.layoutParams[Z].setMax?this.layoutParams[Z].setMax:this.layoutParams[Z].xAxisMax?this.layoutParams[Z].xAxisMax:0;if(this.graphType.match(/BarLine|Candlestick/)){H=this.layoutParams[Z].setMin2?this.layoutParams[Z].setMin2:this.layoutParams[Z].xAxis2Min?this.layoutParams[Z].xAxis2Min:0;p=this.layoutParams[Z].setMax2?this.layoutParams[Z].setMax2:this.layoutParams[Z].xAxis2Max?this.layoutParams[Z].xAxis2Max:0}}L=this.layoutParams[Z].offsetX+this.layoutParams[Z].left;z=L+this.layoutParams[Z].x;J=this.layoutParams[Z].offsetY+this.layoutParams[Z].top;x=J+this.layoutParams[Z].y;Q=this.layoutParams[Z].xAxisUnit;E=this.layoutParams[Z].xAxis2Unit;G=1;F=1}else{var V=this.layoutValidR;var U=this.layoutValidC;var y=this.width/this.layoutCols;var w=this.height/this.layoutRows;L=(y*U)+(this.left*this.scaleX);z=(y*U)+((this.left+this.x)*this.scaleX);J=(w*V)+(this.top*this.scaleY);x=(w*V)+((this.top+this.y)*this.scaleY);Q=this.xAxisUnit;E=this.xAxis2Unit;G=this.scaleX;F=this.scaleY}}else{L=this.left;z=this.left+this.x;J=this.top;x=this.top+this.y;Q=this.xAxisUnit;E=this.xAxis2Unit;G=1;F=1}if(this.graphOrientation=="vertical"){g=ab+((x-ac)/(Q*F));O=C-((d-J)/(Q*F));if(this.graphType.match(/BarLine|Candlestick/)){N=H+((x-ac)/(E*F));A=p-((d-J)/(E*F))}}else{g=ab+((l-L)/(Q*G));O=C-((z-k)/(Q*G));if(this.graphType.match(/BarLine|Candlestick/)){N=H+((l-L)/(E*G));A=p-((z-k)/(E*G))}}if(this.validateMinMax(g,O)){this.setMin=g;this.setMax=O;if(this.graphType.match(/BarLine|Candlestick/)&&this.validateMinMax(N,A)){this.setMin2=N;this.setMax2=A}this.draw()}}}}}}};this.validateMinMax=function(d,c){if(!isNaN(d)&&!isNaN(c)){if(d>c){return false}return true}else{return false}};this.resetDragDiv=function(c){var f=document.getElementById(b+"canvasXpressDrag");if(f){f.style.left="0px";f.style.top="0px";f.style.width="0px";f.style.height="0px"}this.resetOn=true;this.draggingOn=false;this.draggingShiftOn=false;this.draggingAltOn=false;this.draggingCtrlOn=false;this.movingOn=false;this.xMouseDown=false;this.yMouseDown=false;this.moveNode=false;this.moveNodeIndex=false;this.moveNodeLab=false;this.moveLegend=false;if(c){this.stopEvent(c)}};this.resetSelectedDataPoints=function(){if(this.isSelectDataPoints){this.selectDataPoint=[];this.hideDataPoint=[];this.isSelectDataPoints=0}};this.resetSelectedNodes=function(){if(this.isSelectNodes){this.selectNode={};this.isSelectNodes=0}};this.resetInfoSpan=function(f){var d=document.getElementById(b+"canvasXpressInfo");if(d&&this.infoStartTime){var c=new Date().getTime()-this.infoStartTime;if(c>100){d.style.left="0px";d.style.top="0px";d.style.borderColor="white";d.innerHTML=""}}};this.showInfoSpan=function(d,i,c){if(this.draggingOn){return}var l=document.getElementById(b+"canvasXpressInfo");if(l){var j=this.adjustedCoordinates(d,l);if(j){var g=j.x;var f=j.y;if(l){l.style.left=(g+5)+"px";l.style.top=(f-20)+"px";l.innerHTML=i;this.infoStartTime=new Date().getTime();var k=this;var h=function(){this.update=function(){var m=new Date().getTime();if(m-k.infoStartTime>k.infoTimeOut){k.resetInfoSpan();clearInterval(e)}};var e=setInterval(this.update,500)};h.call()}}}};this.setUserEvents=function(){this.userEvents={};var d=this;if(a&&a.enddragnode){this.userEvents.enddragnode=a.enddragnode}if(a&&a.mouseout){this.userEvents.mouseout=a.mouseout}else{this.userEvents.mouseout=function(g,f){d.resetInfoSpan(f)}}if(a&&a.click){this.userEvents.click=a.click}else{this.userEvents.click=function(g,f){if(g&&g.t){d.modifyDendrogram(g)}else{DumperAlert(g)}}}var e=["mouseover"];if(d.modelEvent!="local"){e.push("mousemove")}for(var c=0;c<e.length;c++){if(a&&a[e[c]]){this.userEvents[e[c]]=a[e[c]]}else{switch(this.graphType){case"Bar":case"Line":case"Area":case"BarLine":case"Boxplot":case"Dotplot":case"Heatmap":case"Stacked":case"StackedPercent":case"Scatter2D":case"ScatterBubble2D":case"Scatter3D":this.userEvents[e[c]]=function(i,g){if(i){var h;if(d.isGroupedData&&i.w){h="<b>"+i.w.vars[0]+"</b><br>";if(d.summaryType=="mean"){for(var f=0;f<i.w.smps.length;f++){h+="<b>"+i.w.smps[f]+"</b>: "+i.w.mean[f]+"<br>"}}else{if(d.summaryType=="median"||d.summaryType=="iqr"){for(var f=0;f<i.w.smps.length;f++){h+="<b>"+i.w.smps[f]+"</b>: "+i.w.median[f]+"<br>"}}else{if(d.summaryType=="sum"){for(var f=0;f<i.w.smps.length;f++){h+="<b>"+i.w.smps[f]+"</b>: "+i.w.sum[f]+"<br>"}}}}}else{if(i.y){h="<b>"+i.y.vars[0]+"</b><br>";for(var f=0;f<i.y.smps.length;f++){h+="<b>"+i.y.smps[f]+"</b>: "+i.y.data[f]+"<br>"}}else{if(i.t){h="<b>"+i.t.t+"</b><br>Depth: "+i.t.d+"<br>Ocurrence: "+i.t.o+"<br>"}else{return}}}d.showInfoSpan(g,h)}};break;case"Pie":this.userEvents[e[c]]=function(k,h){if(k){var i="<b>"+k.y.smps[0]+"</b><br>";for(var f=0;f<k.y.vars.length;f++){var g=sprintf("%."+d.pieSegmentPrecision+"f",(k.y.data[f]/d.varPie.tot)*100);i+="<b>"+k.y.vars[f]+"</b>: "+k.y.data[f]+" ("+g+"%)<br>"}d.showInfoSpan(h,i)}};break;case"Candlestick":this.userEvents[e[c]]=function(h,f){if(h){var g=dateFormat(h.y.smps[0],d.timeFormat)+", "+h.y.close[0];d.showInfoSpan(f,g)}};break;case"Correlation":this.userEvents[e[c]]=function(h,f){if(h){var g;if(d.correlationAxis=="samples"){g=h.y.smps[0]+" vs "+h.y.smps[1]}else{g=h.y.vars[0]+" vs "+h.y.vars[1]}d.showInfoSpan(f,g)}};break;case"Venn":this.userEvents[e[c]]=function(i,g){if(i){var h;for(var f in i.venn.data){h=f+" = "+i.venn.data[f];break}d.showInfoSpan(g,h)}};break;case"Network":this.userEvents[e[c]]=function(j,h){if(j){var i;if(j&&j.nodes){if(j.nodes[0]){i=j.nodes[0].name||j.nodes[0].label||j.nodes[0].id}}else{if(j&&j.edges){var g=d.nodes[j.edges[0].id1];var f=d.nodes[j.edges[0].id2];i=(g.label||g.id)+" - "+(f.label||f.id)}}if(i){d.showInfoSpan(h,i)}}};break;case"Genome":this.userEvents[e[c]]=function(g,f){if(g){d.showInfoSpan(f,g[0].data[0].id)}};break}}}};this.initializeEvents=function(){if(!this.disableEvents){this.setUserEvents();this.addDragDiv();this.addResizeDiv();this.addResizeAxesDiv();this.addImage();this.addMap();this.addInfoSpan();this.addCanvasListeners()}};this.initializeEvents()};CanvasXpress.prototype.initAnimation=function(){this.saveSnapshot=function(){var a=this.cloneVisualData(this.data);if(a){this.snapshots.push(a)}};this.playSnapshot=function(b,d,c){if(this.snapshots.length<1){return}this.stopSnapshotPlay();var a=this;this.snapshotPlay={idx:0,time:b,task:setTimeout(function(){a.nextSnapshot(c)},0),callback:d,oldData:this.data};this.snapshotPaused=false};this.nextSnapshot=function(b){if(this.snapshotPlay.idx>=this.snapshots.length){if(this.snapshotPlay.callback){this.snapshotPlay.callback.call(this,b)}else{this.snapshotPlay.idx=0}}if(this.snapshotPlay){this.loadData(this.snapshots[this.snapshotPlay.idx++],true);var a=this;this.snapshotPlay.task=setTimeout(function(){a.nextSnapshot(b)},this.snapshotPlay.time);this.snapshotPaused=false}};this.stopSnapshotPlay=function(a){if(!this.snapshotPlay){return}clearTimeout(this.snapshotPlay.task);this.loadData(this.snapshotPlay.oldData,a);delete this.snapshotPlay;this.snapshotPaused=false};this.clearSnapshot=function(){this.stopSnapshotPlay(true);this.snapshots=[];this.snapshotPaused=false};this.duplicateSnapshot=function(){if(this.snapshots.length<1){return}if(this.snapshotPlay){this.snapshots.splice(this.snapshotPlay.idx,0,this.cloneVisualData(this.snapshots[this.snapshotPlay.idx-1]));this.snapshotPlay.idx++}else{this.snapshots.push(this.cloneVisualData(this.snapshots[this.snapshots.length-1]))}};this.makeSnapshotPlay=function(){if(!this.snapshotPlay){this.snapshotPlay={idx:this.snapshots.length,oldData:this.data}}else{this.pauseSnapshot()}};this.moveSnapshot=function(c){if(this.snapshots.length<1){return}this.makeSnapshotPlay();var b=this.snapshotPlay.idx-1,a=b+c;if(a>=0&&a<=this.snapshots.length){this.snapshots.splice(a,0,(this.snapshots.splice(b,1))[0])}this.snapshotPlay.idx=a+1};this.prevSnapshotOnce=function(){if(this.snapshots.length<2){return}this.makeSnapshotPlay();this.snapshotPlay.idx-=2;if(this.snapshotPlay.idx<0){this.snapshotPlay.idx=0}this.loadData(this.snapshots[this.snapshotPlay.idx++],true);this.snapshotPaused=true};this.nextSnapshotOnce=function(){if(!this.snapshotPlay){return}if(this.snapshotPlay.idx<this.snapshots.length){this.loadData(this.snapshots[this.snapshotPlay.idx++],true)}this.snapshotPaused=true};this.hasNextSnapshot=function(){return this.snapshots.length>1&&this.snapshotPlay&&this.snapshotPaused&&this.snapshotPlay.idx<this.snapshots.length};this.hasPrevSnapshot=function(){return this.snapshots.length>1&&(!this.snapshotPlay||(this.snapshotPlay.idx>1&&this.snapshotPaused))};this.updateSnapshot=function(){if(this.snapshotPlay){this.snapshots[this.snapshotPlay.idx-1]=this.cloneVisualData(this.data)}};this.pauseSnapshot=function(){if(!this.snapshotPlay){return}if(this.snapshotPlay.task){clearTimeout(this.snapshotPlay.task)}this.snapshotPaused=true};this.loadData=function(d,e){this.data=d;switch(this.graphType){case"Bar":case"Line":case"BarLine":case"Dotplot":case"Scatter2D":case"ScatterBubble2D":break;case"Scatter3D":case"Area":case"Boxplot":case"Heatmap":case"Stacked":case"StackedPercent":case"Candlestick":case"Correlation":case"Venn":case"Pie":case"Genome":return false;break;case"Network":this.edges=this.data.edges;var b={};for(var c=0;c<this.data.nodes.length;c++){var a=this.data.nodes[c];b[a.id]=a}this.nodes=b;break}if(e){this.draw(false,false,true)}};this.cloneVisualData=function(f){switch(this.graphType){case"Bar":case"Line":case"BarLine":case"Dotplot":case"Scatter2D":case"ScatterBubble2D":return this.cloneObject(f);break;case"Scatter3D":case"Area":case"Boxplot":case"Heatmap":case"Stacked":case"StackedPercent":case"Candlestick":case"Correlation":case"Venn":case"Pie":case"Genome":return false;break;case"Network":if(!this.snapshotNoCopyData){return this.cloneObject(f)}var c={nodes:[],edges:[]};if(f.nodes&&f.nodes.length){for(var b=0;b<f.nodes.length;b++){var g={};var e=f.nodes[b];var h=["color","shape","size","x","y","id","hideName","hideChildren","hideParent","label","labelX","labelY","labelSize","name","hide","anchor","parentNode"];for(var a=0;a<h.length;a++){g[h[a]]=e[h[a]]}c.nodes.push(g)}}if(f.edges&&f.edges.length){for(var b=0;b<f.edges.length;b++){var g={};var e=f.edges[b];var h=["color","width","type","id1","id2","anchor"];for(var a=0;a<h.length;a++){g[h[a]]=e[h[a]]}c.edges.push(g)}}return c;break}};this.isValidAnimation=function(){switch(this.graphType){case"Bar":case"Line":case"BarLine":case"Dotplot":case"Scatter2D":case"ScatterBubble2D":return true;case"Scatter3D":case"Area":case"Boxplot":case"Heatmap":case"Stacked":case"StackedPercent":case"Candlestick":case"Correlation":case"Venn":case"Pie":case"Genome":case"Network":return false}};this.createAnimation=function(e){switch(this.graphType){case"Bar":case"Line":case"BarLine":case"Dotplot":case"Scatter2D":case"ScatterBubble2D":this.isAnimation=true;var f=this.cloneVisualData(this.data);if(e.match(/grow|spring|random/)&&this.data.y.data){var d=this.animationCycles;for(var c=0;c<d;c++){for(var b=0;b<this.data.y.data.length;b++){for(var a=0;a<this.data.y.data[b].length;a++){if(!isNaN(this.data.y.data[b][a])){var g=this.data.y.data[b][a];if(e=="grow"){this.data.y.data[b][a]=g/d*c}else{if(e=="spring"){this.data.y.data[b][a]=g/(d-1.5)*(c+1)}else{this.data.y.data[b][a]=g/d*Math.floor(Math.random()*c)}}}}}this.saveSnapshot();this.data=this.cloneVisualData(f)}}this.data=f;this.saveSnapshot();this.playSnapshot(this.animationTime,this.stopAnimation);break;case"Scatter3D":case"Area":case"Boxplot":case"Heatmap":case"Stacked":case"StackedPercent":case"Candlestick":case"Correlation":case"Venn":case"Pie":case"Genome":case"Network":return;break}};this.stopAnimation=function(){this.stopSnapshotPlay();this.snapshots=[];this.isAnimation=false}};CanvasXpress.prototype.initData=function(a){this.exampleRawData={x:{Tissue:["Kidney","Liver","Kidney","Liver","Kidney","Liver","Kidney","Liver"],Donor:["D1","D1","D1","D1","D2","D2","D2","D2"],Time:["1h","1h","2h","2h","1h","1h","2h","2h"]},z:{Symbol:["abc","def","ghi","jkl","mno","pqr"],Cat:["A","A","B","C","D","C"],Class:["A","A","A","A","A","B"]},y:{vars:["Gene1","Gene2","Gene3","Gene4","Gene5","Gene6"],smps:["Smp1","Smp2","Smp3","Smp4","Smp5","Smp6","Smp7","Smp8"],desc:["Intensity","Normalized Intensity"],data:[[10,12,3,4,100,73,42,64],[12,4,60,5,24,14,32,13],[7,12,20,13,49,52,42,92],[21,10,30,8,65,166,47,58],[15,14,100,5,34,30,82,51],[100,82,73,4,3,4,5,2]]},a:{xAxis:["Gene1","Gene2","Gene3"],xAxis2:["Gene4","Gene5","Gene6"]},t:{vars:"((Gene6:0.2,Gene3:0.3):0.2,((Gene1:0.25,(Gene4:0.15,Gene2:0.3):0.2):0.3,Gene5:0.7):0.1)",smps:"((Smp2:0.8,(Smp4:0.7,((Smp1:0.6,(Smp6:0.2,Smp5:0.1):0.2):0.15,(Smp8:0.15,Smp3:0.05):0.1):0.15):0.2):0.05,Smp7:0.9)"},d:{nlfit:[{param:[1,100,50,1,1.23e-7],label:"Fit Example",type:"reg"}]},l:{vars:[["Gene1","Gene2","Gene3","Gene4","Gene5"],["Gene6"]],weight:[0.7,0.3],type:["Bar","Line"],desc:["Intensity","Score"]},venn:{data:{A:340,B:562,C:620,D:592,AB:639,AC:456,AD:257,BC:915,BD:354,CD:143,ABC:552,ABD:578,ACD:298,BCD:613,ABCD:148},legend:{A:"List 1",B:"List 2",C:"List 3",D:"List 4"}},nodes:[{id:"Gene1",color:"rgb(255,0,0)",shape:"square",size:1},{id:"Gene2",color:"rgb(255,0,0)",shape:"square",size:1.8},{id:"Gene3",color:"rgb(255,0,0)",shape:"square",size:1.4},{id:"Gene4",color:"rgb(255,0,0)",shape:"square",size:1.2},{id:"Gene5",color:"rgb(255,0,0)",shape:"square",size:1.3},{id:"Gene6",color:"rgb(255,0,0)",shape:"square",size:1},{id:"Gene7",color:"rgb(255,0,0)",shape:"square",size:1},{id:"Gene8",color:"rgb(255,0,0)",shape:"square",size:1},{id:"SNP1",color:"rgb(0,255,0)",shape:"sphere",size:1},{id:"SNP2",color:"rgb(0,255,0)",shape:"sphere",size:1},{id:"SNP3",color:"rgb(0,255,0)",shape:"sphere",size:1},{id:"SNP4",color:"rgb(0,255,0)",shape:"sphere",size:1.5},{id:"SNP5",color:"rgb(0,255,0)",shape:"sphere",size:1},{id:"SNP6",color:"rgb(0,255,0)",shape:"sphere",size:1},{id:"SNP7",color:"rgb(0,255,0)",shape:"sphere",size:1},{id:"SNP8",color:"rgba(0,255,0)",shape:"sphere",size:1.2},{id:"PH1",color:"rgb(0,255,255,0.5)",shape:"triangle",size:1,hideChildren:false},{id:"PH2",color:"rgb(0,255,255,0.6)",shape:"triangle",size:1,parentNode:"PH1"},{id:"PH3",color:"rgb(0,255,255,0.7)",shape:"triangle",size:1,parentNode:"PH1"},{id:"PH4",color:"rgb(0,255,255,0.8)",shape:"triangle",size:1,parentNode:"PH3"}],edges:[{id1:"Gene1",id2:"Gene2",color:"rgb(51,102,255)",width:"1",type:"line"},{id1:"Gene2",id2:"Gene3",color:"rgb(51,102,255)",width:"1",type:"arrowHeadLine"},{id1:"Gene1",id2:"Gene4",color:"rgb(51,102,255)",width:"1",type:"arrowHeadLine"},{id1:"Gene3",id2:"Gene5",color:"rgb(51,102,255)",width:"1",type:"dashedArrowHeadLine"},{id1:"Gene6",id2:"Gene5",color:"rgb(51,102,255)",width:"1",type:"arrowHeadSquareTailLine"},{id1:"Gene7",id2:"Gene5",color:"rgb(153,153,255)",width:"1",type:"dottedArrowHeadLine"},{id1:"Gene8",id2:"Gene7",color:"rgb(51,102,255)",width:"1",type:"line"},{id1:"Gene4",id2:"Gene7",color:"rgb(51,102,255)",width:"1",type:"squareHeadArrowTailLine"},{id1:"Gene1",id2:"SNP2",color:"rgb(153,102,255)",width:"1",type:"bezierLine"},{id1:"SNP1",id2:"SNP4",color:"rgb(51,102,152)",width:"1",type:"line"},{id1:"SNP5",id2:"Gene5",color:"rgb(153,102,255)",width:"1",type:"arrowHeadLine"},{id1:"SNP1",id2:"PH2",color:"rgb(51,102,152)",width:"1",type:"line"},{id1:"SNP1",id2:"Gene2",color:"rgb(51,102,152)",width:"1",type:"line"},{id1:"PH4",id2:"SNP7",color:"rgb(153,102,255)",width:"1",type:"arrowHeadLine"},{id1:"PH2",id2:"Gene5",color:"rgb(51,102,152)",width:"1",type:"line"},{id1:"PH1",id2:"Gene7",color:"rgb(153,102,255)",width:"1",type:"arrowHeadLine"},{id1:"PH3",id2:"Gene2",color:"rgb(51,102,152)",width:"1",type:"line"},{id1:"SNP6",id2:"Gene2",color:"rgb(51,102,152)",width:"1",type:"line"},{id1:"SNP3",id2:"Gene4",color:"rgb(153,102,255)",width:"1",type:"arrowHeadLine"},{id1:"SNP4",id2:"Gene5",color:"rgb(51,102,152)",width:"1",type:"line"},{id1:"SNP5",id2:"Gene7",color:"rgb(153,102,255)",width:"1",type:"arrowHeadLine"},{id1:"SNP7",id2:"Gene5",color:"rgb(153,102,255)",width:"1",type:"arrowHeadLine"},{id1:"SNP8",id2:"Gene6",color:"rgb(153,102,255)",width:"1",type:"arrowHeadLine"},{id1:"SNP8",id2:"Gene2",color:"rgb(51,102,152)",width:"1",type:"line"}],legend:{nodes:[],edges:[]},tracks:[{name:"Affy Probes",type:"box",connect:true,fill:"rgb(255,255,51)",line:"rgb(0,0,0)",data:[{id:"123456_at",dir:"right",data:[[100,120],[123,132],[141,160]]},{id:"234567_at",dir:"left",data:[[181,200],[211,230],[251,270]]},{id:"345678_at",dir:"right",data:[[281,300],[311,330],[351,370]]}]},{hide:true,type:"bar",height:20,fill:["rgb(255,0,0)","rgb(0,0,255)","rgb(255,255,0)"],line:["rgb(255,0,0)","rgb(0,0,255)","rgb(255,255,0)"],data:[{id:"123456_at",data:[100,25,35,46]},{id:"234567_at",data:[181,80,45,10]},{id:"345678_at",data:[281,65,46,29]}]},{name:"Tissue Distribution (Heart, Liver, Kidney)",hide:false,type:"heatmap",autowidth:true,height:20,line:"rgb(0,0,0)",smps:["Heart","Kidney","Liver"],data:[{id:"123456_at",data:[100,25,35,46]},{id:"234567_at",data:[181,80,45,10]},{id:"345678_at",data:[281,65,46,29]}]},{name:"Ref Seq",type:"box",connect:true,fill:"rgb(0,100,0)",stroke:"rgb(0,0,0)",data:[{id:"NM_012345",dir:"left",data:[[171,190],[201,220],[241,290]]},{id:"NM_567890",dir:"right",data:[[121,140],[145,156],[168,196]]},{id:"NM_987654",dir:"right",data:[[271,290],[301,320],[341,390]]}]},{name:"SNP",type:"triangle",fill:"rgb(100,0,0)",line:"rgb(0,0,0)",data:[{id:"SNP123",data:123},{id:"SNP234",data:145},{id:"SNP789",data:220}]},{type:"sequence",subtype:"DNA",hide:true,line:"rgb(255,255,255)",data:[{id:"SNP123",data:[119,"AGCT[TA]CGAG"]},{id:"SNP234",data:[141,"ATCG[TG]AATA"]},{id:"SNP789",data:[216,"GCCC[CT]AGGG"]}]}],market:[{symbol:"BMY",data:[[20100824,26.26,26.37,25.95,26.02,11625900,26.02],[20100823,26.48,26.76,26.38,26.48,12146600,26.48],[20100820,26.31,26.54,26.08,26.44,18140100,26.44],[20100819,26.2,26.29,25.81,26.06,8218000,26.06],[20100818,26.53,26.57,26.23,26.28,12235800,26.28],[20100817,26.4,26.79,26.26,26.59,12325700,26.59],[20100816,26.24,26.34,26.04,26.28,10377700,26.28],[20100813,26.24,26.46,26.1,26.32,5760100,26.32],[20100812,26.01,26.39,26,26.33,7350500,26.33],[20100811,26.32,26.5,26.15,26.25,8808100,26.25],[20100810,26.32,26.78,26.3,26.66,7009500,26.66],[20100809,26.37,26.54,26.3,26.51,6825300,26.51],[20100806,26.29,26.45,26.05,26.37,8774900,26.37],[20100805,25.83,26.38,25.8,26.38,12264600,26.38],[20100804,25.7,26.13,25.61,26.03,10233700,26.03],[20100803,25.65,25.85,25.58,25.68,6842900,25.68],[20100802,25.33,25.61,25.29,25.53,9770900,25.53],[20100730,24.98,25.13,24.78,24.92,11435700,24.92],[20100729,25.37,25.5,24.85,25.08,9463800,25.08],[20100728,25.25,25.36,25.02,25.12,8072400,25.12],[20100727,25.09,25.35,24.84,25.32,14152600,25.32],[20100726,24.57,25.03,24.57,24.97,8817400,24.97],[20100723,24.94,24.95,24.26,24.65,13043700,24.65],[20100722,24.96,25.22,24.75,24.93,10385300,24.93],[20100721,24.92,25.11,24.59,24.75,9830000,24.75],[20100720,24.65,25.09,24.46,25.02,10655500,25.02],[20100719,25.27,25.27,24.78,24.84,11804800,24.84],[20100716,25.44,25.47,25.1,25.17,13136300,25.17]]}]};this.exampleBasicData={x:{Tissue:["Kidney","Liver","Breast","Brain"],Donor:["D1","D2","D2","D1"]},z:{Symbol:["abc","def","ghi","jkl","mno","pqr"],Desc:["blah","yeah","maybe","good","bad","awsome"]},y:{vars:["Gene1","Gene2","Gene3","Gene4","Gene5","Gene6"],smps:["Smp1","Smp2","Smp3","Smp4"],desc:["Intensity"],mean:[[1,2,3,4],[2,1,3,6],[3,2,1,5],[4,2,1,3],[4,3,2,1],[9,2,7,4]],stdev:[[1,3,2,1],[2,3,2,1],[2,2,2,1],[2,3,1,1],[1,1,1,1],[3,1,3,1]],n:[[4,5,5,5],[4,5,5,5],[6,4,4,5],[6,4,5,6],[5,5,5,5],[6,5,5,5]]},a:{xAxis:["Gene1","Gene2","Gene3"],xAxis2:["Gene4","Gene5","Gene6"]}};this.isValidPlotData=function(b){var c=this.isGroupedData?this.data.w:this.data.y;if(b=="cor"&&c.cor){return true}else{if(b=="venn"&&this.data.venn){return true}else{if(b=="network"&&this.data.nodes){return true}else{if(b=="genome"&&this.data.tracks){return true}else{if(b=="sum"&&c.sum&&c.sum[0].length>0){return true}else{if(b=="mean"&&c.mean&&c.mean[0].length>0){return true}else{if(b=="median"&&c.median&&c.median[0].length>0){return true}else{if(b=="iqr"&&c.iqr1&&c.qtl1&&c.median&&c.qtl3&&c.iqr3&&c.median[0].length>0){return true}else{if(b=="candle"&&c.close&&c.open&&c.high&&c.low&&c.close[0].length>0){return true}else{if(b=="volume"&&c.volume&&c.volume[0].length>0){return true}else{if(b=="raw"&&this.isRawData){return true}else{return false}}}}}}}}}}}};this.setAllNodesVisible=function(){this.nodes={};this.data.nodeIndices={};for(var b=0;b<this.data.nodes.length;b++){var c=this.data.nodes[b];c.hide=false;this.nodes[c.id]=c;this.data.nodeIndices[c.id]=b}};this.setNodeIndices=function(){this.nodes={};this.data.nodeIndices={};for(var b=0;b<this.data.nodes.length;b++){var c=this.data.nodes[b];this.nodes[c.id]=c;this.data.nodeIndices[c.id]=b}};this.setNodes=function(){if(this.data.nodeIndices){this.nodes={};for(var b=0;b<this.data.nodes.length;b++){var c=this.data.nodes[b];this.nodes[c.id]=c}this.data.nodes=[];for(var d in this.data.nodeIndices){this.data.nodes[this.data.nodeIndices[d]]=this.nodes[d]}}else{this.setNodeIndices()}};this.hideUnhideNodes=function(d,c){c=c?true:false;if(d){if(this.isArray(d)){for(var b=0;b<d.length;b++){var f=d[b];var e=this.data.nodes[this.data.nodeIndices[f]];e.hide=c;e.hideChildren=c;if(this.nodes&&this.nodes[f]){this.nodes[f].hide=c;this.nodes[f].hideChildren=c}}}}else{for(var b=0;b<this.data.nodes.length;b++){var e=this.data.nodes[b];e.hide=c;e.hideChildren=c;if(this.nodes&&this.nodes[e.id]){this.nodes[e.id].hide=c;this.nodes[e.id].hideChildren=c}}}};this.hideUnhideChildrenNodes=function(e,c){c=c?true:false;if(this.nodeParentHood[e]&&this.nodeParentHood[e].children){for(var b=0;b<this.nodeParentHood[e].children.length;b++){var d=this.nodeParentHood[e].children[b];this.data.nodes[this.data.nodeIndices[d]].hiddenParent=c;this.hideUnhideChildrenNodes(d,c)}}};this.setSelectNodes=function(c){this.selectNode={};this.isSelectNodes=0;for(var b=0;b<c.length;b++){this.selectNode[c[b]]=true;this.isSelectNodes++}};this.getAnnotations=function(c){var b=[];if(c){if(this.data.z){for(var d in this.data.z){b.push(d)}}}else{if(this.data.x){for(var d in this.data.x){b.push(d)}}}return b};this.setAllVariablesVisible=function(){if(this.data.y&&this.data.y.vars){this.varIndices=[];this.hiddenVars=[];this.xAxisVarIndices=[];this.xAxis2VarIndices=[];for(var b=0;b<this.data.y.vars.length;b++){this.varIndices.push(b);this.hiddenVars.push(false)}}if(this.data.a){if(this.data.a.xAxis){this.xAxisVarIndices=this.getVariableIndices(this.data.a.xAxis)}if(this.data.a.xAxis2){this.xAxis2VarIndices=this.getVariableIndices(this.data.a.xAxis2)}}};this.resetVariablesVisibleByAxis=function(b){if(this.data.a){this.setVariablesVisibleByAxis(b,this.getVariableIndices(this.data.a[b]))}};this.setVariablesVisibleByAxis=function(e,b){var c=e+"VarIndices";this[c]=[];for(var d=0;d<b.length;d++){this[c].push(b[d])}};this.getVariablesVisibleByAxis=function(b){return this[b+"VarIndices"]};this.getVariablesByAxis=function(b){if(this.data.a&&this.data.a[b]){return this.data.a[b]}return[]};this.setVariablesVisible=function(b){this.varIndices=[];for(var c=0;c<b.length;c++){this.varIndices.push(b[c])}};this.getVariableIndices=function(b){if(b&&this.data.y.vars){var e=[];if(this.isArray(b)){if(b.length>0){for(var d=0;d<b.length;d++){for(var c=0;c<this.data.y.vars.length;c++){if(this.data.y.vars[c]==b[d]){e.push(c);break}}}return e}}else{for(var d=0;d<this.data.y.vars.length;d++){if(this.data.y.vars[d]==b){return d}}return -1}}};this.hideUnhideVars=function(g){if(g){if(this.isArray(g)){for(var d=0;d<g.length;d++){for(var c=0;c<this.data.y.vars.length;c++){if(this.data.y.vars[c]==g[d]){if(this.hiddenVars[c]){this.hiddenVars[c]=false}else{this.hiddenVars[c]=true}break}}}}else{for(var d=0;d<this.data.y.vars.length;d++){if(this.data.y.vars[d]==g){if(this.hiddenVars[d]){this.hiddenVars[d]=false}else{this.hiddenVars[d]=true}break}}}var b=[];for(var d=0;d<this.data.y.vars.length;d++){if(!this.hiddenVars[d]){b.push(d)}}this.setVariablesVisible(b);var f=["xAxis","xAxis2"];if(this.data.a){for(var d=0;d<f.length;d++){var h=this.getVariableIndices(this.data.a[f[d]]);if(h.length>0){var b=[];for(var c=0;c<h.length;c++){var e=h[c];if(!this.hiddenVars[e]){b.push(e)}}this.setVariablesVisibleByAxis(f[d],b)}}}}};this.getVariables=function(){var e=[];for(var d=0;d<this.data.y.vars.length;d++){var b=-1;for(var c=0;c<this.varIndices.length;c++){if(this.varIndices[c]==d){b=c;break}}e.push({name:this.data.y.vars[d],hidden:this.hiddenVars[d],index:b})}return e};this.setAllSamplesVisible=function(){if(this.data.y&&this.data.y.smps){this.smpIndices=[];this.hiddenSmps=[];for(var b=0;b<this.data.y.smps.length;b++){this.smpIndices.push(b);this.hiddenSmps.push(false)}}if(this.data.w&&this.data.w.smps){this.grpIndices=[];this.hiddenGrps=[];for(var b=0;b<this.data.w.smps.length;b++){this.grpIndices.push(b);this.hiddenGrps.push(false)}}};this.getSamplesByAxis=function(b){if(this[b]){return this[b]}return[]};this.setSamplesVisible=function(b,c){if(this.isGroupedData){this.grpIndices=[];for(var e=0;e<b.length;e++){this.grpIndices.push(b[e])}}else{this.smpIndices=[];for(var e=0;e<b.length;e++){this.smpIndices.push(b[e])}}if(c){var d=this.getObjectArray(b);var g=this.isGroupedData?this.data.w:this.data.y;var f=this.isGroupedData?this.hiddenGrps:this.hiddenSmps;for(var e=0;e<g.smps.length;e++){if(d.hasOwnProperty(e)){f[e]=false}else{f[e]=true}}}};this.getSampleIndices=function(b){var f=this.isGroupedData?this.data.w:this.data.y;if(b&&f.smps){var e=[];if(this.isArray(b)){if(b.length>0){for(var d=0;d<b.length;d++){for(var c=0;c<f.smps.length;c++){if(f.smps[c]==b[d]){e.push(c);break}}}return e}}else{for(var d=0;d<f.smps.length;d++){if(f.smps[d]==b){return d}}return -1}}};this.hideUnhideSmps=function(g){if(g){var h=this.isGroupedData?this.data.w:this.data.y;var e=this.isGroupedData?this.hiddenGrps:this.hiddenSmps;var f=[];if(this.isArray(g)){for(var d=0;d<g.length;d++){for(var c=0;c<h.smps.length;c++){if(h.smps[c]==g[d]){if(e[c]){e[c]=false}else{e[c]=true}break}}}}else{for(var d=0;d<h.smps.length;d++){if(h.smps[d]==g){if(e[d]){e[d]=false}else{e[d]=true}break}}}var b=[];for(var d=0;d<h.smps.length;d++){if(!e[d]){b.push(d)}}this.setSamplesVisible(b)}};this.getSamples=function(){var d=[];var h=this.isGroupedData?this.data.w.smps:this.data.y.smps;var k=this.isGroupedData?this.data.w:this.data.y;var f=this.isGroupedData?this.hiddenGrps:this.hiddenSmps;var g=this.isGroupedData?this.grpIndices:this.smpIndices;for(var e=0;e<h.length;e++){var b=-1;for(var c=0;c<g.length;c++){if(g[c]==e){b=c;break}}d.push({name:h[e],hidden:f[e],index:b})}return d};this.setIndices=function(){if(this.graphType=="Network"){this.setNodes()}else{if(this.graphType!="Genome"&&this.graphType!="Venn"){this.setAllVariablesVisible();this.setAllSamplesVisible()}}};this.resetIndices=function(){if(this.isGroupedData){this.setIndices()}};this.setMaxSmpStringAttr=function(c,b){this.setMaxSmpStringAnnt(c,b);this.setMaxSmpStringLabel(c,b);this.setMaxSmpStringName(b)};this.setMaxSmpStringAnnt=function(e,d){if(!d){d=this.smpLabelFont}var c=0;this.maxSmpAnnt=0;this.maxSmpAnntStr="";if(this.data.x){if(e&&this.data.x[e]){return e}else{for(var f in this.data.x){var b=this.measureText(f,d);if(b>c){c=b;this.maxSmpAnnt=f.length;this.maxSmpAnntStr=f}}}}};this.setMaxSmpStringLabel=function(f,d){if(!d){d=this.smpLabelFont}var c=0;this.maxSmpLabel=0;this.maxSmpLabelStr="";if(this.data.x){if(f&&this.data.x[f]){var h="";for(var e=0;e<this.smpIndices.length;e++){var b=this.measureText(this.data.x[f][this.smpIndices[e]],d);if(b>c){c=b;h=this.data.x[f][this.smpIndices[e]]}}return h}else{for(var g in this.data.x){for(var e=0;e<this.smpIndices.length;e++){if(this.data.x[g][this.smpIndices[e]]){var b=this.measureText(this.data.x[g][this.smpIndices[e]],d);if(b>c){c=b;this.maxSmpLabel=this.data.x[g][this.smpIndices[e]].length;this.maxSmpLabelStr=this.data.x[g][this.smpIndices[e]]}}}}}}};this.setMaxSmpStringName=function(d){if(!d){d=this.smpLabelFont}if(this.data.y||this.data.w){var f=this.isGroupedData?this.data.w:this.data.y;var c=0;this.maxSmpName=0;this.maxSmpNameStr="";if(this.isGroupedData){for(var e=0;e<f.smps.length;e++){var b=this.measureText(f.smps[e],d);if(b>c){c=b;this.maxSmpName=f.smps[e].length;this.maxSmpNameStr=f.smps[e]}}}else{for(var e=0;e<this.smpIndices.length;e++){var b=this.measureText(f.smps[this.smpIndices[e]],d);if(b>c){c=b;this.maxSmpName=f.smps[this.smpIndices[e]].length;this.maxSmpNameStr=f.smps[this.smpIndices[e]]}}}}};this.setMaxVarStringAttr=function(c,b){this.setMaxVarStringAnnt(c,b);this.setMaxVarStringLabel(c,b);this.setMaxVarStringName(b)};this.setMaxVarStringAnnt=function(e,d){if(!d){d=this.varLabelFont}var c=0;this.maxVarAnnt=0;this.maxVarAnntStr="";if(this.data.z){if(e&&this.data.z[e]){return e}else{for(var f in this.data.z){var b=this.measureText(f,d);if(b>c){c=b;this.maxVarAnnt=f.length;this.maxVarAnntStr=f}}}}};this.setMaxVarStringLabel=function(f,d){if(!d){d=this.varLabelFont}var c=0;this.maxVarLabel=0;this.maxVarLabelStr="";if(this.data.z){if(f&&this.data.z[f]){var h="";for(var e=0;e<this.varIndices.length;e++){var b=this.measureText(this.data.z[f][this.varIndices[e]],d);if(b>c){c=b;h=this.data.z[f][this.varIndices[e]]}}return h}else{for(var g in this.data.z){for(var e=0;e<this.varIndices.length;e++){if(this.data.z[g][this.varIndices[e]]){var b=this.measureText(this.data.z[g][this.varIndices[e]],d);if(b>c){c=b;this.maxVarLabel=this.data.z[g][this.varIndices[e]].length;this.maxVarLabelStr=this.data.z[g][this.varIndices[e]]}}}}}}};this.setMaxVarStringName=function(d){if(!d){d=this.varLabelFont}if(this.data.y||this.data.w){var f=this.graphType=="BarLine"?this.data.y:this.isGroupedData?this.data.w:this.data.y;var c=0;this.maxVarName=0;this.maxVarNameStr="";if(f.vars){for(var e=0;e<this.varIndices.length;e++){var b=this.measureText(f.vars[this.varIndices[e]],d);if(b>c){c=b;this.maxVarName=f.vars[this.varIndices[e]].length;this.maxVarNameStr=f.vars[this.varIndices[e]]}}}}};this.setRangeData=function(d,e,b,u){var c=this.isGroupedData&&!e?this.data.w:this.data.y;var n=Number.MAX_VALUE;var r=Number.MIN_VALUE;if(this.setMin&&this.setMax){this.minData=this.setMin;this.maxData=this.setMax;return}if(this.isGroupedData&&!d){d=this.summaryType}if(d=="genome"){for(var s=0;s<this.data.tracks.length;s++){for(var p=0;p<this.data.tracks[s].data.length;p++){for(var o=0;o<this.data.tracks[s].data[p].data.length;o++){if(this.data.tracks[s].type=="box"){m=this.data.tracks[s].data[p].data[o];r=Math.max(r,Math.max(m[0],m[1]));n=Math.min(n,Math.min(m[0],m[1]))}else{if(this.data.tracks[s].type.match(/bar|heatmap|sequence/)){m=this.data.tracks[s].data[p].data;r=Math.max(r,m[0]);n=Math.min(n,m[0])}else{m=this.data.tracks[s].data[p].data;r=Math.max(r,m);n=Math.min(n,m)}}}}}}else{if(d=="percentile"&&!e){n=0;r=100}else{if((d=="mean"||d=="median"||d=="sum")&&!e){if(u){var f=this.isGroupedData?this.grpIndices:this.smpIndices;var y=this.isTransformedData?c.trans:c[this.summaryType];for(var s=0;s<f.length;s++){var l=f[s];var h=0;for(var p=0;p<this.varIndices.length;p++){var t=this.varIndices[p];var A=y[t][l];if(!isNaN(A)&&A>0){h+=A}}r=Math.max(h,r)}n=0}else{for(var s=0;s<this.varIndices.length;s++){var l=this.varIndices[s];var m;if(this.isTransformedData){m=c.trans[l]}else{if(this.summaryType=="mean"){m=c.mean[l]}else{if(this.summaryType=="median"){m=c.median[l]}else{if(this.summaryType=="sum"){m=c.sum[l]}}}}for(var p=0;p<m.length;p++){var x;var A=m[p];if(c.stdev&&!this.isTransformedData){x=c.stdev[l][p]}else{x=Number.NaN}if(!isNaN(A)){if(!isNaN(x)){if(b){if(A>0){n=Math.min(A,n);r=Math.max(A+x,r)}}else{n=Math.min(A,n);r=Math.max(A+x,r)}}else{if(b){if(A>0){n=Math.min(A,n);r=Math.max(A,r)}}else{n=Math.min(A,n);r=Math.max(A,r)}}}}}}}else{if(d=="iqr"&&!e){if(this.isTransformedData){alert("Transformation not allowed");this.isTransformedData=false}for(var s=0;s<this.varIndices.length;s++){var l=this.varIndices[s];for(var p=0;p<c.iqr1.length;p++){var w=c.iqr1[l][p];var v=c.iqr3[l][p];var q=c.out[l][p];if(!isNaN(w)&&!isNaN(v)){if(b){if(w>0&&v>0){n=Math.min(w,n);r=Math.max(v,r)}}else{n=Math.min(w,n);r=Math.max(v,r)}}if(q){for(var o=0;o<q.length;o++){if(!isNaN(q[o])){if(b){if(q[o]>0){n=Math.min(q[o],n);r=Math.max(q[o],r)}}else{n=Math.min(q[o],n);r=Math.max(q[o],r)}}}}}}}else{if(d=="candle"){if(this.isTransformedData){alert("Transformation not allowed");this.isTransformedData=false}var f=this.isGroupedData?this.grpIndices:this.smpIndices;for(var s=0;s<this.varIndices.length;s++){var l=this.varIndices[s];for(var p=0;p<f.length;p++){var t=f[p];var g=c.high[l][t];var z=c.low[l][t];if(!isNaN(g)&&!isNaN(z)){n=Math.min(z,n);r=Math.max(g,r)}}}}else{if(d=="volume"){var f=this.isGroupedData?this.grpIndices:this.smpIndices;for(var s=0;s<this.varIndices.length;s++){var l=this.varIndices[s];for(var p=0;p<f.length;p++){var t=f[p];if(!isNaN(c.volume[l][t])){n=Math.min(c.volume[l][t],n);r=Math.max(c.volume[l][t],r)}}}}else{if(d=="cor"){var f=this.correlationAxis=="variables"?this.varIndices:this.isGroupedData?this.grpIndices:this.smpIndices;for(var s=0;s<f.length;s++){for(var p=0;p<f.length;p++){var A=this.isTransformedData?c.trans[s][p]:c.cor[s][p];if(!isNaN(A)){if(b){if(A>0){n=Math.min(A,n);r=Math.max(A,r)}}else{n=Math.min(A,n);r=Math.max(A,r)}}}}}else{var y=this.isTransformedData?c.trans:c.data;if(u){for(var s=0;s<this.smpIndices.length;s++){var h=0;for(var p=0;p<this.varIndices.length;p++){var A=y[this.varIndices[p]][this.smpIndices[s]];if(!isNaN(A)&&A>0){h+=A}}r=Math.max(h,r)}n=0}else{for(var s=0;s<this.varIndices.length;s++){for(var p=0;p<this.smpIndices.length;p++){var A=y[this.varIndices[s]][this.smpIndices[p]];if(!isNaN(A)){if(b){if(A>0){n=Math.min(A,n);r=Math.max(A,r)}}else{n=Math.min(A,n);r=Math.max(A,r)}}}}}}}}}}}}this.minData=this.setMin?this.setMin:n;this.maxData=this.setMax?this.setMax:r};this.sortIndices=function(f,d,b,h,e){var c=this;var g=this.isGroupedData?this.grpIndices:f=="vars"?this.varIndices:this.smpIndices;if(!d){d=this.sortDir}if(b&&f=="vars"&&this.data.z[b]){this.tmpAsciiArray=this.data.z[b];this.smpSort=-1;this.varSort=b}else{if(b&&f=="smps"&&this.data.x[b]){this.tmpAsciiArray=this.data.x[b];this.varSort=-1;this.smpSort=b}else{if(h){this.tmpAsciiArray=this.getDataForSmpGrpAtIndex(h-1);this.smpSort=h-1}else{if(e){this.tmpAsciiArray=this.data.y.data[e-1];this.varSort=e-1}else{this.tmpAsciiArray=this.isGroupedData?this.data.w.smps:f=="vars"?this.data.y.vars:this.data.y.smps;if(f=="vars"){this.varSort=false}else{this.smpSort=false}}}}}if(this.isAsciiArray(this.tmpAsciiArray)){g.sort(function(j,i){return c.sortAsciibetically(j,i)})}else{g.sort(function(j,i){return c.sortNumerically(j,i)})}if(d!="ascending"){g.reverse()}this.tmpAsciiArray=[]};this.isAsciiArray=function(b){for(var c=0;c<b.length;c++){if(isNaN(b[c])){return true}}return false};this.sortAsciibetically=function(d,c){return((this.tmpAsciiArray[d]>this.tmpAsciiArray[c])?1:(this.tmpAsciiArray[d]<this.tmpAsciiArray[c])?-1:0)};this.sortNumerically=function(d,c){return(this.tmpAsciiArray[d]-this.tmpAsciiArray[c])};this.isNumeric=function(b,f,e){if(f){for(var d=0;d<this.smpIndices.length;d++){var c=this.smpIndices[d];if(b[c]&&isNaN(b[c])){return false}}}else{if(e){for(var d=0;d<this.varIndices.length;d++){var c=this.varIndices[d];if(b[c]&&isNaN(b[c])){return false}}}else{for(var c=0;c<b.length;c++){if(b[c]&&isNaN(b[c])){return false}}}}return true};this.cleanArray=function(b,g,f){var d=[];if(g){for(var e=0;e<this.smpIndices.length;e++){var c=this.smpIndices[e];if(!isNaN(b[c])){d.push(b[c])}}}else{if(f){for(var e=0;e<this.varIndices.length;e++){var c=this.varIndices[e];if(!isNaN(b[c])){d.push(b[c])}}}else{for(var c=0;c<b.length;c++){if(!isNaN(b[c])){d.push(b[c])}}}}return d};this.cleanArrays=function(c,b,j,h){var g=[];var f=[];if(j){for(var e=0;e<this.smpIndices.length;e++){var d=this.smpIndices[e];if(!isNaN(c[d])&&!isNaN(b[d])){g.push(c[d]);f.push(b[d])}}}else{if(h){for(var e=0;e<this.varIndices.length;e++){var d=this.varIndices[e];if(!isNaN(c[d])&&!isNaN(b[d])){g.push(c[d]);f.push(b[d])}}}else{for(var d=0;d<c.length;d++){if(!isNaN(c[d])&&!isNaN(b[d])){g.push(c[d]);f.push(b[d])}}}}return[g,f]};this.sortArray=function(b,c){var e=[];if(b.length!=c.length){return b}for(var d=0;d<b.length;d++){if(b[c[d]]){e[d]=b[c[d]]}else{return b}}return e};this.reverseArray=function(b){var e=[];var d=0;for(var c=b.length-1;c>=0;c--){e[d]=b[c];d++}return e};this.percentile=function(e,b,f){var c=b-e;if(c==0){return 50}var d=f-e;return d*100/c};this.rank=function(b){var d=[];for(var c=0;c<b.length;c++){d.push(c)}d.sort(function(f,e){return b[f]-b[e]});return d};this.min=function(b,f,e){b=this.cleanArray(b,f,e);var d=Number.MAX_VALUE;for(var c=0;c<b.length;c++){d=Math.min(d,b[c])}return d};this.max=function(c,f,e){c=this.cleanArray(c,f,e);var b=Number.MIN_VALUE;for(var d=0;d<c.length;d++){b=Math.max(b,c[d])}return b};this.sum=function(b,g,f,e){b=this.cleanArray(b,g,f);var d=0;for(var c=0;c<b.length;c++){if(e){if(b[c]>0){d+=b[c]}}else{d+=b[c]}}return d};this.mean=function(b,g,e){b=this.cleanArray(b,g,e);var c=0;var f=0;for(var d=0;d<b.length;d++){if(!isNaN(b[d])){c+=b[d];f++}}if(f>0){c/=f}return c};this.range=function(c,g,f){c=this.cleanArray(c,g,f);var e=Number.MAX_VALUE;var b=Number.MIN_VALUE;for(var d=0;d<c.length;d++){e=Math.min(c[d],e);b=Math.max(c[d],b)}return[e,b]};this.median=function(b,h,f){b=this.cleanArray(b,h,f);var e=[];var d=[];var g=0;e[0]=Number.NaN;e[1]=Number.NaN;for(var c=0;c<b.length;c++){d.push(b[c]);g++}if(g>0){e[1]=g;d.sort(function(j,i){return j-i});if(g%2){e[0]=d[parseInt(g/2)]}else{e[0]=(d[parseInt((g-1)/2)]+d[g/2])/2}}return e};this.meanStandardDeviationN=function(b,j,g){b=this.cleanArray(b,j,g);var f=[];var d=0;var c=0;var h=0;for(var e=0;e<b.length;e++){c+=b[e];d+=b[e]*b[e];h++}if(h>0){c/=h;d=Math.sqrt(d/h-c*c);f.push(c);f.push(d);f.push(h)}else{f.push("");f.push("");f.push("")}return f};this.quantiles=function(l,d,s){l=this.cleanArray(l,d,s);var o=[];var h=[];var e=l.length;if(e>2){var p=Math.floor(e*0.25);var k=Math.floor(e*0.5);var c=Math.floor(e*0.75);l.sort(function(n,i){return n-i});var b;var r;var q;if(e%2){r=l[k]}else{r=this.mean([l[k-1],l[k]])}if((e/2)%2){b=l[p];q=l[c]}else{b=this.mean([l[p-1],l[p]]);q=this.mean([l[c-1],l[c]])}var m=(q-b)*1.5;var g;var f;for(var j=0;j<=p;j++){if(l[j]<b-m){h.push(l[j])}else{g=l[j];break}}for(var j=e-1;j>=c;j--){if(l[j]>q+m){h.push(l[j])}else{f=l[j];break}}o.push(b);o.push(r);o.push(q);o.push(g);o.push(f);o.push(h);o.push(e)}else{if(e>1){o.push(l[0]);o.push(l[1]);o.push(l[1]);o.push(l[0]);o.push(l[1]);o.push(h);o.push(e)}else{if(e>0){o.push(l[0]);o.push(l[0]);o.push(l[0]);o.push(l[0]);o.push(l[0]);o.push(h);o.push(e)}else{o.push(Number.NaN);o.push(Number.NaN);o.push(Number.NaN);o.push(Number.NaN);o.push(Number.NaN);o.push(Number.NaN)}}}return o};this.covariance=function(g,f,b,l){var e=this.cleanArrays(g,f,b,l);g=e[0];f=e[1];var k=0;var c=0;var j=this.mean(g);var h=this.mean(f);for(var d=0;d<g.length;d++){k+=g[d]*f[d];c++}if(c>0){k/=c;return k-(j*h)}return k};this.correlation=function(h,g,c,p){var f=this.cleanArrays(h,g,c,p);h=f[0];g=f[1];var d=0;var m=0;var k=0;var b=0;var j=0;var l=this.covariance(h,g);var o=0;for(var e=0;e<h.length;e++){m+=h[e];k+=g[e];b+=h[e]*h[e];j+=g[e]*g[e];d++}if(d>0){o=(d*d)*l/Math.sqrt(((d*b)-(m*m))*((d*j)-(k*k)))}return o};this.regression=function(k,j,c,s){var h=this.cleanArrays(k,j,c,s);k=h[0];j=h[1];var d=0;var p=0;var m=0;var r=0;var b=0;var l=0;var o=this.covariance(k,j);var q=0;var g=0;var e=0;for(var f=0;f<k.length;f++){p+=k[f];m+=j[f];r+=k[f]*j[f];b+=k[f]*k[f];l+=j[f]*j[f];d++}if(d>2){g=(d*r-p*m)/(d*b-p*p);e=(m-g*p)/d;q=(d*d)*o/Math.sqrt(((d*b)-(p*p))*((d*l)-(m*m)))}return[g,e,q]};this.normalize=function(f){for(var e=0;e<f.length;e++){var b=this.meanStandardDeviationN(f[e]);for(var c=0;c<f[e].length;c++){f[e][c]=(f[e][c]-b[0])/b[1]}}return f};this.euclidianDistance=function(c,b,j,h){var f=this.cleanArrays(c,b,j,h);c=f[0];b=f[1];var g=0;if(c.length==b.length){for(var e=0;e<c.length;e++){g+=Math.pow(c[e]-b[e],2)}g=Math.sqrt(g)}return g};this.manhattanDistance=function(c,b,j,h){var f=this.cleanArrays(c,b,j,h);c=f[0];b=f[1];var g=0;if(c.length==b.length){for(var e=0;e<c.length;e++){g+=Math.abs(c[e]-b[e])}}return g};this.maxDistance=function(c,b,j,h){var f=this.cleanArrays(c,b,j,h);c=f[0];b=f[1];var g=0;if(c.length==b.length){for(var e=0;e<c.length;e++){g=Math.max(g,Math.abs(c[e]-b[e]))}}return g};this.addVectors=function(d,c,h,g){var f=this.cleanArrays(d,c,h,g);d=f[0];c=f[1];var b=[];if(d.length==c.length){for(var e=0;e<d.length;e++){b.push(d[e]+c[e])}}return b};this.compareVectors=function(c,b){if(this.isArray(c)&&this.isArray(b)){if(c.length!=b.length){return false}for(var d=0;d<c.length;d++){if(this.isArray(c[d])&&this.isArray(b[d])){if(!this.compareArrays(c[d],b[d])){return false}}if(c[d]!==b[d]){return false}}return true}};this.vectorDotProduct=function(c,b,h,g){var e=this.cleanArrays(c,b,h,g);c=e[0];b=e[1];var f=0;if(c.length==b.length){for(var d=0;d<c.length;d++){f+=c[d]*b[d]}}return f};this.multiplyVectorByValue=function(b,e,f,d){b=this.cleanArray(b,f,d);for(var c=0;c<b.length;c++){b[c]*=e}return b};this.getCentroid=function(e,h,g,b){var j=[];if(h.length==b.length){var f=e+g;for(var d=0;d<h.length;d++){j.push((e*h[d]+g*b[d])/f)}}return j};this.createNode=function(j,e,f,g,i,b){var h={id:j,left:e,right:f,dist:g,centroid:i};if(b){h.mid=b}if(e==null&&f==null){h.size=1;h.depth=0}else{h.size=e.size+f.size;h.depth=1+Math.max(e.depth,f.depth)}return h};this.createRandomVectors=function(e,h){var d=h.length;if(e>d){return null}var m=[];var g=[];var b={};var o=0;var p=0;var l,c;while(p<e){if(o==d){return null}var j=Math.floor(Math.random()*d);if(j in b){continue}b[j]=1;o++;l=h[j];c=true;for(var f=0;f<p;f++){if(this.compareVectors(l,m[f])){c=false;break}}if(c){m[p]=l;g[p]=j;p++}}return{vectors:m,indices:g}};this.imputeDatum=function(b){var e=[];if(this.clusterAxis=="samples"){for(var c=0;c<this.varIndices.length;c++){var d=this.varIndices[c];e.push(this.data.y.data[d][b])}}else{for(var c=0;c<this.smpIndices.length;c++){var d=this.smpIndices[c];e.push(this.data.y.data[b][d])}}return this[this.imputeMethod](e)};this.getIdsForClustering=function(){var e=[];if(this.clusterAxis=="samples"){for(var b=0;b<this.smpIndices.length;b++){var c=this.smpIndices[b];e[b]=this.data.y.smps[c]}}else{for(var b=0;b<this.varIndices.length;b++){var c=this.varIndices[b];e[b]=this.data.y.vars[c]}}return e};this.getDataForClustering=function(){var k=[];var b=[];if(this.clusterAxis=="samples"){for(var e=0;e<this.smpIndices.length;e++){k[e]=[]}for(var e=0;e<this.varIndices.length;e++){var f=this.varIndices[e];for(var c=0;c<this.smpIndices.length;c++){var g=this.smpIndices[c];var h=this.data.y.data[f][g];if(isNaN(h)){if(!b[c]){b[c]=this.imputeDatum(g)}h=b[c]}k[c][e]=h}}}else{for(var e=0;e<this.varIndices.length;e++){k[e]=[]}for(var e=0;e<this.varIndices.length;e++){var f=this.varIndices[e];for(var c=0;c<this.smpIndices.length;c++){var g=this.smpIndices[c];var h=this.data.y.data[f][g];if(isNaN(h)){if(!b[e]){b[e]=this.imputeDatum(f)}h=b[e]}k[e][c]=h}}}if(this.centerData){k=this.normalize(k)}return k};this.cluster=function(){var v;var o=this.getDataForClustering();var g=this.getIdsForClustering();var f=[];var e=[];var q=[];var u=[];for(var n=0;n<o.length;n++){f[n]=[]}for(var n=0;n<o.length;n++){f[n][n]=Number.POSITIVE_INFINITY;for(var k=n+1;k<o.length;k++){f[n][k]=this[this.distance+"Distance"](o[n],o[k]);f[k][n]=f[n][k]}}for(var n=0;n<o.length;n++){e[n]=0;for(var k=0;k<o.length;k++){if(f[n][e[n]]>f[n][k]){e[n]=k}}}for(var n=0;n<o.length;n++){u[n]=[];u[n][0]=this.createNode(g[n],null,null,0,o[n]);q[n]=1}for(var b=0;b<o.length-1;b++){var m=0;for(var n=0;n<o.length;n++){if(f[n][e[n]]<f[m][e[m]]){m=n}}var h=e[m];var c=u[m][0];var r=u[h][0];var t=this.getCentroid(c.size,c.centroid,r.size,r.centroid);var s=this.createNode(-1,c,r,f[m][h],t);u[m].splice(0,0,s);q[m]+=q[h];for(var k=0;k<o.length;k++){if(this.linkage=="single"){if(f[m][k]>f[h][k]){f[k][m]=f[m][k]=f[h][k]}}else{if(this.linkage=="complete"){if(f[m][k]<f[h][k]){f[k][m]=f[m][k]=f[h][k]}}else{if(this.linkage=="average"){f[k][m]=f[m][k]=(q[m]*f[m][k]+q[h]*f[h][k])/(q[m]+q[k])}}}}f[m][m]=Number.POSITIVE_INFINITY;for(var n=0;n<o.length;n++){f[n][h]=f[h][n]=Number.POSITIVE_INFINITY}for(var k=0;k<o.length;k++){if(e[k]==h){e[k]=m}if(f[m][k]<f[m][e[m]]){e[m]=k}}v=s}return this.writeNewick(v)};this.isLeafNode=function(b){if(b.left==null&&b.right==null){return true}else{return false}};this.writeNewick=function(c,j){var h="";var g="";if(this.isLeafNode(c)){h=c.id}else{var b;var d=this.writeNewick(c.left,j);var f=this.writeNewick(c.right,j);if(c.mid){for(var e=0;e<c.mid.length;e++){if(j&&c.mid[e].dist){g+=","+c.mid[e].id+":"+c.mid[e].dist}else{g+=","+c.mid[e].id}g+=c.mid[e].id}}h="("+d+g+","+f+")"}if(j&&c.dist){h+=":"+c.dist}return h};this.kmeans=function(){var m;var o=this.getDataForClustering();var c=this.getIdsForClustering();var n=[];var p=[];var r=true;var q=0;var h=null;var w=this.createRandomVectors(this.kmeansClusters,o);if(w==null){return null}else{h=w.vectors}while(r){for(var k=0;k<this.kmeansClusters;k++){p[k]=0}for(var k=0;k<o.length;k++){var s=o[k];var g=Number.MAX_VALUE;var e;for(var f=0;f<this.kmeansClusters;f++){var b=this.euclidianDistance(h[f],s);if(b<g){g=b;e=f}}p[e]++;n[k]=e}var u=[];for(var k=0;k<this.kmeansClusters;k++){u[k]=null}for(var k=0;k<o.length;k++){if(u[n[k]]==null){u[n[k]]=o[k]}else{u[n[k]]=this.addVectors(u[n[k]],o[k])}}for(var k=0;k<this.kmeansClusters;k++){u[k]=this.multiplyVectorByValue(u[k],1/p[k])}r=false;for(var k=0;k<this.kmeansClusters;k++){if(!this.compareVectors(u[k],h[k])){r=true;break}}h=u;q++;if(q>this.maxIterations){r=false}}for(var k=0;k<n.length;k++){n[k]="K-"+(n[k]+1)}return n};this.transpose=function(h){if(h){var l=[];for(var f=0;f<h.length;f++){for(var e=0;e<h[f].length;e++){if(!l[e]){l[e]=[]}l[e][f]=h[f][e]}}return l}else{this.ungroupSamples();this.transform("reset");if(this.data.l){delete (this.data.l)}if(this.data.d){delete (this.data.d)}if(this.data.a){delete (this.data.a)}if(this.data.t){var c=this.data.t.vars;var g=this.data.t.smps;if(c){this.data.t.smps=c}if(g){this.data.t.vars=g}}var b=this.data.x;var k=this.data.z;if(b){this.data.z=b}if(k){this.data.x=k}var g=this.data.y.smps;this.data.y.smps=this.data.y.vars;this.data.y.vars=g;var l=this.data.y.data;this.data.y.data=[];for(var f=0;f<this.data.y.vars.length;f++){this.data.y.data[f]=[];for(var e=0;e<this.data.y.smps.length;e++){this.data.y.data[f][e]=l[e][f]}}this.initializeData(this.data);this.resetObject()}};this.checkObject=function(){var d=this.data.y;if(this.isGroupedData){this.data.w={};d=this.data.w}var c=["vars","smps","desc","data","mean","median","stdev","n","qtl1","qtl3","iqr1","iqr3","out","trans","cor","sum","grps","close","open","high","low","volume"];for(var b=0;b<c.length;b++){if(!d[c[b]]){d[c[b]]=[]}}};this.resetObject=function(b){var d=["mean","median","stdev","n","qtl1","qtl3","iqr1","iqr3","out","cor","sum","grps","close","open","high","low","volume"];if(this.isGroupedData){if(!this.isTransformedData){d.push("trans")}for(var c=0;c<d.length;c++){delete (this.data.y[d[c]])}delete (this.data.w)}else{if(!this.isTransformedData){d.push("trans")}if(this.isRawData){for(var c=0;c<d.length;c++){delete (this.data.y[d[c]])}}else{delete (this.data.y.data)}}if(b){this.checkObject()}};this.getDataAtPos=function(g,e,c,d,f,b){var h=Number.NaN;var k=this.isGroupedData?this.data.w:this.data.y;if(this.isGroupedData||!this.isRawData){if(this.isTransformedData){h=k.trans[g][e]}else{c=c?c:this.summaryType;if(k.hasOwnProperty(c)){h=k[c][g][e]}else{h=0}}}else{if(c&&k[c][g]){h=k[c][g][e]}else{if(this.isTransformedData){h=k.trans[g][e]}else{h=k.data[g][e]}}}if(d){if(!isNaN(h)){if(d=="log2"){h=Math.log(h)/Math.LN2}else{if(d=="log10"){h=Math.log(h)/Math.LN10}else{if(d=="exp2"){h=Math.pow(2,h)}else{if(d=="exp10"){h=Math.pow(2,h)}else{if(d=="percentile"){h=this.percentile(f,b,h)}}}}}}}return h};this.getDataForSmpGrpAtIndex=function(c){var b=[];if(this.isGroupedData||!this.isRawData){var g=this.isGroupedData?this.data.w:this.data.y;if(this.isTransformedData){b.push(g.trans[f][c])}else{var d=this.summaryType;if(g.hasOwnProperty(d)){for(var e=0;e<this.varIndices.length;e++){var f=this.varIndices[e];b.push(g[d][f][c])}}}}else{if(this.isTransformedData){for(var e=0;e<this.varIndices.length;e++){var f=this.varIndices[e];b.push(this.data.y.trans[f][c])}}else{for(var e=0;e<this.varIndices.length;e++){var f=this.varIndices[e];b.push(this.data.y.data[f][c])}}}return b};this.getMetaDataForVariableAtIndex=function(b){var d={};if(this.data.z){for(var c in this.data.z){d[c]=this.data.z[c][b]}}d[name]=this.data.y.vars[b];return d};this.getMetaDataForSampleAtIndex=function(b){if(this.isGroupedData){return this.getMetaDataForGrpAtIndex(b)}else{return this.getMetaDataForSmpAtIndex(b)}};this.getMetaDataForSmpAtIndex=function(b){var d={};if(this.data.x){for(var c in this.data.x){d[c]=this.data.x[c][b]}}d[name]=this.data.y.vars[b];return d};this.getMetaDataForGrpAtIndex=function(b){var e=[];for(var c=0;c<this.data.w.grps[b].length;c++){var d=this.data.w.grps[b][c];e.push(this.getMetaDataForSmpAtIndex[d])}return e};this.summarize=function(l,o){var b=this.isGroupedData?this.data.w:this.data.y;var c=this.isGroupedData?false:true;if(!this.isGroupedData){this.checkObject()}if(l=="cor"){this.isBoxPlotCalc=false;if(this.correlationAxis=="samples"){var p=this.isGroupedData?this.grpIndices:this.smpIndices;for(var e=0;e<p.length;e++){var q=p[e];var m=this.getDataForSmpGrpAtIndex(q);if(!b.cor[q]){b.cor[q]=[]}for(var d=e;d<p.length;d++){var g=p[d];if(!b.cor[g]){b.cor[g]=[]}var k=this.getDataForSmpGrpAtIndex(g);if(e==d){if(this.isTransformedData){b.trans[q][g]=1}b.cor[q][g]=1}else{b.cor[q][g]=this.correlation(m,k);b.cor[g][q]=b.cor[q][g];if(this.isTransformedData){b.trans[q][g]=b.cor[q][g];b.trans[g][q]=b.cor[g][q]}}}}}else{for(var e=0;e<this.varIndices.length;e++){var q=this.varIndices[e];if(!b.cor[q]){b.cor[q]=[]}for(var d=e;d<this.varIndices.length;d++){var g=this.varIndices[d];if(!b.cor[g]){b.cor[g]=[]}if(e==d){b.cor[q][g]=1;if(this.isTransformedData){b.trans[q][g]=1}}else{b.cor[q][g]=this.correlation(b.data[q],b.data[g],c);b.cor[g][q]=b.cor[q][g];if(this.isTransformedData){b.trans[q][g]=b.cor[q][g];b.trans[g][q]=b.cor[g][q]}}}}}}else{this.isBoxPlotCalc=l=="iqr"?true:false;for(var e=0;e<this.varIndices.length;e++){var f;var q=this.varIndices[e];if(!b.mean[q]){b.trans[q]=[];b.mean[q]=[];b.median[q]=[];b.stdev[q]=[];b.qtl1[q]=[];b.qtl3[q]=[];b.iqr1[q]=[];b.iqr3[q]=[];b.out[q]=[];b.n[q]=[];b.sum[q]=[]}if(this.isGroupedData){f=o[q]}else{b.grps=[];f=[];for(var d=0;d<this.smpIndices.length;d++){var g=this.smpIndices[d];b.grps[d]=[];b.grps[d].push(g);f[d]=[b.data[q][g]]}}if(l=="iqr"){this.summaryType="iqr";for(var d=0;d<f.length;d++){var n=this.quantiles(f[d],c);if(this.isTransformedData){b.trans[q][d]=n[1]}b.median[q][d]=n[1];b.qtl1[q][d]=n[0];b.qtl3[q][d]=n[2];b.iqr1[q][d]=n[3];b.iqr3[q][d]=n[4];b.out[q][d]=n[5];b.n[q][d]=n[6]}}else{if(l=="median"){this.summaryType="median";for(var d=0;d<f.length;d++){var n=this.median(f[d],c);if(this.isTransformedData){b.trans[q][d]=n[1]}b.median[q][d]=n[0];b.n[q][d]=n[1]}}else{if(l=="mean"){this.summaryType="mean";for(var d=0;d<f.length;d++){var n=this.meanStandardDeviationN(f[d],c);if(this.isTransformedData){b.trans[q][d]=n[1]}b.mean[q][d]=n[0];b.stdev[q][d]=n[1];b.n[q][d]=n[2]}}else{if(l=="sum"){this.summaryType="sum";for(var d=0;d<f.length;d++){var h=this.sum(f[d],c);if(this.isTransformedData){b.trans[q][d]=h}b.sum[q][d]=h;b.n[q][d]=f[d].length}}}}}}}};this.copySummarizedData=function(){var f=this.isGroupedData?this.data.w:this.data.y;var e;for(var c=0;c<this.varIndices.length;c++){var d=this.varIndices[c];f.data[d]=[];f.trans[d]=[];if(this.summaryType=="mean"){for(var b=0;b<f.mean[d].length;b++){f.data[d][b]=f.mean[d][b]}}else{if(this.summaryType=="median"||this.summaryType=="iqr"){for(var b=0;b<f.median[d].length;b++){f.data[d][b]=f.median[d][b]}}else{if(this.summaryType=="candle"){for(var b=0;b<f.close[d].length;b++){f.data[d][b]=f.close[d][b]}}else{if(this.summaryType=="volume"){for(var b=0;b<f.volume[d].length;b++){f.data[d][b]=f.volume[d][b]}}else{if(this.summaryType=="sum"){for(var b=0;b<f.volume[d].length;b++){f.data[d][b]=f.sum[d][b]}}}}}}if(!e){e=d}}return e};this.transform=function(d,c,b){var e=0;if(!this.isGroupedData){this.checkObject()}if(!this.isRawData||this.isGroupedData){e=this.copySummarizedData()}this.transformType=d;if(d=="reset"||d=="undo"){this.transformReset();this.transformType=false;this.isTransformedData=false}else{if(d=="save"){this.transformSave();this.transformType=false;this.isTransformedData=false}else{if(d=="log2"||d=="log10"||d=="exp2"||d=="exp10"){this.transformLogExp(d);this.isTransformedData=true}else{if(d=="ratio"||d=="ratio2"||d=="ratio10"){this.transformRatio(d,b);this.isTransformedData=true}else{this.transformRelative(d,c,e);this.isTransformedData=true}}}}};this.transformReset=function(){var e=this.isGroupedData?this.data.w:this.data.y;for(var c=0;c<this.varIndices.length;c++){var d=this.varIndices[c];for(var b=0;b<e.data[d].length;b++){if(e.trans[d]&&!isNaN(e.data[d][b])){e.trans[d][b]=e.data[d][b]}}}};this.transformSave=function(){var e=this.isGroupedData?this.data.w:this.data.y;for(var c=0;c<this.varIndices.length;c++){var d=this.varIndices[c];for(var b=0;b<e.data[d].length;b++){if(!isNaN(e.data[d][b])){e.data[d][b]=e.trans[d][b]}}}};this.transformLogExp=function(e){var f=this.isGroupedData?this.data.w:this.data.y;if(e=="log"){e=this.transformBase==2?"type2":"type10"}else{if(e=="exp"){e=this.transformBase==2?"exp2":"exp10"}}for(var c=0;c<this.varIndices.length;c++){var d=this.varIndices[c];if(!f.trans[d]){f.trans[d]=[]}for(var b=0;b<f.data[d].length;b++){if(!isNaN(f.data[d][b])){if(e=="log2"){this.isLogData=true;this.transformBase=2;f.trans[d][b]=Math.log(f.data[d][b])/Math.LN2}else{if(e=="log10"){this.isLogData=true;this.transformBase=10;f.trans[d][b]=Math.log(f.data[d][b])/Math.LN10}else{if(e=="exp2"){this.isLogData=false;this.transformBase=2;f.trans[d][b]=Math.pow(2,f.data[d][b])}else{if(e=="exp10"){this.isLogData=false;this.transformBase=10;f.trans[d][b]=Math.pow(10,f.data[d][b])}}}}}}}};this.transformRatio=function(f,b){var h=this.isGroupedData?this.data.w:this.data.y;b=b?b:this.ratioReference;for(var d=0;d<this.varIndices.length;d++){var e=this.varIndices[d];if(!h.trans[e]){h.trans[e]=[]}for(var c=0;c<h.data[e].length;c++){if(!isNaN(h.data[e][c])&&!isNaN(h.data[e][b])){if(this.isLogData){if(f=="ratio"){f=this.transformBase==2?"ratio2":"ratio10"}var g;if(h.data[e][c]>=h.data[e][b]){g=h.data[e][c]-h.data[e][b];if(f=="ratio2"){h.trans[e][c]=Math.pow(2,g)}else{if(f=="ratio10"){h.trans[e][c]=Math.pow(10,g)}}}else{g=h.data[e][b]/h.data[e][d];if(f=="ratio2"){h.trans[e][c]=Math.pow(2,g)*-1}else{h.trans[e][c]=Math.pow(10,g)*-1}}}else{if(h.data[e][c]>=h.data[e][b]){h.trans[e][c]=h.data[e][c]/h.data[e][b]}else{h.trans[e][c]=h.data[e][b]/h.data[e][c]*-1}}}}}};this.transformRelative=function(l,d,e){var b=this.isGroupedData?this.data.w:this.data.y;var c=this.isGroupedData?false:true;d=d?d:this.zscoreAxis;if(d=="samples"){for(var g=0;g<b.data[e].length;g++){var h=[];for(var f=0;f<this.varIndices.length;f++){var k=this.varIndices[f];h.push(b.data[k][g])}if(l=="percentile"){var m=this.range(h,c)}else{if(l=="zscore"){var m=this.meanStandardDeviationN(h,c)}}for(var f=0;f<this.varIndices.length;f++){var k=this.varIndices[f];if(!b.trans[k]){b.trans[k]=[]}if(!isNaN(b.data[k][g])){if(l=="percentile"){b.trans[k][g]=this.percentile(m[0],m[1],b.data[k][g])}else{if(l=="zscore"){b.trans[k][g]=(b.data[k][g]-m[0])/m[1]}}}}}}else{for(var g=0;g<this.varIndices.length;g++){var n=this.varIndices[g];b.trans[n]=[];var h=b.data[n];if(l=="percentile"){var m=this.range(h,c)}else{if(l=="zscore"){var m=this.meanStandardDeviationN(h,c)}}for(var f=0;f<h.length;f++){if(!isNaN(b.data[n][f])){if(l=="percentile"){b.trans[n][f]=this.percentile(m[0],m[1],b.data[n][f])}else{if(l=="zscore"){b.trans[n][f]=(b.data[n][f]-m[0])/m[1]}}}}}}};this.getGroupingFactors=function(b){if(b){return this.groupingFactors}else{return this.getObjectArray(this.groupingFactors)}};this.modifyGroupingFactors=function(c,b){this.modifyObjectArray(c,b,"groupingFactors")};this.segregateSamplesVariables=function(k,h,f,l){delete (this.data.l);this.deleteSubGraphAttributes();this.data.l={};this.data.l.smps=k;this.data.l.vars=h;this.data.l.weight=[];this.data.l.type=[];this.data.l.name=[];this.data.l.desc=[];var g=1/k.length;var d=1/h.length;var e=this.data.y.desc[0]?this.data.y.desc[0]:"";for(var c=0;c<h.length;c++){for(var b=0;b<k.length;b++){this.data.l.weight.push([d,g]);this.data.l.type.push(this.graphType);this.data.l.name.push([l[c],f[b]]);this.data.l.desc.push(e)}}this.layoutComb=true;this.layout=k.length+"X"+h.length;this.isValidLayout()};this.desegregateSamples=function(){this.segregateSamplesBy=false;this.showAnimation=this.showAnimationTemp;this.resetLayout();if(this.segregateVariablesBy){this.segregateVariables(this.segregateVariablesBy)}else{this.isValidLayout()}};this.segregateSamples=function(j){if(this.data.x&&this.data.x[j]){delete (this.layoutParams);var c={};var h=0;var f=[];var g=[];for(var d=0;d<this.data.x[j].length;d++){var e=this.data.x[j][d];if(!c.hasOwnProperty(e)){c[e]=[];h++}c[e].push(this.data.y.smps[d])}var b=1/h;if(this.segregateVariablesBy){vars=this.data.l.vars;for(var e in c){f.push(e);g.push(c[e])}this.segregateSamplesBy=j;this.segregateSamplesVariables(g,this.data.l.vars,f,this.data.l.name)}else{delete (this.data.l);this.deleteSubGraphAttributes();this.data.l={};this.data.l.smps=[];this.data.l.weight=[];this.data.l.type=[];this.data.l.name=[];this.data.l.desc=[];for(var e in c){this.data.l.smps.push(c[e]);this.data.l.weight.push(b);this.data.l.type.push(this.graphType);this.data.l.name.push(e);this.data.l.desc.push(this.data.y.desc&&this.data.y.desc[0]?this.data.y.desc[0]:"")}this.segregateSamplesBy=j;this.layoutComb=true;this.showAnimationTemp=this.showAnimation;this.showAnimation=false;this.layout="1X"+this.data.l.smps.length;this.isValidLayout()}}};this.desegregateVariables=function(){this.segregateVariablesBy=false;this.showAnimation=this.showAnimationTemp;this.resetLayout();if(this.segregateSamplesBy){this.segregateSamples(this.segregateSamplesBy)}else{this.isValidLayout()}};this.segregateVariables=function(b){if(this.data.z&&this.data.z[b]){delete (this.layoutParams);var d={};var k=0;var j=[];var h=[];for(var e=0;e<this.data.z[b].length;e++){var f=this.data.z[b][e];if(!d.hasOwnProperty(f)){d[f]=[];k++}d[f].push(this.data.y.vars[e])}var c=1/k;if(this.segregateSamplesBy){for(var f in d){h.push(f);j.push(d[f])}this.segregateVariablesBy=b;this.segregateSamplesVariables(this.data.l.smps,j,this.data.l.name,h)}else{delete (this.data.l);this.deleteSubGraphAttributes();this.data.l={};this.data.l.vars=[];this.data.l.weight=[];this.data.l.type=[];this.data.l.name=[];this.data.l.desc=[];for(var f in d){this.data.l.vars.push(d[f]);this.data.l.weight.push(c);this.data.l.type.push(this.graphType);this.data.l.name.push(f);this.data.l.desc.push(this.data.y.desc&&this.data.y.desc[0]?this.data.y.desc[0]:"")}this.segregateVariablesBy=b;this.layoutComb=true;this.showAnimationTemp=this.showAnimation;this.showAnimation=false;this.layout="1X"+this.data.l.vars.length;this.isValidLayout()}}};this.deleteSubGraphAttributes=function(){if(this.layoutRows&&this.layoutCols){var e=0;for(var d=0;d<this.layoutRows;d++){for(var b=0;b<this.layoutCols;b++){delete (this["subGraphWeight"+e]);delete (this["subGraphType"+e]);delete (this["subGraphSummaryType"+e]);delete (this["subGraphTransformType"+e]);e++}}}};this.unsetAllVsAll=function(){if(this.graphType.match(/Scatter/)){this.xAxis=this.xAxisTemp;this.xAxisTmp=[];this.yAxis=this.yAxisTemp;this.yAxisTmp=[];this.zAxis=this.zAxisTemp;this.zAxisTmp=[];this.allVsAll=false;this.showAnimation=this.showAnimationTemp;this.resetLayout();this.isValidLayout()}};this.setAllVsAll=function(){if(this.graphType.match(/Scatter/)){var e=this.data.y.data[0].length;var b=1/e;this.xAxisTemp=this.xAxisTemp||this.xAxis;this.xAxis=[];this.yAxisTemp=this.yAxisTemp||this.yAxis;this.yAxis=[];this.zAxisTemp=this.zAxisTemp||this.zAxis;this.zAxis=[];this.data.l={};this.data.l.smps=[];this.data.l.weight=[];this.data.l.type=[];this.data.l.desc=[];for(var d=0;d<e;d++){for(var c=0;c<e;c++){this.data.l.weight.push(b);this.data.l.desc.push(this.data.y.desc[0]?this.data.y.desc[0]:"");this.data.l.type.push(this.graphType);if(d==c){this.data.l.smps.push({})}else{if(this.allVsAllType=="upper"){if(c>d){this.data.l.smps.push({xAxis:[this.data.y.smps[c]],yAxis:[this.data.y.smps[d]]})}else{this.data.l.smps.push({})}}else{if(this.allVsAllType=="lower"){if(d>c){this.data.l.smps.push({xAxis:[this.data.y.smps[c]],yAxis:[this.data.y.smps[d]]})}else{this.data.l.smps.push({})}}else{this.data.l.smps.push({xAxis:[this.data.y.smps[c]],yAxis:[this.data.y.smps[d]]})}}}}}this.layoutComb=true;this.showAnimationTemp=this.showAnimation;this.showAnimation=false;this.layout=e+"X"+e;this.isValidLayout()}};this.ungroupSamples=function(){this.isGroupedData=false;this.groupingFactors=[];this.grpIndices=[];this.hiddenGrps=[];this.setMaxSmpStringName();return};this.createHistogram=function(d){var n,k,h,p,q;var c=0;var o=[];var b=[];var m=[];var g={};g.y={};g.y.data=[];g.y.vars=[];g.y.smps=[];if(this.graphType.match(/Scatter/)){if(this.type2D=="XYZ"){n=d=="y"?this.yAxisIndices[this.yAxisCurrent]:this.xAxisIndices[this.xAxisCurrent];o.push(n)}else{if(this.type2D=="XY"){for(var f=0;f<this.xAxisIndices.length;f++){n=d=="y"?this.yAxisIndices[f]:this.xAxisIndices[f];o.push(n)}}else{if(this.type2D=="X"){if(d=="y"){o.push(this.yAxisIndices[this.yAxisCurrent])}else{for(var f=0;f<this.xAxisIndices.length;f++){o.push(this.xAxisIndices[f])}}}else{if(d=="y"){for(var f=0;f<this.yAxisIndices.length;f++){o.push(this.yAxisIndices[f])}}else{o.push(this.xAxisIndices[this.xAxisCurrent])}}}}for(var f=0;f<this.histogramBins;f++){g.y.vars.push("Bin"+(f+1));g.y.data[f]=[]}for(var f=0;f<o.length;f++){g.y.smps.push(this.data.y.smps[o[f]]);g.y.smps.push(this.data.y.smps[o[f]]+" counts");b.push(this.data.y.smps[o[f]]);m.push(this.data.y.smps[o[f]]+" counts");var l=[];for(var e=0;e<this.histogramBins;e++){l[e]=0}k=this.getDataForSmpGrpAtIndex(o[f]);h=this.range(k);p=((h[1]-h[0])/this.histogramBins)+(h[0]/(this.histogramBins*2));for(var e=0;e<k.length;e++){q=Math.floor((k[e]-h[0])/p);l[q]++}for(var e=0;e<this.histogramBins;e++){g.y.data[e][c]=p*(e+1)}c++;for(var e=0;e<this.histogramBins;e++){g.y.data[e][c]=l[e]}c++}this.isCreateHistogram=true;this.isHistogram=true;this.histogramBarWidthStndBy=this.histogramBarWidth;this.dataStndBy=this.data;this.data={};this.resetOptions(["graphType","isHistogram"]);this.xAxis=b;this.yAxis=m;this.showLegend=false;this.histogramBarWidth=1.5;this.initializeData(g)}};this.removeHistogram=function(){this.isCreateHistogram=false;this.histogramBarWidth=this.histogramBarWidthStndBy;this.switchData()};this.addRegressionLine=function(){var c,h,e,b,j,g,d;if(this.graphType.match(/Scatter/)){if(this.type2D=="XYZ"){c=this.xAxisIndices[this.xAxisCurrent];h=this.yAxisIndices[this.yAxisCurrent];g=this.data.y.smps[c]+" vs "+this.data.y.smps[h];e=this.getDataForSmpGrpAtIndex(c);b=this.getDataForSmpGrpAtIndex(h);j=this.regression(e,b);this.addRegressionDecoration(j,g,this.foreground)}else{if(this.type2D=="XY"){for(var f=0;f<this.xAxisIndices.length;f++){d=f%this.colors.length;c=this.xAxisIndices[f];h=this.yAxisIndices[f];g=this.data.y.smps[c]+" vs "+this.data.y.smps[h];e=this.getDataForSmpGrpAtIndex(c);b=this.getDataForSmpGrpAtIndex(h);j=this.regression(e,b);this.addRegressionDecoration(j,g,this.colors[d])}}else{if(this.type2D=="X"){h=this.yAxisIndices[this.yAxisCurrent];b=this.getDataForSmpGrpAtIndex(h);for(var f=0;f<this.xAxisIndices.length;f++){d=f%this.colors.length;c=this.xAxisIndices[f];g=this.data.y.smps[c]+" vs "+this.data.y.smps[h];e=this.getDataForSmpGrpAtIndex(c);j=this.regression(e,b);this.addRegressionDecoration(j,g,this.colors[d])}}else{c=this.xAxisIndices[this.xAxisCurrent];e=this.getDataForSmpGrpAtIndex(c);for(var f=0;f<this.yAxisIndices.length;f++){d=f%this.colors.length;h=this.yAxisIndices[f];b=this.getDataForSmpGrpAtIndex(h);g=this.data.y.smps[c]+" vs "+this.data.y.smps[h];j=this.regression(e,b);this.addRegressionDecoration(j,g,this.colors[d])}}}}}};this.addRegressionDecoration=function(d,c,b){this.showDecorations=true;if(!this.data.d){this.data.d={}}if(!this.data.d.reg){this.data.d.reg=[]}this.data.d.reg.push({slope:d[0],intercept:d[1],cor:d[2],label:c,color:b})};this.addNormalDistributionLine=function(c){var o,g,m,h,j,k,l,f,d,f,b,n;if(this.graphType.match(/Scatter/)){if(this.type2D=="XYZ"){m=c=="y"?this.yAxisIndices[this.yAxisCurrent]:this.xAxisIndices[this.xAxisCurrent];h=c=="y"?this.xAxisIndices[this.xAxisCurrent]:this.yAxisIndices[this.yAxisCurrent];j=this.getDataForSmpGrpAtIndex(m);k=this.getDataForSmpGrpAtIndex(h);l=this.max(k);f=this.data.y.smps[m];d=this.meanStandardDeviationN(j);this.addNormalDistributionDecoration(d,l,f,this.foreground,c)}else{o=c=="y"?this.yAxisIndices:this.xAxisIndices;g=c=="y"?this.xAxisIndices:this.yAxisIndices;n=c=="y"?this.xAxisCurrent:this.yAxisCurrent;for(var e=0;e<o.length;e++){b=e%this.colors.length;m=o[e];h=g[e]?g[e]:g[n];j=this.getDataForSmpGrpAtIndex(m);k=this.getDataForSmpGrpAtIndex(h);l=this.max(k);f=this.data.y.smps[m];d=this.meanStandardDeviationN(j);this.addNormalDistributionDecoration(d,l,f,this.colors[b],c)}}}};this.addNormalDistributionDecoration=function(f,b,d,c,e){this.showDecorations=true;if(!this.data.d){this.data.d={}}if(!this.data.d.nor){this.data.d.nor=[]}if(e&&e=="y"){this.data.d.nor.push({mu:f[0],sigma:f[1],yAxis:true,max:b,label:d,color:c})}else{this.data.d.nor.push({mu:f[0],sigma:f[1],max:b,label:d,color:c})}};this.createRandomData=function(){var e={};e.y={};e.y.data=[];e.y.vars=[];e.y.smps=[];for(var c=0;c<this.randomDataSamples;c++){e.y.smps[c]="Sample"+(c+1)}for(var c=0;c<this.randomDataVariables;c++){e.y.data[c]=[];e.y.vars[c]="Variable"+(c+1);for(var b=0;b<this.randomDataSamples;b++){e.y.data[c].push(Math.floor(((Math.random()*2-1)+(Math.random()*2-1)+(Math.random()*2-1))*this.randomDataSigma+this.randomDataMean))}}e.x={};var d=Math.floor(this.randomDataSamples/this.randomDataSampleAnnotationRatio);for(var c=0;c<this.randomDataSampleAnnotations;c++){e.x["Factor"+(c+1)]=[];for(var b=0;b<this.randomDataSamples;b++){e.x["Factor"+(c+1)][b]="Level"+(Math.floor(Math.random()*d)+1)}}e.z={};var d=Math.floor(this.randomDataVariables/this.randomDataVariableAnnotationRatio);for(var c=0;c<this.randomDataVariableAnnotations;c++){e.z["Annt"+(c+1)]=[];for(var b=0;b<this.randomDataVariables;b++){e.z["Annt"+(c+1)][b]="Desc"+(Math.floor(Math.random()*d)+1)}}if(this.data&&!this.dataStndBy){this.dataStndBy=this.data;this.data={}}this.resetOptions(["graphType"]);this.initializeData(e)};this.restoreRandomData=function(){this.switchData()};this.groupSamples=function(e,p){if(e.length<1){return this.ungroupSamples()}for(var h=0;h<e.length;h++){if(!e||!this.data.x[e[h]]){return this.ungroupSamples()}}if(this.layoutComb&&this.data.l.comp){this.varIndices=[];for(var h=0;h<this.data.l.comp.length;h++){for(var g=0;g<this.data.l.comp[h].length;g++){this.varIndices.push(this.data.l.comp[h][g])}}}this.resetIndices();this.isGroupedData=true;this.groupingFactors=e;this.resetObject(true);this.hiddenGrps=[];var v={};var b=[];var d=0;for(var h=0;h<this.smpIndices.length;h++){var r=this.smpIndices[h];var u=[];var q;for(var g=0;g<e.length;g++){var l=e[g];q=this.data.x[l][r];if(!q){q="NA"}u.push(q)}q=u.join(" - ");if(!v.hasOwnProperty(q)){this.data.w.smps.push(q);b[d]=q;v[q]=[];v[q].push(r);d++}else{v[q].push(r)}}for(var h=0;h<b.length;h++){var q=b[h];this.data.w.grps.push(v[q])}this.grpIndices=[];for(var h=0;h<this.data.w.grps.length;h++){this.grpIndices.push(h);this.hiddenGrps.push(false)}for(var h=0;h<this.varIndices.length;h++){this.data.w.vars.push(this.data.y.vars[this.varIndices[h]])}var m=[];if(p){if(this.isArray(p)){m=p}else{m.push(p)}}else{p=this.graphType=="Boxplot"?"iqr":"mean";m.push(p)}for(var s=0;s<m.length;s++){var o=[];var n=m[s];if(this.isTransformedData){a=this.data.y.trans}else{if(this.isRawData){a=this.data.y.data}else{if(this.summaryType=="median"||this.summaryType=="iqr"){a=this.data.y.median}else{if(this.summaryType=="mean"){a=this.data.y.mean}else{if(this.summaryType=="cor"){a=this.data.y.cor}else{if(this.summaryType=="sum"){a=this.data.y.sum}else{a=this.data.y[this.summaryType]}}}}}}for(var h=0;h<this.varIndices.length;h++){var r=this.varIndices[h];o[r]=[];for(var g=0;g<this.data.w.grps.length;g++){o[r][g]=[];for(var f=0;f<this.data.w.grps[g].length;f++){var c=this.data.w.grps[g][f];o[r][g].push(a[r][c])}}}this.summarize(n,o)}this.setMaxVarStringName();this.setMaxSmpStringName();this.xAxisValues=[];this.xAxis2Values=[];this.yAxisValues=[];this.zAxisValues=[];if(!this.layoutComb||!this.layoutAdjust){if(typeof(this.setAxes)=="function"){this.setAxes()}}};this.initializeDataAttributes=function(){this.setIndices();if(this.graphType!="Network"&&this.graphType!="Genome"&&this.graphType!="Venn"){this.setMaxVarStringAttr();this.setMaxSmpStringAttr()}};this.initializeData=function(b){if(a&&!b){this.isExample=false;this.data=a;delete a}else{if(b){this.isExample=false;this.data=b;delete b}else{this.isExample=true;this.data=this.exampleRawData}}this.validGraphTypes=[];if(this.data.y||this.data.venn||this.data.nodes||this.data.tracks||this.data.market){if(this.data.market){this.setMarketData();this.summaryType="candle";this.validGraphTypes.push("Candlestick")}if(this.data.venn){this.summaryType="venn";this.validGraphTypes.push("Venn")}if(this.data.nodes){this.summaryType="network";this.validGraphTypes.push("Network")}if(this.data.tracks){this.summaryType="genome";this.validGraphTypes.push("Genome")}if(this.data.y){if(!this.data.y.data&&!this.data.y.mean&&!this.data.y.median&&!this.data.y.cor&&!this.data.y.sum&&!this.data.y.close){alert("Dude! there is not a valid data structure");return}else{if(this.data.y.data){this.isRawData=true;this.summaryType="raw"}else{this.isRawData=false;if(this.data.y.iqr1&&this.data.y.qtl1&&this.data.y.median&&this.data.y.qtl3&&this.data.y.iqr3){this.summaryType="iqr"}else{if(this.data.y.median){this.summaryType="median"}else{if(this.data.y.mean){this.summaryType="mean"}else{if(this.data.y.cor){this.summaryType="cor"}else{if(this.data.y.sum){this.summaryType="sum"}}}}}}}this.validGraphTypes.push("Bar");this.validGraphTypes.push("Line");this.validGraphTypes.push("Area");this.validGraphTypes.push("BarLine");this.validGraphTypes.push("Boxplot");this.validGraphTypes.push("Dotplot");this.validGraphTypes.push("Heatmap");this.validGraphTypes.push("Stacked");this.validGraphTypes.push("StackedPercent");this.validGraphTypes.push("Pie");this.validGraphTypes.push("Correlation");if(this.data.y.smps){if(this.data.y.smps.length>2){this.validGraphTypes.push("Scatter2D");this.validGraphTypes.push("ScatterBubble2D");this.validGraphTypes.push("Scatter3D")}else{if(this.data.y.smps.length>1){this.validGraphTypes.push("Scatter2D")}}}}this.validGraphTypes.sort()}this.initializeDataAttributes()};this.setMarketData=function(){if(this.data.market&&!this.isMarketDataFormated){var c=this.data.market;this.data.market={};this.data.market.smps=[];this.data.market.vars=[];this.data.market.close=[];this.data.market.open=[];this.data.market.high=[];this.data.market.low=[];this.data.market.volume=[];this.data.market.desc=["Price","Vol"];var k={};var g=0;for(var f=0;f<c.length;f++){this.data.market.vars.push(c[f].symbol);this.data.market.close[f]=[];this.data.market.open[f]=[];this.data.market.high[f]=[];this.data.market.low[f]=[];this.data.market.volume[f]=[];var h=c[f].data;for(var e=0;e<h.length;e++){var l=this.parseDate(h[e][0]);var b=0;if(!k.hasOwnProperty(l)){b=g;k[l]=g;this.data.market.smps.push(l);g++}else{b=k[l]}this.data.market.open[f][b]=h[e][1];this.data.market.high[f][b]=h[e][2];this.data.market.low[f][b]=h[e][3];this.data.market.close[f][b]=h[e][4];this.data.market.volume[f][b]=h[e][5]}}}this.isMarketDataFormated=true};this.switchToMarketData=function(){var b=this.data.market;this.dataStndBy=this.data;this.data={};this.data.y=b;this.initializeDataAttributes();if(this.showVolume){this.deleteSubGraphAttributes();this.data.l={};this.data.l.vars=[this.data.y.vars,this.data.y.vars];this.data.l.weight=this.graphOrientation=="vertical"?[0.75,0.25]:[0.25,0.75];this.data.l.type=["Candlestick","Candlestick"];this.data.l.name=this.graphOrientation=="vertical"?["Price","Volume"]:["Volume","Price"];this.data.l.desc=this.graphOrientation=="vertical"?["Price","Volume"]:["Volume","Price"];this.segregateSamplesBy=false;this.segregateVariablesBy=false;this.layoutComb=true;this.layout="1X2";this.isValidLayout()}};this.switchFromMarketData=function(){this.switchData();if(this.showVolume){this.resetLayout();this.isValidLayout()}};this.switchData=function(){if(this.dataStndBy){this.initConfigurations();this.data=this.dataStndBy;this.initializeData(this.data)}};this.initializeData()};CanvasXpress.prototype.initGraph=function(){this.draw=function(b,c,a){this.hideResizer();this.resetUserEvents();this.initializeGraph(true,b,c,a)};this.save=function(){return this.data};this.setGraphType=function(b){var a;if(b==66){a="Bar"}else{if(b==76){a="Line"}else{if(b==65){a="Area"}else{if(b==67){a="BarLine"}else{if(b==73){a="Boxplot"}else{if(b==68){a="Dotplot"}else{if(b==72){a="Heatmap"}else{if(b==83){a="Stacked"}else{if(b==84){a="StackedPercent"}else{if(b==50){a="Scatter2D"}else{if(b==52){a="ScatterBubble2D"}else{if(b==51){a="Scatter3D"}else{if(b==88){a="Correlation"}else{if(b==86){a="Venn"}else{if(b==80){a="Pie"}else{if(b==78){a="Network"}else{if(b==71){a="Genome"}else{if(b==77){a="Candlestick"}}}}}}}}}}}}}}}}}}if(a&&this.isValidGraphType(a)){this.graphType=a;this.draw()}else{alert("Dude! You cannot plot this data in a "+a+" graph")}};this.isValidGraphType=function(a){switch(a){case"Bar":case"Line":case"Area":case"Dotplot":case"Heatmap":case"Stacked":case"StackedPercent":case"Boxplot":case"Correlation":case"Pie":if(this.data.y){return true}else{return false}case"BarLine":if(this.data.y&&this.data.a&&this.data.a.xAxis&&this.data.a.xAxis2){return true}else{return false}case"Scatter2D":if(this.data.y&&this.data.y.smps&&this.data.y.smps.length>1){return true}else{return false}case"ScatterBubble2D":case"Scatter3D":if(this.data.y&&this.data.y.smps&&this.data.y.smps.length>2){return true}else{return false}case"Candlestick":if(this.data.market){return true}else{return false}case"Venn":if(this.data.venn){return true}else{return false}case"Network":if(this.data.nodes){return true}else{return false}case"Genome":if(this.data.tracks){return true}else{return false}}return false};this.reinitializeGraph=function(){if(this.graphType=="Candlestick"){this.isGraphTime=true;if(!this.isMarketSwitched){this.switchToMarketData();this.initAxes();this.summaryType="candle";this.initializeDataAttributes();this.isMarketSwitched=true}}else{if(this.isExample&&this.isMarketSwitched){this.switchFromMarketData();this.isMarketSwitched=false;this.summaryType=this.data.y.data?"raw":"mean";this.initializeDataAttributes();this.isGraphTime=false;if(this.showVolume){this.layoutComb=false}}else{if(this.graphType.match(/Scatter/)&&this.allVsAll){this.setAllVsAll()}}}};this.initializeGraph=function(d,c,a,b){this.reinitializeGraph();if((!this.layoutComb||!this.layoutAdjust)&&!b){if(this.graphType!="Candlestick"){this.initAxes(d)}}if(d){this.resizeCanvas(true,c,a)}else{this.resizeCanvas(false,c,a)}if(this.isIE){this.showShadow=false}if(this.isValidAnimation()&&this.showAnimation&&!this.isAnimation){this.createAnimation(this.animationType)}else{switch(this.graphType){case"Bar":case"Line":case"Area":case"BarLine":case"Dotplot":case"Heatmap":case"Stacked":case"StackedPercent":case"Candlestick":if(this.isBoxPlotCalc&&this.isGroupedData){this.groupSamples(this.getGroupingFactors(true))}this.oneDPlot();break;case"Boxplot":if(!this.isBoxPlotCalc&&this.isGroupedData){this.groupSamples(this.getGroupingFactors(true))}this.oneDPlot();break;case"Scatter2D":case"ScatterBubble2D":this.Scatter2D();break;case"Scatter3D":this.Scatter3D();break;case"Correlation":this.Correlation();break;case"Venn":this.Venn();break;case"Pie":this.Pie();break;case"Network":this.Network();break;case"Genome":this.Genome();break}this.resizeImage()}};this.initializeGraph()};CanvasXpress.prototype.initAxes=function(b,a){this.getValidAxes=function(c){var d=[];if(this.graphType=="Scatter2D"){d.push("xAxis");d.push("yAxis")}else{if(this.graphType=="ScatterBubble2D"||this.graphType=="Scatter3D"){d.push("xAxis");d.push("yAxis");d.push("zAxis")}else{if(this.graphType.match(/Network|Genome|Correlation|Venn|Heatmap|Pie/)){if(c){d.push("xAxis")}else{return false}}else{if(this.graphType=="BarLine"||this.graphType=="Candlestick"){d.push("xAxis");d.push("xAxis2")}else{d.push("xAxis")}}}}return d};this.addRemoveSamplesInAxis=function(e,d,c){if(this.graphType=="Scatter2D"||this.graphType=="ScatterBubble2D"){if(c){return this.removeSamplesFromAxis(e,d)}else{return this.addSamplesToAxis(e,d)}}else{if(this.graphType=="Scatter3D"||this.graphType=="Pie"){return this.switchSampleInAxis(e,d)}}};this.addSamplesToAxis=function(e,d){if(this[d]){if(this.isArray(e)){for(var c=0;c<e.length;c++){this[d].push(e[c])}}else{this[d].push(e)}return false}else{return"Not a valid axis"}};this.removeSamplesFromAxis=function(g,f){if(this[f]){if(this[f].length>1){var d={};var c=[];if(this.isArray(g)){for(var e=0;e<g.length;e++){d[g[e]]=1}}else{d[g]=1}for(var e=0;e<this[f].length;e++){if(!d.hasOwnProperty(this[f][e])){c.push(this[f][e])}}this[f]=c;return false}else{return f+" cannot be null"}}else{return"Not a valid axis"}};this.switchSampleInAxis=function(d,c){if(this[c]){this[c][0]=d;return false}else{return"Not a valid axis"}};this.addRemoveVariablesInAxis=function(e,d,c){if(c){return this.removeVariablesFromAxis(e,d)}else{return this.addVariablesToAxis(e,d)}};this.addVariablesToAxis=function(e,d){if(!this.data.a){this.data.a={}}if(!this.data.a[d]){this.data.a[d]=[]}if(this.isArray(e)){for(var c=0;c<e.length;c++){this.data.a[d].push(e[c])}}else{this.data.a[d].push(e)}this.resetVariablesVisibleByAxis(d);return false};this.removeVariablesFromAxis=function(g,f){if(this.data.a&&this.data.a[f]){var d={};var c=[];if(this.isArray(g)){for(var e=0;e<g.length;e++){d[g[e]]=1}}else{d[g]=1}for(var e=0;e<this.data.a[f].length;e++){if(!d.hasOwnProperty(this.data.a[f][e])){c.push(this.data.a[f][e])}}this.data.a[f]=c}this.resetVariablesVisibleByAxis(f);return false};this.getAxisRangeBySample=function(c){var g=[];if(this.isArray(c)){for(var e=0;e<this.varIndices.length;e++){var f=this.varIndices[e];for(var d=0;d<c.length;d++){g.push(this.getDataAtPos(f,d))}}}else{for(var e=0;e<this.varIndices.length;e++){var f=this.varIndices[e];g.push(this.getDataAtPos(f,c))}}return this.range(g)};this.getAxisIncrements=function(g,m,n,j){var l=j?0:(m-g)*this.axisExtension;var c=m==g?g-(g*this.axisExtension):g-l;var h=m==g?m+(m*this.axisExtension):m+l;var i=h-c;var e=i/n;if(j){return e}var k;if(e.toString().match(/e\+/)){k=parseInt(e.toString().match(/e\+(\d+)/)[1])}else{if(i>=1){k=parseInt(e).toString().length-1}else{k=parseInt((Math.log(e)/Math.LN10)+1)}}e=Math.pow(10,k)/2;var f=0;while(f*n<i){f+=e}if(g>=0&&g-f<0){return f}else{var d=this.getAxisMin(g,1,f);if(d+(f*n)<m){return f+e}else{return f}}};this.getAxisMin=function(c,g,f){var h=c<0?-1:1;var c=Math.abs(c);var e=Math.pow(10,g);c=h<0?c+f:c-f;c=parseInt(c*e)/e;return c*h};this.getAxisDecimals=function(c){var d=(c-parseInt(c)).toString().replace(/\./,"").length-1;return d};this.setAxis=function(c){var d=this.isGroupedData?this.data.w:this.data.y;if(this[c].length==0){if(c=="xAxis"){this[c].push(d.smps[this.smpIndices[0]])}else{if(c=="yAxis"){if(d.smps.length>1){this[c].push(d.smps[this.smpIndices[1]])}else{this[c].push(d.smps[this.smpIndices[0]])}}else{if(c=="zAxis"){if(d.smps.length>2){this[c].push(d.smps[this.smpIndices[2]])}else{if(d.smps.length>1){this[c].push(d.smps[this.smpIndices[1]])}else{this[c].push(d.smps[this.smpIndices[0]])}}}}}}else{if(this.graphType=="Scatter3D"&&this[c].length>1){this[c]=[this[c][0]]}}};this.setAxisValues=function(g){var e,o,h,r,n;var c={};var p=g+"Values";var m=g+"Ticks";var d=g+"Incr";var l=g+"Decs";var j=g+"Min";var f=g+"Transform";if(this[f]=="percentile"){this[l]=0;this[p]=[];var q=[0,25,50,75,100];for(var k=0;k<q.length;k++){e=this.formatNumber(q[k]);if(c.hasOwnProperty(e)){n=true}else{c[e]=1}this[p].push(e)}}else{if(this[p].length==0||b){if(b){this[p]=[]}e=this[j];for(var k=1;k<this[m];k++){e+=this[d];if(this[l]==0&&e.toString().match(/\.5$/)){this[l]=1}o=this.formatNumber(sprintf("%."+this[l]+"f",e));if(c.hasOwnProperty(o)){n=true}else{c[o]=1}this[p].push(o)}}else{h=this[p];this[p]=[];for(var k=0;k<h.length;k++){e=h[k];r=parseFloat(e);o=this.formatNumber(sprintf("%."+this[l]+"f",r));if(c.hasOwnProperty(o)){n=true}else{c[o]=1}this[p].push(o)}}}if(n){this[l]++;this[p]=[];this.setAxisValues(g)}};this.setAxisAttributes=function(h,o,r,e,n){var q=e&&e.match(/log/)?true:false;var l=h+"Ticks";var d=h+"Incr";var g=h+"Exact";var c=h+"AbsMin";var k=h+"AbsMax";var i=h+"Min";var p=h+"Max";var m=h+"Range";var j=h+"Decs";var f=h+"Transform";this.setRangeData(o,r,q,n);if(e){if(e=="log2"){this.minData=Math.log(this.minData)/Math.LN2;this.maxData=Math.log(this.maxData)/Math.LN2}else{if(e=="log10"){this.minData=Math.log(this.minData)/Math.LN10;this.maxData=Math.log(this.maxData)/Math.LN10}else{if(e=="exp2"){this.minData=Math.pow(2,this.minData);this.maxData=Math.pow(2,this.maxData)}else{if(e=="exp10"){this.minData=Math.pow(10,this.minData);this.maxData=Math.pow(10,this.maxData)}else{if(e=="percentile"){this.minData=-12.5;this.maxData=112.5}}}}}}this[c]=!this.setMin?this.minData:this[c];this[k]=!this.setMax?this.maxData:this[k];this[d]=this.getAxisIncrements(this.minData,this.maxData,this[l],this[g]);this[j]=this.getAxisDecimals(this[d]);if(n){this[i]=0;if(this.graphType.match(/Percent/)){this[p]=100}else{this[p]=this[i]+(this[d]*this[l])}}else{if(this[g]||(e&&e=="percentile")){this[i]=this.minData;this[p]=this.maxData}else{this[i]=this.minData>=0&&(this.minData-this[d])<0?0:this.getAxisMin(this.minData,this[j],this[d]);this[p]=this[i]+(this[d]*this[l])}}this[m]=this[p]-this[i];this.setAxisValues(h)};this.setAxes=function(){if(this.graphType.match(/Correlation/)){var e=this.isGroupedData?this.data.w:this.data.y;this.setMin=false;this.setMax=false;if(this.correlationAnchorLegend){this.setAxisAttributes("xAxis")}if(!e.cor||e.cor.length==0){this.summarize("cor");this.setRangeData("cor")}if(!this.yAxisTitle){this.yAxisTitle="Correaltion"}}else{if(this.graphType.match(/Scatter|Pie/)){var s=this.smpIndices;var o=["xAxis"];var c=["X"];this.setMin=false;this.setMax=false;if(this.graphType.match(/Scatter/)){o.push("yAxis");c.push("Y")}if(this.graphType.match(/ScatterBubble2D|Scatter3D/)){o.push("zAxis");c.push("Z")}if(this.graphType=="Scatter3D"){this.xAxisTicks=7;this.yAxisTicks=7;this.zAxisTicks=7}for(var j=0;j<o.length;j++){var k=o[j]+"Indices";var h="setMin"+c[j];var q="setMax"+c[j];this.setAxis(o[j]);this[k]=this.getSampleIndices(this[o[j]]);this.setSamplesVisible(this[k]);if(this[h]){this.setMin=this[h]}if(this[q]){this.setMax=this[q]}this.setAxisAttributes(o[j],false,false,this[o[j]+"Transform"]);this.setSamplesVisible(s)}if(!this.xAxisTitle){this.xAxisTitle=this.xAxis.length==1?this.xAxis[0]:" "}if(!this.yAxisTitle){this.yAxisTitle=this.yAxis.length==1?this.yAxis[0]:" "}if(!this.zAxisTitle){this.zAxisTitle=this.zAxis.length==1?this.zAxis[0]:" "}}else{if(this.graphType.match(/Genome/)){if(!this.setMin||!this.setMax){this.setRangeData("genome")}this.xAxisExact=true;this.xAxisTransform=false;this.xAxisMin=this.setMin?this.setMin:this.minData;this.xAxisMax=this.setMax?this.setMax:this.maxData;this.xAxisDecs=0;this.xAxisRange=this.xAxisMax-this.xAxisMin;this.xAxisTicks=this.ticks;this.xAxisIncr=this.xAxisRange/this.xAxisTicks;this.setAxisValues("xAxis")}else{var n=this.smpIndices;var d=this.varIndices;var g=this.grpIndices;var l=this.varIndices;var r=this.graphType=="Dotplot"&&this.isGroupedData?true:false;var f=this.graphType.match(/Percent/)?"percentile":false;var m=this.graphType.match(/Stacked|Area/)?true:false;var p=this.graphType=="Candlestick"?"candle":f?f:false;if(this.graphType=="Heatmap"){this.setMin=false;this.setMax=false;this.graphOrientation="horizontal";if(this.varIndicesStart>-1||this.smpIndicesStart>-1){this.setAllVariablesVisible();this.setAllSamplesVisible()}}else{if(this.graphType=="StackedPercent"){this.setMin=false;this.setMax=false;this.axisExact=true;this.xAxisExact=true}else{if(this.graphType=="Boxplot"&&!this.isGroupedData){if(!this.data.y.median){this.summarize("iqr")}}}}if(this.graphType=="BarLine"&&this.data.a){this.setVariablesVisible(this.getVariablesVisibleByAxis("xAxis"))}this.setAxisAttributes("xAxis",p,r,f,m);this["xAxisTitle"]=!this["xAxisTitle"]&&this.data.y.desc?this.data.y.desc[0]:"";if((this.graphType=="BarLine"&&this.data.a)||(this.graphType=="Candlestick"&&this.showVolume)){p=this.graphType=="Candlestick"?"volume":false;if(this.graphType=="BarLine"){this.setVariablesVisible(l);this.setVariablesVisible(this.getVariablesVisibleByAxis("xAxis2"))}var q=this.setMax?this.setMax:null;var h=this.setMin?this.setMin:null;this.setMax=this.setMax2?this.setMax2:null;this.setMin=this.setMin2?this.setMin2:null;this.setAxisAttributes("xAxis2",p,r,f,m);this["xAxis2Title"]=!this["xAxis2Title"]&&this.data.y.desc?this.data.y.desc[1]:"";this.setMax=q?q:null;this.setMin=h?h:null}this.setVariablesVisible(l);this.smpIndices=n;this.varIndices=d;this.grpIndices=g}}}};this.setScatterPointSize=function(){this.scatterPointSize=this.varIndices.length>50?this.sizes[1]:this.varIndices.length>20?this.sizes[2]:this.sizes[3];if(this.layoutComb){this.scatterPointSize=Math.ceil(this.scatterPointSize/this.layoutRows)}};this.setAxisUnits=function(h,j){var i=h+"Unit";var f=h+"Range";var g=h+"Min";var c=h+"Max";var e=h+"Exact";var d=j?j:h.substring(0,1);this[i]=this[d]/this[f]};this.setAxisFont=function(h,g){var f=this.graphType=="Venn"?16:12;if(this.autoScaleFont||!this.axisTickFont||!this.decorationFont||!this.axisTitleFont){var c,e,d;if(g>=600){c=12*this.scaleTickFontFactor;d=10*this.scaleDecorationFontFactor;e=this.getFontPt(this.scaleTextToFont(h,f,g-2))*this.scaleTitleFontFactor}else{if(g>=400){c=10*this.scaleTickFontFactor;d=8*this.scaleDecorationFontFactor;e=this.getFontPt(this.scaleTextToFont(h,f,g-2))*this.scaleTitleFontFactor}else{if(g>=200){c=8*this.scaleTickFontFactor;d=6*this.scaleDecorationFontFactor;e=8*this.scaleTitleFontFactor}else{c=6*this.scaleTickFontFactor;d=4*this.scaleDecorationFontFactor;e=6*this.scaleTitleFontFactor}}}this.axisTickFont=(parseInt(c))+"Pt "+this.fontName;this.decorationFont=(parseInt(d))+"Pt "+this.fontName;this.axisTitleFont=(parseInt(e))+"Pt "+this.fontName}else{this.axisTickFont=parseInt(this.axisTickFontSize)+"Pt "+this.fontName;this.decorationFont=parseInt(this.decorationFontSize)+"Pt "+this.fontName;this.axisTitleFont=parseInt(this.axisTitleFontSize)+"Pt "+this.fontName}};this.getAxisFont=function(c){if(c>=600){return 12}else{if(c>=400){return 10}else{if(c>=200){return 8}else{return 6}}}};this.setHeatmapColors=function(d){this.setRGB();var f=d?d:this.maxData-this.minData;var c=this.heatmapType.split("-");var e=c[0];var j=256/this.indicatorBins;var h=e=="green"?this.greens:e=="red"?this.reds:this.blues;this.heatmapColors=[];this.heatmapBin=f/this.indicatorBins;if(c.length>1){for(var g=0;g<j;g++){this.heatmapColors.push(h[g])}if(this.indicatorCenter=="black"){this.heatmapColors.push("rgb(0,0,0)")}else{this.heatmapColors.push("rgb(255,255,255)")}e=c[1];h=e=="green"?this.greens:e=="red"?this.reds:this.blues;for(var g=j-1;g>=0;g--){this.heatmapColors.push(h[g])}}else{if(this.indicatorCenter=="black"){this.heatmapColors.push("rgb(0,0,0)")}else{this.heatmapColors.push("rgb(255,255,255)")}for(var g=j-1;g>=0;g--){this.heatmapColors.push(h[g])}}};this.initializeAxis=function(){if(!this.graphType.match(/Venn|Network/)){if(!a){this.setAxes();this.setHeatmapColors()}}};this.initializeAxis()};CanvasXpress.prototype.Pie=function(){this.setVarPie=function(){this.varPie={no:0,idso:[],ids:[],data:{},oprc:0,tot:0};var b=this.xAxisIndices[0];if(this.varIndices.length>=this.maxPieSectors-1){var a=this;this.varIndices.sort(function(h,g){return a.data.y.data[g][b]-a.data.y.data[h][b]})}for(var d=0;d<this.varIndices.length;d++){var e=this.varIndices[d];this.varPie.tot+=this.getDataAtPos(e,b)}for(var d=0;d<this.varIndices.length;d++){var e=this.varIndices[d];var f=this.getDataAtPos(e,b);var c=f/this.varPie.tot;this.varPie.data[e]=c;if(d>=this.maxPieSectors-1){this.varPie.oprc+=c;this.varPie.idso.push(e);this.varPie.no++}else{this.varPie.ids.push(e)}}if(this.varPie.no){this.varPie.ids.push(-1)}};this.getPieLegendDimensions=function(){this.setLegendFont();this.setVarPie();var e=this.getFontPt(this.legendFont);var d=this.shortenText(this.maxVarNameStr,this.maxVarStringLen);var b=this.measureText(d,this.legendFont);if(!this.autoExtend){if(b>this.width/2){this.legendFont=this.scaleTextToFont(b,e,this.width/2)}}var c=e+this.measureText(d,this.legendFont)+(this.margin*5);var f=this.varIndices.length>this.maxPieSectors?this.maxPieSectors:this.varIndices.length;var a=(f*(e+this.margin))+(this.margin*3);return([c,a])};this.setPieXYDimensions=function(){var a=this.getPieLegendDimensions();if(this.autoExtend){if(this.showLegend){this.right=a[0]}if((a[0]+this.left+this.right)>this.width&&this.showLegend){this.x=a[0];this.width=this.left+this.x+this.right}else{this.x=this.width-(this.left+this.right)}if((a[1]+this.top+this.bottom)>this.height&&this.showLegend){this.y=a[1];this.height=this.top+this.y+this.bottom}else{this.y=this.height-(this.top+this.bottom)}this.resizeCanvas()}else{if(this.showLegend){this.right=a[0]}this.x=this.width-(this.left+this.right);this.y=this.height-(this.top+this.bottom)}this.setAxisFont("Pie",this.x)};this.drawPieDataPoints=function(){var n=Math.min(this.x,this.y);var w=(n-(n/5))/2;var m=this.pieSegmentLabels=="inside"?w-(w/3):w+(w/10);var q=this.left+(this.x/2);var a=this.top+(this.y/2);var c=0;var r=this.xAxisIndices[0];for(var t=0;t<this.varPie.ids.length;t++){var g=this.varPie.ids[t];var x=g>-1?this.varPie.data[g]:this.varPie.oprc;var f=t%this.colors.length;var l=Math.PI*(2*c);var e=Math.PI*(2*(c+x));var v=(l+e)/2;var p=(e-l)/16;this.ctx.beginPath();this.ctx.fillStyle=this.colors[f];this.ctx.lineWidth=this.pieSegmentSeparation;this.ctx.strokeStyle=this.pieType=="separated"?this.background:this.pieType=="solid"?this.foreground:this.foreground;if(this.showShadow){this.ctx.shadowOffsetX=this.shadowOffsetX;this.ctx.shadowOffsetY=this.shadowOffsetY;this.ctx.shadowBlur=this.shadowBlur;this.ctx.shadowColor=this.shadowColor}this.ctx.moveTo(q,a);this.ctx.arc(q,a,w,l,e,false);this.ctx.lineTo(q,a);this.ctx.closePath();this.ctx.fill();this.ctx.stroke();if(this.showShadow){this.ctx.restore();this.ctx.shadowOffsetX=0;this.ctx.shadowOffsetY=0;this.ctx.shadowBlur=0;this.ctx.shadowColor=this.background}if(this.pieSegmentLabels){var u=q-Math.sin(v-(Math.PI/2))*m;var d=a+Math.cos(v-(Math.PI/2))*m;this.drawText(sprintf("%."+this.pieSegmentPrecision+"f",x*100)+"%",u,d,this.axisTickFont,this.axisTickColor,"center","middle");u=q+w*Math.cos(l);d=a+w*Math.sin(l);var b=["poly",q,a,u,d];var h=l;for(var o=0;o<16;o++){h+=p;u=q+w*Math.cos(h);d=a+w*Math.sin(h);b.push(u);b.push(d)}b.push(q);b.push(a);if(g>-1){this.addArea(b,[g,r])}else{this.varPie.idso.push(r);this.addArea(b,this.varPie.idso)}}c+=x}this.ctx.lineWidth=1};this.drawPieLegend=function(){if(this.showLegend){var k=this.getPieLegendDimensions();var l=this.getFontPt(this.legendFont);var j=l/2;var b=this.left+this.x+(this.margin*2)+j;var a=b+j+this.margin;var g=this.top+((this.y/2)-(k[1]/2))+this.margin;var f=g;for(var d=0;d<this.varPie.ids.length;d++){var h=this.varPie.ids[d];var c=d%this.colors.length;var e=h>-1?this.shortenText(this.data.y.vars[h],this.maxVarStringLen):"Other";this.square(b,f,this.colors[c],10);this.drawText(e,a,f,this.legendFont,this.legendColor,"left","middle");f+=l+this.margin}if(this.legendBox){this.rectangleShd(b-(this.margin*2),g-(this.margin*2),k[0]-l,k[1]-l,this.foreground,false,true)}}};this.drawPiePlot=function(){this.setPieXYDimensions();this.drawTitle();this.drawPieDataPoints();this.drawPieLegend()};this.initializePiePlot=function(){if(this.xAxisMin<0){alert("Dude you can't draw a pie chart with negative numbers!");return}this.drawPiePlot()};this.initializePiePlot()};CanvasXpress.prototype.Venn=function(){this.setVennXYDimensions=function(){this.setLegendFont();var a=this.autoExtend?Math.max(this.width,this.height):this.height;this.height=a;this.setAxisFont("Venn",a);if(this.showLegend){this.bottom+=(this.getFontPt(this.legendFont)+this.margin)*this.vennGroups}this.y=this.height-(this.top+this.bottom);this.x=this.y;if(this.x<400){var b=this.getFontPt(this.axisTickFont)-2;if(this.x<200){b-=1}this.axisTickFont=b+"Pt "+this.fontName}this.width=this.left+this.x+this.right;this.resizeCanvas()};this.drawVennBubble=function(b,c,a){if(this.vennGroups==4){if(this.isIE){a=a.replace("rgb","rgba");a=a.replace(")",",0.5)");this.ellipse(0,0,a,this.x/1.4)}else{this.ellipse(0,0,a,this.x/1.4);this.ctx.globalCompositeOperation="lighter"}}else{if(this.isIE){a=a.replace("rgb","rgba");a=a.replace(")",",0.5)");this.circle(b,c,a,this.x/2)}else{this.circle(b,c,a,this.x/2);this.ctx.globalCompositeOperation="lighter"}}};this.drawVennLayout=function(){var g,h,b,e;var a=["A","B","C","D"];this.ctx.clearRect(0,0,this.width,this.height);if(this.vennGroups==4){this.ctx.save();g=this.margin+(this.x/4.94);h=this.top+(this.x/13);this.ctx.translate(g,h);this.ctx.rotate(Math.PI/4);this.drawVennBubble(0,0,"rgb(255,0,0)");g=this.x/22.4;h=-this.x/5.32;this.ctx.translate(g,h);this.drawVennBubble(0,0,"rgb(0,153,51)");g=this.x/1.84;h=this.x/-5.32;this.ctx.translate(g,h);this.ctx.rotate(Math.PI/2);g=-this.x/22.4;h=-this.x/5.32;this.ctx.translate(g,h);this.drawVennBubble(0,0,"rgb(0,0,255)");g=this.x/22.4;h=this.x/5.32;this.ctx.translate(g,h);this.drawVennBubble(0,0,"rgb(153,204,0)");this.ctx.restore();b=[11.2,3.05,1.46,1.08];e=[7,42,42,7]}else{if(this.vennGroups==3){this.ctx.save();g=this.left+(this.x/2);h=this.top+(this.x/2.86);this.drawVennBubble(g,h,"rgb(255,0,0)");h+=(this.x/3.33);g=this.left+(this.x/3);this.drawVennBubble(g,h,"rgb(0,255,0)");g=this.left+(this.x/1.5);this.drawVennBubble(g,h,"rgb(0,0,255)");this.ctx.restore();b=[2,8.66,1.13];e=[20,2.3,2.3]}else{if(this.vennGroups==2){this.ctx.save();g=this.left+(this.x/3);h=this.top+(this.x/2.67);this.drawVennBubble(g,h,"rgb(0,0,255)");g=this.left+(this.x/1.5);h=this.top+(this.x/2.67);this.drawVennBubble(g,h,"rgb(255,0,0)");this.ctx.restore();b=[3,1.5];e=[16,16]}else{if(this.vennGroups==1){g=this.left+(this.x/2);h=this.top+(this.x/2);this.circle(g,h,"rgb(255,0,0)",this.x);b=[100];e=[100]}}}}for(var d=0;d<this.vennGroups;d++){var c=this.left+(this.x/b[d]);var f=this.top+(this.x/e[d]);this.drawText(a[d],c,f,this.axisTickFont,this.axisTickColor,"center","middle")}};this.drawVennDataPoints=function(){var a,e;if(this.vennGroups==4){a=[5.6,2.94,3.5,1.54,3.29,2,2.59,1.212,2,1.442,1.4,1.757,2.31,1.624,2];e=[2.94,7,3.92,7,1.89,4.06,2.66,2.94,1.54,1.89,3.92,1.729,1.729,2.66,2.03];this.y=(this.x*1.1)/1.4}else{if(this.vennGroups==3){a=[2,3.5,2.55,1.4,1.6,2,2];e=[3.6,1.54,2.07,1.54,2.07,1.54,1.83];this.y=this.x*0.95}else{if(this.vennGroups==2){a=[3.5,1.4,2];e=[2.66,2.66,2.66];this.y=this.x*0.65}else{if(this.vennGroups==1){a=[2];e=[2]}}}}for(var d=0;d<a.length;d++){var c=this.left+(this.x/a[d]);var f=this.top+(this.x/e[d]);var b=this.getFontPt(this.axisTickFont);var g=this.data.venn.data[this.vennCompartments[d]]?this.data.venn.data[this.vennCompartments[d]]:0;this.drawText(g,c,f,this.axisTickFont,this.axisTickColor,"center","middle");this.addArea(["circle",c,f,b],[d])}};this.drawVennLegend=function(){if(this.showLegend){var f=["A","B","C","D"];var h=this.getFontPt(this.legendFont);var e=this.left;var c=e+(h*2);var g=this.top+this.y+this.margin+(h/2);for(var d=0;d<this.vennGroups;d++){this.drawText(f[d]+": ",e,g,this.legendFont,this.legendColor,"left","middle");var b=this.data.venn.legend&&this.data.venn.legend[f[d]]?this.data.venn.legend[f[d]]:"N/A";var a=(this.measureText(b,this.legendFont)>this.x)?this.scaleTextToFont(b,h,this.x-this.margin):this.legendFont;this.drawText(b,c,g,a,this.legendColor,"left","middle");g+=this.margin+h}}};this.drawVennPlot=function(){this.setVennXYDimensions();this.drawTitle();this.showShadow=false;this.drawVennLayout();this.showShadow=this.tmpshowShadow;this.drawVennDataPoints();this.drawVennLegend()};this.initializeVennPlot=function(){this.tmpshowShadow=this.showShadow;this.background="rgb(255,255,255)";this.foreground="rgb(0,0,0)";this.drawVennPlot()};this.initializeVennPlot()};CanvasXpress.prototype.Correlation=function(){this.setCorrelationVarSmpLabelFont=function(b){var a=this.scaleTextToSize(b);a=this.correlationAxis=="samples"?a*this.scaleSmpLabelFontFactor:a*this.scaleVarLabelFontFactor;a=Math.min(a,this.maxTextSize);this.smpLabelFont=(a)+"Pt "+this.fontName;this.varLabelFont=(a)+"Pt "+this.fontName};this.getCorrelationLabelsHeight=function(){var a=0;if(this.correlationAxis=="samples"){if(this.maxSmpName>this.maxSmpStringLen){a+=this.measureText(this.maxSmpNameStr.substring(0,this.maxSmpStringLen),this.smpLabelFont)}else{a+=this.measureText(this.maxSmpNameStr,this.smpLabelFont)}}else{if(this.maxVarName>this.maxVarStringLen){a+=this.measureText(this.maxVarNameStr.substring(0,this.maxVarStringLen),this.varLabelFont)}else{a+=this.measureText(this.maxVarNameStr,this.varLabelFont)}}if(this.correlationAnchorLegend){a+=this.correlationAnchorLegendAlignWidth+this.margin}return a};this.setCorrelationXYDimensions=function(){var a=this.autoExtend?Math.max(this.width,this.height):Math.min(this.width,this.height);this.width=a;this.height=a/2;if(this.yAxisShow){this.setAxisFont(this.yAxisTitle,this.height);this.left=this.margin+this.getFontPt(this.axisTitleFont)+this.margin}this.x=this.width-(this.left+this.right);var b=this.correlationAxis=="variables"?this.varIndices.length:this.isGroupedData?this.grpIndices.length:this.smpIndices.length;this.diamondSize=this.x/b;this.setCorrelationVarSmpLabelFont(b);this.y=this.x/2+(this.diamondSize/2);if(this.xAxisShow){this.top+=this.margin+this.getCorrelationLabelsHeight()+this.margin}this.height=this.top+this.y+this.bottom;this.resizeCanvas()};this.drawCorrelationLayout=function(){if(this.yAxisShow){this.drawText(this.yAxisTitle,this.left/2,this.top+(this.y/2),this.axisTitleFont,this.axisTitleColor,"center","middle",-Math.PI/2)}if(this.xAxisShow){var c=this.left+this.diamondSize/2;var o=this.top-this.margin;var n=this.top-(this.getCorrelationLabelsHeight()+this.margin);var m=n+this.correlationAnchorLegendAlignWidth;var k,f,h;var a=this.isGroupedData?this.data.w:this.data.y;var q=this.correlationAxis=="variables"?this.varIndices:this.isGroupedData?this.grpIndices:this.smpIndices;var l=this.correlationAxis=="samples"?this.maxSmpStringLen:this.maxVarStringLen;if(this.correlationAnchorLegend){h=this.correlationAxis=="samples"?a.data[0]:this.getDataForSmpGrpAtIndex(0);q.sort(function(r,i){return h[r]-h[i]});this.setAxisUnits("xAxis")}if(this.correlationAxis=="samples"){k=a.smps;f=this.smpLabelFont}else{k=a.vars;f=this.varLabelFont}for(var g=0;g<q.length;g++){var p=q[g];var j=this.shortenText(k[p],l);var e=this.correlationAxis=="samples"?this.getSmpColor(k[p]):this.getVarColor(k[p]);if(q.length<100){this.drawText(j,c,o,f,e,"left","middle",-Math.PI/2)}else{if(g%2){this.drawText(j,c,o,f,e,"left","middle",-Math.PI/2)}}if(this.correlationAnchorLegend){var d=h[p];var b=this.left+((d-this.xAxisMin)*this.xAxisUnit);this.line(b,n-this.margin,b,n,e);this.line(b,n,c,m,e)}c+=this.diamondSize}}c=this.left+(this.x/16);o=this.top+(this.y*7/8);if(this.correlationAnchorLegend){this.setRangeData("cor")}this.drawColorIndicator(c,o,this.minData,this.maxData,2)};this.drawCorrelationDataPoints=function(){var c,p,b,n;var s=this.diamondSize/2;var o="rgb(255,255, 0)";var l=this.isGroupedData?this.data.w.cor:this.data.y.cor;var r=this.correlationAxis=="variables"?this.varIndices:this.isGroupedData?this.grpIndices:this.smpIndices;c=this.left+s;p=this.top+s;for(var h=0;h<Math.ceil(r.length/2);h++){var q=r[h];b=c+(this.diamondSize*h);n=p;for(var g=h;g<r.length-h;g++){var m=r[g];var e=l[q][m];var d=this.getHeatmapColor(this.minData,this.maxData,e);if(isNaN(e)){this.addArea(this.diamond(b,n,o,this.diamondSize,true),[q,m])}else{this.addArea(this.diamond(b,n,d,this.diamondSize,true),[q,m])}b+=s;n+=s}n-=this.diamondSize;for(var f=g-2;f>=h;f--){var a=r[(r.length-f)-1];var e=l[a][m];var d=this.getHeatmapColor(this.minData,this.maxData,e);if(isNaN(e)){this.addArea(this.diamond(b,n,o,this.diamondSize,true),[a,m])}else{this.addArea(this.diamond(b,n,d,this.diamondSize,true),[a,m])}b+=s;n-=s}}this.lineShd(this.left,this.top+s,this.left+(this.x/2),this.top+this.y,this.foreground);this.lineShd(this.left+this.x,this.top+s,this.left+(this.x/2),this.top+this.y,this.foreground);c=this.left+s;p=this.top;b=c+(this.x/2);n=(this.top+this.y)-s;for(var h=0;h<r.length;h++){this.lineShd(c,p,b,n,this.foreground);c+=this.diamondSize;b+=s;n-=s}c=(this.left+this.x)-s;p=this.top;b=(this.left+(this.x/2))-s;n=(this.top+this.y)-s;for(var h=0;h<r.length;h++){this.lineShd(c,p,b,n,this.foreground);c-=this.diamondSize;b-=s;n-=s}};this.drawCorrelationPlot=function(){this.setCorrelationXYDimensions();this.drawCorrelationLayout();this.drawTitle();this.drawCorrelationDataPoints()};this.initializeCorrelationPlot=function(){this.drawCorrelationPlot()};this.initializeCorrelationPlot()};CanvasXpress.prototype.Scatter2D=function(){this.get2DYAxisWidth=function(){return this.yAxisShow?this.getFontPt(this.axisTitleFont)+this.measureText(this.getMaxText(this.yAxisValues),this.axisTickFont)+(this.margin*5):this.margin};this.get2DXAxisHeight=function(){return this.xAxisShow?this.getFontPt(this.axisTickFont)+this.getFontPt(this.axisTitleFont)+(this.margin*5):this.margin};this.set2DType=function(){if(this.graphType=="ScatterBubble2D"&&this.xAxisIndices.length>1&&this.xAxisIndices.length==this.yAxisIndices.length&&this.xAxisIndices.length==this.zAxisIndices.length){this.type2D="XYZ"}else{if(this.xAxisIndices.length>1&&this.xAxisIndices.length==this.yAxisIndices.length){this.type2D="XY"}else{if(this.xAxisIndices.length>this.yAxisIndices.length){this.type2D="X"}else{this.type2D="Y"}}}};this.set2DText=function(){var b=this.xAxisTitle.length>this.yAxisTitle.length?this.xAxisTitle:this.yAxisTitle;var a=this.layoutComb?Math.min(this.layoutWidth,this.layoutHeight):Math.min(this.width,this.height);this.setAxisFont(b,a)};this.setDecorationsLegendPositions=function(){if(this.showDecorations){this.setDecorationLegendDimension();if(this.showLegend){if(this.legendPosition=="bottom"){this.decorationsPosition="right"}else{this.decorationsPosition="bottom"}}}};this.set2DXYDimensions=function(){this.setDecorationsLegendPositions();this.setLegendDimensions();if(this.showLegend||this.showIndicators){this.right=this.legendWidth}if(this.showDecorations&&this.decorationsPosition=="right"){this.right+=this.legendDecorationWidth+(this.margin*2)}if(this.graphType=="ScatterBubble2D"&&this.zAxisShow){this.right+=this.getFontPt(this.axisTitleFont)+this.margin}else{this.right+=this.margin}this.left=this.get2DYAxisWidth();this.bottom=this.get2DXAxisHeight();if(this.showLegend||this.showIndicators){this.bottom+=this.legendHeight}if(this.showDecorations&&this.decorationsPosition=="bottom"){this.bottom+=this.legendDecorationHeight+(this.margin*2)}this.x=this.autoExtend?this.width-this.left:this.layoutComb?this.layoutWidth-(this.left+this.right):this.width-(this.left+this.right);this.y=this.layoutComb?this.layoutHeight-(this.top+this.bottom):this.height-(this.top+this.bottom);if(!this.layoutComb){this.width=this.autoExtend?this.left+this.x+this.right:this.layoutComb?this.layoutWidth:this.width;this.resizeCanvas()}this.setScatterPointSize();this.setAxisUnits("xAxis");this.setAxisUnits("yAxis")};this.set2DWireFrame=function(){var d,f,b,e,a,g;d=this.offsetX+this.left;b=d+this.x;a=this.yAxisTickStyle=="dotted"?"dottedLine":"line";for(var c=0;c<this.yAxisValues.length;c++){g=parseFloat(this.yAxisValues[c]);f=(this.offsetY+this.top+this.y)-((g-this.yAxisMin)*this.yAxisUnit);this[a](d,f,b,f,this.yAxisTickColor)}f=this.offsetY+this.top;e=f+this.y;a=this.xAxisTickStyle=="dotted"?"dottedLine":"line";for(var c=0;c<this.xAxisValues.length;c++){g=parseFloat(this.xAxisValues[c]);d=(this.offsetX+this.left)+((g-this.xAxisMin)*this.xAxisUnit);this[a](d,f,d,e,this.yAxisTickColor)}};this.set2DLayout=function(){var c=this.offsetX+this.margin+(this.getFontPt(this.axisTitleFont)/2);var d=this.offsetY+this.top+(this.y/2);if(this.yAxisShow){this.drawText(this.yAxisTitle,c,d,this.axisTitleFont,this.axisTitleColor,"center","middle",-Math.PI/2)}var b=this.measureText(this.getMaxText(this.yAxisValues),this.axisTickFont)/2;c=this.offsetX+this.margin+this.getFontPt(this.axisTitleFont)+this.margin+this.margin+b;for(var a=0;a<this.yAxisValues.length;a++){var f=parseFloat(this.yAxisValues[a]);var e=sprintf("%."+this.yAxisDecs+"f",f);d=(this.offsetY+this.top+this.y)-((f-this.yAxisMin)*this.yAxisUnit);if(this.yAxisShow){this.drawText(e,c,d,this.axisTickFont,this.axisTickColor,"center","middle")}}c=this.offsetX+this.left+(this.x/2);d=this.offsetY+this.top+this.y+this.margin+this.margin+this.getFontPt(this.axisTickFont)+this.margin+this.margin+(this.getFontPt(this.axisTitleFont)/2);if(this.xAxisShow){this.drawText(this.xAxisTitle,c,d,this.axisTitleFont,this.axisTitleColor,"center","middle")}d=this.offsetY+this.top+this.y+this.margin+this.margin+(this.getFontPt(this.axisTickFont)/2);for(var a=0;a<this.xAxisValues.length;a++){var f=parseFloat(this.xAxisValues[a]);var e=sprintf("%."+this.xAxisDecs+"f",f);c=(this.offsetX+this.left)+((f-this.xAxisMin)*this.xAxisUnit);if(this.xAxisShow){this.drawText(e,c,d,this.axisTickFont,this.axisTickColor,"center","middle")}}if(this.graphType=="ScatterBubble2D"){if(this.zAxisShow){c=this.offsetX+this.left+this.x+this.margin;d=this.offsetY+this.top+(this.y/2);this.drawText(this.zAxisTitle,c,d,this.axisTitleFont,this.axisTitleColor,"center","bottom",Math.PI/2)}}this.rectangle(this.offsetX+this.left,this.offsetY+this.top,this.x,this.y,this.foreground,this.foreground,true)};this.draw2DDataPoints=function(){var p,F,E;var u,b,a;var C,g,e;if(this.type2D=="XYZ"){var s=this.xAxisIndices[this.xAxisCurrent];var G=this.yAxisIndices[this.yAxisCurrent];var k=this.zAxisIndices[this.zAxisCurrent];var H=s+":"+G;if(this.xAxisTransform=="percentile"){p=this.getAxisRangeBySample(this.xAxisIndices);E=p[0];F=p[1]}if(this.yAxisTransform=="percentile"){u=this.getAxisRangeBySample(this.yAxisIndices);a=u[0];b=u[1]}C=this.getAxisRangeBySample(this.zAxisIndices);e=C[0];g=C[1];for(var v=0;v<this.varIndices.length;v++){var D=this.varIndices[v];var n=this.getDataAtPos(D,s,false,this.xAxisTransform,E,F);var m=this.getDataAtPos(D,G,false,this.yAxisTransform,a,b);var l=this.getDataAtPos(D,k,false,"percentile",e,g);var r=this.sizeBy?this.dataSizes[v]:this.sizes[Math.floor(l/10)+1];var h=this.colorBy?this.dataColors[v]:this.colors[0];var t=this.shapeBy?this.dataShapes[v]:this.shapes[0];var B=(this.offsetX+this.left)+((n-this.xAxisMin)*this.xAxisUnit);var d=(this.offsetY+this.top+this.y)-((m-this.yAxisMin)*this.yAxisUnit);if(this.isVisibleSelectedDataPoint(D,H)){this.drawSelectedBackground(D,H,t,B,d,r,false,false,true);this.addArea(this[t](B,d,h,r,false,false,true),[D,s,G,k]);if(this.isScatterLine&&v<this.varIndices.length-1&&this.isVisibleSelectedDataPoint(this.varIndices[v+1],H)){D=this.varIndices[v+1];n=this.getDataAtPos(D,s,false,this.xAxisTransform,E,F);m=this.getDataAtPos(D,G,false,this.yAxisTransform,a,b);var A=(this.offsetX+this.left)+((n-this.xAxisMin)*this.xAxisUnit);var c=(this.offsetY+this.top+this.y)-((m-this.yAxisMin)*this.yAxisUnit);this.line(B,d,A,c,this.colors[0])}}}}else{if(this.type2D=="XY"){for(var w=0;w<this.xAxisIndices.length;w++){var h=w%this.colors.length;var s=this.xAxisIndices[w];var G=this.yAxisIndices[w];var k;var H=s+":"+G;if(this.xAxisTransform=="percentile"){p=this.getAxisRangeBySample(s);E=p[0];F=p[1]}if(this.yAxisTransform=="percentile"){u=this.getAxisRangeBySample(G);a=u[0];b=u[1]}if(this.graphType=="ScatterBubble2D"&&!this.sizeBy){if(this.zAxisIndices[this.zAxisCurrent]){k=this.zAxisIndices[this.zAxisCurrent];C=this.getAxisRangeBySample(k);e=C[0];g=C[1]}}for(var v=0;v<this.varIndices.length;v++){var D=this.varIndices[v];var n=this.getDataAtPos(D,s,false,this.xAxisTransform,E,F);var m=this.getDataAtPos(D,G,false,this.yAxisTransform,a,b);var l;var t=this.shapeBy?this.dataShapes[v]:this.shapes[0];var r=this.scatterPointSize;if(this.sizeBy){r=this.dataSizes[v]}else{if(this.graphType=="ScatterBubble2D"){if(this.zAxisIndices[w]){l=this.getDataAtPos(D,k,false,"percentile",e,g);r=this.sizes[Math.floor(l/10)+1]}}}var B=(this.offsetX+this.left)+((n-this.xAxisMin)*this.xAxisUnit);var d=(this.offsetY+this.top+this.y)-((m-this.yAxisMin)*this.yAxisUnit);if(this.isHistogram){var c=(this.offsetY+this.top+this.y)-d;if(this.isVisibleSelectedDataPoint(D,H)){this.drawSelectedBackground(D,H,"rectangleShd",B-this.histogramBarWidth,d-this.histogramBarWidth,false,this.histogramBarWidth*2,c,true);this.addArea(this.rectangleShd(B-this.histogramBarWidth,d,this.histogramBarWidth*2,c,this.colors[h],false,false,true),[D,s,G])}}else{if(this.isVisibleSelectedDataPoint(D,H)){this.drawSelectedBackground(D,H,t,B,d,r,false,false,true);if(this.graphType=="ScatterBubble2D"){if(this.colorBy){this.addArea(this[t](B,d,this.dataColors[v],r,"closed",this.colors[h],true),[D,s,G,k])}else{this.addArea(this[t](B,d,this.colors[h],r,false,false,true),[D,s,G,k])}}else{if(this.colorBy){this.addArea(this[t](B,d,this.dataColors[v],r,"closed",this.colors[h],true),[D,s,G])}else{this.addArea(this[t](B,d,this.colors[h],r,false,false,true),[D,s,G])}}if(this.isScatterLine&&v<this.varIndices.length-1&&this.isVisibleSelectedDataPoint(this.varIndices[v+1],H)){D=this.varIndices[v+1];n=this.getDataAtPos(D,s,false,this.xAxisTransform,E,F);m=this.getDataAtPos(D,G,false,this.yAxisTransform,a,b);var A=(this.offsetX+this.left)+((n-this.xAxisMin)*this.xAxisUnit);var c=(this.offsetY+this.top+this.y)-((m-this.yAxisMin)*this.yAxisUnit);this.line(B,d,A,c,this.colors[w])}}}}}}else{if(this.type2D=="X"){var q=this.yAxisIndices[this.yAxisCurrent];if(this.yAxisTransform=="percentile"){u=this.getAxisRangeBySample(q);a=u[0];b=u[1]}var f;if(this.graphType=="ScatterBubble2D"&&!this.sizeBy){if(this.zAxisIndices[this.zAxisCurrent]){f=this.zAxisIndices[this.zAxisCurrent];C=this.getAxisRangeBySample(f);e=C[0];g=C[1]}}for(var w=0;w<this.xAxisIndices.length;w++){var h=w%this.colors.length;var o=this.xAxisIndices[w];var H=o+":"+q;if(this.xAxisTransform=="percentile"){p=this.getAxisRangeBySample(o);E=p[0];F=p[1]}for(var v=0;v<this.varIndices.length;v++){var D=this.varIndices[v];var n=this.getDataAtPos(D,o,false,this.xAxisTransform,E,F);var m=this.getDataAtPos(D,q,false,this.yAxisTransform,a,b);var l;var r=this.scatterPointSize;var t=this.shapeBy?this.dataShapes[v]:this.shapes[0];if(this.sizeBy){r=this.dataSizes[v]}else{if(this.graphType=="ScatterBubble2D"){if(this.zAxisIndices[this.zAxisCurrent]){l=this.getDataAtPos(D,f,false,"percentile",e,g);r=this.sizes[Math.floor(l/10)+1]}}}var B=(this.offsetX+this.left)+((n-this.xAxisMin)*this.xAxisUnit);var d=(this.offsetY+this.top+this.y)-((m-this.yAxisMin)*this.yAxisUnit);if(this.isHistogram){var c=(this.offsetY+this.top+this.y)-d;if(this.isVisibleSelectedDataPoint(D,H)){this.drawSelectedBackground(D,H,"rectangleShd",B-this.histogramBarWidth,d-this.histogramBarWidth,false,this.histogramBarWidth*2,c,true);this.addArea(this.rectangleShd(B-this.histogramBarWidth,d,this.histogramBarWidth*2,c,this.colors[h],false,false,true),[D,o,q])}}else{if(this.isVisibleSelectedDataPoint(D,H)){this.drawSelectedBackground(D,H,t,B,d,r,false,false,true);if(this.graphType=="ScatterBubble2D"){if(this.colorBy){this.addArea(this[t](B,d,this.dataColors[v],r,"closed",this.colors[h],true),[D,o,q,f])}else{this.addArea(this[t](B,d,this.colors[h],r,false,false,true),[D,o,q,f])}}else{if(this.colorBy){this.addArea(this[t](B,d,this.dataColors[v],r,"closed",this.colors[h],true),[D,o,q])}else{this.addArea(this[t](B,d,this.colors[h],r,false,false,true),[D,o,q])}}if(this.isScatterLine&&v<this.varIndices.length-1&&this.isVisibleSelectedDataPoint(this.varIndices[v+1],H)){D=this.varIndices[v+1];n=this.getDataAtPos(D,o,false,this.xAxisTransform,E,F);m=this.getDataAtPos(D,q,false,this.yAxisTransform,a,b);var A=(this.offsetX+this.left)+((n-this.xAxisMin)*this.xAxisUnit);var c=(this.offsetY+this.top+this.y)-((m-this.yAxisMin)*this.yAxisUnit);this.line(B,d,A,c,this.colors[w])}}}}}}else{var q=this.xAxisIndices[this.xAxisCurrent];if(this.xAxisTransform=="percentile"){p=this.getAxisRangeBySample(q);E=p[0];F=p[1]}var f;if(this.graphType=="ScatterBubble2D"&&!this.sizeBy){if(this.zAxisIndices[this.zAxisCurrent]){f=this.zAxisIndices[this.zAxisCurrent];C=this.getAxisRangeBySample(f);e=C[0];g=C[1]}}for(var w=0;w<this.yAxisIndices.length;w++){var h=this.colors[w%this.colors.length];var o=this.yAxisIndices[w];var H=q+":"+o;if(this.yAxisTransform=="percentile"){u=this.getAxisRangeBySample(o);a=u[0];b=u[1]}for(var v=0;v<this.varIndices.length;v++){var D=this.varIndices[v];var n=this.getDataAtPos(D,q,false,this.xAxisTransform,E,F);var m=this.getDataAtPos(D,o,false,this.yAxisTransform,a,b);var l;var t=this.shapeBy?this.dataShapes[v]:this.shapes[0];var r=this.scatterPointSize;if(this.colorBy){h=this.dataColors[v]}if(this.sizeBy){r=this.dataSizes[v]}else{if(this.graphType=="ScatterBubble2D"){if(this.zAxisIndices[this.yAxisCurrent]){l=this.getDataAtPos(D,f,false,"percentile",e,g);r=this.sizes[Math.floor(l/10)+1]}}}var B=(this.offsetX+this.left)+((n-this.xAxisMin)*this.xAxisUnit);var d=(this.offsetY+this.top+this.y)-((m-this.yAxisMin)*this.yAxisUnit);if(this.isHistogram){var c=(this.offsetY+this.top+this.y)-d;if(this.isVisibleSelectedDataPoint(D,H)){this.drawSelectedBackground(D,H,"rectangleShd",B-this.histogramBarWidth,d-this.histogramBarWidth,false,this.histogramBarWidth*2,c,true);this.addArea(this.rectangleShd(B-this.histogramBarWidth,d,this.histogramBarWidth*2,c,h,false,false,true),[D,q,o])}}else{if(this.isVisibleSelectedDataPoint(D,H)){this.drawSelectedBackground(D,H,t,B,d,r,false,false,true);if(this.graphType=="ScatterBubble2D"){this.addArea(this[t](B,d,h,r,false,false,true),[D,q,o,f])}else{this.addArea(this[t](B,d,h,r,false,false,true),[D,q,o])}if(this.isScatterLine&&v<this.varIndices.length-1&&this.isVisibleSelectedDataPoint(this.varIndices[v+1],H)){D=this.varIndices[v+1];n=this.getDataAtPos(D,q,false,this.xAxisTransform,E,F);m=this.getDataAtPos(D,o,false,this.yAxisTransform,a,b);var A=(this.offsetX+this.left)+((n-this.xAxisMin)*this.xAxisUnit);var c=(this.offsetY+this.top+this.y)-((m-this.yAxisMin)*this.yAxisUnit);this.line(B,d,A,c,this.colors[w])}}}}}}}}};this.draw2DLegend=function(){if(this.showLegend){this.drawScatterLegend()}if(this.showDecorations){this.drawDecorationLegend()}};this.set2DprivateParams=function(){this.set2DType();this.set2DText()};this.draw2DPlot=function(){if(this.xAxis&&this.yAxis){this.setDataColorShapeSize()}this.set2DprivateParams();this.set2DXYDimensions();if(this.xAxis&&this.yAxis){this.set2DWireFrame();this.draw2DDataPoints();this.maskPlotArea();this.set2DLayout();this.drawTitle();this.drawDecorationData();this.draw2DLegend()}};this.initializeScatter2D=function(){if(this.layoutValid){this.drawLayoutCompartments(this.draw2DPlot)}else{this.draw2DPlot()}};this.initializeScatter2D()};CanvasXpress.prototype.Scatter3D=function(){this.set3DText=function(){this.setAxisFont(false,this.x)};this.set3DXYDimensions=function(){if(this.height<this.width){this.height=this.width}this.x=this.width-this.top;this.y=this.height-this.top;this.left=this.top;if(this.showLegend||this.showIndicators){this.setLegendDimensions();if(this.autoExtend){this.width=this.x+this.legendWidth;this.height=this.y+this.legendHeight}else{var a=Math.max(this.legendWidth,this.legendHeight);this.x-=a;this.y-=a;this.width=this.x+this.legendWidth;this.height=this.y+this.legendHeight}}this.resizeCanvas();this.setScatterPointSize()};this.draw3DLayout=function(g,a,l,h,b,m,f,c){var e,o,d,n,k;for(var j=0;j<g.length;j++){k=this.get3DTransfrom(g[j],a[j],l[j]);e=k[0]+this.left;o=k[1]+this.top;k=this.get3DTransfrom(h[j],b[j],m[j]);d=k[0]+this.left;n=k[1]+this.top;if(c=="dotted"){this.dottedLine(e,o,d,n,f[j])}else{this.line(e,o,d,n,f[j])}}};this.set3DXLayout=function(){var r=[],c=[],l=[],q=[],b=[],j=[],d=[];var o,k,m,a,t,h,g;var e=(this.len/(this.xAxisTicks-2))/3;var p=this.xAxisLen/((this.xAxisTicks-2)*2)/3;var n=((this.xAxisTicks-2)*3*-e)+e;var f=this.xAxisTitle?this.xAxisTitle:this.data.y.smps[this.xAxisIndex];m=n;o=0;k=0;while(m<this.len){if((o+1)%3){r[k]=m;c[k]=-this.len;l[k]=this.len;q[k]=m;b[k]=this.len;j[k]=this.len;d.push(this.xAxisTickColor);k++;r[k]=-this.len;c[k]=m;l[k]=this.len;q[k]=this.len;b[k]=m;j[k]=this.len;d.push(this.xAxisTickColor);k++}m+=e;o++}this.draw3DLayout(r,c,l,q,b,j,d,this.xAxisTickStyle);r=[],c=[],l=[],q=[],b=[],j=[],d=[];m=n;o=0;k=0;while(m<this.len){if(!((o+1)%3)){r[k]=m;c[k]=-this.len;l[k]=this.len;q[k]=m;b[k]=this.len;j[k]=this.len;d.push(this.foreground);k++;r[k]=-this.len;c[k]=m;l[k]=this.len;q[k]=this.len;b[k]=m;j[k]=this.len;d.push(this.foreground);a=this.get3DTransfrom(m,this.len,-this.len);h=a[0]+this.left;g=a[1]+this.top;t=sprintf("%."+this.xAxisDecs+"f",this.xAxisMin+(o*p));if(this.xAxisShow){this.drawText(t,h,g+5,this.axisTickFont,this.axisTickColor,"right",false,-Math.PI/2)}k++}m+=e;o++}this.draw3DLayout(r,c,l,q,b,j,d,this.xAxisTickStyle);if(this.xAxisShow){this.draw3DAxisTitle(n-(e*2),this.len+e,this.len+(e*4),this.len+(e*4),-this.len-(e*4),-this.len-(e*4),f,"x")}r=[-this.len,-this.len,this.len,-this.len];c=[-this.len,-this.len,-this.len,this.len];l=[this.len,this.len,this.len,this.len];q=[-this.len,this.len,this.len,this.len];b=[this.len,-this.len,this.len,this.len];j=[this.len,this.len,this.len,this.len];d=[this.foreground,this.foreground,this.foreground,this.foreground];this.draw3DLayout(r,c,l,q,b,j,d,this.xAxisTickStyle)};this.set3DYLayout=function(){var t=[],c=[],l=[],r=[],b=[],j=[],d=[];var p,k,n,a,u,h,g;var e=(this.len/(this.yAxisTicks-2))/3;var q=this.yAxisLen/((this.yAxisTicks-2)*2)/3;var o=((this.yAxisTicks-2)*3*-e)+e;var f=this.yAxisTitle?this.yAxisTitle:this.data.y.smps[this.yAxisIndex];var m=[];n=o;p=0;k=0;while(n<this.len){if((p+1)%3){t[k]=-this.len;c[k]=-this.len;l[k]=n;r[k]=-this.len;b[k]=this.len;j[k]=n;d.push(this.yAxisTickColor);k++;t[k]=-this.len;c[k]=n;l[k]=-this.len;r[k]=-this.len;b[k]=n;j[k]=this.len;d.push(this.yAxisTickColor);k++}else{m.push(sprintf("%."+this.yAxisDecs+"f",this.yAxisMin+(p*q)))}n+=e;p++}this.draw3DLayout(t,c,l,r,b,j,d,this.yAxisTickStyle);t=[],c=[],l=[],r=[],b=[],j=[],d=[];n=o;p=0;k=0;while(n<this.len){if(!((p+1)%3)){t[k]=-this.len;c[k]=-this.len;l[k]=n;r[k]=-this.len;b[k]=this.len;j[k]=n;d.push(this.foreground);k++;t[k]=-this.len;c[k]=n;l[k]=-this.len;r[k]=-this.len;b[k]=n;j[k]=this.len;d.push(this.foreground);a=this.get3DTransfrom(-this.len,n,-this.len);h=a[0]+this.left;g=a[1]+this.top;u=m.pop();if(this.yAxisShow){if(this.yRotate>=45&&this.xRotate>=45){this.drawText(u,h,g+5,this.axisTickFont,this.axisTickColor,"right",false,-Math.PI/2)}else{this.drawText(u,h-5,g,this.axisTickFont,this.axisTickColor,"right")}}k++}n+=e;p++}this.draw3DLayout(t,c,l,r,b,j,d,this.yAxisTickStyle);if(this.yAxisShow){this.draw3DAxisTitle(-this.len-(e*4),-this.len-(e*4),o-(e*2),this.len+e,-this.len-(e*4),-this.len-(e*4),f,"y")}t=[-this.len,-this.len,-this.len,-this.len];c=[-this.len,-this.len,-this.len,this.len];l=[-this.len,this.len,this.len,this.len];r=[-this.len,-this.len,-this.len,-this.len];b=[this.len,-this.len,this.len,this.len];j=[-this.len,-this.len,this.len,-this.len];d=[this.foreground,this.foreground,this.foreground,this.foreground];this.draw3DLayout(t,c,l,r,b,j,d,this.yAxisTickStyle)};this.set3DZLayout=function(){var r=[],c=[],l=[],q=[],b=[],j=[],d=[];var o,k,m,a,t,h,g;var e=(this.len/(this.zAxisTicks-2))/3;var p=this.zAxisLen/((this.zAxisTicks-2)*2)/3;var n=((this.zAxisTicks-2)*3*-e)+e;var f=this.zAxisTitle?this.zAxisTitle:this.data.y.smps[this.zAxisIndex];m=n;o=0;k=0;while(m<this.len){if((o+1)%3){r[k]=-this.len;c[k]=this.len;l[k]=m;q[k]=this.len;b[k]=this.len;j[k]=m;d.push(this.zAxisTickColor);k++;r[k]=m;c[k]=this.len;l[k]=-this.len;q[k]=m;b[k]=this.len;j[k]=this.len;d.push(this.zAxisTickColor);k++}m+=e;o++}this.draw3DLayout(r,c,l,q,b,j,d,this.zAxisTickStyle);r=[],c=[],l=[],q=[],b=[],j=[],d=[];m=n;o=0;k=0;while(m<this.len){if(!((o+1)%3)){r[k]=-this.len;c[k]=this.len;l[k]=m;q[k]=this.len;b[k]=this.len;j[k]=m;d.push(this.foreground);k++;r[k]=m;c[k]=this.len;l[k]=-this.len;q[k]=m;b[k]=this.len;j[k]=this.len;d.push(this.foreground);a=this.get3DTransfrom(this.len,this.len,m);h=a[0]+this.left;g=a[1]+this.top;t=sprintf("%."+this.zAxisDecs+"f",this.zAxisMin+(o*p));if(this.zAxisShow){if(this.xRotate>=45){if(this.yRotate>=45){this.drawText(t,h+5,g,this.axisTickFont,this.axisTickColor,"left")}else{this.drawText(t,h,g+5,this.axisTickFont,this.axisTickColor,"right",false,-Math.PI/2)}}else{this.drawText(t,h+5,g,this.axisTickFont,this.axisTickColor,"left")}}k++}m+=e;o++}this.draw3DLayout(r,c,l,q,b,j,d,this.zAxisTickStyle);if(this.zAxisShow){this.draw3DAxisTitle(this.len+(e*6),this.len+(e*6),this.len+(e*6),this.len+(e*6),n-(e*2),this.len+e,f,"z")}r=[-this.len,-this.len,this.len,-this.len];c=[this.len,this.len,this.len,this.len];l=[-this.len,this.len,-this.len,-this.len];q=[-this.len,this.len,this.len,this.len];b=[this.len,this.len,this.len,this.len];j=[this.len,this.len,this.len,-this.len];d=[this.foreground,this.foreground,this.foreground,this.foreground];this.draw3DLayout(r,c,l,q,b,j,d,this.zAxisTickStyle)};this.draw3DAxisTitle=function(c,b,o,n,h,f,p,d){var a=this.measureText(p);var r=a/2;var j=p.split("");var m=(c+b)/2;var l=(o+n)/2;var k=(h+f)/2;var q=this.xRotate>=45||this.yRotate>=45?4:0;if(this.xRotate>=45||this.yRotate>=45){a+=j.length*4;r=a/2}if(d=="x"){m-=r;for(var e=0;e<j.length;e++){var g=this.get3DTransfrom(m,l,k);this.drawText(j[e],this.offsetX+g[0],this.offsetY+g[1],this.axisTitleFont,this.axisTitleColor,"left","top");m+=this.measureText(j[e])+q}}else{if(d=="y"){l+=r;for(var e=0;e<j.length;e++){var g=this.get3DTransfrom(m,l,k);this.drawText(j[e],this.offsetX+g[0],this.offsetY+g[1],this.axisTitleFont,this.axisTitleColor,"left","bottom",-Math.PI/2);l-=this.measureText(j[e])+q}}else{if(d=="z"){k-=r;for(var e=0;e<j.length;e++){var g=this.get3DTransfrom(m,l,k);this.drawText(j[e],this.offsetX+g[0],this.offsetY+g[1],this.axisTitleFont,this.axisTitleColor,"left","bottom");k+=this.measureText(j[e])+q}}}}};this.set3DLayout=function(){this.set3DXLayout();this.set3DYLayout();this.set3DZLayout()};this.set3DAxes=function(){var b=["x","y","z"];for(var a=0;a<b.length;a++){var c=this.smpIndices;this[b[a]+"AxisIndex"]=this.getSampleIndices([this[b[a]+"Axis"]])[0];this.setSamplesVisible([this[b[a]+"AxisIndex"]]);this.setRangeData();this[b[a]+"AxisMin"]=this.minData;this[b[a]+"AxisMax"]=this.maxData;this[b[a]+"AxisIncr"]=this.getAxisIncrements(this[b[a]+"AxisMax"],this[b[a]+"AxisMin"],(this[b[a]+"AxisTicks"]-2)*2);this[b[a]+"AxisDecs"]=this.getAxisDecimals(this[b[a]+"AxisIncr"]);this[b[a]+"AxisLen"]=this[b[a]+"AxisMax"]-this[b[a]+"AxisMin"];this[b[a]+"AxisUnit"]=this.len*2/this[b[a]+"AxisLen"];this[b[a]+"AxisOffset"]=(this[b[a]+"AxisMin"]+(this[b[a]+"AxisLen"]/2))*this[b[a]+"AxisUnit"];this.setSamplesVisible(c)}};this.set3DDataPoints=function(){this.dataPoints=[];for(var b=0;b<this.varIndices.length;b++){var c=this.varIndices[b];var a=this.getDataAtPos(c,this.xAxisIndex);var e=this.getDataAtPos(c,this.yAxisIndex);var d=this.getDataAtPos(c,this.zAxisIndex);this.dataPoints.push(this.get3DTransfrom((a*this.xAxisUnit)-this.xAxisOffset,this.yAxisOffset-(e*this.yAxisUnit),(d*this.zAxisUnit)-this.zAxisOffset))}};this.draw3DDataPoints=function(){var k=this.xAxisIndex+":"+this.yAxisIndex+":"+this.zAxisIndex;if(this.isScatterLine){for(var f=0;f<this.varIndices.length-1;f++){if(this.isVisibleSelectedDataPoint(f,k)&&this.isVisibleSelectedDataPoint(f+1,k)){var c=this.offsetX+this.left+this.dataPoints[f][0];var j=this.offsetY+this.top+this.dataPoints[f][1];var a=this.offsetX+this.left+this.dataPoints[f+1][0];var h=this.offsetY+this.top+this.dataPoints[f+1][1];this.line(c,j,a,h,this.colors[0])}}}var g=[];var e=[];for(var f=0;f<this.dataPoints.length;f++){e.push(f);g.push(Math.sqrt((this.dataPoints[f][0]*this.dataPoints[f][0])+(this.dataPoints[f][1]*this.dataPoints[f][1])+(this.dataPoints[f][2]*this.dataPoints[f][2])))}e.sort(function(n,i){return g[i]-g[n]});for(var l=0;l<this.dataPoints.length;l++){var f=e[l];if(this.dataPoints[f][0]>this.left&&this.dataPoints[f][0]<(this.left+this.x)&&this.dataPoints[f][1]>this.top&&this.dataPoints[f][1]<(this.top+this.y)){var d=this.colorBy?this.dataColors[f]:this.colors[0];var m=this.shapeBy?this.dataShapes[f]:this.shapes[0];var b=this.sizeBy?this.dataSizes[f]:this.scatterPointSize;if(this.isVisibleSelectedDataPoint(l,k)){this.drawSelectedBackground(l,k,m,this.offsetX+this.left+this.dataPoints[f][0],this.offsetY+this.top+this.dataPoints[f][1],b);this.addArea(this[m](this.offsetX+this.left+this.dataPoints[f][0],this.offsetY+this.top+this.dataPoints[f][1],d,b),[f,this.xAxisIndex,this.yAxisIndex,this.zAxisIndex])}}}};this.set3DprivateParams=function(){this.set3DText();this.set3DParams()};this.draw3DPlot=function(){this.setDataColorShapeSize();this.set3DXYDimensions();this.set3DprivateParams();this.set3DRotation();this.set3DAxes();this.set3DLayout();this.set3DDataPoints();this.drawTitle();this.draw3DDataPoints();this.drawScatterLegend()};this.initializeScatter3D=function(){if(this.layoutValid){this.drawLayoutCompartments(this.draw3DPlot)}else{this.draw3DPlot()}};this.initializeScatter3D()};CanvasXpress.prototype.oneDPlot=function(){this.getShapeSize=function(){if(this.x<100||this.y<100){return this.rowBlockSize/6}else{if(this.x<200||this.y<200){return this.rowBlockSize/3}else{return this.rowBlockSize/1.5}}};this.setRowColBlocks=function(){var c=this.isGroupedData?this.grpIndices.length:this.smpIndices.length;this.rowBlocks=0;if(this.graphType=="Line"||this.graphType=="Area"||this.graphType=="Heatmap"||this.graphType=="Stacked"||this.graphType=="StackedPercent"){this.rowBlocks=c;if(this.graphType=="Heatmap"){this.colBlocks=this.varIndices.length}else{this.colBlocks=1}}else{if(this.graphType=="BarLine"&&this.data.a){var b=this.getVariablesVisibleByAxis("xAxis");var a=this.getVariablesVisibleByAxis("xAxis2");if(b.length>=a.length){this.rowBlocks=b.length*c}else{this.rowBlocks=a.length*c}this.colBlocks=1}else{this.rowBlocks=this.varIndices.length*c;this.colBlocks=1}}};this.set1DVarSmpLabelFont=function(){if(this.autoScaleFont){var a;if(this.data.l&&this.data.l.vars&&this.data.l.smps&&this.graphOrientation=="vertical"){a=this.scaleTextToSize(this.layoutMaxSamples*2)}else{a=this.isGraphTime?this.scaleTextToSize(this.timeValues.length*2):this.scaleTextToSize(this.smpIndices.length*2)}a=Math.min(a*this.scaleSmpLabelFontFactor,this.maxTextSize);this.smpLabelFont=(a)+"Pt "+this.fontName;a=this.scaleTextToSize(this.varIndices.length*2);a=Math.min(a*this.scaleVarLabelFontFactor,this.maxTextSize);this.varLabelFont=(a)+"Pt "+this.fontName}else{this.smpLabelFont=parseInt(this.smpLabelFontSize)+"Pt "+this.fontName;this.varLabelFont=parseInt(this.varLabelFontSize)+"Pt "+this.fontName}};this.set1DText=function(){var a;if(!this.layoutComb){if(this.data.y.desc){if(this.data.y.desc.length>1){if(this.data.y.desc[0].length>this.data.y.desc[1].length){a=this.data.y.desc[0]}else{a=this.data.y.desc[1]}}else{a=this.data.y.desc[0]}}else{a="NA"}}if(this.layoutComb){this.setAxisFont(this.minLayoutAxisTitle,this.minLayoutAxis)}else{if(this.graphOrientation=="vertical"){this.setAxisFont(a,this.y)}else{this.setAxisFont(a,this.x)}}};this.getSampleTitleHeight=function(){if(this.smpTitle){return parseInt(this.smpTitleFontSize*this.scaleSmpTitleFontFactor)+this.margin}else{return 0}};this.getSampleLabelLength=function(){if(this.showSampleNames){if(this.isGraphTime){return this.measureText(dateFormat(this.timeFormat),this.smpLabelFont)+(this.margin*2)}else{if(this.maxSmpName>this.maxSmpStringLen){return this.measureText(this.maxSmpNameStr.substring(0,this.maxSmpStringLen),this.smpLabelFont)+(this.margin*2)}else{return this.measureText(this.maxSmpNameStr,this.smpLabelFont)+(this.margin*2)}}}else{return 0}};this.getSmpOverlaysLength=function(){var a=0;if(this.showOverlays){if(!this.isGroupedData){for(var b=0;b<this.smpOverlays.length;b++){if(this.data.x.hasOwnProperty(this.smpOverlays[b])){a++}}if(a>0){a=(a*this.overlaysWidth)+this.margin}}}return a};this.getVarOverlaysHeight=function(){var a=0;if(this.showOverlays){if(this.graphType=="Heatmap"){for(var b=0;b<this.varOverlays.length;b++){if(this.data.z.hasOwnProperty(this.varOverlays[b])){a++}}if(a>0){a=(a*this.overlaysWidth)+this.margin}}}return a};this.getVarOverlaysLength=function(){var a=0;if(this.showOverlays){if(this.graphType=="Heatmap"){for(var b=0;b<this.varOverlays.length;b++){if(this.data.z.hasOwnProperty(this.varOverlays[b])){a=Math.max(a,this.measureText(this.varOverlays[b],this.overlayFont)+this.margin)}}}}return a};this.getAxisTitleTickLength=function(){if(this.graphOrientation=="vertical"){var a;if(this.graphType=="Candlestick"){if(this.showVolume){a=Math.max(this.measureText(this.getMaxText(this.xAxisValues),this.axisTickFont),this.measureText(this.getMaxText(this.xAxis2Values),this.axisTickFont))}else{if(this.summaryType=="candle"){a=this.measureText(this.getMaxText(this.xAxisValues),this.axisTickFont)}else{a=this.measureText(this.getMaxText(this.xAxis2Values),this.axisTickFont)}}}else{a=this.measureText(this.getMaxText(this.xAxisValues),this.axisTickFont)}return this.getFontPt(this.axisTitleFont)+a+(this.margin*3)}else{return this.getFontPt(this.axisTitleFont)+this.getFontPt(this.axisTickFont)+(this.margin*5)}};this.getHeatmapIndicatorHeight=function(){return this.indicatorHeight+(this.margin*4)+this.getFontPt(this.legendFont)};this.getLegendHeight=function(c){if(this.graphType=="Heatmap"){return 0}else{if(this.colorBy&&this.graphType=="Bar"){if(this.legendColorsN>0){return this.legendColorHeight+this.margin}else{return this.legendPosition=="right"?this.legendColorIndicatorWidth:this.legendColorIndicatorHeight}}else{var a=Math.min(this.getFontPt(this.legendFont),this.maxTextSize);var b=this.layoutComb&&!c?this.layoutMaxLegend:this.varIndices.length;return(b*a*1.5)+(a/2)+this.margin}}};this.getLegendWidth=function(){if(this.graphType=="Heatmap"){return 0}else{if(this.colorBy&&this.graphType=="Bar"){if(this.legendColorsN>0){return this.legendColorWidth+this.margin}else{return this.legendPosition=="right"?this.legendColorIndicatorHeight:this.legendColorIndicatorWidth}}else{var b=Math.min(this.getFontPt(this.legendFont),this.maxTextSize);var a=this.layoutComb?this.layoutMaxLegendLabel:this.maxVarNameStr;var c=a.length>this.maxVarStringLen?a.substring(0,this.maxVarStringLen):a;return(b*2)+this.measureText(c,this.legendFont)+(this.margin*6)}}};this.getVarTreeHeight=function(){var a=0;if(this.graphType=="Heatmap"&&this.showVarDendrogram&&this.varDendrogram){a=((this.varDendrogram.depth+1)*this.dendrogramSpace)+this.margin}return a};this.getSmpTreeWidthHeight=function(){var a=0;if(this.showSmpDendrogram&&this.smpDendrogram&&!this.isGroupedData){a=((this.smpDendrogram.depth+1)*this.dendrogramSpace)+this.margin}return a};this.set1DXYDimensionsLeft=function(){if(this.graphOrientation=="vertical"){this.left=this.margin+this.getAxisTitleTickLength()}else{if(this.smpDendrogramPosition=="right"){this.left=this.margin+this.getSampleTitleHeight()+this.getSampleLabelLength()+this.getSmpOverlaysLength()}else{this.left=this.margin+this.getSampleTitleHeight()+this.getSmpTreeWidthHeight()+this.getSampleLabelLength()+this.getSmpOverlaysLength()}}};this.set1DXYDimensionsRight=function(){if(this.graphOrientation=="vertical"){this.right=this.margin+this.getAxisTitleTickLength()}else{if(this.smpDendrogramPosition=="right"){this.right=this.margin+this.getSmpTreeWidthHeight()}else{this.right=this.margin}}if(this.showLegend&&this.legendPosition=="right"){this.right+=this.getLegendWidth()}if(this.showOverlays&&this.graphType=="Heatmap"){this.right+=this.getVarOverlaysLength()}};this.set1DXYDimensionsTop=function(){this.top=this.margin;if(this.title){this.top+=this.titleHeight+this.margin;if(this.subtitle){this.top+=this.subtitleHeight+this.margin}}if(this.graphOrientation=="vertical"){if(this.smpDendrogramPosition!="bottom"){this.top+=this.getSmpTreeWidthHeight()}}else{if(this.graphType=="Heatmap"){if(this.varDendrogramPosition=="bottom"){this.top+=this.getHeatmapIndicatorHeight()}else{this.top+=this.getHeatmapIndicatorHeight()+this.getVarTreeHeight()}}else{this.top+=this.getAxisTitleTickLength()}}};this.set1DXYDimensionsBottom=function(){if(this.graphOrientation=="vertical"){this.bottom=this.margin+this.getSampleTitleHeight()+this.getSampleLabelLength()+this.getSmpOverlaysLength();if(this.smpDendrogramPosition=="bottom"){this.bottom+=this.getSmpTreeWidthHeight()}if(this.showLegend&&this.legendPosition=="bottom"){this.bottom+=this.getLegendHeight()}}else{if(this.graphType=="Heatmap"){this.bottom=this.margin+this.measureText(this.maxVarNameStr,this.varLabelFont)+this.margin+this.getVarOverlaysHeight();if(this.varDendrogramPosition=="bottom"){this.bottom+=this.getVarTreeHeight()}}else{this.bottom=this.margin+this.getAxisTitleTickLength();if(this.showLegend&&this.legendPosition=="bottom"){this.bottom+=this.getLegendHeight()}}}};this.set1DXYDimensions=function(a){if(this.isGraphTime){if(!this.showVolume||(this.layoutComb&&this.layoutCurrent==0)){this.setTimeAxis()}}if(!a){this.setRowColBlocks();this.set1DVarSmpLabelFont()}if(this.graphOrientation=="vertical"){this.set1DXYDimensionsTop();this.set1DXYDimensionsBottom();this.y=this.layoutComb?this.layoutHeight-(this.top+this.bottom):this.height-(this.top+this.bottom);if(this.y<0){this.showLegend=false;this.set1DXYDimensionsBottom();this.y=this.layoutComb?this.layoutHeight-(this.top+this.bottom):this.height-(this.top+this.bottom);if(this.y<0){alert("Dude it doesn't fit make the graph bigger because it looks ugly!")}else{alert("Dude the legend was taken out because it doesn't fit make the graph bigger!")}}this.set1DText();this.set1DXYDimensionsLeft();this.set1DXYDimensionsRight();this.x=this.layoutComb?this.layoutWidth-(this.left+this.right):this.width-(this.left+this.right);if(this.x<0){this.showLegend=false;this.set1DXYDimensionsRight();this.x=this.layoutComb?this.layoutWidth-(this.left+this.right):this.width-(this.left+this.right);if(this.x<0){alert("Dude it doesn't fit make the graph bigger because it looks ugly!")}else{alert("Dude the legend was taken out because it doesn't fit make the graph bigger!")}}}else{this.set1DXYDimensionsLeft();this.set1DXYDimensionsRight();this.x=this.layoutComb?this.layoutWidth-(this.left+this.right):this.width-(this.left+this.right);if(this.x<0){this.showLegend=false;this.set1DXYDimensionsRight();this.x=this.layoutComb?this.layoutWidth-(this.left+this.right):this.width-(this.left+this.right);if(this.x<0){alert("Dude it doesn't fit make the graph bigger because it looks ugly!")}else{alert("Dude the legend was taken out because it doesn't fit make the graph bigger!")}}this.set1DText();this.set1DXYDimensionsTop();this.set1DXYDimensionsBottom();this.y=this.layoutComb?this.layoutHeight-(this.top+this.bottom):this.height-(this.top+this.bottom);if(this.y<0){this.showLegend=false;this.set1DXYDimensionsBottom();this.y=this.layoutComb?this.layoutHeight-(this.top+this.bottom):this.height-(this.top+this.bottom);if(this.y<0){alert("Dude it doesn't fit make the graph bigger because it looks ugly!")}else{alert("Dude the legend was taken out because it doesn't fit make the graph bigger!")}}if(this.graphType=="Heatmap"&&!this.layoutComb){if(this.bottom*1.5>this.y){if(this.dendrogramSpace>2){this.dendrogramSpace-=2}var b=this.getFontPt(this.varLabelFont)-1;this.varLabelFont=b.toString()+"pt "+this.fontName;this.resizeCanvas(true);this.set1DXYDimensions(true)}}if(this.left*1.5>this.x&&!this.layoutComb){if(this.dendrogramSpace>2){this.dendrogramSpace-=2}var b=this.getFontPt(this.smpLabelFont)-1;this.smpLabelFont=b.toString()+"pt "+this.fontName;this.resizeCanvas(true);this.set1DXYDimensions(true)}}};this.set1DPrivateParams=function(){var a=this.isGroupedData?this.grpIndices.length:this.smpIndices.length;if(this.autoExtend){this.rowBlockSize=this.scaleTextToSize(this.rowBlocks)+this.scaleTextConstantAdd;this.rowBlockSize*=this.blockFactor;if(this.graphType=="Heatmap"){if(this.colBlocks<20){this.colBlockSize=this.scaleTextToSize(this.colBlocks)+this.scaleTextConstantAdd+(this.scaleTextConstantAdd*3)}else{this.colBlockSize=(parseInt(1/Math.sqrt(this.colBlocks)*this.scaleTextConstantMult))+1}this.blockSeparation=this.rowBlockSize/2;this.y=this.rowBlockSize*this.rowBlocks;this.x=this.colBlockSize*this.colBlocks}else{this.blockSeparation=this.rowBlockSize*this.blockSeparationFactor;if(this.graphOrientation=="vertical"){this.x=(this.rowBlockSize*this.rowBlocks)+(this.blockSeparation*a)+this.blockSeparation}else{this.y=(this.rowBlockSize*this.rowBlocks)+(this.blockSeparation*a)+this.blockSeparation}this.colBlockSize=1}this.width=(this.left+this.x+this.right)*this.layoutCols;this.height=(this.top+this.y+this.bottom)*this.layoutRows;this.resizeCanvas()}else{if(this.graphType=="Heatmap"){this.rowBlockSize=this.y/this.rowBlocks;this.blockSeparation=this.rowBlockSize;this.colBlockSize=this.x/this.varIndices.length}else{this.rowBlockSize=this.graphOrientation=="vertical"?this.x/(this.rowBlocks+a+1):this.y/(this.rowBlocks+a+1);this.blockSeparation=this.rowBlockSize;this.colBlockSize=1}}};this.setTrees=function(){if(this.showSmpDendrogram&&this.data.t.smps){this.smpDendrogram={};this.smpDendrogram.data=[];this.smpDendrogram.nodes=[];this.smpDendrogram.idxs=[];this.smpDendrogram.heights=[];this.parseNewick(this.data.t.smps,"smpDendrogram")}if(this.showVarDendrogram&&this.data.t.vars){this.varDendrogram={};this.varDendrogram.data=[];this.varDendrogram.nodes=[];this.varDendrogram.idxs=[];this.varDendrogram.heights=[];this.parseNewick(this.data.t.vars,"varDendrogram")}};this.parseNewick=function(b,d){var o=b.split(/,/);var v=0;var e=0;var f=0;var l=1;var k=0;var t=0;var a=0;var h=0;for(var r=0;r<o.length;r++){var p=o[r];var g=p.split(/\:/);var w=g.shift();w=w.replace(/[\(\)]/g,"");this[d].nodes.push(w);var u=d=="smpDendrogram"?this.getSampleIndices(w):this.getVariableIndices(w);this[d].idxs.push(u);for(var q=0;q<g.length;q++){var c=g[q].replace(/[\(\)]/g,"");t=Math.max(t,c);this[d].heights.push(c)}this[d].max=t;var s=o[r].split(/ */);e=0;for(var q=0;q<s.length;q++){if(s[q]=="("){v++;e++}if(s[q]==")"){v--;e--}}h+=e;if(f>v){this[d].data.push([l,f,e,h])}else{this[d].data.push([l,v,e,h])}f=v;a=Math.max(a,f);k+=e;l++}this[d].unit=t>0?(a*this.dendrogramSpace)/t:0;this[d].depth=a;if(k>0){alert("Dude! Malformed newick tree. There are "+k+" additional right parenthesis!")}else{if(k<0){alert("Dude! Malformed newick tree. There are "+Math.abs(k)+" additional left parenthesis!")}}if(d=="varDendrogram"){if(this.varIndicesStart<0){if(this[d].nodes.length!=this.data.y.vars.length){alert("Dude! The length of the variable nodes in the dendrogram ("+this[d].nodes.length+") is different to that one in the data ("+this.data.y.vars.length+"). This ain't gonna work!");this.showVarDendrogram=false}else{if(this[d].nodes.length!=this.varIndices.length){alert("Ooops! Cannot show dendrogram with "+this[d].nodes.length+" nodes when only "+this.varIndices.length+" variables are visible.");this.showVarDendrogram=false}else{this.varIndices=this[d].idxs}}}else{var m=this.varIndicesStart+this.varIndices.length;this.varIndices=[];for(var r=this.varIndicesStart;r<m;r++){this.varIndices.push(this[d].idxs[r])}}}else{if(this.smpIndicesStart<0){if(this[d].nodes.length!=this.data.y.smps.length){alert("Dude! The length of the sample nodes in the dendrogram ("+this[d].nodes.length+") is different to that one in the data ("+this.data.y.smps.length+"). This ain't gonna work!");this.showSmpDendrogram=false}else{if(this[d].nodes.length!=this.smpIndices.length){alert("Ooops! Cannot show dendrogram with "+this[d].nodes.length+" nodes when only "+this.smpIndices.length+" samples visible.");this.showSmpDendrogram=false}else{this.smpIndices=this[d].idxs}}}else{var m=this.smpIndicesStart+this.smpIndices.length;this.smpIndices=[];for(var r=this.smpIndicesStart;r<m;r++){this.smpIndices.push(this[d].idxs[r])}}}};this.setOverlayColors=function(){var m=0;if(this.smpOverlays.length>0&&!this.isGroupedData){this.smpOverlayColors=[];for(var g=0;g<this.smpOverlays.length;g++){var a={};this.smpOverlayColors[g]=[];var f=this.smpOverlays[g];if(this.data.x.hasOwnProperty(f)){if(this.isNumeric(this.data.x[f],true)){var h=this.range(this.data.x[f],true);var l="rgb(255,255,0)";for(var e=0;e<this.smpIndices.length;e++){var k=this.smpIndices[e];var d=this.data.x[f][k];var c=!isNaN(d)?this.getHeatmapColor(h[0],h[1],d):l;this.smpOverlayColors[g].push(c)}}else{for(var e=0;e<this.smpIndices.length;e++){var k=this.smpIndices[e];var b=this.data.x[f][k];if(!a.hasOwnProperty(b)){a[b]=m%this.colors.length;m++}this.smpOverlayColors[g].push(this.colors[a[b]])}}}}}m=0;if(this.varOverlays.length>0&&this.graphType=="Heatmap"){this.varOverlayColors=[];for(var g=0;g<this.varOverlays.length;g++){var a={};this.varOverlayColors[g]=[];var f=this.varOverlays[g];if(this.data.z.hasOwnProperty(f)){if(this.isNumeric(this.data.z[f],true)){var h=this.range(this.data.z[f],true);var l="rgb(255,255,0)";for(var e=0;e<this.varIndices.length;e++){var k=this.varIndices[e];var d=this.data.z[f][k];var c=!isNaN(d)?this.getHeatmapColor(h[0],h[1],d):l;this.varOverlayColors[g].push(c)}}else{for(var e=0;e<this.varIndices.length;e++){var k=this.varIndices[e];var b=this.data.z[f][k];if(!a.hasOwnProperty(b)){a[b]=m%this.colors.length;m++}this.varOverlayColors[g].push(this.colors[a[b]])}}}}}};this.setOverlayFont=function(){var a=Math.min(this.scaleOverlayFontFactor*this.overlayFontSize,this.maxTextSize);a=parseInt(Math.max(a,this.minTextSize));this.overlayFont=(a)+"Pt "+this.fontName};this.set1DAttributes=function(){this.setLegendFont();this.setTrees();this.setOverlayColors();this.setOverlayFont();this.setDataColor(true)};this.set1DXAxis=function(){var a=this.graphOrientation=="vertical"?"y":"x";this.setAxisUnits("xAxis",a);if((this.graphType=="BarLine"&&this.data.a)||this.graphType=="Candlestick"){this.setAxisUnits("xAxis2",a)}};this.draw1DWireFrame=function(){var p,d,o,c,n,a,e,h,m;var f=this.isGroupedData?this.grpIndices:this.smpIndices;var r=this.xAxisTickStyle=="dotted"||this.yAxisTickStyle=="dotted"?"dottedLine":"line";var s=this.smpHairline=="dotted"?"dottedLine":"line";if(this.graphType!="Heatmap"){if(this.graphType=="BarLine"&&this.data.a&&this.data.y.desc[1]){var b=this.getVariablesVisibleByAxis("xAxis");var q=this.getVariablesVisibleByAxis("xAxis2");m=Math.max(b.length,q.length)}else{if(this.graphType.match(/Stacked|Line|Area/)){m=1}else{m=this.varIndices.length}}h=m*this.rowBlockSize;if(this.graphOrientation=="vertical"){if(this.isGraphTime){var g=(this.x-this.blockSeparation)/f.length;var k=g/2;var j=this.offsetX+this.left+(this.blockSeparation*0.5)+k;d=this.offsetY+this.top;c=this.offsetY+this.top+this.y;for(var l=0;l<this.timeValueIndices.length;l++){p=(this.timeValueIndices[l]*g)+j;if(this.smpHairline){this[s](p,d,p,c,this.smpHairlineColor)}}}else{p=this.offsetX+this.left+this.blockSeparation+(h/2);o=this.offsetX+this.left;n=this.offsetX+this.left+(this.blockSeparation*1.5)+h;d=this.offsetY+this.top;c=this.offsetY+this.top+this.y;for(var l=0;l<f.length;l++){if(this.blockContrast){e=l%2?this.blockContrastEvenColor:this.blockContrastOddColor;this.ctx.save();this.rectangle(o,d,n,c,e,e);this.ctx.restore();o=n;n=o+this.blockSeparation+h}if(this.smpHairline){this[s](p,d,p,c,this.smpHairlineColor)}p+=this.blockSeparation+h}}p=this.offsetX+this.left-(this.margin*2);for(var l=0;l<this.xAxisValues.length;l++){var t=parseFloat(this.xAxisValues[l]);d=this.offsetY+this.top+this.y-((t-this.xAxisMin)*this.xAxisUnit);this[r](this.offsetX+this.left,d,this.offsetX+this.left+this.x,d,this.xAxisTickColor)}}else{if(this.isGraphTime){var g=(this.y-this.blockSeparation)/f.length;var k=g/2;var j=this.offsetY+this.top+(this.blockSeparation*0.5)+k;p=this.offsetX+this.left;o=this.offsetX+this.left+this.x;for(var l=0;l<this.timeValueIndices.length;l++){d=(this.timeValueIndices[l]*g)+j;if(this.smpHairline){this[s](p,d,o,d,this.smpHairlineColor)}}}else{p=this.offsetX+this.left;o=this.offsetX+this.left+this.x;d=this.offsetY+this.top+this.blockSeparation+(h/2);c=this.offsetY+this.top;a=this.offsetY+this.top+(this.blockSeparation*1.5)+h;for(var l=0;l<f.length;l++){if(this.blockContrast){e=l%2?this.blockContrastEvenColor:this.blockContrastOddColor;this.ctx.save();this.rectangle(p,c,o,a,e,e);this.ctx.restore();c=a;a=c+this.blockSeparation+h}if(this.smpHairline){this[s](p,d,o,d,this.smpHairlineColor)}d+=this.blockSeparation+h}}d=this.offsetY+this.top-((this.margin*2)+(this.getFontPt(this.axisTickFont)/2));for(var l=0;l<this.xAxisValues.length;l++){var t=parseFloat(this.xAxisValues[l]);p=this.offsetX+this.left+((t-this.xAxisMin)*this.xAxisUnit);this[r](p,this.offsetY+this.top,p,this.offsetY+this.top+this.y,this.xAxisTickColor)}}}};this.drawTrees=function(){if(!this.isGroupedData){this.drawDendrogram("smpDendrogram");if(this.graphType=="Heatmap"){this.drawDendrogram("varDendrogram")}this.maskTreeArea()}};this.getMaxDepthDendrogramXYs=function(c){if(c.length>0){var a=[];for(var b=0;b<c.length;b++){a.push(c[b][1])}a.sort(function(e,d){return d-e});for(var b=0;b<c.length;b++){if(c[b][1]==a[0]){return b}}}else{return -1}};this.drawDendrogram=function(D){var I=D=="varDendrogram"?"showVarDendrogram":"showSmpDendrogram";var f=D=="varDendrogram"?this.varIndices:this.smpIndices;var A,a,v,ac,aa,E;var S=this.dendrogramSpace/2;if(this.graphType!="Heatmap"){if(this.graphType=="BarLine"&&this.data.a&&this.data.y.desc[1]){var D=this.getVariablesVisibleByAxis("xAxis");var F=this.getVariablesVisibleByAxis("xAxis2");E=Math.max(D.length,F.length)}else{if(this.graphType.match(/Stacked|Line|Area/)){E=1}else{E=this.varIndices.length}}aa=E*this.rowBlockSize}else{aa=0}if(this[I]&&this[D]){var C=this[D].data;var ab=this[D].idxs;var E=this[D].depth;var o=this.getMaxDepthDendrogramXYs(C);var g=this[D].heights;var e=this[D].max;var m={};var u={};var d=[];if(D=="varDendrogram"){for(var Z=0;Z<C.length;Z++){d[Z]=this.createNode(this.data.y.vars[ab[Z]],null,null,0,null)}}else{for(var Z=0;Z<C.length;Z++){d[Z]=this.createNode(this.data.y.smps[ab[Z]],null,null,0,null)}}while(C.length>1){Z=o;var k=[Z];var M=C[Z][0];var L=C[Z][1];var K=C[Z][2];var O=C[Z][3];var q=[M];var p=[L];var n=[K];var s=[O];var G={};var R="";var B=K;G[Z]=1;for(var X=Z+1;X<C.length;X++){var W=C[X][0];var V=C[X][1];var U=C[X][2];var Y=C[X][3];if(V==L&&((U==0&&Y<=O)||(Y<O))){q.push(W);p.push(V);n.push(U);s.push(Y);B+=U;G[X]=1;k.push(X)}else{break}}if(q.length>1){if(D=="varDendrogram"){var h=this.colBlockSize/2;var N;if(this.varDendrogramPosition=="bottom"){N=(this.offsetY+this.top+this.y+this.bottom)-(this.margin+(this.dendrogramSpace*(E+1)))}else{N=(this.offsetY+this.top)-(this.margin+this.getVarTreeHeight())}for(var Z=0;Z<q.length;Z++){d[k[Z]].dist=g[k[Z]];A=(this.offsetX+this.left+h)+(this.colBlockSize*(q[Z]-1));A=this.varIndicesStart>-1?A-(this.colBlockSize*this.varIndicesStart):A;if(this.varDendrogramPosition=="bottom"){ac=this.height-(this.margin+(this.dendrogramSpace*p[Z]));if(this.dendrogramHeight){}else{if(this.isLeafNode(d[k[Z]])&&!this.dendrogramHang){a=N}else{a=ac-this.dendrogramSpace}}}else{a=N+(this.dendrogramSpace*p[Z]);if(this.dendrogramHeight){}else{if(this.isLeafNode(d[k[Z]])&&!this.dendrogramHang){ac=N+(this.dendrogramSpace*(E+1))}else{ac=a+this.dendrogramSpace}}}this.lineClip(A,a,A,ac,this.foreground,[0,0,this.width,this.height]);if(!m.hasOwnProperty(O)){m[O]=0}if(!this.isLeafNode(d[k[Z]])){this.addArea(["rect",A-S,ac-S,A+S,ac+S],[-O],"-"+m[O]+"-varDendrogram");m[O]++}if(Z<q.length-1){v=(this.offsetX+this.left+h)+(this.colBlockSize*(q[Z+1]-1));v=this.varIndicesStart>-1?v-(this.colBlockSize*this.varIndicesStart):v;if(this.varDendrogramPosition=="bottom"){this.lineClip(A,ac,v,ac,this.foreground,[0,0,this.width,this.height])}else{this.lineClip(A,a,v,a,this.foreground,[0,0,this.width,this.height])}}}}else{if(this.graphOrientation=="vertical"){var N;if(this.smpDendrogramPosition=="bottom"){N=(this.offsetY+this.top+this.y+this.bottom)-(this.margin+this.getSampleTitleHeight()+(this.dendrogramSpace*(E+1)));if(this.showLegend&&this.legendPosition=="bottom"){N-=this.getLegendHeight()}}else{N=this.offsetY+this.top-this.getSmpTreeWidthHeight()}for(var Z=0;Z<q.length;Z++){d[k[Z]].dist=g[k[Z]];A=(this.offsetX+this.left+this.blockSeparation+(aa/2))+((this.blockSeparation+aa)*(q[Z]-1));A=this.smpIndicesStart>-1?A-((this.blockSeparation+aa)*this.smpIndicesStart):A;if(this.smpDendrogramPosition=="bottom"){ac=this.height-(this.margin+(this.dendrogramSpace*p[Z]));if(this.showLegend&&this.legendPosition=="bottom"){ac-=this.getLegendHeight()}if(this.dendrogramHeight){}else{if(isEnd&&!this.dendrogramHang){a=N}else{a=ac-this.dendrogramSpace}}}else{a=N+(this.dendrogramSpace*p[Z]);if(this.dendrogramHeight){}else{if(isEnd&&!this.dendrogramHang){ac=N+(this.dendrogramSpace*(E+1))}else{ac=a+this.dendrogramSpace}}}this.lineClip(A,a,A,ac,this.foreground,[0,0,this.width,this.height]);if(!m.hasOwnProperty(O)){m[O]=0}if(!this.isLeafNode(d[k[Z]])){this.addArea(["rect",A-S,ac-S,A+S,ac+S],[-O],"-"+m[O]+"-smpDendrogram");m[O]++}if(Z<q.length-1){v=(this.offsetX+this.left+this.blockSeparation+(aa/2))+((this.blockSeparation+aa)*(q[Z+1]-1));v=this.smpIndicesStart>-1?v-((this.blockSeparation+aa)*this.smpIndicesStart):v;if(this.smpDendrogramPosition=="bottom"){this.lineClip(A,ac,v,ac,this.foreground,[0,0,this.width,this.height])}else{this.lineClip(A,a,v,a,this.foreground,[0,0,this.width,this.height])}}}}else{for(var Z=0;Z<q.length;Z++){d[k[Z]].dist=g[k[Z]];if(this.smpDendrogramPosition=="right"){v=(this.offsetX+this.left+this.x+this.margin)+((this.dendrogramSpace*(E+1))-(this.dendrogramSpace*p[Z]))}else{A=this.offsetX+this.margin+this.getSampleTitleHeight()+(this.dendrogramSpace*p[Z])}if(this.graphType=="Heatmap"){a=(this.offsetY+this.top+this.blockSeparation)+(this.rowBlockSize*(q[Z]-1));a=this.smpIndicesStart>-1?a-(this.rowBlockSize*this.smpIndicesStart):a;if(!this.autoExtend){a-=this.blockSeparation/2}}else{a=(this.offsetY+this.top+this.blockSeparation+(aa/2))+((this.blockSeparation+aa)*(q[Z]-1));a=this.smpIndicesStart>-1?a-((this.blockSeparation+aa)*this.smpIndicesStart):a}if(this.smpDendrogramPosition=="right"){if(this.dendrogramHeight){}else{if(this.isLeafNode(d[k[Z]])&&!this.dendrogramHang){A=this.offsetX+this.left+this.x+this.margin}else{A=v-this.dendrogramSpace}}}else{if(this.dendrogramHeight){}else{if(this.isLeafNode(d[k[Z]])&&!this.dendrogramHang){v=this.offsetX+this.margin+this.getSampleTitleHeight()+(this.dendrogramSpace*(E+1))}else{v=A+this.dendrogramSpace}}}this.lineClip(A,a,v,a,this.foreground,[0,0,this.width,this.height]);if(!m.hasOwnProperty(O)){m[O]=0}if(!this.isLeafNode(d[k[Z]])){this.addArea(["rect",v-S,a-S,v+S,a+S],[-O],"-"+m[O]+"-smpDendrogram");m[O]++}if(Z<q.length-1){if(this.graphType=="Heatmap"){ac=(this.offsetY+this.top+this.blockSeparation)+(this.rowBlockSize*(q[Z+1]-1));ac=this.smpIndicesStart>-1?ac-(this.rowBlockSize*this.smpIndicesStart):ac;if(!this.autoExtend){ac-=this.blockSeparation/2}}else{ac=(this.offsetY+this.top+this.blockSeparation+(aa/2))+((this.blockSeparation+aa)*(q[Z+1]-1));ac=this.smpIndicesStart>-1?ac-((this.blockSeparation+aa)*this.smpIndicesStart):ac}if(this.smpDendrogramPosition=="right"){this.lineClip(v,a,v,ac,this.foreground,[0,0,this.width,this.height])}else{this.lineClip(A,a,A,ac,this.foreground,[0,0,this.width,this.height])}}}}}var T,Q;var b=[];var H=[];var P=[];var J=[];var t=this.mean(q);var c=false;if(!u.hasOwnProperty(O)){u[O]=0}R=(O-1)+"-"+u[O];for(var Q in G){J.push(d[Q])}for(var X=0;X<C.length;X++){if(!G.hasOwnProperty(X)){b.push(C[X]);H.push(d[X])}else{if(!c){b.push([t,L-1,B,s[s.length-1]]);T=J.shift();Q=J.pop();if(J.length>0){H.push(this.createNode(R,T,Q,0,null,J))}else{H.push(this.createNode(R,T,Q,0,null))}u[O]++;c=true}}}for(var X=0;X<g.length;X++){if(!G.hasOwnProperty(X)){P.push(g[X])}}C=b;d=H;g=P;o=this.getMaxDepthDendrogramXYs(C)}}this[D].object=d[0]}};this.draw1DYLayout=function(){var x,d,w,c,v,b,l,s;if(this.smpTitle){var o=(parseInt(this.smpTitleFontSize*this.scaleSmpTitleFontFactor))+"Pt "+this.fontName;if(this.graphOrientation=="vertical"){x=this.offsetX+this.left+(this.x/2);d=this.offsetY+this.height-(this.margin+(parseInt(this.smpTitleFontSize*this.scaleSmpTitleFontFactor)/2));this.drawText(this.smpTitle,x,d,o,this.smpTitleFontColor,"center","middle")}else{x=this.offsetX+this.margin+(parseInt(this.smpTitleFontSize*this.scaleSmpTitleFontFactor)/2);d=this.offsetY+this.top+(this.y/2);this.drawText(this.smpTitle,x,d,o,this.smpTitleColor,"center","middle",-Math.PI/2)}}if(this.showSampleNames){var f=this.isGroupedData?this.grpIndices:this.smpIndices;var n=this.isGroupedData?this.data.w.smps:this.data.y.smps;if(this.graphType=="Heatmap"){if(this.isGraphTime){var h=this.y/f.length;var r=h/2;var m=this.offsetY+this.top+r;x=this.margin*2;for(var t=0;t<this.timeValueIndices.length;t++){d=(this.timeValueIndices[t]*h)+m;this.drawText(this.timeValues[t],x,d,this.smpLabelFont,e,"left","middle")}}else{x=this.offsetX+this.left;d=this.offsetY+this.top+this.blockSeparation;if(!this.autoExtend){d-=this.blockSeparation/2}s=1;var g=this.getSmpOverlaysLength();for(var t=0;t<f.length;t++){var k=this.shortenText(n[f[t]],this.maxSmpStringLen);var u=this.measureText(k,this.smpLabelFont)+(this.margin*2)+g;var e=this.getSmpColor(n[f[t]]);this.drawText(k,x-u,d,this.smpLabelFont,e,"left","middle");d+=this.rowBlockSize}}var r=this.colBlockSize/2;x=this.offsetX+this.left+r;d=this.offsetY+this.top+this.y+this.margin;if(this.varOverlays.length>0){d+=(this.varOverlays.length*this.overlaysWidth)+this.margin}for(var t=0;t<this.varIndices.length;t++){var p=this.shortenText(this.data.y.vars[this.varIndices[t]],this.maxVarStringLen);var e=this.getVarColor(this.data.y.vars[this.varIndices[t]]);this.drawText(p,x,d,this.varLabelFont,e,"right","middle",-Math.PI/2);x+=this.colBlockSize}}else{if(this.graphType=="BarLine"&&this.data.a&&this.data.y.desc[1]){var a=this.getVariablesVisibleByAxis("xAxis");var y=this.getVariablesVisibleByAxis("xAxis2");s=Math.max(a.length,y.length)}else{if(this.graphType.match(/Stacked|Line|Area/)){s=1}else{s=this.varIndices.length}}l=s*this.rowBlockSize;if(this.graphOrientation=="vertical"){if(this.isGraphTime){var h=(this.x-this.blockSeparation)/f.length;var r=h/2;var m=this.offsetX+this.left+(this.blockSeparation*0.5)+r;d=this.offsetY+this.top+this.y+this.getSmpOverlaysLength()+this.measureText(dateFormat(this.timeFormat),this.smpLabelFont)+this.margin;for(var t=0;t<this.timeValueIndices.length;t++){x=(this.timeValueIndices[t]*h)+m;if(this.smpHairline){this.drawText(this.timeValues[t],x,d,this.smpLabelFont,e,"left","middle",-Math.PI/2)}}}else{x=this.offsetX+this.left+this.blockSeparation+(l/2);d=this.offsetY+this.top;c=this.offsetY+this.top+this.y;b=c+this.getSmpOverlaysLength();for(var t=0;t<f.length;t++){var k=this.shortenText(n[f[t]],this.maxSmpStringLen);var u=this.measureText(k,this.smpLabelFont)+this.margin;var e=this.getSmpColor(n[f[t]]);this.drawText(k,x,b+u,this.smpLabelFont,e,"left","middle",-Math.PI/2);x+=this.blockSeparation+l}}}else{if(this.isGraphTime){var h=(this.y-this.blockSeparation)/f.length;var r=h/2;var m=this.offsetY+this.top+(this.blockSeparation*0.5)+r;x=this.margin*2;for(var t=0;t<this.timeValueIndices.length;t++){d=(this.timeValueIndices[t]*h)+m;this.drawText(this.timeValues[t],x,d,this.smpLabelFont,e,"left","middle")}}else{x=this.offsetX+this.left;w=this.offsetX+this.left+this.x;v=x-this.getSmpOverlaysLength();d=this.offsetY+this.top+this.blockSeparation+(l/2);for(var t=0;t<f.length;t++){var k=this.shortenText(n[f[t]],this.maxSmpStringLen);var u=this.measureText(k,this.smpLabelFont)+(this.margin*2);var e=this.getSmpColor(n[f[t]]);this.drawText(k,v-u,d,this.smpLabelFont,e,"left","middle");d+=this.blockSeparation+l}}}}}if(this.showOverlays){if(this.smpOverlays.length>0&&!this.isGroupedData){l=s*this.rowBlockSize;if(this.graphOrientation=="vertical"){x=this.offsetX+this.left;w=l;c=this.overlaysWidth;if(this.graphType!="Heatmap"){x+=this.blockSeparation/2;w+=this.blockSeparation}for(var t=0;t<this.smpIndices.length;t++){d=this.offsetY+this.top+this.y+this.margin;for(var q=0;q<this.smpOverlays.length;q++){this.rectangle(x,d,w,c,this.smpOverlayColors[q][t]);if(l>this.overlaysWidth){this.drawText(this.data.x[this.smpOverlays[q]][this.smpIndices[t]],x+(w/2),d+(c/2),this.overlayFont,this.overlayFontColor,"center","middle",false,l-2)}else{this.drawText(this.data.x[this.smpOverlays[q]][this.smpIndices[t]],x+(w/2),d+(c/2),this.overlayFont,this.overlayFontColor,"center","middle",-Math.PI/2,this.overlaysWidth-2)}d+=c}x+=w}x=this.offsetX+this.left+this.x;d=this.offsetY+this.top+this.y+this.margin+(c/2);for(var t=0;t<this.smpOverlays.length;t++){this.drawText(this.smpOverlays[t],x,d,this.overlayFont,this.overlayFontColor,"left","middle",false,l*2);d+=c}}else{w=this.overlaysWidth;d=this.offsetY+this.top;c=l;if(this.graphType!="Heatmap"){d+=this.blockSeparation/2;c+=this.blockSeparation}for(var t=0;t<this.smpIndices.length;t++){x=this.offsetX+this.left-(this.margin+(this.smpOverlays.length*this.overlaysWidth)+this.margin);for(var q=0;q<this.smpOverlays.length;q++){this.rectangle(x,d,w,c,this.smpOverlayColors[q][t]);if(l>this.overlaysWidth){this.drawText(this.data.x[this.smpOverlays[q]][this.smpIndices[t]],x+(w/2),d+(c/2),this.overlayFont,this.overlayFontColor,"center","middle",-Math.PI/2,l-2)}else{this.drawText(this.data.x[this.smpOverlays[q]][this.smpIndices[t]],x+(w/2),d+(c/2),this.overlayFont,this.overlayFontColor,"center","middle",false,this.overlaysWidth-2)}x+=w}d+=c}x=(this.offsetX+this.left+(w/2))-(this.margin+(this.smpOverlays.length*this.overlaysWidth)+this.margin);d=this.offsetY+this.top+this.y;if(this.graphType=="Heatmap"){d+=this.margin}for(var t=0;t<this.smpOverlays.length;t++){this.drawText(this.smpOverlays[t],x,d,this.overlayFont,this.overlayFontColor,"right","middle",-Math.PI/2,l*2);x+=w}}}if(this.varOverlays.length>0&&this.graphType=="Heatmap"){x=this.offsetX+this.left+(this.colBlockSize/2);c=this.overlaysWidth;for(var t=0;t<this.varIndices.length;t++){d=this.offsetY+this.top+this.y+this.margin;for(var q=0;q<this.varOverlays.length;q++){this.rectangle(x-(this.colBlockSize/2),d,this.colBlockSize,c,this.varOverlayColors[q][t]);if(this.colBlockSize>this.overlaysWidth){this.drawText(this.data.z[this.varOverlays[q]][this.varIndices[t]],x,d+(c/2),this.overlayFont,this.overlayFontColor,"center","middle",-Math.PI/2,this.colBlockSize-2)}else{this.drawText(this.data.z[this.varOverlays[q]][this.varIndices[t]],x,d+(c/2),this.overlayFont,this.overlayFontColor,"center","middle",false,this.overlaysWidth-2)}d+=this.overlaysWidth}x+=this.colBlockSize}x=this.offsetX+this.left+this.x+this.margin;d=this.offsetY+this.top+this.y+this.margin+(c/2);for(var t=0;t<this.varOverlays.length;t++){this.drawText(this.varOverlays[t],x,d,this.overlayFont,this.overlayFontColor,"left","middle",false,this.colBlockSize*2);d+=c}}}};this.draw1DXLayout=function(){if(!this.layoutValid){this.layoutAxis=3}if(this.graphType=="Heatmap"){var b=(this.offsetX+this.left+(this.x/2))-(this.heatmapColors.length/2);var c=this.offsetY+this.top-this.getHeatmapIndicatorHeight();if(this.varDendrogramPosition=="top"){c-=this.getVarTreeHeight()}this.drawColorIndicator(b,c,this.minData,this.maxData,this.xAxisDecs)}else{var g;var d;if(this.graphOrientation=="vertical"){if(this.layoutAxis==1||this.layoutAxis==3){var b=this.offsetX+this.margin+(this.getFontPt(this.axisTitleFont)/2);var c=this.offsetY+this.top+(this.y/2);g=this.graphType=="Candlestick"&&this.summaryType=="volume"?this.xAxis2Title:this.xAxisTitle?this.xAxisTitle:this.data.y.desc&&this.data.y.desc[0]?this.data.y.desc[0]:this.yAxisTitle?this.yAxisTitle:"";if(this.graphType=="BarLine"&&this.data.a&&this.data.y.desc&&this.data.y.desc[1]){this.drawText(g+" (Bars)",b,c,this.axisTitleFont,this.axisTitleColor,"center","middle",-Math.PI/2)}else{this.drawText(g,b,c,this.axisTitleFont,this.axisTitleColor,"center","middle",-Math.PI/2)}d=this.graphType=="Candlestick"&&this.summaryType=="volume"?this.xAxis2Values:this.xAxisValues;b=this.offsetX+this.left-(this.margin*2);for(var a=0;a<d.length;a++){var f=parseFloat(d[a]);var e=this.graphType=="Candlestick"&&this.summaryType=="volume"?sprintf("%."+this.xAxis2Decs+"f",f):sprintf("%."+this.xAxisDecs+"f",f);c=this.graphType=="Candlestick"&&this.summaryType=="volume"?this.offsetY+this.top+this.y-((f-this.xAxis2Min)*this.xAxis2Unit):this.offsetY+this.top+this.y-((f-this.xAxisMin)*this.xAxisUnit);this.drawText(e,b,c,this.axisTickFont,this.axisTickColor,"right","middle")}}if(this.layoutAxis==2||this.layoutAxis==3){b=this.offsetX+this.left+this.x+(this.margin*2);if(this.graphType=="BarLine"&&this.data.a&&this.data.y.desc&&this.data.y.desc[1]){for(var a=0;a<this.xAxis2Values.length;a++){var f=parseFloat(this.xAxis2Values[a]);var e=sprintf("%."+this.xAxis2Decs+"f",f);c=this.offsetY+this.top+this.y-((f-this.xAxis2Min)*this.xAxis2Unit);this.drawText(e,b,c,this.axisTickFont,this.axisTickColor,"left","middle")}g=this.data.y.desc&&this.data.y.desc[1]?this.data.y.desc[1]+" (Lines)":""}else{d=this.graphType=="Candlestick"&&this.summaryType=="volume"?this.xAxis2Values:this.xAxisValues;for(var a=0;a<d.length;a++){var f=parseFloat(d[a]);var e=this.graphType=="Candlestick"&&this.summaryType=="volume"?sprintf("%."+this.xAxis2Decs+"f",f):sprintf("%."+this.xAxisDecs+"f",f);c=this.graphType=="Candlestick"&&this.summaryType=="volume"?this.offsetY+this.top+this.y-((f-this.xAxis2Min)*this.xAxis2Unit):this.offsetY+this.top+this.y-((f-this.xAxisMin)*this.xAxisUnit);this.drawText(e,b,c,this.axisTickFont,this.axisTickColor,"left","middle")}g=this.graphType=="Candlestick"&&this.summaryType=="volume"?this.xAxis2Title:this.xAxisTitle?this.xAxisTitle:this.data.y.desc&&this.data.y.desc[0]?this.data.y.desc[0]:this.yAxisTitle?this.yAxisTitle:""}b=(this.offsetX+this.left+this.x+this.right)-(this.margin+(this.getFontPt(this.axisTitleFont)/2));if(this.showLegend&&this.legendPosition=="right"){b-=this.getLegendWidth()}c=this.offsetY+this.top+(this.y/2);this.drawText(g,b,c,this.axisTitleFont,this.axisTitleColor,"center","middle",-Math.PI/2)}}else{if(this.layoutAxis==1||this.layoutAxis==3){var b=this.offsetX+this.left+(this.x/2);var c=this.offsetY+this.top-((this.margin*4)+this.getFontPt(this.axisTickFont)+(this.getFontPt(this.axisTitleFont)/2));g=this.graphType=="Candlestick"&&this.summaryType=="volume"?this.xAxis2Title:this.xAxisTitle?this.xAxisTitle:this.data.y.desc&&this.data.y.desc[0]?this.data.y.desc[0]:this.yAxisTitle?this.yAxisTitle:"";if(this.graphType=="BarLine"&&this.data.a&&this.data.y.desc&&this.data.y.desc[1]){this.drawText(g+" (Bars)",b,c,this.axisTitleFont,this.axisTitleColor,"center","middle")}else{this.drawText(g,b,c,this.axisTitleFont,this.axisTitleColor,"center","middle")}d=this.graphType=="Candlestick"&&this.summaryType=="volume"?this.xAxis2Values:this.xAxisValues;c=this.offsetY+this.top-((this.margin*2)+(this.getFontPt(this.axisTickFont)/2));for(var a=0;a<d.length;a++){var f=parseFloat(d[a]);var e=this.graphType=="Candlestick"&&this.summaryType=="volume"?sprintf("%."+this.xAxis2Decs+"f",f):sprintf("%."+this.xAxisDecs+"f",f);b=this.graphType=="Candlestick"&&this.summaryType=="volume"?this.offsetX+this.left+((f-this.xAxis2Min)*this.xAxis2Unit):this.offsetX+this.left+((f-this.xAxisMin)*this.xAxisUnit);this.drawText(e,b,c,this.axisTickFont,this.axisTickColor,"center","middle")}}if(this.layoutAxis==2||this.layoutAxis==3){c=this.offsetY+this.top+this.y+(this.margin*2)+(this.getFontPt(this.axisTickFont)/2);if(this.graphType=="BarLine"&&this.data.a&&this.data.y.desc&&this.data.y.desc[1]){for(var a=0;a<this.xAxis2Values.length;a++){var f=parseFloat(this.xAxis2Values[a]);var e=sprintf("%."+this.xAxis2Decs+"f",f);b=this.offsetX+this.left+((f-this.xAxis2Min)*this.xAxis2Unit);this.drawText(e,b,c,this.axisTickFont,this.axisTickColor,"center","middle")}g=this.data.y.desc&&this.data.y.desc[1]?this.data.y.desc[1]+" (Lines)":""}else{d=this.graphType=="Candlestick"&&this.summaryType=="volume"?this.xAxis2Values:this.xAxisValues;for(var a=0;a<d.length;a++){var f=parseFloat(d[a]);var e=this.graphType=="Candlestick"&&this.summaryType=="volume"?sprintf("%."+this.xAxis2Decs+"f",f):sprintf("%."+this.xAxisDecs+"f",f);b=this.graphType=="Candlestick"&&this.summaryType=="volume"?this.offsetX+this.left+((f-this.xAxis2Min)*this.xAxis2Unit):this.offsetX+this.left+((f-this.xAxisMin)*this.xAxisUnit);this.drawText(e,b,c,this.axisTickFont,this.axisTickColor,"center","middle")}g=this.graphType=="Candlestick"&&this.summaryType=="volume"?this.xAxis2Title:this.xAxisTitle?this.xAxisTitle:this.data.y.desc&&this.data.y.desc[0]?this.data.y.desc[0]:this.yAxisTitle?this.yAxisTitle:""}b=this.offsetX+this.left+(this.x/2);c=this.offsetY+this.top+this.y+(this.margin*4)+this.getFontPt(this.axisTickFont)+(this.getFontPt(this.axisTitleFont)/2);this.drawText(g,b,c,this.axisTitleFont,this.axisTitleColor,"center","middle")}}this.rectangle(this.offsetX+this.left,this.offsetY+this.top,this.x,this.y,this.foreground,this.foreground,true)}};this.draw1DDataPoints=function(){var N=this.isGroupedData?this.grpIndices.length:this.smpIndices.length;switch(this.graphType){case"Bar":var c=this.xAxisMin<0?Math.abs(this.xAxisMin)*this.xAxisUnit:0;var e=this.isGroupedData?this.grpIndices:this.smpIndices;if(this.graphOrientation=="vertical"){var a=(this.offsetY+this.top+this.y)-c;var x=this.offsetX+this.left+this.blockSeparation;var w=this.rowBlockSize;for(var Q=0;Q<N;Q++){var J=e[Q];for(var P=0;P<this.varIndices.length;P++){var h=this.colorBy&&this.legendColorsN?this.dataColors[Q]:this.colors[P%this.colors.length];var r=this.varIndices[P];var F=this.getDataAtPos(r,J)-this.xAxisMin;var Y=F*this.xAxisUnit-c;this.addArea(this.rectangleXYShd(x,a,w,-Y,h),[r,J]);if(this.isGroupedData||this.data.y.hasOwnProperty("stdev")){F=this.getDataAtPos(r,J,"stdev")-this.xAxisMin;if(!isNaN(F)){var X=(F/2)*this.xAxisUnit-(c/2);this.errorBar(x+this.rowBlockSize/2,a-Y,x+this.rowBlockSize/2,(a-Y)+X,-this.rowBlockSize/2,this.foreground);this.errorBar(x+this.rowBlockSize/2,a-Y,x+this.rowBlockSize/2,(a-Y)-X,-this.rowBlockSize/2,this.foreground)}}x+=w}x+=this.blockSeparation}}else{var x=this.offsetX+this.left+c;var a=this.offsetY+this.top+this.blockSeparation;var Y=this.rowBlockSize;for(var Q=0;Q<N;Q++){var J=e[Q];for(var P=0;P<this.varIndices.length;P++){var h=this.colorBy&&this.legendColorsN?this.dataColors[Q]:this.colors[P%this.colors.length];var r=this.varIndices[P];var F=this.getDataAtPos(r,J)-this.xAxisMin;var w=F*this.xAxisUnit-c;this.addArea(this.rectangleXYShd(x,a,w,Y,h),[r,J]);if(this.isGroupedData||this.data.y.hasOwnProperty("stdev")){F=this.getDataAtPos(r,J,"stdev")-this.xAxisMin;if(!isNaN(F)){var v=(F/2)*this.xAxisUnit-(c/2);this.errorBar(x+w,a+this.rowBlockSize/2,(x+w)+v,a+this.rowBlockSize/2,this.rowBlockSize/2,this.foreground);this.errorBar(x+w,a+this.rowBlockSize/2,(x+w)-v,a+this.rowBlockSize/2,this.rowBlockSize/2,this.foreground)}}a+=Y}a+=this.blockSeparation}}return true;case"Stacked":case"StackedPercent":var e=this.isGroupedData?this.grpIndices:this.smpIndices;if(this.graphOrientation=="vertical"){var x=this.offsetX+this.left+this.blockSeparation;var w=this.rowBlockSize;for(var Q=0;Q<N;Q++){var J=e[Q];var S=this.getDataForSmpGrpAtIndex(J);var y=this.sum(S);var a=this.offsetY+this.top+this.y;for(var P=0;P<this.varIndices.length;P++){var h=P%this.colors.length;var r=this.varIndices[P];var F=this.getDataAtPos(r,J);var Y=this.graphType=="StackedPercent"?((F*100)/y)*this.xAxisUnit:F*this.xAxisUnit;this.addArea(this.rectangleShd(x,a,w,-Y,this.colors[h]),[r,J]);a-=Y}x+=w+this.blockSeparation}}else{var a=this.offsetY+this.top+this.blockSeparation;var Y=this.rowBlockSize;for(var Q=0;Q<N;Q++){var J=e[Q];var S=this.getDataForSmpGrpAtIndex(J);var y=this.sum(S);var x=this.offsetX+this.left;for(var P=0;P<this.varIndices.length;P++){var h=P%this.colors.length;var r=this.varIndices[P];var F=this.getDataAtPos(r,J);var w=this.graphType=="StackedPercent"?((F*100)/y)*this.xAxisUnit:F*this.xAxisUnit;this.addArea(this.rectangleShd(x,a,w,Y,this.colors[h]),[r,J]);x+=w}a+=Y+this.blockSeparation}}return true;case"Line":var e=this.isGroupedData?this.grpIndices:this.smpIndices;if(this.graphOrientation=="vertical"){var x=this.offsetX+this.left+this.blockSeparation+(this.rowBlockSize/2);var w=x+this.rowBlockSize+this.blockSeparation;for(var Q=0;Q<N-1;Q++){var J=e[Q];var D=e[Q+1];for(var P=0;P<this.varIndices.length;P++){var h=this.colors[P%this.colors.length];var d=this.lineDecoration=="symbol"?this.foreground:h;var G=this.lineDecoration=="symbol"?this.shapes[P%this.shapes.length]:"sphere";var r=this.varIndices[P];var C=this.getDataAtPos(r,J)-this.xAxisMin;var B=this.getDataAtPos(r,D)-this.xAxisMin;var a=(this.offsetY+this.top+this.y)-(C*this.xAxisUnit);var Y=(this.offsetY+this.top+this.y)-(B*this.xAxisUnit);if(!isNaN(C)&&!isNaN(B)){if(C<B){this.lineClipShd(w,Y,x,a,d)}else{this.lineClipShd(x,a,w,Y,d)}}if(this.isGroupedData||this.data.y.hasOwnProperty("stdev")){C=this.getDataAtPos(r,J,"stdev")-this.xAxisMin;B=this.getDataAtPos(r,D,"stdev")-this.xAxisMin;if(!isNaN(C)){var X=(C/2)*this.xAxisUnit;this.errorBar(x,a,x,a+X,-this.rowBlockSize/2,h);this.errorBar(x,a,x,a-X,-this.rowBlockSize/2,h)}if(!isNaN(B)){var X=(B/2)*this.xAxisUnit;this.errorBar(w,Y,w,Y+X,-this.rowBlockSize/2,h);this.errorBar(w,Y,w,Y-X,-this.rowBlockSize/2,h)}}if(!isNaN(C)){if(this.lineDecoration){this.addArea(this[G](x,a,h,this.rowBlockSize/3,false,false,true),[r,J])}}if(!isNaN(B)){if(this.lineDecoration){if(Q==N-2){this.addArea(this[G](w,Y,h,this.rowBlockSize/3,false,false,true),[r,D])}else{this[G](w,Y,h,this.rowBlockSize/3,false,false,true)}}}}x=w;w+=this.rowBlockSize+this.blockSeparation}}else{var a=this.offsetY+this.top+this.blockSeparation+(this.rowBlockSize/2);var Y=a+this.rowBlockSize+this.blockSeparation;for(var Q=0;Q<N-1;Q++){var J=e[Q];var D=e[Q+1];for(var P=0;P<this.varIndices.length;P++){var h=this.colors[P%this.colors.length];var d=this.lineDecoration=="symbol"?this.foreground:h;var G=this.lineDecoration=="symbol"?this.shapes[P%this.shapes.length]:"sphere";var r=this.varIndices[P];var C=this.getDataAtPos(r,J)-this.xAxisMin;var B=this.getDataAtPos(r,D)-this.xAxisMin;var x=this.offsetX+this.left+C*this.xAxisUnit;var w=this.offsetX+this.left+B*this.xAxisUnit;if(!isNaN(C)&&!isNaN(B)){this.lineClipShd(w,Y,x,a,d)}if(this.isGroupedData||this.data.y.hasOwnProperty("stdev")){C=this.getDataAtPos(r,J,"stdev")-this.xAxisMin;B=this.getDataAtPos(r,D,"stdev")-this.xAxisMin;if(!isNaN(C)){var v=(C/2)*this.xAxisUnit;this.errorBar(x,a,x+v,a,this.rowBlockSize/2,h);this.errorBar(x,a,x-v,a,this.rowBlockSize/2,h)}if(!isNaN(B)){var v=(B/2)*this.xAxisUnit;this.errorBar(w,Y,w+v,Y,this.rowBlockSize/2,h);this.errorBar(w,Y,w-v,Y,this.rowBlockSize/2,h)}}if(!isNaN(C)){if(this.lineDecoration){this.addArea(this[G](x,a,h,this.rowBlockSize/3,false,false,true),[r,J])}}if(!isNaN(B)){if(this.lineDecoration){if(Q==N-2){this.addArea(this[G](w,Y,h,this.rowBlockSize/3,false,false,true),[r,D])}else{this[G](w,Y,h,this.rowBlockSize/3,false,false,true)}}}}a=Y;Y+=this.rowBlockSize+this.blockSeparation}}return true;case"Area":var e=this.isGroupedData?this.grpIndices:this.smpIndices;var A=[];var I=[];if(this.graphOrientation=="vertical"){for(var Q=0;Q<N;Q++){A[Q]=this.offsetY+this.top+this.y;I[Q]=this.offsetY+this.top+this.y}for(var Q=0;Q<this.varIndices.length;Q++){var x=this.offsetX+this.left+this.blockSeparation+(this.rowBlockSize/2);var H=[[this.offsetX+this.left,this.offsetY+this.top+this.y]];var J=this.varIndices[Q];var h=this.colors[Q%this.colors.length];for(var P=0;P<N;P++){var r=e[P];var F=this.getDataAtPos(J,r)-this.xAxisMin;var a=!isNaN(F)?F*this.xAxisUnit:0;H.push([x,A[P]-a]);A[P]-=a;x+=this.rowBlockSize+this.blockSeparation}x-=this.rowBlockSize+this.blockSeparation;H.push([this.offsetX+this.left+this.x,this.offsetY+this.top+this.y]);for(var P=N-1;P>=0;P--){H.push([x,I[P]]);I[P]=A[P];x-=this.rowBlockSize+this.blockSeparation}this.addArea(this.polygon(H,h,h),[J])}}else{for(var Q=0;Q<N;Q++){A[Q]=this.offsetX+this.left;I[Q]=this.offsetX+this.left}for(var Q=0;Q<this.varIndices.length;Q++){var a=this.offsetY+this.top+this.blockSeparation+(this.rowBlockSize/2);var H=[[this.offsetX+this.left,this.offsetY+this.top]];var J=this.varIndices[Q];var h=this.colors[Q%this.colors.length];for(var P=0;P<N;P++){var r=e[P];var F=this.getDataAtPos(J,r)-this.xAxisMin;var x=!isNaN(F)?F*this.xAxisUnit:0;H.push([A[P]+x,a]);A[P]+=x;a+=this.rowBlockSize+this.blockSeparation}a-=this.rowBlockSize+this.blockSeparation;H.push([this.offsetX+this.left,this.offsetY+this.top+this.y]);for(var P=N-1;P>=0;P--){H.push([I[P],a]);I[P]=A[P];a-=this.rowBlockSize+this.blockSeparation}this.addArea(this.polygon(H,h,h),[J])}}return true;case"BarLine":var c=this.xAxisMin<0?Math.abs(this.xAxisMin)*this.xAxisUnit:0;var e=this.isGroupedData?this.grpIndices:this.smpIndices;var q=Math.abs(this.xAxisVarIndices.length-this.xAxis2VarIndices.length);var u=this.xAxisVarIndices.length>this.xAxis2VarIndices.length?0:q*this.rowBlockSize;var m=this.xAxisVarIndices.length>this.xAxis2VarIndices.length?q*this.rowBlockSize:0;if(this.graphOrientation=="vertical"){var a=(this.offsetY+this.top+this.y)-c;var x=this.offsetX+this.left+this.blockSeparation;var w=this.rowBlockSize;for(var Q=0;Q<N;Q++){var J=e[Q];for(var P=0;P<this.xAxisVarIndices.length;P++){var h=P%this.colors.length;var r=this.xAxisVarIndices[P];var F=this.getDataAtPos(r,J)-this.xAxisMin;var Y=F*this.xAxisUnit-c;this.addArea(this.rectangleXYShd(x,a,w,-Y,this.colors[h]),[r,J]);if(this.isGroupedData||this.data.y.hasOwnProperty("stdev")){F=this.getDataAtPos(r,J,"stdev")-this.xAxisMin;if(!isNaN(F)){var X=(F/2)*this.xAxisUnit-(c/2);this.errorBar(x+this.rowBlockSize/2,a-Y,x+this.rowBlockSize/2,(a-Y)+X,-this.rowBlockSize/2,this.foreground);this.errorBar(x+this.rowBlockSize/2,a-Y,x+this.rowBlockSize/2,(a-Y)-X,-this.rowBlockSize/2,this.foreground)}}x+=w}x+=this.blockSeparation+u}var x=this.offsetX+this.left+this.blockSeparation+(this.rowBlockSize/2);var w=x+this.blockSeparation+(Math.max(this.xAxisVarIndices.length,this.xAxis2VarIndices.length)*this.rowBlockSize);for(var Q=0;Q<N-1;Q++){var J=e[Q];var D=e[Q+1];for(var P=0;P<this.xAxis2VarIndices.length;P++){var h=this.coordinateLineColor?P%this.colors.length:(P+this.xAxisVarIndices.length)%this.colors.length;var r=this.xAxis2VarIndices[P];var C=this.getDataAtPos(r,J)-this.xAxis2Min;var B=this.getDataAtPos(r,D)-this.xAxis2Min;var a=(this.offsetY+this.top+this.y)-C*this.xAxis2Unit;var Y=(this.offsetY+this.top+this.y)-B*this.xAxis2Unit;if(!isNaN(C)&&!isNaN(B)){if(C<B){this.lineClipShd(w,Y,x,a,this.colors[h])}else{this.lineClipShd(x,a,w,Y,this.colors[h])}}if(this.isGroupedData||this.data.y.hasOwnProperty("stdev")){C=this.getDataAtPos(r,J,"stdev")-this.xAxis2Min;B=this.getDataAtPos(r,D,"stdev")-this.xAxis2Min;if(!isNaN(C)){var X=(C/2)*this.xAxis2Unit;this.errorBar(x,a,x,a+X,-this.rowBlockSize/2,this.colors[h]);this.errorBar(x,a,x,a-X,-this.rowBlockSize/2,this.colors[h])}if(!isNaN(B)){var X=(B/2)*this.xAxis2Unit;this.errorBar(w,Y,w,Y+X,-this.rowBlockSize/2,this.colors[h]);this.errorBar(w,Y,w,Y-X,-this.rowBlockSize/2,this.colors[h])}}if(!isNaN(C)){this.addArea(this.sphere(x,a,this.colors[h],this.rowBlockSize/3,false,false,true),[r,J])}if(!isNaN(B)){if(Q==N-2){this.addArea(this.sphere(w,Y,this.colors[h],this.rowBlockSize/3,false,false,true),[r,D])}else{this.sphere(w,Y,this.colors[h],this.rowBlockSize/3,false,false,true)}}x+=this.rowBlockSize;w+=this.rowBlockSize}x+=this.blockSeparation+m;w+=this.blockSeparation+m}}else{var x=this.offsetX+this.left+c;var a=this.offsetY+this.top+this.blockSeparation;var Y=this.rowBlockSize;for(var Q=0;Q<N;Q++){var J=e[Q];for(var P=0;P<this.xAxisVarIndices.length;P++){var h=P%this.colors.length;var r=this.xAxisVarIndices[P];var F=this.getDataAtPos(r,J)-this.xAxisMin;var w=F*this.xAxisUnit-c;this.addArea(this.rectangleXYShd(x,a,w,Y,this.colors[h]),[r,J]);if(this.isGroupedData||this.data.y.hasOwnProperty("stdev")){F=this.getDataAtPos(r,J,"stdev")-this.xAxisMin;if(!isNaN(F)){var v=(F/2)*this.xAxisUnit-(c/2);this.errorBar(x+w,a+this.rowBlockSize/2,(x+w)+v,a+this.rowBlockSize/2,this.rowBlockSize/2,this.foreground);this.errorBar(x+w,a+this.rowBlockSize/2,(x+w)-v,a+this.rowBlockSize/2,this.rowBlockSize/2,this.foreground)}}a+=Y}a+=this.blockSeparation+u}var a=this.offsetY+this.top+this.blockSeparation+(this.rowBlockSize/2);var Y=a+this.blockSeparation+(Math.max(this.xAxisVarIndices.length,this.xAxis2VarIndices.length)*this.rowBlockSize);for(var Q=0;Q<N-1;Q++){var J=e[Q];var D=e[Q+1];for(var P=0;P<this.xAxis2VarIndices.length;P++){var h=this.coordinateLineColor?P%this.colors.length:(P+this.xAxisVarIndices.length)%this.colors.length;var r=this.xAxis2VarIndices[P];var C=this.getDataAtPos(r,J)-this.xAxis2Min;var B=this.getDataAtPos(r,D)-this.xAxis2Min;var x=this.offsetX+this.left+C*this.xAxis2Unit;var w=this.offsetX+this.left+B*this.xAxis2Unit;if(!isNaN(C)&&!isNaN(B)){this.lineClipShd(w,Y,x,a,this.colors[h])}if(this.isGroupedData||this.data.y.hasOwnProperty("stdev")){C=this.getDataAtPos(r,J,"stdev")-this.xAxis2Min;B=this.getDataAtPos(r,D,"stdev")-this.xAxis2Min;if(!isNaN(C)){var v=(C/2)*this.xAxis2Unit;this.errorBar(x,a,x+v,a,this.rowBlockSize/2,this.colors[h]);this.errorBar(x,a,x-v,a,this.rowBlockSize/2,this.colors[h])}if(!isNaN(B)){var v=(B/2)*this.xAxis2Unit;this.errorBar(w,Y,w+v,Y,this.rowBlockSize/2,this.colors[h]);this.errorBar(w,Y,w-v,Y,this.rowBlockSize/2,this.colors[h])}}if(!isNaN(C)){this.addArea(this.sphere(x,a,this.colors[h],this.rowBlockSize/3,false,false,true),[r,J])}if(!isNaN(B)){if(Q==N-2){this.addArea(this.sphere(w,Y,this.colors[h],this.rowBlockSize/3,false,false,true),[r,D])}else{this.sphere(w,Y,this.colors[h],this.rowBlockSize/3,false,false,true)}}a+=this.rowBlockSize;Y+=this.rowBlockSize}a+=this.blockSeparation+m;Y+=this.blockSeparation+m}}return true;case"Boxplot":var e=this.isGroupedData?this.grpIndices:this.smpIndices;if(this.graphOrientation=="vertical"){var x=this.offsetX+this.left+this.blockSeparation;var w=this.rowBlockSize;for(var Q=0;Q<N;Q++){var J=e[Q];for(var P=0;P<this.varIndices.length;P++){var h=P%this.colors.length;var r=this.varIndices[P];var t=this.getDataAtPos(r,J,"iqr1")-this.xAxisMin;var o=this.getDataAtPos(r,J,"iqr3")-this.xAxisMin;var l=this.getDataAtPos(r,J,"qtl1")-this.xAxisMin;var g=this.getDataAtPos(r,J,"qtl3")-this.xAxisMin;var z=this.getDataAtPos(r,J,"median")-this.xAxisMin;var K=this.getDataAtPos(r,J,"out");var a=(this.offsetY+this.top+this.y)-(l*this.xAxisUnit);var Y=(this.offsetY+this.top+this.y)-(g*this.xAxisUnit);var X=(this.offsetY+this.top+this.y)-(z*this.xAxisUnit);var W=(this.offsetY+this.top+this.y)-(t*this.xAxisUnit);var U=(this.offsetY+this.top+this.y)-(o*this.xAxisUnit);this.addArea(this.rectangleXYShd(x,a,w,Y-a,this.colors[h]),[r,J]);this.lineClipShd(x,X,x+(w-1),X,this.foreground);this.errorBar(x+this.rowBlockSize/2,a,x+this.rowBlockSize/2,W,-this.rowBlockSize/2,this.foreground);this.errorBar(x+this.rowBlockSize/2,Y,x+this.rowBlockSize/2,U,-this.rowBlockSize/2,this.foreground);if(K){for(var O=0;O<K.length;O++){a=(this.offsetY+this.top+this.y)-((K[O]-this.xAxisMin)*this.xAxisUnit);this.sphere(x+this.rowBlockSize/2,a,this.colors[h],this.rowBlockSize/2,false,false,true)}}x+=w}x+=this.blockSeparation}}else{var a=this.offsetY+this.top+this.blockSeparation;var Y=this.rowBlockSize;for(var Q=0;Q<N;Q++){var J=e[Q];for(var P=0;P<this.varIndices.length;P++){var h=P%this.colors.length;var r=this.varIndices[P];var t=this.getDataAtPos(r,J,"iqr1")-this.xAxisMin;var o=this.getDataAtPos(r,J,"iqr3")-this.xAxisMin;var l=this.getDataAtPos(r,J,"qtl1")-this.xAxisMin;var g=this.getDataAtPos(r,J,"qtl3")-this.xAxisMin;var z=this.getDataAtPos(r,J,"median")-this.xAxisMin;var K=this.getDataAtPos(r,J,"out");var x=this.offsetX+this.left+(l*this.xAxisUnit);var w=this.offsetX+this.left+(g*this.xAxisUnit);var v=this.offsetX+this.left+(z*this.xAxisUnit);var s=this.offsetX+this.left+(t*this.xAxisUnit);var p=this.offsetX+this.left+(o*this.xAxisUnit);this.addArea(this.rectangleXYShd(x,a,w-x,Y,this.colors[h]),[r,J]);this.lineClipShd(v,a,v,a+(Y-1),this.foreground);this.errorBar(x,a+this.rowBlockSize/2,s,a+this.rowBlockSize/2,this.rowBlockSize/2,this.foreground);this.errorBar(w,a+this.rowBlockSize/2,p,a+this.rowBlockSize/2,this.rowBlockSize/2,this.foreground);if(K){for(var O=0;O<K.length;O++){x=this.offsetX+this.left+((K[O]-this.xAxisMin)*this.xAxisUnit);this.sphere(x,a+this.rowBlockSize/2,this.colors[h],this.rowBlockSize/2,false,false,true)}}a+=Y}a+=this.blockSeparation}}return true;case"Candlestick":var e=this.isGroupedData?this.grpIndices:this.smpIndices;if(this.graphOrientation=="vertical"){var x=this.offsetX+this.left+this.blockSeparation;var w=this.rowBlockSize;for(var Q=0;Q<N;Q++){var J=e[Q];for(var P=0;P<this.varIndices.length;P++){var h=P%this.colors.length;var r=this.varIndices[P];if(this.summaryType=="candle"){var E=this.getDataAtPos(r,J,"open")-this.xAxisMin;var L=this.getDataAtPos(r,J,"close")-this.xAxisMin;var M=this.getDataAtPos(r,J,"high")-this.xAxisMin;var b=this.getDataAtPos(r,J,"low")-this.xAxisMin;var a=(this.offsetY+this.top+this.y)-(E*this.xAxisUnit);var Y=(this.offsetY+this.top+this.y)-(L*this.xAxisUnit);var X=(this.offsetY+this.top+this.y)-(M*this.xAxisUnit);var W=(this.offsetY+this.top+this.y)-(b*this.xAxisUnit);if(L>E){this.addArea(this.rectangleXYShd(x,a,w,Y-a,this.background,this.colors[h],true),[r,J]);this.lineClipShd(x+this.rowBlockSize/2,Y,x+this.rowBlockSize/2,X,this.colors[h]);this.lineClipShd(x+this.rowBlockSize/2,W,x+this.rowBlockSize/2,a,this.colors[h])}else{this.addArea(this.rectangleXYShd(x,a,w,Y-a,this.colors[h],this.colors[h]),[r,J]);this.lineClipShd(x+this.rowBlockSize/2,W,x+this.rowBlockSize/2,Y,this.colors[h]);this.lineClipShd(x+this.rowBlockSize/2,a,x+this.rowBlockSize/2,X,this.colors[h])}}else{var V=this.getDataAtPos(r,J,"volume")-this.xAxis2Min;var a=(this.offsetY+this.top+this.y)-(V*this.xAxis2Unit);var Y=(V*this.xAxis2Unit);this.addArea(this.rectangleXYShd(x,a,w,Y,this.colors[h],this.colors[h]),[r,J])}x+=w}x+=this.blockSeparation}}else{var a=this.offsetY+this.top+this.blockSeparation;var Y=this.rowBlockSize;for(var Q=0;Q<N;Q++){var J=e[Q];for(var P=0;P<this.varIndices.length;P++){var h=P%this.colors.length;var r=this.varIndices[P];if(this.summaryType=="candle"){var E=this.getDataAtPos(r,J,"open")-this.xAxisMin;var L=this.getDataAtPos(r,J,"close")-this.xAxisMin;var M=this.getDataAtPos(r,J,"high")-this.xAxisMin;var b=this.getDataAtPos(r,J,"low")-this.xAxisMin;var x=this.offsetX+this.left+(E*this.xAxisUnit);var w=this.offsetX+this.left+(L*this.xAxisUnit);var v=this.offsetX+this.left+(M*this.xAxisUnit);var s=this.offsetX+this.left+(b*this.xAxisUnit);if(L>E){this.addArea(this.rectangleXYShd(x,a,w-x,Y,this.background,this.colors[h],true),[r,J]);this.lineClipShd(w,a+this.rowBlockSize/2,v,a+this.rowBlockSize/2,this.colors[h]);this.lineClipShd(s,a+this.rowBlockSize/2,x,a+this.rowBlockSize/2,this.colors[h])}else{this.addArea(this.rectangleXYShd(x,a,w-x,Y,this.colors[h],this.colors[h]),[r,J]);this.lineClipShd(s,a+this.rowBlockSize/2,w,a+this.rowBlockSize/2,this.colors[h]);this.lineClipShd(x,a+this.rowBlockSize/2,v,a+this.rowBlockSize/2,this.colors[h])}}else{var V=this.getDataAtPos(r,J,"volume")-this.xAxis2Min;var x=this.offsetX+this.left;var w=V*this.xAxis2Unit;this.addArea(this.rectangleXYShd(x,a,w,Y,this.colors[h],this.colors[h]),[r,J])}a+=Y}a+=this.blockSeparation}}return true;case"Dotplot":if(this.graphOrientation=="vertical"){var x=this.offsetX+this.left+this.blockSeparation+this.rowBlockSize/2;var w=this.rowBlockSize;var n=this.getShapeSize();if(this.isGroupedData){for(var Q=0;Q<N;Q++){var J=this.grpIndices[Q];for(var P=0;P<this.varIndices.length;P++){var h=P%this.colors.length;var G=parseInt(P/this.colors.length);var r=this.varIndices[P];for(var O=0;O<this.data.w.grps[J].length;O++){var T=this.data.w.grps[J][O];var F=this.data.y.data[r][T]-this.xAxisMin;var a=(this.offsetY+this.top+this.y)-(F*this.xAxisUnit);if(!isNaN(F)){this.addArea(this[this.shapes[G]](x,a,this.colors[h],n,false,false,true),[r,J])}}x+=w}x+=this.blockSeparation}}else{for(var Q=0;Q<N;Q++){var J=this.smpIndices[Q];for(var P=0;P<this.varIndices.length;P++){var h=P%this.colors.length;var G=parseInt(P/this.colors.length);var r=this.varIndices[P];var F=this.getDataAtPos(r,J)-this.xAxisMin;var a=(this.offsetY+this.top+this.y)-(F*this.xAxisUnit);if(this.data.y.hasOwnProperty("stdev")){var R=this.getDataAtPos(r,J,"stdev")-this.xAxisMin;if(!isNaN(R)){var Y=(R/2)*this.xAxisUnit;this.errorBar(x,a,x,a+Y,-this.blockSeparation,this.colors[h]);this.errorBar(x,a,x,a-Y,-this.blockSeparation,this.colors[h])}}if(!isNaN(F)){this.addArea(this[this.shapes[G]](x,a,this.colors[h],n,false,false,true),[r,J])}x+=w}x+=this.blockSeparation}}}else{var a=this.offsetY+this.top+this.blockSeparation+this.rowBlockSize/2;var Y=this.rowBlockSize;var n=this.getShapeSize();if(this.isGroupedData){for(var Q=0;Q<N;Q++){var J=this.grpIndices[Q];for(var P=0;P<this.varIndices.length;P++){var h=P%this.colors.length;var G=parseInt(P/this.colors.length);var r=this.varIndices[P];for(var O=0;O<this.data.w.grps[J].length;O++){var T=this.data.w.grps[J][O];var F=this.data.y.data[r][T]-this.xAxisMin;var x=this.offsetX+this.left+F*this.xAxisUnit;if(!isNaN(F)){this.addArea(this[this.shapes[G]](x,a,this.colors[h],n,false,false,true),[r,J])}}a+=Y}a+=this.blockSeparation}}else{for(var Q=0;Q<N;Q++){var J=this.smpIndices[Q];for(var P=0;P<this.varIndices.length;P++){var h=P%this.colors.length;var G=parseInt(P/this.colors.length);var r=this.varIndices[P];var F=this.getDataAtPos(r,J)-this.xAxisMin;var x=this.offsetX+this.left+F*this.xAxisUnit;if(this.data.y.hasOwnProperty("stdev")){var R=this.getDataAtPos(r,J,"stdev")-this.xAxisMin;if(!isNaN(R)){var w=(R/2)*this.xAxisUnit;this.errorBar(x,a,x+w,a,this.blockSeparation,this.colors[h]);this.errorBar(x,a,x-w,a,this.blockSeparation,this.colors[h])}}if(!isNaN(F)){this.addArea(this[this.shapes[G]](x,a,this.colors[h],n,false,false,true),[r,J])}a+=Y}a+=this.blockSeparation}}}return true;case"Heatmap":var a=this.offsetY+this.top;var w=this.colBlockSize;var Y=this.rowBlockSize;var f="rgb(255,255, 0)";var e=this.isGroupedData?this.grpIndices:this.smpIndices;for(var Q=0;Q<N;Q++){var x=this.offsetX+this.left;var J=e[Q];for(var P=0;P<this.varIndices.length;P++){var r=this.varIndices[P];var F=this.getDataAtPos(r,J);if(!isNaN(F)){var h=this.getHeatmapColor(this.minData,this.maxData,F);this.addArea(this.rectangleXYShd(x,a,w,Y,h),[r,J])}else{this.addArea(this.rectangleXYShd(x,a,w,Y,f),[r,J])}x+=w}a+=Y}return true}throw'Illegal graph type "'+this.graphType+'"'};this.draw1DLegend=function(){if(this.showLegend&&this.graphType!="Heatmap"){if(this.colorBy&&this.graphType=="Bar"){var c=this.offsetX+this.left;var m=this.offsetY+this.top;if(this.legendPosition=="right"){if(this.legendColorsN>0){c=(c+this.x+this.right)-(this.legendColorWidth+this.margin);m+=(this.y-this.legendColorHeight)/2;this.drawColorLegend(c,m)}else{c=(c+this.x+this.right)-this.legendColorIndicatorHeight;m+=((this.y-this.legendColorIndicatorWidth)/2)+this.legendColorIndicatorWidth;this.drawColorIndicator(c,m,this.legendColorRange[0],this.legendColorRange[1],this.legendColorDecs)}}else{if(this.legendColorsN>0){c+=(this.x-this.legendColorWidth)/2;m=(m+this.y+this.bottom)-(this.legendColorHeight+this.margin);this.drawColorLegend(c,m)}else{c+=((this.x-this.legendColorIndicatorWidth)/2);m=(m+this.y+this.bottom)-this.legendColorIndicatorHeight;this.drawColorIndicator(c,m,this.legendColorRange[0],this.legendColorRange[1],this.legendColorDecs)}}}else{if(this.graphType=="BarLine"){var g=this.maxVarName>this.maxVarStringLen?this.maxVarNameStr.substring(0,this.maxVarStringLen):this.maxVarNameStr;var e=this.getFontPt(this.legendFont);var c=this.legendPosition=="right"?this.offsetX+this.left+this.x+(this.margin*4):(this.offsetX+this.left+(this.x/2))-((this.measureText(g,this.legendFont)+e)/2);var m=this.legendPosition=="right"?(this.offsetY+this.top+(this.y/2))-(this.getLegendHeight(true)/2):this.offsetY+this.top+this.y;if(this.smpDendrogramPosition=="right"){c+=this.getSmpTreeWidthHeight()}if(this.legendPosition=="bottom"){if(this.graphOrientation=="vertical"){m+=this.getSampleTitleHeight()+this.getSampleLabelLength()+this.getSmpOverlaysLength()+this.margin}else{m+=this.getAxisTitleTickLength()+this.margin}if(this.showSmpDendrogram&&this.smpDendrogramPosition=="bottom"){m+=this.getSmpTreeWidthHeight()}}else{if(this.graphOrientation=="vertical"){c+=this.getAxisTitleTickLength()}}var l=m-this.margin;for(var f=0;f<this.xAxisVarIndices.length;f++){var n=this.xAxisVarIndices[f];var d=f%this.colors.length;var g=this.shortenText(this.data.y.vars[n],this.maxVarStringLen);var h=this.getVarColor(this.data.y.vars[n]);this.rectangleShd(c,m,e,e,this.colors[d]);this.drawText(g,c+(e*2),m+(e/2),this.legendFont,h,"left","middle");m+=e*1.5}for(var f=0;f<this.xAxis2VarIndices.length;f++){var n=this.xAxis2VarIndices[f];var d=this.coordinateLineColor?f%this.colors.length:(f+this.xAxisVarIndices.length)%this.colors.length;var g=this.shortenText(this.data.y.vars[n],this.maxVarStringLen);var h=this.getVarColor(this.data.y.vars[n]);this.lineShd(c,m+(e/2),c+e,m+(e/2),this.colors[d]);this.drawText(g,c+(e*2),m+(e/2),this.legendFont,h,"left","middle");m+=e*1.5}if(this.legendBox){var g=this.maxVarName>this.maxVarStringLen?this.maxVarNameStr.substring(0,this.maxVarStringLen):this.maxVarNameStr;var k=((m-l)-(e/2))+this.margin;var a=(this.margin*3)+(e*2)+this.measureText(g,this.legendFont);this.rectangleShd(c-this.margin*2,l,a,k,this.foreground,false,true)}}else{var g=this.maxVarName>this.maxVarStringLen?this.maxVarNameStr.substring(0,this.maxVarStringLen):this.maxVarNameStr;var e=this.getFontPt(this.legendFont);var c=this.legendPosition=="right"?this.offsetX+this.left+this.x+(this.margin*4):(this.offsetX+this.left+(this.x/2))-((this.measureText(g,this.legendFont)+e)/2);var m=this.legendPosition=="right"?(this.offsetY+this.top+(this.y/2))-(this.getLegendHeight(true)/2):this.offsetY+this.top+this.y;if(this.legendPosition=="bottom"){if(this.graphOrientation=="vertical"){m+=this.getSampleTitleHeight()+this.getSampleLabelLength()+this.getSmpOverlaysLength()+this.margin}else{m+=this.getAxisTitleTickLength()+this.margin}if(this.showSmpDendrogram&&this.smpDendrogramPosition=="bottom"){m+=this.getSmpTreeWidthHeight()}}else{if(this.graphOrientation=="vertical"){c+=this.getAxisTitleTickLength()}}if(this.smpDendrogramPosition=="right"&&this.showLegend&&this.legendPosition=="right"){c+=this.getSmpTreeWidthHeight()}var l=m-this.margin;for(var f=0;f<this.varIndices.length;f++){var n=this.varIndices[f];var d=f%this.colors.length;var o=this.shapes[f%this.shapes.length];var g=this.shortenText(this.data.y.vars[n],this.maxVarStringLen);var h=this.getVarColor(this.data.y.vars[n]);var b=this.getFontPt(this.legendFont);if(this.graphType=="Line"){var j=this.rowBlockSize/2;if(this.lineDecoration){if(this.lineDecoration=="symbol"){this.lineShd(c,m+(e/2),c+e,m+(e/2),this.foreground);this[o](c+(e/2),m+(e/2),this.colors[d],b)}else{if(this.lineDecoration=="dot"){this.lineShd(c,m+(e/2),c+e,m+(e/2),this.colors[d]);this.circleShd(c+(e/2),m+(e/2),this.colors[d],b)}}}else{this.lineShd(c,m+(e/2),c+e,m+(e/2),this.colors[d])}}else{if(this.graphType=="Dotplot"){o=this.shapes[parseInt(f/this.colors.length)];this[o](c+(e/2),m+(e/2),this.colors[d],e)}else{this.rectangleShd(c,m,e,e,this.colors[d])}}this.drawText(g,c+(e*2),m+(e/2),this.legendFont,h,"left","middle");m+=e*1.5}if(this.legendBox){var g=this.maxVarName>this.maxVarStringLen?this.maxVarNameStr.substring(0,this.maxVarStringLen):this.maxVarNameStr;var k=((m-l)-(e/2))+this.margin;var a=(this.margin*3)+(e*2)+this.measureText(g,this.legendFont);this.rectangleShd(c-this.margin*2,l,a,k,this.foreground,false,true)}}}}};this.setIndicatorsLegendPositions=function(){if(this.colorBy&&this.graphType=="Bar"){this.indicatorsPosition=this.legendPosition}};this.draw1DLayout=function(){this.drawTrees();this.draw1DXLayout();this.draw1DYLayout()};this.draw1DData=function(){this.draw1DWireFrame();this.draw1DDataPoints();this.maskPlotArea();this.draw1DLayout();this.draw1DLegend();this.drawTitle()};this.draw1DPlot=function(){this.setIndicatorsLegendPositions();this.set1DAttributes();this.set1DXYDimensions();this.set1DPrivateParams();this.set1DXAxis();this.draw1DData()};this.initialize1DPlot=function(){if(this.layoutValid){this.drawLayoutCompartments(this.draw1DPlot)}else{this.draw1DPlot()}};this.initialize1DPlot()};CanvasXpress.prototype.Network=function(){this.addNode=function(d,c){if(d){if(!d.id){var a=0;var e="id"+a;while(this.nodes.hasOwnProperty(e)){a++;e="id"+a}d.id=e}if(!d.color){d.color=this.colors[0]}if(!d.shape){d.shape=this.shapes[0]}if(!d.size){d.size=1}if(c){var b=this.findXYCoordinates(c);d.x=b.x;d.y=b.y}this.data.nodeIndices[d.id]=this.data.nodes.length;this.data.nodes.push(d);this.nodes[d.id]=d;return d}};this.removeNode=function(g,f){if(g&&g.id){this.data.nodeIndices={};var e=f?this.getObjectArray(this.findChildrenNodeIndices(g.id)):false;var d=[];var h=0;for(var c=0;c<this.data.nodes.length;c++){if(this.data.nodes[c].id!=g.id){if(e&&e.hasOwnProperty(c)){var a=this.edgesForNode(this.data.edges,this.data.nodes[c].id);for(var b=0;b<a.length;b++){this.removeEdge(a[b])}}else{d.push(this.data.nodes[c]);this.data.nodeIndices[this.data.nodes[c].id]=h;h++}}else{var a=this.edgesForNode(this.data.edges,g.id);for(var b=0;b<a.length;b++){this.removeEdge(a[b])}}}this.data.nodes=d}};this.addEdge=function(a){if(a&&a.id1&&a.id2){if(!a.color){a.color=this.colors[0]}if(!a.width){a.width=1}if(!a.type){a.type="line"}this.data.edges.push(a)}};this.removeEdge=function(c){if(c&&c.id1&&c.id2){var b=[];for(var a=0;a<this.data.edges.length;a++){if(this.data.edges[a].id1!=c.id1||this.data.edges[a].id2!=c.id2){b.push(this.data.edges[a])}}this.data.edges=b}};this.getAllObjectAttributes=function(c){var d=[];if(this.data[c]){for(var b=0;b<this.data[c].length;b++){for(var a in this.data[c][b]){if(d.hasOwnProperty(a)){d[a]++}else{d[a]=1}}}}return d};this.setAllObjectAttributes=function(k,l,p){if(this.data[k]){var m=this.getAllObjectAttributeValues(k,p);if(m){if(this.isNumeric(m)){var h=this.range(m);if(l=="color"){var n="rgb(255,255,0)";this.setHeatmapColors(h[1]-h[0]);for(var f=0;f<this.data[k].length;f++){if(this.data[k][f].hasOwnProperty(p)){var d=this.data[k][f][p];var c=this.getHeatmapColor(h[0],h[1],d);this.data[k][f][l]=c}else{this.data[k][f][l]=n}}}else{if(l=="size"){for(var f=0;f<this.data[k].length;f++){if(this.data[k][f].hasOwnProperty(p)){var d=this.data[k][f][p];var e=this.percentile(h[0],h[1],d);var b=parseInt(e*25/10);this.data[k][f][l]=1+(b/100)}else{this.data[k][f][l]=0.5}}}else{if(l=="shape"&&k=="nodes"){var r="square";for(var f=0;f<this.data[k].length;f++){if(this.data[k][f].hasOwnProperty(p)){var d=this.data[k][f][p];var e=this.percentile(h[0],h[1],d);var q=parseInt(e/10);if(q>0){q--}this.data[k][f][l]="pie"+q}else{this.data[k][f][l]=r}}}}}}else{var o=0;var g=0;var j=0.1;var a={color:{},shape:{},size:{}};for(var f=0;f<m.length;f++){if(!a.color.hasOwnProperty(m[f])){a.color[m[f]]=this.colors[o%this.colors.length];o++}if(k=="nodes"){if(!a.shape.hasOwnProperty(m[f])){a.shape[m[f]]=this.shapes[g%this.shapes.length];g++}}else{if(!a.shape.hasOwnProperty(m[f])){a.lines[m[f]]=this.lines[g%this.lines.length];g++}}if(!a.size.hasOwnProperty(m[f])){a.size[m[f]]=j;j+=0.1}}for(var f=0;f<this.data[k].length;f++){if(this.data[k][f].hasOwnProperty(p)){var d=this.data[k][f][p];this.data[k][f][l]=a[l][d]}}}}}};this.getAllObjectAttributeValues=function(c,a){var d=[];if(this.data[c]){for(var b=0;b<this.data[c].length;b++){if(this.data[c][b].hasOwnProperty(a)){d.push(this.data[c][b][a])}}}return d};this.modifyXYNode=function(g,c,a){var f=this.data.nodes[this.data.nodeIndices[g]];f.x-=c;f.y-=a;if(f.labelX&&f.labelY){this.modifyXYNodeLab(g,c,a)}if(this.networkLayoutType!="radial"){if(this.nodeParentHood[f.id]&&this.nodeParentHood[f.id]["children"]){for(var e=0;e<this.nodeParentHood[f.id]["children"].length;e++){var b=this.nodeParentHood[f.id]["children"][e];var d=this.data.nodes[this.data.nodeIndices[b]];this.modifyXYNode(b,c,a)}}}};this.modifyXYNodeLab=function(g,c,b){var f=this.data.nodes[this.data.nodeIndices[g]];var d=f.label?f.label:f.name?f.name:f.id;var e=this.measureText(d,this.nodeFont);var a=this.nodeFontSize;if(f.labelX&&f.labelY){f.labelX-=c;f.labelY-=b}else{if(this.rangeX>this.rangeY){f.labelX=(f.x-(e/2))-c;f.labelY=(f.y+((this.nodeWidth*f.size)/1.3))-b}else{f.labelX=(f.x+((this.nodeWidth*f.size)/1.3))-c;f.labelY=(f.y-(a/2))-b}}};this.getHiddenNodes=function(){var b=[];if(this.data.nodes){for(var a=0;a<this.data.nodes.length;a++){if(this.data.nodes[a].hide){b.push(this.data.nodes[a])}}}return b};this.sendNodeToBack=function(c){var b=[c];for(var a=0;a<this.data.nodes.length;a++){if(this.data.nodes[a].id!=c.id){b.push(this.data.nodes[a])}}this.data.nodes=b;this.setNodeIndices()};this.sendNodeBackward=function(d){var c=[];var a=this.data.nodeIndices[d.id];if(a>0){for(var b=0;b<a-1;b++){c.push(this.data.nodes[b])}c.push(this.data.nodes[a]);c.push(this.data.nodes[a-1]);for(var b=a+1;b<this.data.nodes.length;b++){c.push(this.data.nodes[b])}this.data.nodes=c;this.setNodeIndices()}};this.bringNodeToFront=function(c){var b=[];for(var a=0;a<this.data.nodes.length;a++){if(this.data.nodes[a].id!=c.id){b.push(this.data.nodes[a])}}b.push(c);this.data.nodes=b;this.setNodeIndices()};this.bringNodeForward=function(d){var c=[];var a=this.data.nodeIndices[d.id];if(this.data.nodes.length-1>a){for(var b=0;b<a;b++){c.push(this.data.nodes[b])}c.push(this.data.nodes[a+1]);c.push(this.data.nodes[a]);for(var b=a+2;b<this.data.nodes.length;b++){c.push(this.data.nodes[b])}this.data.nodes=c;this.setNodeIndices()}};this.addLegend=function(a,d,c){this.inititalizeNetworkLegend();if(a&&d){if(c&&a=="text"){var b=this.findXYCoordinates(c);d.x=b.x;d.y=b.y}this.data.legend[a].push(d);return d}};this.deleteLegend=function(c,d){if(c&&d&&d.id){var b=[];for(var a=0;a<this.data.legend[c].length;a++){if(this.data.legend[c][a].id!=d.id){b.push(this.data.legend[c][a])}}this.data.legend[c]=b;delete this.data.legend.ids[c][d.id]}};this.alignDistributeSelectedNodes=function(b){if(this.isSelectNodes>1){var e,a,g,k,f;var h=this.getSelectedNodeCoordinates();if(b==84){e=this.min(h.y);for(var f in this.selectNode){var d=this.data.nodes[this.data.nodeIndices[f]];this.addCoordinatesToStack(d,d.x,d.y);d.y=e}}else{if(b==82){e=this.max(h.x);for(var f in this.selectNode){var d=this.data.nodes[this.data.nodeIndices[f]];this.addCoordinatesToStack(d,d.x,d.y);d.x=e}}else{if(b==66){e=this.max(h.y);for(var f in this.selectNode){var d=this.data.nodes[this.data.nodeIndices[f]];this.addCoordinatesToStack(d,d.x,d.y);d.y=e}}else{if(b==76){e=this.min(h.x);for(var f in this.selectNode){var d=this.data.nodes[this.data.nodeIndices[f]];this.addCoordinatesToStack(d,d.x,d.y);d.x=e}}else{if(b==86){a=this.range(h.y);g=this.rank(h.y);k=(a[1]-a[0])/(this.isSelectNodes-1);e=a[0];for(var j=0;j<g.length;j++){f=h.i[g[j]];var d=this.data.nodes[this.data.nodeIndices[f]];this.addCoordinatesToStack(d,d.x,d.y);d.y=e+(j*k)}}else{if(b==72){a=this.range(h.x);g=this.rank(h.x);k=(a[1]-a[0])/(this.isSelectNodes-1);e=a[0];for(var j=0;j<g.length;j++){f=h.i[g[j]];var d=this.data.nodes[this.data.nodeIndices[f]];this.addCoordinatesToStack(d,d.x,d.y);d.x=e+(j*k)}}else{if(b==85){for(var f in this.selectNode){var d=this.data.nodes[this.data.nodeIndices[f]];if(d.stack&&d.stack.x.length>0){d.x=d.stack.x.pop();d.y=d.stack.y.pop()}}}}}}}}}this.draw()}};this.getSelectedNodeCoordinates=function(){var d={x:[],y:[],i:[]};for(var a in this.selectNode){var b=this.data.nodes[this.data.nodeIndices[a]];d.x.push(b.x);d.y.push(b.y);d.i.push(a)}return d};this.addCoordinatesToStack=function(b,a,c){if(!b.stack){b.stack={x:[],y:[]}}b.stack.x.push(a);b.stack.y.push(c)};this.setNetworkDimensions=function(){this.x=this.width;this.y=this.height};this.setNetworkPrivateParams=function(){if(this.data.nodes.length>0){this.layoutDone=false;this.x=this.width;this.y=this.height;if(this.networkLayoutType=="radial"){if(this.width>this.height){this.width=this.height}else{this.height=this.width}this.x=this.width;this.y=this.height;this.networkXCenter=this.x/2;this.networkYCenter=this.y/2}else{this.x=this.width;this.y=this.height;this.set3DParams();this.area=this.x*this.y;this.k=Math.sqrt(this.area/this.data.nodes.length);this.temperature=this.data.nodes.length+Math.floor(Math.sqrt(this.data.edges.length));this.minimumTemperature=1;this.initialTemperature=this.temperature;this.iteration=0}if(this.x<=400||this.y<=400){this.nodeWidth-=4;this.nodeFont=(this.nodeWidth-6)+"Pt "+this.fontName;this.showAnimationFont=this.nodeFont+"Pt "+this.fontName}else{this.edgeWidth=2}}else{this.layoutDone=true}};this.networkContains=function(a,b){return this.findNode(a,b)!=null};this.findNode=function(b,d){for(var c in b){var a=b[c];if(d.call(a)){return a}}return null};this.filterEdges=function(b,e){var d=[];for(var c in b){var a=b[c];if(e.call(a)){d.push(a)}}return d};this.reduceNetwork=function(a,e,c){var d=null;for(var b in a){if(d==null){if(c){d=c.apply(c,[a[b]])}else{d=a[b]}}else{d=e.apply(a[b],[d,a[b]])}}return d};this.vectorDifference=function(b,a){return{x:b.x-a.x,y:b.y-a.y,z:b.z-a.z}};this.vectorMagnitude=function(a){if(this.is3DNetwork){var b=Math.sqrt((a.x*a.x)+(a.y*a.y)+(a.z*a.z));return isNaN(b)?0:b}else{return Math.sqrt((a.x*a.x)+(a.y*a.y))}};this.normalizeGraph=function(h){var g=[];var a={};var j=this;for(var e in h.nodes){if(!a.hasOwnProperty(h.nodes[e].id)){var d=h.nodes[e];var c=[];a[d.id]=1;if(!this.networkContains(c,function(){return j.networkContains(this.nodes,function(){return this.id=d.id})})){var b={};b.nodes=[];b.edges=[];this.addNodeToGraph(d,b,h);if(b.nodes.length>0){g.push(b)}for(var f=0;f<b.nodes.length;f++){a[b.nodes[f].id]=1}}}}return g};this.addNodeToGraph=function(c,e,d){if(this.findNodeForId(c.id,e)==null){e.nodes.push(c);var a=this.edgesForNode(d.edges,c.id);for(edgeIndex in a){var b=a[edgeIndex];e.edges.push(b);if(b.id1==c.id){this.addNodeToGraph(this.findNodeForId(b.id2,d),e,d)}else{this.addNodeToGraph(this.findNodeForId(b.id1,d),e,d)}}}};this.findNodeForId=function(b,a){return this.findNode(a.nodes,function(){return b==this.id})};this.edgesForNode=function(a,b){return this.filterEdges(a,function(c){return(this.id1==b||this.id2==b)})};this.attractiveForce=function(b,a){return(b*b)/a};this.repulsiveForce=function(b,a){return(a*a)/b};this.storePositions=function(){var d={};for(var b=0;b<this.data.nodes.length;b++){var c=this.data.nodes[b];if(!c.hide&&!c.hiddenParent){var a={x:c.x,y:c.y,z:c.z};d[c.id]=a}}return d};this.calculateRepulsiveDisplacement=function(e){for(var d=0;d<this.data.nodes.length;d++){var h=this.data.nodes[d];if(!h.hide&&!h.hiddenParent){var a={x:0,y:0,z:0};for(var b=0;b<this.data.nodes.length;b++){var f=this.data.nodes[b];if(!f.hide&&!f.hiddenParent){var g=this.vectorDifference(h,f);var c=this.vectorMagnitude(g);if(c!=0){a.x+=(g.x/c)*this.repulsiveForce(c,this.k);a.y+=(g.y/c)*this.repulsiveForce(c,this.k);a.z+=(g.z/c)*this.repulsiveForce(c,this.k)}}e[h.id]=a}}}};this.calculateAttractiveDisplacement=function(e){for(var c=0;c<this.data.edges.length;c++){var d=this.data.edges[c];if(!this.nodes||!this.nodes[d.id1]||!this.nodes[d.id2]){alert('Nodes "'+d.id1+'" and/or "'+d.id2+'" are missing!');return}if(this.nodes&&!this.nodes[d.id1].hide&&!this.nodes[d.id2].hide&&!this.nodes[d.id1].hiddenParent&&!this.nodes[d.id2].hiddenParent){var g=this.vectorDifference(this.nodes[d.id1],this.nodes[d.id2]);var b=this.vectorMagnitude(g);if(b!=0){var f=e[d.id1];f.x-=(g.x/b)*this.attractiveForce(b,this.k);f.y-=(g.y/b)*this.attractiveForce(b,this.k);f.z-=(g.z/b)*this.attractiveForce(b,this.k);var a=e[d.id2];a.x+=(g.x/b)*this.attractiveForce(b,this.k);a.y+=(g.y/b)*this.attractiveForce(b,this.k);a.z+=(g.z/b)*this.attractiveForce(b,this.k)}}}};this.isLayoutDone=function(){var h=this.storePositions();var j=0;var b=0;var d;var g;for(var f=0;f<this.data.nodes.length;f++){if(!this.data.nodes[f].hide&&!this.data.nodes[f].hiddenParent){var c=this.data.nodes[f].id;var a=h[c];if(d){d.x=Math.min(d.x,a.x);d.y=Math.min(d.y,a.y);d.z=Math.min(d.z,a.z);g.x=Math.max(g.x,a.x);g.y=Math.max(g.y,a.y);g.z=Math.max(g.z,a.z)}else{d={};g={};d.x=a.x;d.y=a.y;d.z=a.z;g.x=a.x;g.y=a.y;g.z=a.z}var k=Math.abs(this.vectorMagnitude(this.vectorDifference(this.previousNodePositions[c],a)));j+=k;b++}}var m=j/b;var e=Math.abs(this.vectorMagnitude(this.vectorDifference(d,g)));var l=Math.abs(this.vectorMagnitude({x:this.x,y:this.y,z:parseInt((this.x+this.y)/2)}));this.minimumTemperature=(e/l);this.layoutDone=m<(this.minimumTemperature/2);this.previousNodePositions=h;if(this.initialProgress==null&&this.temperature<=this.minimumTemperature){this.initialProgress=m-(this.minimumTemperature/2)}if(this.initialProgress!=null){this.layoutProgress=Math.max(this.layoutProgress,1-((m-(this.minimumTemperature/2))/this.initialProgress))}};this.applyDisplacement=function(d){if(this.nodes){for(var e in d){var c=this.nodes[e];var b=d[e];var a=this.vectorMagnitude(b);if(a!=0){c.x+=(b.x/a)*Math.min(this.temperature,Math.abs(b.x));c.y+=(b.y/a)*Math.min(this.temperature,Math.abs(b.y));c.z+=(b.z/a)*Math.min(this.temperature,Math.abs(b.z))}}}};this.setInitialForceDirectedLayout=function(){this.layoutProgress=0;for(var a=0;a<this.data.nodes.length;a++){if(!this.data.nodes[a].hide&&!this.data.nodes[a].hiddenParent){this.data.nodes[a].x=Math.floor(Math.random()*this.x);this.data.nodes[a].y=Math.floor(Math.random()*this.y);this.data.nodes[a].z=this.is3DNetwork?Math.floor(Math.random()*parseInt((this.x+this.y)/2)):0}}this.previousNodePositions=this.storePositions()};this.updateForceDirectedLayout=function(c){var d=new Date().getTime();var b=d;if(this.data.edges.length<1){this.layoutDone=true}if(!this.layoutDone){while(b-d<c){var a={};this.calculateRepulsiveDisplacement(a);this.calculateAttractiveDisplacement(a);this.applyDisplacement(a);this.iteration++;this.temperature=Math.max(this.temperature-(this.initialTemperature/100),this.minimumTemperature);if(this.iteration%10==0){this.isLayoutDone()}b=new Date().getTime()}}return this.layoutDone};this.renderNetwork=function(){this.ctx.shadowOffsetX=this.shadowOffsetX;this.ctx.shadowOffsetY=this.shadowOffsetY;this.ctx.shadowBlur=this.shadowBlur;this.ctx.shadowColor=this.shadowColor;this.setNetworkRotation();this.resizeCanvas();if(!this.layoutDone&&!this.showAnimation){this.drawNetworkProgressBar(true);return}if(this.data.nodes.length>0){if(this.layoutDone){this.setXYNodePrecision()}this.setNetworkMinMaxRangeXY();this.setNetworkScaleFactor();if(this.scaleFactor){if(this.showAnimation){if(this.preScaleNetwork){this.centerNetwork();this.ctx.save();this.ctx.scale(1/this.scaleFactor,1/this.scaleFactor);this.ctx.translate(this.offsetX,this.offsetY);this.ctx.restore();this.drawNetworkEdges();this.drawNetworkNodes();if(this.layoutDone){this.drawNetworkLegend()}this.ctx.save();this.ctx.translate(-this.offsetX,-this.offsetY);this.ctx.scale(this.scaleFactor,this.scaleFactor);this.ctx.restore()}else{this.ctx.scale(this.scaleFactor,this.scaleFactor);this.ctx.translate(this.offsetX,this.offsetY);if(this.networkLayoutType=="radial"&&this.showNetworkRadialLayout){this.renderRadialLayout()}if(this.layoutDone){this.drawNetworkEdges();this.drawNetworkNodes();this.drawNetworkLegend()}this.ctx.translate(-this.offsetX,-this.offsetY);this.ctx.scale(1/this.scaleFactor,1/this.scaleFactor)}}else{if(this.preScaleNetwork){this.centerNetwork();this.ctx.save();this.ctx.scale(this.scaleFactor,this.scaleFactor);this.ctx.translate(this.offsetX,this.offsetY);this.ctx.restore()}else{this.ctx.scale(this.scaleFactor,this.scaleFactor);this.ctx.translate(this.offsetX,this.offsetY)}if(this.networkLayoutType=="radial"&&this.showNetworkRadialLayout){for(var a=1;a<this.networkDepth;a++){this.circle(this.networkXCenter,this.networkYCenter,this.infoAreaColor,a*this.networkLevelSize*2,true)}}this.drawNetworkEdges();this.drawNetworkNodes();if(this.layoutDone){this.drawNetworkLegend()}}this.drawNetworkProgressBar()}}};this.renderRadialLayout=function(){var a=this.data.nodes[this.data.nodeIndices[this.networkRoot]];for(var b=1;b<this.networkDepth;b++){this.circle(a.x,a.y,this.infoAreaColor,b*this.networkLevelSize*2,true)}};this.centerNetwork=function(){for(var a=0;a<this.data.nodes.length;a++){var b=this.data.nodes[a];if(!b.hide&&!b.hiddenParent){b.x=(this.offsetX+b.x)*this.scaleFactor;b.y=(this.offsetY+b.y)*this.scaleFactor}}this.scaleFactor=0.9;this.offsetX=this.x*0.05;this.offsetY=this.y*0.05};this.adjustNetworkObjects=function(b){if(b){if(b[0]=="circle"){b[1]=(this.offsetX+b[1])*this.scaleFactor;b[2]=(this.offsetY+b[2])*this.scaleFactor;b[3]=b[3]*this.scaleFactor}else{for(var a=1;a<b.length;a++){if(a%2){b[a]=(this.offsetX+b[a])*this.scaleFactor}else{b[a]=(this.offsetY+b[a])*this.scaleFactor}}}}else{return false}return b};this.validateNetworkLine=function(e,g,d,f,a,c,b){if(b.match(/bezier/i)){if(b.match(/beziery/i)){if(f>g){if(g+a>f-c){b=b.replace(/beziery/i,"")}}else{if(g-a<f+c){b=b.replace(/beziery/i,"")}}}else{if(d>e){if(e+a>d-c){b=b.replace(/bezier[x]?/i,"")}}else{if(e-a<d+c){b=b.replace(/bezier[x]?/i,"")}}}}return b};this.setXYNodePrecision=function(){for(var a=0;a<this.data.nodes.length;a++){var b=this.data.nodes[a];if(b.x){b.x=parseInt(b.x);this.nodes[b.id].x=b.x}if(b.y){b.y=parseInt(b.y);this.nodes[b.id].y=b.y}if(b.z){b.z=parseInt(b.z);this.nodes[b.id].z=b.z}}};this.drawNetworkEdges=function(){if(this.nodes){var a={};var e=this.foreground;for(var p=0;p<this.data.edges.length;p++){var g=this.data.edges[p];var n=this.nodes[g.id1];var m=this.nodes[g.id2];var t=false;if(!n.hide&&!n.hiddenParent&&!m.hide&&!m.hiddenParent&&!g.anchor){t=true}else{if(this.showHiddenChildEdges){if(n.hide||n.hiddenParent||(n.parentNode&&this.nodes[n.parentNode].hideChildren)){n=this.findVisibleParentNode(g.id1);if(n){t=true}}if(m.hide||m.hiddenParent||(m.parentNode&&this.nodes[m.parentNode].hideChildren)){m=this.findVisibleParentNode(g.id2);if(m){t=true}}}}var v=n.id+":"+m.id;if(t){if(!a.hasOwnProperty(v)){var c=n.size<2?1:n.size>5?1.6:n.size>3?1.5:1.2;var b=m.size<2?1:m.size>5?1.6:m.size>3?1.5:1.2;var u=n.size?(n.size/c)*this.nodeWidth:0;var f=m.size?(m.size/b)*this.nodeWidth:0;var d=this.selectNode.hasOwnProperty(n.id)&&this.selectNode.hasOwnProperty(m.id)?this.nodeHighlightColor:g.color?g.color:e;var h=g.width?g.width:1;this.ctx.lineWidth=h*this.edgeWidth;var l,j,r,q;if(this.is3DNetwork){l=n.x3d;j=n.y3d;r=m.x3d;q=m.y3d}else{l=n.x;j=n.y;r=m.x;q=m.y}var k=g.type?this.validateNetworkLine(l,j,r,q,u,f,g.type):"line";var o=this.shortenLine(l,j,r,q,u,f,k);var s=this.drawLine(o[0],o[1],o[2],o[3],d,k,u,f);if(this.layoutDone&&!this.isAnimation){if(this.preScaleNetwork){this.addArea(s,[p+this.data.nodes.length])}else{this.addArea(this.adjustNetworkObjects(s),[p+this.data.nodes.length])}}this.ctx.lineWidth=1;a[v]=1}}}}};this.drawNetworkNodes=function(){var h=this.data.nodes.length<this.showNodeNameThreshold?true:false;var e=this.foreground;var q=this.shapes[0];var f=this.rangeX>this.rangeY?"bottom":"right";for(var s=0;s<this.data.nodes.length;s++){var p=this.data.nodes[s];if(!p.hide&&!p.hiddenParent&&!p.anchor){var k=this.is3DNetwork?p.x3d:p.x;var u=this.is3DNetwork?p.y3d:p.y;var n=p.shape?p.shape:q;var d=this.selectNode.hasOwnProperty(p.id)?this.nodeHighlightColor:p.color?p.color:e;var t=p.size?p.size:1;var v=this[n](k,u,d,this.nodeWidth*t);if(this.layoutDone&&!this.isAnimation){if(this.preScaleNetwork){this.addArea(v,[s])}else{this.addArea(this.adjustNetworkObjects(v),[s])}if(h&&!p.hideName){var b,a;var g=p.label?p.label:p.name?p.name:p.id;var r=this.getNodeColor(p.id);var c=p.labelSize?this.nodeFontSize*p.labelSize*this.scaleNodeFontFactor:this.nodeFontSize*this.scaleNodeFontFactor;var l=(parseInt(c))+"Pt "+this.fontName;var o=this.measureText(g,l);var m=c;if(p.labelX&&p.labelY){b=p.labelX-(o/2);a=p.labelY-(m/2);this.drawText(g,p.labelX,p.labelY,l,r,"center","middle")}else{if(f=="right"){b=k+((this.nodeWidth*t)/1.3);a=u-(m/2);this.drawText(g,k+((this.nodeWidth*t)/1.3),u,l,r,"left","middle")}else{b=k-(o/2);a=u+((this.nodeWidth*t)/1.3);this.drawText(g,k,u+((this.nodeWidth*t)/1.3),l,r,"center","top")}}var j=["rect",b,a,b+o,a+m];if(this.preScaleNetwork&&!this.isAnimation){this.addArea(j,[s],"-lab")}else{this.addArea(this.adjustNetworkObjects(j),[s],"-lab")}}}}}};this.getLegendId=function(b,c){if(b){if(!c){var a=0;c=b+"LegendId"+a;while(this.data.legend.ids[b].hasOwnProperty(c)){a++;c=b+"LegendId"+a}}this.data.legend.ids[b][c]=true;return c}};this.findNetworkXYRange=function(){if(this.data.nodes.length>0){var a=Number.MAX_VALUE;var e=Number.MIN_VALUE;var f=Number.MAX_VALUE;var d=Number.MIN_VALUE;if(this.is3DNetwork&&this.layoutDone&&this.scaleFactor){for(var b=0;b<this.data.nodes.length;b++){var c=this.data.nodes[b];if(!c.hide&&!c.hiddenParent&&!c.anchor){a=Math.min(a,c.x3d);e=Math.max(e,c.x3d);f=Math.min(f,c.y3d);d=Math.max(d,c.y3d)}}}else{for(var b=0;b<this.data.nodes.length;b++){var c=this.data.nodes[b];if(!c.hide&&!c.hiddenParent&&!c.anchor){a=Math.min(a,c.x);e=Math.max(e,c.x);f=Math.min(f,c.y);d=Math.max(d,c.y)}}}}return({minX:a,maxX:e,minY:f,maxY:d})};this.inititalizeNetworkLegend=function(){if(!this.data.legend){this.data.legend={}}if(!this.data.legend.pos){this.data.legend.pos={nodes:{x:false,y:false},edges:{x:false,y:false}}}if(!this.data.legend.ids){this.data.legend.ids={nodes:{},edges:{},text:{}}}};this.drawNetworkLegend=function(){this.inititalizeNetworkLegend();var a=this.findNetworkXYRange();this.curLegendX=a.minX;this.curLegendY=a.minY;this.drawNetworkLegendNodes();this.drawNetworkLegendEdges();this.drawNetworkLegendText()};this.drawNetworkLegendNodes=function(){if(this.data.legend.nodes){var g=this.data.legend.pos.nodes.x||this.curLegendX;var e=this.data.legend.pos.nodes.y||this.curLegendY;this.data.legend.pos.nodes.x=parseInt(g);this.data.legend.pos.nodes.y=parseInt(e);var n=0;var q=0;for(var j=0;j<this.data.legend.nodes.length;j++){this.data.legend.nodes[j].id=this.getLegendId("nodes",this.data.legend.nodes[j].id);var f=this.data.legend.nodes[j].color||this.nodeFontColor;var k=this.data.legend.nodes[j].shape||this.shapes[0];var r=this.data.legend.nodes[j].size?this.data.legend.nodes[j].size*this.nodeFontSize:this.nodeFontSize;var m=this.data.legend.nodes[j].font?this.data.legend.nodes[j].font*this.nodeFontSize*this.scaleNodeFontFactor:this.nodeFontSize*this.scaleNodeFontFactor;var d=(parseInt(m))+"Pt "+this.fontName;var p=this.data.legend.nodes[j].text?this.data.legend.nodes[j].text:"";var c=this.measureText(p,d);r=parseFloat(sprintf("%.1f",r));n=Math.max(n,(this.margin*3)+r+c);q=r/2;e+=q;this[k](this.margin+g+q,this.margin+e+q,f,r);this.drawText(p,(this.margin*2)+g+r,this.margin+e+q,d,this.nodeFontColor,"left","middle");e+=r}e+=this.margin+q;var b=this.data.legend.pos.nodes.x;var o=this.data.legend.pos.nodes.y;var a=n;var l=e-this.data.legend.pos.nodes.y;if(this.legendBox){this.rectangle(b,o,a,l,this.nodeFontColor,this.nodeFontColor,true)}var h=["rect",b,o,b+a,o+l];if(this.preScaleNetwork){this.addArea(h,[-1],"-legend-Nodes")}else{this.addArea(this.adjustNetworkObjects(h),[-1],"-legend-Nodes")}this.curLegendX=g;this.curLegendY=e}};this.drawNetworkLegendEdges=function(){if(this.data.legend.edges){var d=this.data.legend.pos.edges.x||this.curLegendX;var b=this.data.legend.pos.edges.y||this.curLegendY;this.data.legend.pos.edges.x=parseInt(d);this.data.legend.pos.edges.y=parseInt(b);var n=0;var m=0;for(var o=0;o<this.data.legend.edges.length;o++){this.data.legend.edges[o].id=this.getLegendId("edges",this.data.legend.edges[o].id);var l=this.data.legend.edges[o].color||this.nodeFontColor;var f=this.data.legend.edges[o].type||"line";var k=this.data.legend.edges[o].width||1;var j=this.data.legend.edges[o].size?this.data.legend.edges[o].size*this.nodeFontSize:this.nodeFontSize;var e=this.data.legend.edges[o].font?this.data.legend.edges[o].font*this.nodeFontSize*this.scaleNodeFontFactor:this.nodeFontSize*this.scaleNodeFontFactor;var h=(parseInt(e))+"Pt "+this.fontName;var g=this.data.legend.edges[o].text||"";var p=this.measureText(g,h);j=parseFloat(sprintf("%.1f",j));n=Math.max(n,(this.margin*3)+j+p);m=e/2;b+=m;this.ctx.lineWidth=k*this.edgeWidth;this.drawLine(this.margin+d,this.margin+b+m,d+j,this.margin+b+m,l,f,0,0);this.drawText(g,(this.margin*2)+d+j,this.margin+b+m,h,this.nodeFontColor,"left","middle");b+=e}b+=this.margin+m;var r=this.data.legend.pos.edges.x;var c=this.data.legend.pos.edges.y;var q=n;var a=b-this.data.legend.pos.edges.y;if(this.legendBox){this.rectangle(r,c,q,a,this.nodeFontColor,this.nodeFontColor,true)}var s=["rect",r,c,r+q,c+a];if(this.preScaleNetwork){this.addArea(s,[-1],"-legend-Edges")}else{this.addArea(this.adjustNetworkObjects(s),[-1],"-legend-Edges")}this.curLegendX=d;this.curLegendY=b}};this.drawNetworkLegendText=function(){if(this.data.legend.text){var r=0;for(var l=0;l<this.data.legend.text.length;l++){this.data.legend.text[l].id=this.getLegendId("text",this.data.legend.text[l].id);var j=this.data.legend.text[l].x||this.curLegendX;var f=this.data.legend.text[l].y||this.curLegendY;this.data.legend.text[l].x=parseInt(j);this.data.legend.text[l].y=parseInt(f);var d=this.data.legend.text[l].boxed||this.legendBox;var g=this.data.legend.text[l].margin||this.margin;var m=this.setNetworkLegendMargins(g);var h=this.data.legend.text[l].color||this.nodeFontColor;var q=this.data.legend.text[l].text||"";var o=this.data.legend.text[l].font?this.data.legend.text[l].font*this.nodeFontSize*this.scaleNodeFontFactor:this.nodeFontSize*this.scaleNodeFontFactor;o=parseInt(o);var e=(o)+"Pt "+this.fontName;var c=this.measureText(q,e);r=o/2;this.drawText(q,m[3]+j,m[0]+f+r,e,h,"left","middle");var b=this.data.legend.text[l].x;var p=this.data.legend.text[l].y;var a=m[1]+m[3]+c;var n=m[0]+m[2]+o;if(d){this.rectangle(b,p,a,n,this.nodeFontColor,this.nodeFontColor,true)}f+=m[0]+m[2]+o;var k=["rect",b,p,b+a,p+n];if(this.preScaleNetwork){this.addArea(k,[-1],"-legend-Text"+l)}else{this.addArea(this.adjustNetworkObjects(k),[-1],"-legend-Text"+l)}this.curLegendX=j;this.curLegendY=f}}};this.setNetworkLegendMargins=function(a){if(isNaN(a)){var b=a.split(/[,\s]+/);if(b.length>3){return[parseInt(b[0]),parseInt(b[1]),parseInt(b[2]),parseInt(b[3])]}else{if(b.length==3){return[parseInt(b[0]),parseInt(b[1]),parseInt(b[2]),parseInt(b[1])]}else{if(b.length==2){return[parseInt(b[0]),parseInt(b[1]),parseInt(b[0]),parseInt(b[1])]}else{return[parseInt(b[0]),parseInt(b[0]),parseInt(b[0]),parseInt(b[0])]}}}}else{return[parseInt(a),parseInt(a),parseInt(a),parseInt(a)]}};this.drawNetworkProgressBar=function(b){if(!this.layoutDone){this.ctx.save();this.ctx.fillStyle="#fff";this.ctx.strokeStyle="#fff";var a=(new Date().getTime()-this.preUpdateTime)/(this.layoutTime*1000);a=Math.max(a,this.layoutProgress);if(b){this.ctx.strokeRect((this.width/2)-50,(this.height/2)-5,100,10);this.ctx.fillRect((this.width/2)-50,(this.height/2)-5,a*100,10);this.drawText("Calculating ...",(this.width/2)-50,(this.height/2)+10,this.showAnimationFont,this.showAnimationFontColor,"left","top")}else{this.ctx.strokeRect(this.width-110,this.height-20,100,10);this.ctx.fillRect(this.width-110,this.height-20,a*100,10)}this.ctx.restore()}};this.setNetworkMinMaxRangeXY=function(){this.minX=Number.MAX_VALUE;this.minY=Number.MAX_VALUE;this.maxX=0;this.maxY=0;if(this.is3DNetwork&&this.layoutDone){for(var a=0;a<this.data.nodes.length;a++){var b=this.data.nodes[a];if(!b.hide){this.minX=Math.min(this.minX,b.x3d);this.minY=Math.min(this.minY,b.y3d);this.maxX=Math.max(this.maxX,b.x3d);this.maxY=Math.max(this.maxY,b.y3d)}}}else{for(var a=0;a<this.data.nodes.length;a++){var b=this.data.nodes[a];if(!b.hide){this.minX=Math.min(this.minX,b.x);this.minY=Math.min(this.minY,b.y);this.maxX=Math.max(this.maxX,b.x);this.maxY=Math.max(this.maxY,b.y)}}}this.minX-=(this.nodeWidth*3);this.minY-=(this.nodeWidth*3);this.maxX+=(this.nodeWidth*3);this.maxY+=(this.nodeWidth*3);this.rangeX=this.maxX-this.minX;this.rangeY=this.maxY-this.minY};this.setNetworkRotation=function(){if(this.is3DNetwork&&this.layoutDone){var e=[];var b=[];var k=[];this.set3DRotation();for(var c=0;c<this.data.nodes.length;c++){b.push(c);var a=this.data.nodes[c];var d=this.get3DTransfrom(a.x,a.y,a.z);a.x3d=d[0];a.y3d=d[1];a.z3d=d[2];e.push(Math.sqrt((a.x3d*a.x3d)+(a.y3d*a.y3d)+(a.z3d*a.z3d)))}b.sort(function(l,i){return e[i]-e[l]});for(var j=0;j<this.data.nodes.length;j++){var c=b[j];var a=this.data.nodes[c];k.push(a)}this.data.nodes=k;this.setNodeIndices()}else{if(this.network2DRotate!=0){if(this.network2DRotate>=Math.abs(360)){this.network2DRotate=0}var f=Math.PI*this.network2DRotate/360;for(var c=0;c<this.data.nodes.length;c++){var a=this.data.nodes[c];if(a.x&&a.y){var h=a.x;var g=a.y;a.x=(h*Math.cos(f))-(g*Math.sin(f));a.y=(g*Math.cos(f))+(h*Math.sin(f))}}if(this.data.legend.pos.nodes.x&&this.data.legend.pos.nodes.y){var h=this.data.legend.pos.nodes.x;var g=this.data.legend.pos.nodes.y;this.data.legend.pos.nodes.x=(h*Math.cos(f))-(g*Math.sin(f));this.data.legend.pos.nodes.y=(g*Math.cos(f))+(h*Math.sin(f))}if(this.data.legend.pos.edges.x&&this.data.legend.pos.edges.y){var h=this.data.legend.pos.edges.x;var g=this.data.legend.pos.edges.y;this.data.legend.pos.edges.x=(h*Math.cos(f))-(g*Math.sin(f));this.data.legend.pos.edges.y=(g*Math.cos(f))+(h*Math.sin(f))}if(this.data.legend.text){for(var c=0;c<this.data.legend.text.length;c++){var h=this.data.legend.text[c].x;var g=this.data.legend.text[c].y;this.data.legend.text[c].x=(h*Math.cos(f))-(g*Math.sin(f));this.data.legend.text[c].y=(g*Math.cos(f))+(h*Math.sin(f))}}this.network2DRotate=0}}};this.setNetworkScaleFactor=function(){this.scaleFactor=this.networkLayoutType=="radial"?0.3:Math.min(this.x/(this.maxX-this.minX),this.y/(this.maxY-this.minY));this.widthBounds=this.x/this.scaleFactor;this.heightBounds=this.y/this.scaleFactor;this.offsetX=(this.widthBounds/2)-((this.minX+this.maxX)/2);this.offsetY=(this.heightBounds/2)-((this.minY+this.maxY)/2)};this.optimizeNetworkLayout=function(){if(this.data.nodes.length>0){this.isAnimation=true;this.setInitialForceDirectedLayout();this.preUpdateTime=new Date().getTime();var b=this.layoutTime*1000;var a=this;var c=function(){this.update=function(){if(a.updateForceDirectedLayout(1000/30)||(b&&new Date().getTime()-a.preUpdateTime>b)){a.layoutDone=true;clearInterval(d);a.isAnimation=false}a.renderNetwork()};var d=setInterval(this.update,1000/30)};c.call()}};this.getAngle=function(e,g,c,f,d){var b=(Math.atan2(f-g,c-e)*180/Math.PI)%360;if(!d){d=0}while(b<d){b+=360}while(b>=(d+360)){b-=360}return b};this.getPolar=function(c,b){return{x:this.networkXCenter+c*Math.cos(b*Math.PI/180),y:this.networkYCenter+c*Math.sin(b*Math.PI/180)}};this.setNodePositions=function(a){for(var c in a){var b=this.data.nodes[this.data.nodeIndices[c]];b.x=a[c].x;b.y=a[c].y}};this.animateRadialNodePositions=function(){this.isAnimation=true;var a=this;var e=50;var d=0;var c=0;for(var g in a.finalRadialNodePositions){if(this.initialRadialNodePositions[g].r==0){this.initialRadialNodePositions[g].a=this.finalRadialNodePositions[g].a}if(this.finalRadialNodePositions[g].r==0){this.finalRadialNodePositions[g].a=this.initialRadialNodePositions[g].a}var b=(this.finalRadialNodePositions[g].a-this.initialRadialNodePositions[g].a);if(b<0){b+=360}if(b>360){b-=360}if(b>180){b-=360}this.finalRadialNodePositions[g].a=(this.initialRadialNodePositions[g].a+b)}var f=function(){this.update=function(){var j={};var q=Math.atan((d/e)*10-5)*0.5/Math.atan(5)+0.5;var m=1-q;for(var l in a.finalRadialNodePositions){var i=((m*a.initialRadialNodePositions[l].a)+(q*a.finalRadialNodePositions[l].a));var k=((m*a.initialRadialNodePositions[l].r)+(q*a.finalRadialNodePositions[l].r));var p=a.getPolar(k,i);j[l]={x:p.x,y:p.y}}if(d>=e){clearInterval(h);a.isAnimation=false;j=a.finalRadialNodePositions}d++;a.setNodePositions(j);a.renderNetwork()};var h=setInterval(this.update,50)};f.call()};this.setFinalRadialNodePositions=function(e,d){if(!this.finalRadialNodePositions){this.finalRadialNodePositions={}}if(!this.nodeParentHood.drawn.hasOwnProperty(e)){var m,o,g,n,b;var f=this.data.nodes[this.data.nodeIndices[e]];if(!f.hide&&!f.hiddenParent){if(this.nodeParentHood[e].children.length>1&&!d){var k=[];var h=this;if(this.orderRadialNetwork){this.nodeParentHood[e].children.sort(function(i,c){return h.orderRadialNetwork[i]-h.orderRadialNetwork[c]})}for(var j=0;j<this.nodeParentHood[e].children.length;j++){if(this.nodeParentHood[this.nodeParentHood[e].children[j]].level>this.nodeParentHood[e].level){this.setFinalRadialNodePositions(this.nodeParentHood[e].children[j]);k.push(this.nodeParentHood[this.nodeParentHood[e].children[j]].angle)}}if(k.length>0){if(k.length==1){n=k[0]}else{if(k[0]>k[k.length-1]){n=((k[0]+k[k.length-1])%360)/2}else{n=(k[0]+k[k.length-1])/2}}}else{this.setFinalRadialNodePositions(e,true)}}else{n=this.networkCurrentAngle;this.networkCurrentAngle=(this.networkCurrentAngle+this.networkAngleStep)}g=(this.networkDepth-1)-this.nodeParentHood[e].level;m=this.getPolar(this.networkRadialRadius,n);o=this.shortenLine(this.networkXCenter,this.networkYCenter,m.x,m.y,0,this.networkLevelSize*g,"line");b=this.lineLength(this.networkXCenter,this.networkYCenter,o[2],o[3]);if(this.nodeParentHood[e].level==0){n=0;b=0}this.finalRadialNodePositions[f.id]={x:o[2],y:o[3],r:b,a:n%360};this.nodeParentHood.drawn[e]=true;this.nodeParentHood[e].angle=n}}};this.setInitialRadialNodePositions=function(){if(!this.initialRadialNodePositions){this.initialRadialNodePositions={};for(var a=0;a<this.data.nodes.length;a++){if(!this.data.nodes[a].hide&&!this.data.nodes[a].hiddenParent){var b=this.data.nodes[a];this.initialRadialNodePositions[b.id]={x:this.networkXCenter,y:this.networkYCenter,r:0,a:0}}}}else{this.initialRadialNodePositions=this.finalRadialNodePositions;this.finalRadialNodePositions=false}};this.setRadialNetwrorkLayout=function(){if(this.data.nodes.length>0){this.networkLevelSize=this.x*4/(this.networkDepth*2);this.networkAngleStep=360/this.networkDivisions;this.networkCurrentAngle=this.networkCurrentAngle?this.networkCurrentAngle:0;this.networkRadialRadius=this.networkLevelSize*(this.networkDepth-1);this.setInitialRadialNodePositions();this.setFinalRadialNodePositions(this.networkRoot);this.layoutDone=true;if(this.showAnimation){this.animateRadialNodePositions()}else{this.setNodePositions(this.finalRadialNodePositions);this.renderNetwork()}}};this.createRandomNetwork=function(t){var l={};var a={};if(t){l=this.createMesh()}else{l.nodes=[];var d=Math.floor(Math.random()*this.randomNetworkNodes)+1;for(var m=0;m<d;m++){var g={};var r=Math.floor(Math.random()*this.shapes.length);var e=Math.floor(Math.random()*this.colors.length);g.id="id"+m;g.shape=this.shapes[r];g.color=this.colors[e];g.size=1;l.nodes.push(g)}l.edges=[];for(var m=0;m<l.nodes.length;m++){var f=l.nodes[m];var k=[];for(var h=0;h<Math.floor(Math.random()*this.randomNetworkNodeEdgesMax)-1;h++){k.push(Math.floor(Math.random()*d))}for(var h=0;h<k.length;h++){var c=l.nodes[k[h]];var q=m+":"+k[h];var p=k[h]+":"+m;if(f.id!=c.id&&!a.hasOwnProperty(q)&&!a.hasOwnProperty(q)){var b={};var s=Math.floor(Math.random()*this.lines.length);var e=Math.floor(Math.random()*this.colors.length);b.id1=f.id;b.id2=c.id;b.width=1;b.type=this.lines[s];b.color=this.colors[e];l.edges.push(b);a[q]=1;a[p]=1}}}}if(this.reduceRandomNetwork){var o=this.normalizeGraph(l);l=this.reduceNetwork(o,function(j,i){if(j.nodes&&i.nodes){if(j.nodes.length>=i.nodes.length){return j}else{return i}}else{if(j.nodes){return j}else{if(i.nodes){return i}else{return null}}}})}if(l.nodes.length<5){return this.createRandomNetwork(true)}else{var k=[];for(var m=0;m<l.edges.length;m++){if(l.edges[m].id1&&l.edges[m].id2){k.push(l.edges[m])}}l.edges=k;return l}};this.createMesh=function(){var f={};f.nodes=[];f.edges=[];var e=7;var a=this;for(var h=0;h<e*e;h++){var c={};var g=Math.floor(Math.random()*this.shapes.length);var b=Math.floor(Math.random()*this.colors.length);c.id="id"+h;c.shape=this.shapes[g];c.color=this.colors[b];c.size=1;f.nodes.push(c)}var d=function(m,l){var k={};var i=Math.floor(Math.random()*a.lines.length);var j=Math.floor(Math.random()*a.colors.length);k.id1=f.nodes[m].id;k.id2=f.nodes[l].id;k.width=1;k.type=a.lines[i];k.color=a.colors[j];return k};for(var h=0;h<f.nodes.length;h++){if(Math.floor(Math.random()*e)!=0){if(h+1<f.nodes.length&&(h+1)%e!=0){f.edges.push(d(h,h+1))}if(h+e<f.nodes.length){f.edges.push(d(h,h+e))}}}return f};this.setNodeChildren=function(f,b,g){this.networkDepth=b>this.networkDepth?b:this.networkDepth;var d=this.data.nodes[this.data.nodeIndices[f]];if(!d.hide&&!d.hiddenParent){var a=this.edgesForNode(this.data.edges,f);if(!this.nodeParentHood.hasOwnProperty(f)){if(a.length==1){this.networkDivisions++}if(a.length>0){for(var c=0;c<a.length;c++){if(!this.nodeParentHood[f]){this.nodeParentHood[f]={};this.nodeParentHood[f].children=[];this.nodeParentHood[f].level=b;this.nodeParentHood[f].angle=0;this.nodeParentHood[f].parent=g}this.nodeParentHood[f].level=b<this.nodeParentHood[f].level?b:this.nodeParentHood[f].level;if(a[c].id1==f){this.nodeParentHood[f].children.push(a[c].id2);this.setNodeChildren(a[c].id2,b+1,f)}else{if(a[c].id2==f){this.nodeParentHood[f].children.push(a[c].id1);this.setNodeChildren(a[c].id1,b+1,f)}}}}}else{this.nodeParentHood[f].level=b<this.nodeParentHood[f].level?b:this.nodeParentHood[f].level;for(var c=0;c<this.nodeParentHood[f].children.length;c++){var e=this.nodeParentHood[f].children[c];if(this.nodeParentHood[e]){if((b+1)<this.nodeParentHood[e].level){this.nodeParentHood[e].level=b+1;this.nodeParentHood[e].parent=f}}}}}};this.setNodeParentHood=function(){this.nodeParentHood={};if(this.networkLayoutType=="radial"){if(!this.networkRoot){this.networkRoot=this.data.nodes[0].id}this.nodeParentHood.drawn={};this.networkDepth=0;this.networkDivisions=0;this.setNodeChildren(this.networkRoot,0,false)}else{for(var a=0;a<this.data.nodes.length;a++){if(!this.data.nodes[a].hide){if(this.data.nodes[a].parentNode||this.data.nodes[a].hideChildren){if(this.data.nodes[a].parentNode&&!this.nodeParentHood.hasOwnProperty(this.data.nodes[a].parentNode)){this.nodeParentHood[this.data.nodes[a].parentNode]={}}if(this.data.nodes[a].parentNode){if(!this.nodeParentHood[this.data.nodes[a].parentNode].children){this.nodeParentHood[this.data.nodes[a].parentNode].children=[]}this.nodeParentHood[this.data.nodes[a].parentNode].children.push(this.data.nodes[a].id);if(this.data.nodes[this.data.nodeIndices[this.data.nodes[a].parentNode]].hideChildren){this.data.nodes[a].hiddenParent=true}}if(this.data.nodes[a].hideChildren){if(!this.nodeParentHood.hasOwnProperty(this.data.nodes[a].id)){this.nodeParentHood[this.data.nodes[a].id]={}}this.nodeParentHood[this.data.nodes[a].id].hideChildren=true}}}}for(var b in this.nodeParentHood){if(this.data.nodes[this.data.nodeIndices[b]].hideChildren||this.isParentHidden(b)){this.hideUnhideChildrenNodes(b,true)}else{if(this.nodeParentHood[b].children){this.hideUnhideChildrenNodes(b,false)}}}}};this.isParentHidden=function(c){var b=this.findParentNodes(c);if(b){for(var a=0;a<b.length;a++){if(this.data.nodes[this.data.nodeIndices[b[a]]].hideChildren){return true}}}return false};this.findParentNodes=function(c,a){if(this.data.nodes[this.data.nodeIndices[c]].parentNode){var b=this.data.nodes[this.data.nodeIndices[c]].parentNode;if(!a){a=[]}a.push(b);a=this.findParentNodes(b,a);return a}else{return a?a.reverse():false}};this.findChildrenNodeIndices=function(c,b){if(!b){b=[]}if(this.nodeParentHood[c]&&this.nodeParentHood[c]["children"]){for(var a=0;a<this.nodeParentHood[c]["children"].length;a++){b.push(this.data.nodeIndices[this.nodeParentHood[c]["children"][a]]);b=this.findChildrenNodeIndices(this.nodeParentHood[c]["children"][a],b)}}return b.length>0?b:false};this.hasChildren=function(a){return this.nodeParentHood[a]&&this.nodeParentHood[a].children};this.findVisibleParentNode=function(c){var b=this.findParentNodes(c);if(b){b.reverse();for(var a=0;a<b.length;a++){if(!this.nodes[b[a]].hide&&!this.nodes[b[a]].hiddenParent){return this.nodes[b[a]]}}}return false};this.collateNetworks=function(){if(this.data.nodes.length>0){var b=this.normalizeGraph({nodes:this.data.nodes,edges:this.data.edges});if(b.length>1){var e={id:"canvasXpressAnchorNode",anchor:true};this.addNode(e);for(var c=0;c<b.length;c++){var a=b[c].nodes[0];var d={id1:"canvasXpressAnchorNode",id2:a.id,anchor:true};this.addEdge(d)}}}};this.setObjectAttributes=function(){if(this.colorNodeBy){this.setAllObjectAttributes("nodes","color",this.colorNodeBy)}if(this.shapeNodeBy){this.setAllObjectAttributes("nodes","shape",this.shapeNodeBy)}if(this.sizeNodeBy){this.setAllObjectAttributes("nodes","size",this.sizeNodeBy)}if(this.colorEgdeBy){this.setAllObjectAttributes("egdes","color",this.colorEgdeBy)}if(this.shapeEgdeBy){this.setAllObjectAttributes("egdes","shape",this.shapeEgdeBy)}if(this.sizeEgdeBy){this.setAllObjectAttributes("egdes","size",this.sizeEgdeBy)}};this.drawNetworkPlot=function(){this.showAnimationFont=(this.showAnimationFontSize)+"Pt "+this.fontName;this.setNodeParentHood();this.setObjectAttributes();if(this.calculateLayout&&!this.layoutDone){this.collateNetworks();this.setNetworkPrivateParams();if(this.networkLayoutType=="radial"){this.setRadialNetwrorkLayout()}else{this.optimizeNetworkLayout()}}else{this.layoutDone=true;this.renderNetwork()}};this.initializeNetwork=function(){this.setNetworkDimensions();if(!this.nodes&&this.data.nodes){this.setNodes()}if(this.randomNetwork){var a=this.createRandomNetwork();this.data.nodes=a.nodes;this.data.edges=a.edges;this.setAllNodesVisible();this.setNodes();this.layoutDone=false}this.drawNetworkPlot()};this.initializeNetwork()};CanvasXpress.prototype.Genome=function(){this.setGenomeSubtracks=function(){this.subtracks=[];this.y=this.margin*2;var e=0;for(var k=0;k<this.data.tracks.length;k++){if(this.data.tracks[k].name){this.y+=this.getFontPt(this.trackNameFont)+(this.margin*2)}var c=this.data.tracks[k];var o=c.data.length>this.showFeatureNameThereshold||c.hide?false:true;var m=c.type?c.type:"line";var b=c.width?c.width:this.featureWidthDefault;var p=c.height?c.height:this.featureHeightDefault;this.subtracks[k]={features:[],cur:[]};this.subtracks[k].cur[0]=-3;this.subtracks[k].features[0]=[];if(o){this.y+=this.getFontPt(this.featureNameFont)+this.margin}this.y+=p+this.margin;for(var g=0;g<c.data.length;g++){var d=0;var a,f;var q=c.data[g];var l=this.measureText(q.id,this.featureNameFont);var h=q.data;q.counter=e++;if(m=="box"){a=h[0][0]*this.xAxisUnit;f=h[h.length-1][1]*this.xAxisUnit}else{if(m.match(/bar|heatmap/)){a=h[0]*this.xAxisUnit;f=a+b}else{if(m=="sequence"){a=h[0]*this.xAxisUnit;f=a+(h[1].length*this.xAxisUnit)}else{a=h*this.xAxisUnit;f=a+1}}}var n=o?Math.max(a+l,f):f;while(a<(this.subtracks[k].cur[d]+2)){d++;if(!this.subtracks[k].cur[d]){if(o){this.y+=this.getFontPt(this.featureNameFont)+this.margin}this.y+=p+this.margin;this.subtracks[k].cur[d]=-3;this.subtracks[k].features[d]=[]}}this.subtracks[k].features[d].push(g);this.subtracks[k].cur[d]=n}this.y+=this.margin*2}};this.getGenomeRange=function(a){var e=[];for(var c=0;c<a.length;c++){var d=a[c].data;for(var b=1;b<d.length;b++){e.push(d[b])}}return this.range(e)};this.plotGenomeData=function(){var x,W,w,v;var D=this.getFontPt(this.trackNameFont);var J=this.getFontPt(this.featureNameFont);var b=this.top+(this.margin*2);for(var R=0;R<this.data.tracks.length;R++){var y=this.left;if(this.data.tracks[R].name){this.drawText(this.data.tracks[R].name,y,b+(D/2),this.trackNameFont,this.trackNameFontColor,"left","middle");b+=D+(this.margin*2)}var C=this.cloneObject(this.data.tracks[R]);var m=C.data.length>this.showFeatureNameThereshold||C.hide?false:true;var V=C.type?C.type:"line";var f=C.height?C.height:this.featureHeightDefault;var z=C.fills?C.fills:C.fill?C.fill:this.foreground;var E=C.lines?C.lines:C.line?C.line:this.foreground;var q=V.match(/bar|heatmap/)?this.getGenomeRange(C.data):false;for(var Q=0;Q<this.subtracks[R].features.length;Q++){var t=this.subtracks[R].features[Q];for(var P=0;P<t.length;P++){var U=t[P];var I=C.data[U];var T=I.data;var u=I.id;if(V=="box"){if(T.length>0){y=this.left+((T[0][0]-this.xAxisMin)*this.xAxisUnit);if(m){this.drawText(u,y,b+(J/2),this.featureNameFont,this.featureNameFontColor,"left","middle");b+=J+this.margin}this.addArea(["rect",y,b,((T[T.length-1][1]-this.xAxisMin)*this.xAxisUnit),b+f],[I.counter]);var B=Math.floor(f*this.xAxisUnit);if(I.dir=="right"){x=(T[T.length-1][1]-this.xAxisMin)*this.xAxisUnit;if(x-B<(T[T.length-1][0]-this.xAxisMin)*this.xAxisUnit){T.pop()}else{T[T.length-1][1]-=f}y=this.left+((T[T.length-1][0]-this.xAxisMin)*this.xAxisUnit);W=b+(f/2);this.lineShd(y,W,x,W,z);y=x-((f/2)*this.xAxisUnit);this.lineShd(y,b,x,W,z);this.lineShd(y,b+f,x,W,z)}else{if(I.dir=="left"){if(y+B>(T[0][1]-this.xAxisMin)*this.xAxisUnit){T.shift()}else{T[0][0]+=f}x=this.left+((T[0][0]-this.xAxisMin)*this.xAxisUnit);W=b+(f/2);this.lineShd(y,W,x,W,z);x=y+((f/2)*this.xAxisUnit);this.lineShd(y,W,x,b,z);this.lineShd(y,W,x,b+f,z)}}for(var O=0;O<T.length;O++){y=this.left+((T[O][0]-this.xAxisMin)*this.xAxisUnit);x=((T[O][1]-this.xAxisMin)*this.xAxisUnit)-y;if(C.connect){if(O<T.length-1){W=b+(f/2);w=this.left+((T[O+1][0]-this.xAxisMin)*this.xAxisUnit);v=(((T[O][1]+((T[O+1][0]-T[O][1])/2))-this.xAxisMin)*this.xAxisUnit);this.lineShd(y+x,W,v,b,z);this.lineShd(v,b,w,W,z)}}this.rectangleShd(y,b,x,f,z,E)}}}else{if(V=="bar"){var a=C.autowidth?this.xAxisUnit/(T.length-1):C.width?C.width:this.featureWidthDefault;y=this.left+((T[0]-this.xAxisMin)*this.xAxisUnit);if(m){this.drawText(u,y,b+(J/2),this.featureNameFont,this.featureNameFontColor,"left","middle");b+=J+this.margin}this.addArea(["rect",y,b,y+(T.length*a),b+f],[I.counter]);x=y;var L=q[1]-q[0];var d=q[0]-(L*0.05);if(d>0){q[0]=d;L=q[1]-q[0]}var A=f/L;var c=q[1]<0?b:q[0]>=0?b+f:(b+f)-Math.abs(q[0]*A);for(var K=1;K<T.length;K++){var G=typeof z==="object"&&z[K-1]?z[K-1]:z[0];var r=typeof E==="object"&&E[K-1]?E[K-1]:E[0];var S=T[K]*A;this.rectangleShd(x,c,a,-S,G,r);if(C.autowidth){x+=a}else{x+=a+2}}}else{if(V=="heatmap"){var a=C.autowidth?this.xAxisUnit:C.width?C.width:this.featureWidthDefault;y=this.left+((T[0]-this.xAxisMin)*this.xAxisUnit);if(m){this.drawText(u,y,b+(J/2),this.featureNameFont,this.featureNameFontColor,"left","middle");b+=J+this.margin}this.addArea(["rect",y,b,y+a,b+f],[I.counter]);var S=f/(T.length-1);var o="rgb(255,255, 0)";W=b;for(var K=1;K<T.length;K++){var F=T[K];var p=this.getHeatmapColor(q[0],q[1],F);if(isNaN(F)){this.rectangleShd(y,W,a,S,o,o)}else{this.rectangleShd(y,W,a,S,p,p)}W+=S}}else{if(V=="sequence"){var N=C.subtype;y=this.left+((T[0]-this.xAxisMin)*this.xAxisUnit);if(m){this.drawText(u,y,b+(J/2),this.featureNameFont,this.featureNameFontColor,"left","middle");b+=J+this.margin}var g=T[1].split(/ */);this.addArea(["rect",y,b,y+(g.length*this.xAxisUnit),b+J],[I.counter]);var M=0;var K=N=="DNA"?1:3;var O=this.measureText("A",this.sequenceFont)>K*this.xAxisUnit?true:false;while(g.length>0){var e=g.shift();if(e=="["){e=g.shift();var H=[];while(e!="]"){H.push(e);e=g.shift()}if(O){this.lineShd(y+(M*this.xAxisUnit),b,y+(M*this.xAxisUnit),b+J,this.sequenceMColor)}else{this.drawText(H.join("/"),y+(M*this.xAxisUnit),b+(J/2),this.sequenceFont,this.sequenceMColor,"center","middle")}M+=K}else{var p="sequence"+e.toUpperCase()+"Color";if(O){this.lineShd(y+(M*this.xAxisUnit),b,y+(M*this.xAxisUnit),b+J,this[p])}else{this.drawText(e,y+(M*this.xAxisUnit),b+(J/2),this.sequenceFont,this[p],"center","middle")}M+=K}}}else{if(V=="triangle"){y=this.left+((T-this.xAxisMin)*this.xAxisUnit);if(m){this.drawText(u,y,b+(J/2),this.featureNameFont,this.featureNameFontColor,"left","middle");b+=J+this.margin}this.addArea(this.triangle(y,b+(f/2),z,f,false,E),[I.counter])}else{y=this.left+((T-this.xAxisMin)*this.xAxisUnit);if(m){this.drawText(u,y,b+(J/2),this.featureNameFont,this.featureNameFontColor,"left","middle");b+=J+this.margin}this.addArea(this.lineShd(y,b,y,b+f,E),[I.counter])}}}}}if(m){b-=(J+this.margin)}}if(m){b+=J+this.margin}b+=f+this.margin}b+=(this.margin*2)}};this.setGenomeWireFrame=function(){var c=this.getFontPt(this.featureNameFont)/2;if(this.xAxisTickStyle=="dotted"){this.dottedLine(this.left,this.top,this.left,this.top+this.y,this.wireColor)}else{this.line(this.left,this.top,this.left,this.top+this.y,this.wireColor)}for(var b=0;b<this.xAxisValues.length;b++){var d=parseFloat(this.xAxisValues[b]);var a=this.left+((d-this.xAxisMin)*this.xAxisUnit);if(this.xAxisTickStyle=="dotted"){this.dottedLine(a,this.top,a,this.top+this.y,this.wireColor)}else{this.line(a,this.top,a,this.top+this.y,this.wireColor)}if(!((b+(this.periodTicksLabels+1))%this.periodTicksLabels)){this.drawText(parseInt(d),a,this.top+this.y+this.margin+c,this.featureNameFont,this.xAxisTickColor,"center","middle")}}if(this.xAxisTickStyle=="dotted"){this.dottedLine(this.left+this.x,this.top,this.left+this.x,this.top+this.y,this.wireColor)}else{this.line(this.left+this.x,this.top,this.left+this.x,this.top+this.y,this.wireColor)}};this.setGenomeAxisUnits=function(){this.setAxisUnits("xAxis")};this.setGenomeFontsColors=function(){this.trackNameFont=(this.trackNameFontSize)+"Pt "+this.fontName;this.featureNameFont=(this.featureNameFontSize)+"Pt "+this.fontName;this.sequenceFont=(this.sequenceFontSize)+"Pt "+this.fontName;if(!this.wireColor.match(/,0.1\)$/)){this.wireColor=this.wireColor.replace(/\)$/,",0.1)")}};this.setGenomeDimentions=function(){this.bottom+=this.margin+this.getFontPt(this.featureNameFont);if(this.width){this.x=this.width-(this.left+this.right)}else{this.width=this.left+this.x+this.right}this.height=this.top+this.y+this.bottom;this.resizeCanvas()};this.drawGenome=function(){this.setGenomeDimentions();this.setGenomeFontsColors();this.setGenomeAxisUnits();this.setGenomeSubtracks();this.setGenomeWireFrame();this.plotGenomeData()};this.initializeGenome=function(){this.drawGenome()};this.initializeGenome()};